<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Python API Reference - ProxyWhirl Documentation</title><link rel="shortcut icon" href="../_static/favicon.svg"/><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Configuration Reference" href="configuration.html" /><link rel="prev" title="ProxyWhirl REST API Usage Guide" href="rest-api.html" />
      <link rel="canonical" href="https://www.proxywhirl.com/docs/reference/python-api.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=44020203" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=b31b09b0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://www.proxywhirl.com/docs/reference/python-api.html"/>
  <meta property="og:title" content="Python API Reference"/>
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@wyaborern"/>
<meta name="twitter:site" content="@wyaborern"/>
  </head>
<body>
<a class="skip-link" href="#main-content">Skip to content</a>
<header class="pw-navbar">
  <div class="pw-navbar-inner">
    
    <button class="pw-navbar-sidebar-toggle js-menu" aria-controls="lside" aria-expanded="false" aria-label="Toggle navigation" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
    </button>

    
    <a href="../index.html" class="pw-navbar-brand">
      <svg class="pw-navbar-logo" viewBox="0 0 100 100" aria-hidden="true">
        <defs>
          <linearGradient id="pw-logo-grad" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#06b6d4"/>
            <stop offset="50%" stop-color="#3b82f6"/>
            <stop offset="100%" stop-color="#8b5cf6"/>
          </linearGradient>
        </defs>
        <circle cx="50" cy="50" r="44" fill="none" stroke="url(#pw-logo-grad)" stroke-width="6" stroke-linecap="round" stroke-dasharray="60 30"/>
        <g fill="url(#pw-logo-grad)">
          <path d="M50 18 L58 30 L52 30 L52 42 L48 42 L48 30 L42 30 Z"/>
          <path d="M82 50 L70 58 L70 52 L58 52 L58 48 L70 48 L70 42 Z"/>
          <path d="M50 82 L42 70 L48 70 L48 58 L52 58 L52 70 L58 70 Z"/>
          <path d="M18 50 L30 42 L30 48 L42 48 L42 52 L30 52 L30 58 Z"/>
        </g>
        <circle cx="50" cy="50" r="8" fill="url(#pw-logo-grad)"/>
      </svg>
      <strong>ProxyWhirl</strong>
    </a>

    
    <nav class="pw-navbar-links" aria-label="Main navigation">
      <a href="../getting-started/index.html" class="pw-navbar-link" data-section="getting-started">
        Getting Started
      </a>
      <a href="../guides/index.html" class="pw-navbar-link" data-section="guides">
        Guides
      </a>
      <a href="index.html" class="pw-navbar-link" data-section="reference">
        Reference
      </a>
      <a href="../project/index.html" class="pw-navbar-link" data-section="project">
        Project
      </a>
    </nav>

    
    <div class="pw-navbar-actions">
      
      <button class="pw-navbar-btn" id="pw-theme-toggle" type="button" aria-label="Toggle theme" aria-pressed="false">
        <svg class="pw-icon-sun" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
        <svg class="pw-icon-moon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
      </button>

      
      <a href="https://github.com/wyattowalsh/proxywhirl" class="pw-navbar-btn pw-navbar-github" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
      </a>
    </div>
  </div>
</header>
<div id="main-content"></div>

<script>
(function() {
  /* Theme toggle */
  var toggle = document.getElementById('pw-theme-toggle');
  if (toggle) {
    /* Set initial aria-pressed based on current theme */
    var currentlyDark = document.documentElement.classList.contains('dark');
    toggle.setAttribute('aria-pressed', currentlyDark ? 'true' : 'false');

    toggle.addEventListener('click', function() {
      var isDark = document.documentElement.classList.contains('dark');
      var next = isDark ? 'light' : 'dark';
      localStorage._theme = next;
      if (typeof setColorMode === 'function') {
        setColorMode(next);
      } else {
        var html = document.documentElement;
        html.classList.remove('dark', 'light');
        html.classList.add(next);
        html.setAttribute('data-color-mode', next);
      }
      toggle.setAttribute('aria-pressed', next === 'dark' ? 'true' : 'false');
    });
  }

  /* Active nav link detection — highlight current section */
  var path = window.location.pathname;
  var links = document.querySelectorAll('.pw-navbar-link[data-section]');
  links.forEach(function(link) {
    var section = link.getAttribute('data-section');
    if (path.indexOf('/' + section) !== -1) {
      link.classList.add('active');
    }
  });
  /* Mark home page — none active, or all inactive is fine */
})();
</script>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="2"><ul class="current">
<li class="toctree-l1 _expand"><a class="reference internal" href="../getting-started/index.html">Getting Started</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#what-youll-build">What You&#8217;ll Build</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#installation">Installation</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#quick-start">Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#basic-usage-sync">Basic Usage (sync)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#async-usage">Async Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#context-manager-pattern">Context Manager Pattern</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#authenticated-proxies">Authenticated Proxies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#using-free-proxy-lists">Using Free Proxy Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#fetching-proxies-programmatically">Fetching Proxies Programmatically</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#choosing-a-rotation-strategy">Choosing a Rotation Strategy</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#configuring-retry-and-circuit-breakers">Configuring Retry and Circuit Breakers</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#monitoring-your-pool">Monitoring Your Pool</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#next-steps">Next Steps</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#for-contributors">For Contributors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/rotation-strategies.html">Rotation Strategies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#bootstrap-a-rotator">Bootstrap a Rotator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#decision-matrix">Decision Matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#quick-pick-guide">Quick-Pick Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#strategy-reference">Strategy Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#comparison-at-a-glance">Comparison At a Glance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#hot-swapping-strategies">Hot-Swapping Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#observe-the-pool">Observe the Pool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#building-a-custom-strategy">Building a Custom Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#further-reading">Further Reading</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../guides/index.html">Guides</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/index.html#choosing-a-guide">Choosing a Guide</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/index.html#client-concurrency">Client &amp; Concurrency</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/index.html#resilience-caching">Resilience &amp; Caching</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/index.html#operations-deployment">Operations &amp; Deployment</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/index.html#automation-ai">Automation &amp; AI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html">Async Client Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#when-to-use-async-vs-sync">When to Use Async vs Sync</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#initialization">Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#context-manager-usage">Context Manager Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#http-request-methods">HTTP Request Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#proxy-management">Proxy Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#hot-swapping-strategies">Hot-Swapping Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#error-handling">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#concurrent-requests-with-asyncio-gather">Concurrent Requests with asyncio.gather</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#performance-considerations">Performance Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#asyncio-integration-patterns">Asyncio Integration Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#comparison-async-vs-sync">Comparison: Async vs Sync</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#best-practices-and-common-patterns">Best Practices and Common Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html">Advanced Rotation Strategies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#performance-based-strategy">Performance-Based Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#session-persistence-strategy">Session Persistence Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#geo-targeted-strategy">Geo-Targeted Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#cost-aware-strategy">Cost-Aware Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#composite-strategy">Composite Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#strategy-registry">Strategy Registry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#selectioncontext">SelectionContext</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#strategyconfig">StrategyConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#custom-strategy-implementation">Custom Strategy Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#strategyregistry-usage">StrategyRegistry Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id16">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#testing-strategies">Testing Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#performance-benchmarks">Performance Benchmarks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html">Caching Subsystem Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#architecture-overview">Architecture Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#core-components">Core Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#credential-encryption">Credential Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#ttl-and-expiration">TTL and Expiration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#health-invalidation">Health Invalidation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#migration-from-jsonl-l2-cache">Migration from JSONL L2 Cache</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#cache-warming">Cache Warming</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#performance-tuning">Performance Tuning</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#cli-integration">CLI Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#example-complete-cache-setup">Example: Complete Cache Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html">Retry &amp; Failover Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#architecture-overview">Architecture Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#when-to-use-retry-vs-failover">When to Use Retry vs Failover</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#retrypolicy-configuration">RetryPolicy Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#circuit-breaker-configuration">Circuit Breaker Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#intelligent-proxy-selection">Intelligent Proxy Selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#retrymetrics-and-observability">RetryMetrics and Observability</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#retryexecutor-deep-dive">RetryExecutor Deep Dive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#integration-with-proxywhirl">Integration with ProxyWhirl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#advanced-patterns">Advanced Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#performance-impact">Performance Impact</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#see-also">See Also</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/deployment-security.html">Deployment Security &amp; Reverse Proxy Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#x-forwarded-for-security">X-Forwarded-For Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#reverse-proxy-configurations">Reverse Proxy Configurations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#proxywhirl-configuration">ProxyWhirl Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#security-checklist">Security Checklist</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/cli-reference.html">CLI Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#global-options">Global Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#commands">Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#output-formats">Output Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#configuration-file">Configuration File</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#advanced-usage">Advanced Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#exit-codes">Exit Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/automation.html">Automation &amp; CI/CD Runbook</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#pre-flight-checks">Pre-flight Checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#github-actions-ci-pipeline">GitHub Actions CI Pipeline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#cron-based-proxy-fetching">Cron-Based Proxy Fetching</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#docker-deployment">Docker Deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#integration-testing-patterns">Integration Testing Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#smoke-tests-for-docs-examples">Smoke Tests for Docs Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#automating-releases">Automating Releases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#docsearch-credentials">DocSearch Credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#ci-stage-summary">CI Stage Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html">MCP Server Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#quick-start">Quick Start</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#the-proxywhirl-tool">The <code class="docutils literal notranslate"><span class="pre">proxywhirl</span></code> Tool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#resources">Resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#prompts">Prompts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#authentication">Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#progress-reporting">Progress Reporting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#transport-options">Transport Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#integration-with-claude-desktop">Integration with Claude Desktop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#programmatic-usage">Programmatic Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#lifecycle-management">Lifecycle Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#error-handling">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Reference</a><ul class="current">
<li class="toctree-l2 _expand"><a class="reference internal" href="index.html#quick-lookup">Quick Lookup</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="index.html#api-surfaces">API Surfaces</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="index.html#configuration-error-handling">Configuration &amp; Error Handling</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#subsystem-apis">Subsystem APIs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="rest-api.html">ProxyWhirl REST API Usage Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#getting-started">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#authentication">Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#middleware">Middleware</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#endpoint-reference">Endpoint Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#rate-limiting">Rate Limiting</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#error-handling">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#performance-tips">Performance Tips</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#security-best-practices">Security Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#deployment-examples">Deployment Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#x-forwarded-for-security-checklist">X-Forwarded-For Security Checklist</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#security-references">Security References</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#see-also">See Also</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#support">Support</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Python API Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#core-classes">Core Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rotation-strategies">Rotation Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-models">Data Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cache-components">Cache Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="#retry-failover">Retry &amp; Failover</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parsers">Parsers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#utility-functions">Utility Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enumerations">Enumerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#built-in-proxy-sources">Built-in Proxy Sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exceptions">Exceptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#type-annotations">Type Annotations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#version">Version</a></li>
<li class="toctree-l4"><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html">Configuration Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#configuration-discovery">Configuration Discovery</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#toml-configuration-format">TOML Configuration Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#configuration-classes">Configuration Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#programmatic-configuration">Programmatic Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#validation-rules">Validation Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#security-best-practices">Security Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#configuration-examples">Configuration Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#migration-from-legacy-config">Migration from Legacy Config</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html">Exceptions Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#exception-hierarchy">Exception Hierarchy</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#proxyerrorcode-enum">ProxyErrorCode Enum</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#utility-functions">Utility Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#error-codes">Error Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#exception-reference">Exception Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#error-handling-patterns">Error Handling Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cache-api.html">Cache API Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#data-models">Data Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#tier-implementations">Tier Implementations</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#utilities">Utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#usage-examples">Usage Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#performance-considerations">Performance Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#thread-safety">Thread Safety</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#error-handling">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rate-limiting-api.html">Rate Limiting API Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#core-classes">Core Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#data-models">Data Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#usage-examples">Usage Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#thread-safety">Thread Safety</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#performance-considerations">Performance Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#integration-with-monitoring">Integration with Monitoring</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#sphinx-integration">Sphinx Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#common-patterns">Common Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#faq">FAQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../project/index.html">Project</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#development-setup">Development Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#clone-install">Clone &amp; Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#verify-installation">Verify Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#make-commands">Make Commands</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#contributing">Contributing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#workflow">Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#branch-naming">Branch Naming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#commit-convention">Commit Convention</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#code-style">Code Style</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#pre-commit-hooks">Pre-commit Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#testing-guidelines">Testing Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#extending-with-custom-strategies">Extending with Custom Strategies</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#ci-cd-pipelines">CI/CD Pipelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#quality-gate-pipeline">Quality Gate Pipeline</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#architecture">Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#module-map">Module Map</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#key-exports">Key Exports</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#current-health">Current Health</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#changelog-highlights">Changelog Highlights</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#recent">Recent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#phase-completion-status">Phase Completion Status</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#license">License</a></li>
</ul>
</li>
</ul>
        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#core-classes">Core Classes</a><ul>
<li><a class="reference internal" href="#proxywhirl">ProxyWhirl</a></li>
<li><a class="reference internal" href="#asyncproxywhirl">AsyncProxyWhirl</a></li>
<li><a class="reference internal" href="#proxyfetcher">ProxyFetcher</a></li>
<li><a class="reference internal" href="#proxyvalidator">ProxyValidator</a></li>
<li><a class="reference internal" href="#browserrenderer">BrowserRenderer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rotation-strategies">Rotation Strategies</a><ul>
<li><a class="reference internal" href="#roundrobinstrategy">RoundRobinStrategy</a></li>
<li><a class="reference internal" href="#randomstrategy">RandomStrategy</a></li>
<li><a class="reference internal" href="#weightedstrategy">WeightedStrategy</a></li>
<li><a class="reference internal" href="#leastusedstrategy">LeastUsedStrategy</a></li>
<li><a class="reference internal" href="#performancebasedstrategy">PerformanceBasedStrategy</a></li>
<li><a class="reference internal" href="#sessionpersistencestrategy">SessionPersistenceStrategy</a></li>
<li><a class="reference internal" href="#geotargetedstrategy">GeoTargetedStrategy</a></li>
<li><a class="reference internal" href="#costawarestrategy">CostAwareStrategy</a></li>
<li><a class="reference internal" href="#compositestrategy">CompositeStrategy</a></li>
<li><a class="reference internal" href="#strategyregistry">StrategyRegistry</a></li>
<li><a class="reference internal" href="#strategystate">StrategyState</a></li>
<li><a class="reference internal" href="#proxymetrics">ProxyMetrics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data-models">Data Models</a><ul>
<li><a class="reference internal" href="#proxy">Proxy</a></li>
<li><a class="reference internal" href="#proxypool">ProxyPool</a></li>
<li><a class="reference internal" href="#proxychain">ProxyChain</a></li>
<li><a class="reference internal" href="#proxycredentials">ProxyCredentials</a></li>
<li><a class="reference internal" href="#proxyconfiguration">ProxyConfiguration</a></li>
<li><a class="reference internal" href="#selectioncontext">SelectionContext</a></li>
<li><a class="reference internal" href="#strategyconfig">StrategyConfig</a></li>
<li><a class="reference internal" href="#session">Session</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cache-components">Cache Components</a><ul>
<li><a class="reference internal" href="#cachemanager">CacheManager</a></li>
<li><a class="reference internal" href="#cachehealthstatus">CacheHealthStatus</a></li>
<li><a class="reference internal" href="#healthmonitor">HealthMonitor</a></li>
<li><a class="reference internal" href="#sourcestats">SourceStats</a></li>
<li><a class="reference internal" href="#hourlyaggregate">HourlyAggregate</a></li>
<li><a class="reference internal" href="#circuitbreakerevent">CircuitBreakerEvent</a></li>
<li><a class="reference internal" href="#cacheconfig">CacheConfig</a></li>
<li><a class="reference internal" href="#cacheentry">CacheEntry</a></li>
<li><a class="reference internal" href="#cachestatistics">CacheStatistics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#retry-failover">Retry &amp; Failover</a><ul>
<li><a class="reference internal" href="#retrypolicy">RetryPolicy</a></li>
<li><a class="reference internal" href="#retryexecutor">RetryExecutor</a></li>
<li><a class="reference internal" href="#circuitbreaker">CircuitBreaker</a></li>
<li><a class="reference internal" href="#retrymetrics">RetryMetrics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#parsers">Parsers</a><ul>
<li><a class="reference internal" href="#jsonparser">JSONParser</a></li>
<li><a class="reference internal" href="#csvparser">CSVParser</a></li>
<li><a class="reference internal" href="#plaintextparser">PlainTextParser</a></li>
<li><a class="reference internal" href="#htmltableparser">HTMLTableParser</a></li>
</ul>
</li>
<li><a class="reference internal" href="#utility-functions">Utility Functions</a><ul>
<li><a class="reference internal" href="#configure-logging">configure_logging</a></li>
<li><a class="reference internal" href="#is-valid-proxy-url">is_valid_proxy_url</a></li>
<li><a class="reference internal" href="#parse-proxy-url">parse_proxy_url</a></li>
<li><a class="reference internal" href="#validate-proxy-model">validate_proxy_model</a></li>
<li><a class="reference internal" href="#encrypt-credentials-decrypt-credentials">encrypt_credentials / decrypt_credentials</a></li>
<li><a class="reference internal" href="#proxy-to-dict">proxy_to_dict</a></li>
<li><a class="reference internal" href="#create-proxy-from-url">create_proxy_from_url</a></li>
<li><a class="reference internal" href="#deduplicate-proxies">deduplicate_proxies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#enumerations">Enumerations</a><ul>
<li><a class="reference internal" href="#healthstatus">HealthStatus</a></li>
<li><a class="reference internal" href="#proxysource">ProxySource</a></li>
<li><a class="reference internal" href="#proxyformat">ProxyFormat</a></li>
<li><a class="reference internal" href="#rendermode">RenderMode</a></li>
<li><a class="reference internal" href="#validationlevel">ValidationLevel</a></li>
<li><a class="reference internal" href="#backoffstrategy">BackoffStrategy</a></li>
<li><a class="reference internal" href="#circuitbreakerstate">CircuitBreakerState</a></li>
</ul>
</li>
<li><a class="reference internal" href="#built-in-proxy-sources">Built-in Proxy Sources</a><ul>
<li><a class="reference internal" href="#individual-sources">Individual Sources</a></li>
<li><a class="reference internal" href="#source-collections">Source Collections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exceptions">Exceptions</a></li>
<li><a class="reference internal" href="#type-annotations">Type Annotations</a></li>
<li><a class="reference internal" href="#version">Version</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">ProxyWhirl</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">Reference</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Python API Reference</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <div class="copy-page-wrapper relative pb-4 lg:absolute lg:top-8 lg:right-6 xl:right-12">
  <div id="copy-page-trigger">
    <button
      type="button"
      class="js-copy px-3 py-1 inline-flex items-center gap-1"
      data-url="https://www.proxywhirl.com/docs/_sources/reference/python-api.md.txt"
    >
      <i class="i-lucide" data-icon="copy"></i>
      <span>Copy page</span>
    </button>
    <button class="js-menu px-2 py-1" type="button" aria-label="More actions"
      aria-haspopup="menu" aria-expanded="false" aria-controls="copy-page-content">
      <i class="i-lucide chevron-down"></i>
    </button>
  </div>
  <div id="copy-page-content" role="menu" aria-orientation="vertical" aria-hidden="true">
    <div role="presentation">
      <div class="flex flex-col" role="group">
        <button class="js-copy" type="button" role="menuitem"
          data-url="https://www.proxywhirl.com/docs/_sources/reference/python-api.md.txt">
          <span class="iconify-icon">
            <i class="i-lucide" data-icon="copy"></i>
          </span>
          <span>Copy page</span>
        </button>
        <a role="menuitem" href="https://www.proxywhirl.com/docs/_sources/reference/python-api.md.txt" target="_blank" rel="nofollow"><iconify-icon icon="bi:markdown"></iconify-icon>
            <span>View as Markdown</span></a><a role="menuitem" href="https://chatgpt.com/?hints=search&q=Read%20https%3A//www.proxywhirl.com/docs/_sources/reference/python-api.md.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:openai"></iconify-icon>
          <span>Open in ChatGPT</span>
        </a><a role="menuitem" href="https://claude.ai/new?q=Read%20https%3A//www.proxywhirl.com/docs/_sources/reference/python-api.md.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:claude"></iconify-icon>
          <span>Open in Claude</span>
        </a></div>
    </div>
  </div>
</div><article class="yue dark-code" role="main">
          <section id="python-api-reference">
<h1>Python API Reference<a class="headerlink" href="#python-api-reference" title="Link to this heading">¶</a></h1>
<p>Complete reference for ProxyWhirl’s Python API, covering all public classes, functions, and types.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For guided tutorials on using these APIs, see the <a class="reference internal" href="../guides/index.html"><span class="std std-doc">Guides</span></a> section. For async-specific patterns, see <a class="reference internal" href="../guides/async-client.html"><span class="std std-doc">Async Client</span></a>.</p>
</div>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">proxywhirl</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">proxywhirl</span><span class="o">.</span><span class="vm">__name__</span>
</span><span data-line="3"><span class="go">&#39;proxywhirl&#39;</span>
</span></pre></div>
</div>
<section id="core-classes">
<h2>Core Classes<a class="headerlink" href="#core-classes" title="Link to this heading">¶</a></h2>
<section id="proxywhirl">
<h3>ProxyWhirl<a class="headerlink" href="#proxywhirl" title="Link to this heading">¶</a></h3>
<p>Main synchronous proxy rotation class with automatic failover.</p>
<p>Provides HTTP methods (GET, POST, PUT, DELETE, PATCH) that automatically rotate through a pool of proxies with intelligent failover on connection errors.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyWhirl</span><span class="p">,</span> <span class="n">Proxy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Initialize with default round-robin strategy</span>
</span><span data-line="4"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyWhirl</span><span class="p">()</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># Initialize with specific strategy</span>
</span><span data-line="7"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyWhirl</span><span class="p">(</span>
</span><span data-line="8">    <span class="n">proxies</span><span class="o">=</span><span class="p">[</span><span class="n">proxy1</span><span class="p">,</span> <span class="n">proxy2</span><span class="p">],</span>
</span><span data-line="9">    <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;performance-based&quot;</span><span class="p">,</span>  <span class="c1"># or strategy instance</span>
</span><span data-line="10">    <span class="n">config</span><span class="o">=</span><span class="n">ProxyConfiguration</span><span class="p">(),</span>
</span><span data-line="11">    <span class="n">retry_policy</span><span class="o">=</span><span class="n">RetryPolicy</span><span class="p">(),</span>
</span><span data-line="12">    <span class="n">rate_limiter</span><span class="o">=</span><span class="kc">None</span>
</span><span data-line="13"><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Add proxies</span>
</span><span data-line="16"><span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="17"><span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">))</span>
</span><span data-line="18">
</span><span data-line="19"><span class="c1"># Make HTTP requests with automatic rotation</span>
</span><span data-line="20"><span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="21"><span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/post&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">})</span>
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># Context manager usage</span>
</span><span data-line="24"><span class="k">with</span> <span class="n">ProxyWhirl</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="25">    <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="26">    <span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The constructor accepts a limited set of strategy names. To use advanced strategies like <code class="docutils literal notranslate"><span class="pre">&quot;performance-based&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;session&quot;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&quot;geo-targeted&quot;</span></code>, pass a strategy instance directly or call <code class="docutils literal notranslate"><span class="pre">set_strategy()</span></code> after construction.</p>
</div>
<p><strong>Constructor Parameters:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">proxies</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">list[Proxy]</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Initial list of Proxy instances</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">strategy</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">RotationStrategy</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">RoundRobinStrategy()</span></code></p></td>
<td><p>Rotation strategy instance or name (<code class="docutils literal notranslate"><span class="pre">&quot;round-robin&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;random&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;weighted&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;least-used&quot;</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">config</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ProxyConfiguration</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ProxyConfiguration()</span></code></p></td>
<td><p>Configuration settings (timeout, SSL verification, etc.)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">retry_policy</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">RetryPolicy</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">RetryPolicy()</span></code></p></td>
<td><p>Retry policy configuration</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">rate_limiter</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">SyncRateLimiter</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Synchronous rate limiter for controlling request rates</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">rate_limiter</span></code> parameter accepts a <code class="docutils literal notranslate"><span class="pre">SyncRateLimiter</span></code> (not <code class="docutils literal notranslate"><span class="pre">RateLimiter</span></code>). See <a class="reference internal" href="rate-limiting-api.html"><span class="std std-doc">Rate Limiting API</span></a> for details.</p>
</div>
<p><strong>HTTP Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code> - Make GET request</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">post(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code> - Make POST request</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">put(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code> - Make PUT request</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delete(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code> - Make DELETE request</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">patch(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code> - Make PATCH request</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">head(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code> - Make HEAD request</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">options(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code> - Make OPTIONS request</p></li>
</ul>
<p><strong>Pool Management:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">add_proxy(proxy:</span> <span class="pre">Union[Proxy,</span> <span class="pre">str])</span></code> - Add a proxy to the pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remove_proxy(proxy_id:</span> <span class="pre">str)</span></code> - Remove a proxy from the pool by ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">add_chain(chain:</span> <span class="pre">ProxyChain)</span></code> - Add a proxy chain for multi-hop routing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remove_chain(chain_name:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code> - Remove a proxy chain by name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_chains()</span> <span class="pre">-&gt;</span> <span class="pre">list[ProxyChain]</span></code> - Get all registered proxy chains</p></li>
</ul>
<p><strong>Strategy Management:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">set_strategy(strategy:</span> <span class="pre">Union[RotationStrategy,</span> <span class="pre">str],</span> <span class="pre">atomic:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True)</span></code> - Hot-swap the rotation strategy without restarting (&lt;100ms). Supports all strategy names: <code class="docutils literal notranslate"><span class="pre">&quot;round-robin&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;random&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;weighted&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;least-used&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;performance-based&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;session&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;geo-targeted&quot;</span></code>. See <a class="reference internal" href="../guides/advanced-strategies.html"><span class="std std-doc">Advanced Strategies</span></a>.</p></li>
</ul>
<p><strong>Statistics &amp; Monitoring:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get_pool_stats()</span> <span class="pre">-&gt;</span> <span class="pre">dict</span></code> - Get proxy pool statistics (total, healthy, unhealthy, dead proxies)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_statistics()</span> <span class="pre">-&gt;</span> <span class="pre">dict</span></code> - Get comprehensive statistics including source breakdown</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">clear_unhealthy_proxies()</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code> - Remove unhealthy/dead proxies from pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_circuit_breaker_states()</span> <span class="pre">-&gt;</span> <span class="pre">dict[str,</span> <span class="pre">CircuitBreaker]</span></code> - Get circuit breaker states for all proxies</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reset_circuit_breaker(proxy_id:</span> <span class="pre">str)</span></code> - Manually reset a circuit breaker to CLOSED state</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_retry_metrics()</span> <span class="pre">-&gt;</span> <span class="pre">RetryMetrics</span></code> - Get retry metrics</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_queue_stats()</span> <span class="pre">-&gt;</span> <span class="pre">dict</span></code> - Get request queue statistics (if enabled)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">clear_queue()</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code> - Clear all pending requests from queue</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="asyncproxywhirl">
<h3>AsyncProxyWhirl<a class="headerlink" href="#asyncproxywhirl" title="Link to this heading">¶</a></h3>
<p>Async proxy rotator with automatic failover and intelligent rotation.</p>
<p>Provides async HTTP methods that automatically rotate through a pool of proxies with the same functionality as ProxyWhirl but using async/await.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For detailed async usage patterns and best practices, see <a class="reference internal" href="../guides/async-client.html"><span class="std std-doc">Async Client</span></a>.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyWhirl</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyWhirl</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="4">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="5">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="8">    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">proxies</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">list[Proxy]</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Initial list of Proxy instances</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">strategy</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">RotationStrategy</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">RoundRobinStrategy()</span></code></p></td>
<td><p>Rotation strategy instance or name (<code class="docutils literal notranslate"><span class="pre">&quot;round-robin&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;random&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;weighted&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;least-used&quot;</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">config</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ProxyConfiguration</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ProxyConfiguration()</span></code></p></td>
<td><p>Configuration settings (timeout, SSL verification, etc.)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">retry_policy</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">RetryPolicy</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">RetryPolicy()</span></code></p></td>
<td><p>Retry policy configuration</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>HTTP Methods:</strong> Same as ProxyWhirl but all async (prefixed with <code class="docutils literal notranslate"><span class="pre">await</span></code>)</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">get(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">post(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">put(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">delete(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">patch(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">head(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">options(url:</span> <span class="pre">str,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code></p></li>
</ul>
<p><strong>Pool Management:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">add_proxy(proxy:</span> <span class="pre">Union[Proxy,</span> <span class="pre">str])</span></code> - Add proxy to pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">remove_proxy(proxy_id:</span> <span class="pre">str)</span></code> - Remove proxy from pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">get_proxy()</span> <span class="pre">-&gt;</span> <span class="pre">Proxy</span></code> - Get the next proxy using rotation strategy</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">clear_unhealthy_proxies()</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code> - Remove unhealthy/dead proxies</p></li>
</ul>
<p><strong>Statistics:</strong> Same synchronous methods as ProxyWhirl</p>
</section>
<hr class="docutils" />
<section id="proxyfetcher">
<h3>ProxyFetcher<a class="headerlink" href="#proxyfetcher" title="Link to this heading">¶</a></h3>
<p>Fetch proxies from various sources with automatic parsing and validation.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For automated proxy fetching with scheduling, see <a class="reference internal" href="../guides/automation.html"><span class="std std-doc">Automation</span></a>.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyFetcher</span><span class="p">,</span> <span class="n">ProxyValidator</span><span class="p">,</span> <span class="n">ProxySourceConfig</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">RenderMode</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Initialize with validator</span>
</span><span data-line="5"><span class="n">validator</span> <span class="o">=</span> <span class="n">ProxyValidator</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">concurrency</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</span><span data-line="6"><span class="n">fetcher</span> <span class="o">=</span> <span class="n">ProxyFetcher</span><span class="p">(</span><span class="n">sources</span><span class="o">=</span><span class="p">[],</span> <span class="n">validator</span><span class="o">=</span><span class="n">validator</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Add sources</span>
</span><span data-line="9"><span class="n">fetcher</span><span class="o">.</span><span class="n">add_source</span><span class="p">(</span><span class="n">ProxySourceConfig</span><span class="p">(</span>
</span><span data-line="10">    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://api.example.com/proxies&quot;</span><span class="p">,</span>
</span><span data-line="11">    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
</span><span data-line="12">    <span class="n">refresh_interval</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">render_mode</span><span class="o">=</span><span class="n">RenderMode</span><span class="o">.</span><span class="n">STATIC</span><span class="p">,</span>
</span><span data-line="14">    <span class="n">trusted</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># Set True to skip validation for pre-validated sources</span>
</span><span data-line="15"><span class="p">))</span>
</span><span data-line="16">
</span><span data-line="17"><span class="c1"># Fetch all proxies with validation</span>
</span><span data-line="18"><span class="n">proxies</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fetcher</span><span class="o">.</span><span class="n">fetch_all</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deduplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20"><span class="c1"># Start periodic refresh (runs in background)</span>
</span><span data-line="21"><span class="k">await</span> <span class="n">fetcher</span><span class="o">.</span><span class="n">start_periodic_refresh</span><span class="p">(</span>
</span><span data-line="22">    <span class="n">callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">proxies</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetched </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">proxies</span><span class="p">)</span><span class="si">}</span><span class="s2"> proxies&quot;</span><span class="p">),</span>
</span><span data-line="23">    <span class="n">interval</span><span class="o">=</span><span class="mi">3600</span>
</span><span data-line="24"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sources</span></code> (list[ProxySourceConfig], optional): List of proxy source configurations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">validator</span></code> (ProxyValidator, optional): Validator instance for fetched proxies</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">add_source(source:</span> <span class="pre">ProxySourceConfig)</span></code> - Add a proxy source</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remove_source(url:</span> <span class="pre">str)</span></code> - Remove source by URL</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">fetch_from_source(source:</span> <span class="pre">ProxySourceConfig)</span> <span class="pre">-&gt;</span> <span class="pre">list[dict]</span></code> - Fetch from single source (with retries)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">fetch_all(validate:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True,</span> <span class="pre">deduplicate:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True)</span> <span class="pre">-&gt;</span> <span class="pre">list[dict]</span></code> - Fetch from all sources in parallel</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">start_periodic_refresh(callback=None,</span> <span class="pre">interval=None)</span></code> - Start automatic refresh loop</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="proxyvalidator">
<h3>ProxyValidator<a class="headerlink" href="#proxyvalidator" title="Link to this heading">¶</a></h3>
<p>Validate proxy connectivity and anonymity with configurable validation levels.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyValidator</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationLevel</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">validator</span> <span class="o">=</span> <span class="n">ProxyValidator</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">test_url</span><span class="o">=</span><span class="s2">&quot;http://httpbin.org/ip&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">level</span><span class="o">=</span><span class="n">ValidationLevel</span><span class="o">.</span><span class="n">STANDARD</span><span class="p">,</span>  <span class="c1"># BASIC, STANDARD, or FULL</span>
</span><span data-line="8">    <span class="n">concurrency</span><span class="o">=</span><span class="mi">50</span>  <span class="c1"># Max concurrent validations</span>
</span><span data-line="9"><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># Validate single proxy (TCP + HTTP test)</span>
</span><span data-line="12"><span class="n">proxy</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">}</span>
</span><span data-line="13"><span class="n">is_valid</span> <span class="o">=</span> <span class="k">await</span> <span class="n">validator</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Validate batch with concurrency control</span>
</span><span data-line="16"><span class="n">proxies</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;http://proxy</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.com:8080&quot;</span><span class="p">}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>
</span><span data-line="17"><span class="n">working_proxies</span> <span class="o">=</span> <span class="k">await</span> <span class="n">validator</span><span class="o">.</span><span class="n">validate_batch</span><span class="p">(</span><span class="n">proxies</span><span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19"><span class="c1"># Check anonymity level</span>
</span><span data-line="20"><span class="n">anonymity</span> <span class="o">=</span> <span class="k">await</span> <span class="n">validator</span><span class="o">.</span><span class="n">check_anonymity</span><span class="p">(</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="21"><span class="nb">print</span><span class="p">(</span><span class="n">anonymity</span><span class="p">)</span>  <span class="c1"># &quot;transparent&quot;, &quot;anonymous&quot;, &quot;elite&quot;, or &quot;unknown&quot;</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">timeout</span></code> (float): Connection timeout in seconds (default: 5.0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test_url</span></code> (str): URL to use for connectivity testing (default: “<a class="reference external" href="http://httpbin.org/ip">http://httpbin.org/ip</a>”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">level</span></code> (ValidationLevel): Validation strictness level</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">BASIC</span></code>: Format + TCP connectivity (~100ms)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STANDARD</span></code>: BASIC + HTTP request test (~500ms)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FULL</span></code>: STANDARD + Anonymity check (~2s)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">concurrency</span></code> (int): Maximum number of concurrent validations (default: 50)</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">validate(proxy:</span> <span class="pre">dict)</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code> - Validate single proxy (TCP pre-check + HTTP test)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">validate_batch(proxies:</span> <span class="pre">list[dict])</span> <span class="pre">-&gt;</span> <span class="pre">list[dict]</span></code> - Validate multiple proxies with concurrency control</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">check_anonymity(proxy_url:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">Optional[str]</span></code> - Check proxy anonymity level</p>
<ul>
<li><p>Returns: “transparent” (leaks IP), “anonymous” (hides IP but reveals proxy usage), “elite” (fully anonymous), or “unknown”</p></li>
</ul>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="browserrenderer">
<h3>BrowserRenderer<a class="headerlink" href="#browserrenderer" title="Link to this heading">¶</a></h3>
<p>Browser-based page renderer using Playwright for JavaScript execution.</p>
<p>Useful for proxy sources that require full browser JavaScript execution or dynamic content loading.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">BrowserRenderer</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Context manager usage (recommended)</span>
</span><span data-line="4"><span class="k">async</span> <span class="k">with</span> <span class="n">BrowserRenderer</span><span class="p">(</span><span class="n">headless</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">renderer</span><span class="p">:</span>
</span><span data-line="5">    <span class="n">html</span> <span class="o">=</span> <span class="k">await</span> <span class="n">renderer</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
</span><span data-line="6">        <span class="s2">&quot;https://example.com/proxies&quot;</span><span class="p">,</span>
</span><span data-line="7">        <span class="n">wait_for_selector</span><span class="o">=</span><span class="s2">&quot;.proxy-list&quot;</span><span class="p">,</span>  <span class="c1"># Wait for this element</span>
</span><span data-line="8">        <span class="n">wait_for_timeout</span><span class="o">=</span><span class="mi">2000</span>  <span class="c1"># Additional 2s wait</span>
</span><span data-line="9">    <span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># Manual usage</span>
</span><span data-line="12"><span class="n">renderer</span> <span class="o">=</span> <span class="n">BrowserRenderer</span><span class="p">(</span>
</span><span data-line="13">    <span class="n">headless</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="14">    <span class="n">browser_type</span><span class="o">=</span><span class="s2">&quot;chromium&quot;</span><span class="p">,</span>  <span class="c1"># or &quot;firefox&quot;, &quot;webkit&quot;</span>
</span><span data-line="15">    <span class="n">timeout</span><span class="o">=</span><span class="mi">30000</span><span class="p">,</span>
</span><span data-line="16">    <span class="n">wait_until</span><span class="o">=</span><span class="s2">&quot;load&quot;</span><span class="p">,</span>  <span class="c1"># or &quot;domcontentloaded&quot;, &quot;networkidle&quot;</span>
</span><span data-line="17">    <span class="n">user_agent</span><span class="o">=</span><span class="s2">&quot;Custom User Agent&quot;</span><span class="p">,</span>
</span><span data-line="18">    <span class="n">viewport</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">1920</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mi">1080</span><span class="p">}</span>
</span><span data-line="19"><span class="p">)</span>
</span><span data-line="20"><span class="k">await</span> <span class="n">renderer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span data-line="21"><span class="n">html</span> <span class="o">=</span> <span class="k">await</span> <span class="n">renderer</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&quot;https://example.com/proxies&quot;</span><span class="p">)</span>
</span><span data-line="22"><span class="k">await</span> <span class="n">renderer</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">headless</span></code> (bool): Run browser in headless mode (default: True)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">browser_type</span></code> (Literal[“chromium”, “firefox”, “webkit”]): Browser engine (default: “chromium”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeout</span></code> (int): Page load timeout in milliseconds (default: 30000)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wait_until</span></code> (Literal[“load”, “domcontentloaded”, “networkidle”]): When to consider navigation complete (default: “load”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user_agent</span></code> (Optional[str]): Custom user agent string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">viewport</span></code> (Optional[dict]): Custom viewport size, e.g. <code class="docutils literal notranslate"><span class="pre">{&quot;width&quot;:</span> <span class="pre">1280,</span> <span class="pre">&quot;height&quot;:</span> <span class="pre">720}</span></code></p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">start()</span></code> - Start the browser instance (idempotent)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">render(url:</span> <span class="pre">str,</span> <span class="pre">wait_for_selector:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">wait_for_timeout:</span> <span class="pre">Optional[int]</span> <span class="pre">=</span> <span class="pre">None)</span> <span class="pre">-&gt;</span> <span class="pre">str</span></code> - Render page and return HTML content</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">close()</span></code> - Close the browser instance (safe to call multiple times)</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="rotation-strategies">
<h2>Rotation Strategies<a class="headerlink" href="#rotation-strategies" title="Link to this heading">¶</a></h2>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For a guided walkthrough of all strategies with real-world usage patterns, see <a class="reference internal" href="../guides/advanced-strategies.html"><span class="std std-doc">Advanced Strategies</span></a>.</p>
</div>
<p>All strategies implement the <code class="docutils literal notranslate"><span class="pre">RotationStrategy</span></code> protocol with two core methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">select(pool:</span> <span class="pre">ProxyPool,</span> <span class="pre">context:</span> <span class="pre">Optional[SelectionContext]</span> <span class="pre">=</span> <span class="pre">None)</span> <span class="pre">-&gt;</span> <span class="pre">Proxy</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">record_result(proxy:</span> <span class="pre">Proxy,</span> <span class="pre">success:</span> <span class="pre">bool,</span> <span class="pre">response_time_ms:</span> <span class="pre">float)</span></code></p></li>
</ul>
<section id="roundrobinstrategy">
<h3>RoundRobinStrategy<a class="headerlink" href="#roundrobinstrategy" title="Link to this heading">¶</a></h3>
<p>Select proxies in sequential order with wraparound (circular rotation).</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.strategies</span><span class="w"> </span><span class="kn">import</span> <span class="n">RoundRobinStrategy</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="n">strategy</span> <span class="o">=</span> <span class="n">RoundRobinStrategy</span><span class="p">()</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="s1">&#39;select&#39;</span><span class="p">)</span>
</span><span data-line="4"><span class="go">True</span>
</span></pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">RoundRobinStrategy</span><span class="p">,</span> <span class="n">ProxyWhirl</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">strategy</span> <span class="o">=</span> <span class="n">RoundRobinStrategy</span><span class="p">()</span>
</span><span data-line="4"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyWhirl</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="n">strategy</span><span class="p">)</span>
</span><span data-line="5"><span class="c1"># Or use string name</span>
</span><span data-line="6"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyWhirl</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;round-robin&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Thread Safety:</strong> Uses <code class="docutils literal notranslate"><span class="pre">threading.Lock</span></code> for atomic index increment, preventing proxy skipping or duplicate selection in multi-threaded environments.</p>
<p><strong>Performance:</strong> O(1) selection time.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For strategy comparison and selection guidance, see <a class="reference internal" href="../guides/advanced-strategies.html"><span class="std std-doc">Advanced Strategies</span></a>.</p>
</div>
</section>
<hr class="docutils" />
<section id="randomstrategy">
<h3>RandomStrategy<a class="headerlink" href="#randomstrategy" title="Link to this heading">¶</a></h3>
<p>Randomly select proxies from the pool of healthy proxies.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomStrategy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">strategy</span> <span class="o">=</span> <span class="n">RandomStrategy</span><span class="p">()</span>
</span></pre></div>
</div>
<p><strong>Thread Safety:</strong> Uses Python’s thread-safe <code class="docutils literal notranslate"><span class="pre">random</span></code> module (GIL-protected).</p>
<p><strong>Use Cases:</strong> Unpredictable rotation patterns, avoiding sequential detection.</p>
</section>
<hr class="docutils" />
<section id="weightedstrategy">
<h3>WeightedStrategy<a class="headerlink" href="#weightedstrategy" title="Link to this heading">¶</a></h3>
<p>Select proxies based on custom weights or success rates using weighted random selection.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">WeightedStrategy</span><span class="p">,</span> <span class="n">StrategyConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">strategy</span> <span class="o">=</span> <span class="n">WeightedStrategy</span><span class="p">()</span>
</span><span data-line="4"><span class="n">strategy</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">StrategyConfig</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">weights</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="6">        <span class="s2">&quot;http://proxy1.com:8080&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>  <span class="c1"># 70% selection probability</span>
</span><span data-line="7">        <span class="s2">&quot;http://proxy2.com:8080&quot;</span><span class="p">:</span> <span class="mf">0.3</span>   <span class="c1"># 30% selection probability</span>
</span><span data-line="8">    <span class="p">}</span>
</span><span data-line="9"><span class="p">))</span>
</span></pre></div>
</div>
<p><strong>Features:</strong></p>
<ul class="simple">
<li><p>Custom weights via <code class="docutils literal notranslate"><span class="pre">StrategyConfig.weights</span></code> (proxy URL → weight mapping)</p></li>
<li><p>Fallback to success_rate-based weights if no custom weights provided</p></li>
<li><p>Minimum weight (0.1) ensures all proxies have selection chance</p></li>
<li><p>Weight caching to avoid O(n) recalculation on every selection</p></li>
<li><p>Automatically normalizes weights to sum to 1.0</p></li>
</ul>
<p><strong>Performance:</strong> O(1) selection (when cache valid), O(n) when recalculating weights.</p>
</section>
<hr class="docutils" />
<section id="leastusedstrategy">
<h3>LeastUsedStrategy<a class="headerlink" href="#leastusedstrategy" title="Link to this heading">¶</a></h3>
<p>Select proxy with fewest started requests for load balancing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">LeastUsedStrategy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">strategy</span> <span class="o">=</span> <span class="n">LeastUsedStrategy</span><span class="p">()</span>
</span></pre></div>
</div>
<p><strong>Selection Criteria:</strong> Minimum <code class="docutils literal notranslate"><span class="pre">requests_started</span></code> counter (tracks in-flight requests).</p>
<p><strong>Use Cases:</strong> Even load distribution, preventing proxy overload.</p>
</section>
<hr class="docutils" />
<section id="performancebasedstrategy">
<h3>PerformanceBasedStrategy<a class="headerlink" href="#performancebasedstrategy" title="Link to this heading">¶</a></h3>
<p>Performance-based selection using EMA (Exponential Moving Average) response times.</p>
<p>Faster proxies receive higher selection weights. Includes cold-start exploration for new proxies.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">PerformanceBasedStrategy</span><span class="p">,</span> <span class="n">StrategyConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">strategy</span> <span class="o">=</span> <span class="n">PerformanceBasedStrategy</span><span class="p">(</span><span class="n">exploration_count</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span data-line="4"><span class="n">strategy</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">StrategyConfig</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">ema_alpha</span><span class="o">=</span><span class="mf">0.2</span>  <span class="c1"># Smoothing factor (0-1, higher = more weight to recent values)</span>
</span><span data-line="6"><span class="p">))</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">exploration_count</span></code> (int): Minimum trials for new proxies before performance-based selection applies (default: 5)</p></li>
</ul>
<p><strong>Features:</strong></p>
<ul class="simple">
<li><p>Adaptive selection based on EMA response times</p></li>
<li><p>Inverse weighting: lower EMA = higher selection probability</p></li>
<li><p>Cold-start handling: new proxies get exploration trials before being evaluated</p></li>
<li><p>Configurable EMA alpha (smoothing factor)</p></li>
</ul>
<p><strong>Performance:</strong> O(n) selection (must scan for exploration vs. exploitation split).</p>
</section>
<hr class="docutils" />
<section id="sessionpersistencestrategy">
<h3>SessionPersistenceStrategy<a class="headerlink" href="#sessionpersistencestrategy" title="Link to this heading">¶</a></h3>
<p>Maintain consistent proxy assignment per session ID (sticky sessions).</p>
<p>Ensures that all requests within a session use the same proxy unless the proxy becomes unavailable.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">SessionPersistenceStrategy</span><span class="p">,</span> <span class="n">SelectionContext</span><span class="p">,</span> <span class="n">StrategyConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">strategy</span> <span class="o">=</span> <span class="n">SessionPersistenceStrategy</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">max_sessions</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>  <span class="c1"># LRU eviction threshold</span>
</span><span data-line="5">    <span class="n">auto_cleanup_threshold</span><span class="o">=</span><span class="mi">100</span>  <span class="c1"># Auto-cleanup every 100 operations</span>
</span><span data-line="6"><span class="p">)</span>
</span><span data-line="7"><span class="n">strategy</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">StrategyConfig</span><span class="p">(</span>
</span><span data-line="8">    <span class="n">session_stickiness_duration_seconds</span><span class="o">=</span><span class="mi">3600</span>  <span class="c1"># 1 hour TTL</span>
</span><span data-line="9"><span class="p">))</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># Use with context</span>
</span><span data-line="12"><span class="n">context</span> <span class="o">=</span> <span class="n">SelectionContext</span><span class="p">(</span><span class="n">session_id</span><span class="o">=</span><span class="s2">&quot;user-123&quot;</span><span class="p">)</span>
</span><span data-line="13"><span class="n">proxy</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_sessions</span></code> (int): Maximum active sessions before LRU eviction (default: 10000)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">auto_cleanup_threshold</span></code> (int): Number of operations between auto-cleanups (default: 100)</p></li>
</ul>
<p><strong>Features:</strong></p>
<ul class="simple">
<li><p>Session-to-proxy binding with configurable TTL</p></li>
<li><p>Automatic failover when assigned proxy becomes unhealthy</p></li>
<li><p>Thread-safe session management with <code class="docutils literal notranslate"><span class="pre">threading.RLock</span></code></p></li>
<li><p>LRU eviction when max_sessions reached</p></li>
<li><p>99.9% same-proxy guarantee per session (SC-005)</p></li>
<li><p>Automatic expiration and cleanup</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">close_session(session_id:</span> <span class="pre">str)</span></code> - Explicitly close a session</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cleanup_expired_sessions()</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code> - Remove expired sessions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_session_stats()</span> <span class="pre">-&gt;</span> <span class="pre">dict</span></code> - Get session statistics</p></li>
</ul>
<p><strong>Performance:</strong> O(1) session lookup.</p>
</section>
<hr class="docutils" />
<section id="geotargetedstrategy">
<h3>GeoTargetedStrategy<a class="headerlink" href="#geotargetedstrategy" title="Link to this heading">¶</a></h3>
<p>Select proxies based on geographical location (country or region filtering).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">GeoTargetedStrategy</span><span class="p">,</span> <span class="n">SelectionContext</span><span class="p">,</span> <span class="n">StrategyConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">strategy</span> <span class="o">=</span> <span class="n">GeoTargetedStrategy</span><span class="p">()</span>
</span><span data-line="4"><span class="n">strategy</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">StrategyConfig</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">geo_fallback_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Fallback to any proxy if no matches</span>
</span><span data-line="6">    <span class="n">geo_secondary_strategy</span><span class="o">=</span><span class="s2">&quot;round_robin&quot;</span>  <span class="c1"># Strategy for filtered selection</span>
</span><span data-line="7"><span class="p">))</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Target specific country (ISO 3166-1 alpha-2)</span>
</span><span data-line="10"><span class="n">context</span> <span class="o">=</span> <span class="n">SelectionContext</span><span class="p">(</span><span class="n">target_country</span><span class="o">=</span><span class="s2">&quot;US&quot;</span><span class="p">)</span>
</span><span data-line="11"><span class="n">proxy</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># Target specific region</span>
</span><span data-line="14"><span class="n">context</span> <span class="o">=</span> <span class="n">SelectionContext</span><span class="p">(</span><span class="n">target_region</span><span class="o">=</span><span class="s2">&quot;Europe&quot;</span><span class="p">)</span>
</span><span data-line="15"><span class="n">proxy</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Features:</strong></p>
<ul class="simple">
<li><p>Country-based filtering using ISO 3166-1 alpha-2 codes (e.g., “US”, “GB”, “FR”)</p></li>
<li><p>Region-based filtering (custom region names)</p></li>
<li><p>Country takes precedence over region when both specified</p></li>
<li><p>Configurable fallback behavior (use any proxy vs. raise error)</p></li>
<li><p>Secondary strategy for selection from filtered proxies</p></li>
</ul>
<p><strong>Success Criteria:</strong> 100% correct region selection when available (SC-006).</p>
<p><strong>Performance:</strong> O(n) filtering + O(1) or O(n) secondary selection.</p>
</section>
<hr class="docutils" />
<section id="costawarestrategy">
<h3>CostAwareStrategy<a class="headerlink" href="#costawarestrategy" title="Link to this heading">¶</a></h3>
<p>Cost-aware proxy selection prioritizing free/cheap proxies.</p>
<p>Uses weighted random selection based on inverse cost - lower cost proxies are more likely to be selected.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CostAwareStrategy</span><span class="p">,</span> <span class="n">StrategyConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">strategy</span> <span class="o">=</span> <span class="n">CostAwareStrategy</span><span class="p">(</span><span class="n">max_cost_per_request</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span data-line="4"><span class="n">strategy</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">StrategyConfig</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="6">        <span class="s2">&quot;max_cost_per_request&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># Filter out proxies exceeding this cost</span>
</span><span data-line="7">        <span class="s2">&quot;free_proxy_boost&quot;</span><span class="p">:</span> <span class="mf">10.0</span>  <span class="c1"># Weight multiplier for free proxies</span>
</span><span data-line="8">    <span class="p">}</span>
</span><span data-line="9"><span class="p">))</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_cost_per_request</span></code> (Optional[float]): Maximum acceptable cost per request (filters out expensive proxies)</p></li>
</ul>
<p><strong>Features:</strong></p>
<ul class="simple">
<li><p>Free proxies (cost_per_request = 0.0) are heavily favored (10x weight by default)</p></li>
<li><p>Paid proxies selected based on inverse cost weighting: weight = 1 / (cost + 0.001)</p></li>
<li><p>Configurable cost threshold to filter out expensive proxies</p></li>
<li><p>Fallback to any proxy when no low-cost options available</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="compositestrategy">
<h3>CompositeStrategy<a class="headerlink" href="#compositestrategy" title="Link to this heading">¶</a></h3>
<p>Composite strategy applying filters then selector (filter + select pattern).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CompositeStrategy</span><span class="p">,</span> <span class="n">GeoTargetedStrategy</span><span class="p">,</span> <span class="n">PerformanceBasedStrategy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Filter by geography, then select by performance</span>
</span><span data-line="4"><span class="n">strategy</span> <span class="o">=</span> <span class="n">CompositeStrategy</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">GeoTargetedStrategy</span><span class="p">()],</span>
</span><span data-line="6">    <span class="n">selector</span><span class="o">=</span><span class="n">PerformanceBasedStrategy</span><span class="p">()</span>
</span><span data-line="7"><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Or use configuration</span>
</span><span data-line="10"><span class="n">strategy</span> <span class="o">=</span> <span class="n">CompositeStrategy</span><span class="o">.</span><span class="n">from_config</span><span class="p">({</span>
</span><span data-line="11">    <span class="s2">&quot;filters&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;geo-targeted&quot;</span><span class="p">],</span>
</span><span data-line="12">    <span class="s2">&quot;selector&quot;</span><span class="p">:</span> <span class="s2">&quot;performance-based&quot;</span>
</span><span data-line="13"><span class="p">})</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Use with context</span>
</span><span data-line="16"><span class="n">context</span> <span class="o">=</span> <span class="n">SelectionContext</span><span class="p">(</span><span class="n">target_country</span><span class="o">=</span><span class="s2">&quot;US&quot;</span><span class="p">)</span>
</span><span data-line="17"><span class="n">proxy</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">filters</span></code> (Optional[list[RotationStrategy]]): List of filtering strategies applied sequentially</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">selector</span></code> (Optional[RotationStrategy]): Final selection strategy to choose from filtered pool</p></li>
</ul>
<p><strong>Features:</strong></p>
<ul class="simple">
<li><p>Sequential filter application (each filter narrows the pool)</p></li>
<li><p>Final selector chooses from filtered set</p></li>
<li><p>Configurable filter chain</p></li>
<li><p>Target: &lt;5ms total selection time (SC-007)</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">configure(config:</span> <span class="pre">StrategyConfig)</span></code> - Configure all component strategies</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;classmethod</span> <span class="pre">from_config(config:</span> <span class="pre">dict)</span> <span class="pre">-&gt;</span> <span class="pre">CompositeStrategy</span></code> - Create from configuration dictionary</p></li>
</ul>
<p><strong>Thread Safety:</strong> Thread-safe if all component strategies are thread-safe.</p>
</section>
<hr class="docutils" />
<section id="strategyregistry">
<h3>StrategyRegistry<a class="headerlink" href="#strategyregistry" title="Link to this heading">¶</a></h3>
<p>Singleton registry for custom rotation strategies with thread-safe registration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">StrategyRegistry</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">registry</span> <span class="o">=</span> <span class="n">StrategyRegistry</span><span class="p">()</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Register custom strategy</span>
</span><span data-line="6"><span class="k">class</span><span class="w"> </span><span class="nc">MyStrategy</span><span class="p">:</span>
</span><span data-line="7">    <span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pool</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span data-line="8">        <span class="k">return</span> <span class="n">pool</span><span class="o">.</span><span class="n">get_all_proxies</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span data-line="9">
</span><span data-line="10">    <span class="k">def</span><span class="w"> </span><span class="nf">record_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">response_time_ms</span><span class="p">):</span>
</span><span data-line="11">        <span class="k">pass</span>
</span><span data-line="12">
</span><span data-line="13"><span class="n">registry</span><span class="o">.</span><span class="n">register_strategy</span><span class="p">(</span><span class="s2">&quot;my-strategy&quot;</span><span class="p">,</span> <span class="n">MyStrategy</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Retrieve and use</span>
</span><span data-line="16"><span class="n">StrategyClass</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">get_strategy</span><span class="p">(</span><span class="s2">&quot;my-strategy&quot;</span><span class="p">)</span>
</span><span data-line="17"><span class="n">strategy</span> <span class="o">=</span> <span class="n">StrategyClass</span><span class="p">()</span>
</span><span data-line="18">
</span><span data-line="19"><span class="c1"># List all strategies</span>
</span><span data-line="20"><span class="n">strategies</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">list_strategies</span><span class="p">()</span>
</span><span data-line="21">
</span><span data-line="22"><span class="c1"># Unregister</span>
</span><span data-line="23"><span class="n">registry</span><span class="o">.</span><span class="n">unregister_strategy</span><span class="p">(</span><span class="s2">&quot;my-strategy&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">register_strategy(name:</span> <span class="pre">str,</span> <span class="pre">strategy_class:</span> <span class="pre">type,</span> <span class="pre">validate:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True)</span></code> - Register a custom strategy</p>
<ul>
<li><p>Validates strategy implements <code class="docutils literal notranslate"><span class="pre">RotationStrategy</span></code> protocol if <code class="docutils literal notranslate"><span class="pre">validate=True</span></code></p></li>
<li><p>Allows re-registration (replacement)</p></li>
<li><p>Target: &lt;1s load time (SC-010)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_strategy(name:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">type</span></code> - Retrieve strategy class by name (raises <code class="docutils literal notranslate"><span class="pre">KeyError</span></code> if not found)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list_strategies()</span> <span class="pre">-&gt;</span> <span class="pre">list[str]</span></code> - List all registered strategy names</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">unregister_strategy(name:</span> <span class="pre">str)</span></code> - Remove strategy from registry</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;classmethod</span> <span class="pre">reset()</span></code> - Reset singleton instance (testing only)</p></li>
</ul>
<p><strong>Thread Safety:</strong> Uses <code class="docutils literal notranslate"><span class="pre">threading.RLock</span></code> for thread-safe operations.</p>
</section>
<hr class="docutils" />
<section id="strategystate">
<h3>StrategyState<a class="headerlink" href="#strategystate" title="Link to this heading">¶</a></h3>
<p>Per-strategy mutable state for managing proxy metrics. Separates mutable strategy state from immutable proxy identity, allowing different strategies to track proxy performance independently.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">StrategyState</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">state</span> <span class="o">=</span> <span class="n">StrategyState</span><span class="p">(</span><span class="n">ema_alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">window_duration_seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Record request outcomes</span>
</span><span data-line="6"><span class="n">state</span><span class="o">.</span><span class="n">record_success</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">response_time_ms</span><span class="o">=</span><span class="mf">150.0</span><span class="p">)</span>
</span><span data-line="7"><span class="n">state</span><span class="o">.</span><span class="n">record_failure</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Query metrics</span>
</span><span data-line="10"><span class="n">metrics</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span data-line="11"><span class="n">ema</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get_ema_response_time</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span data-line="12"><span class="n">rate</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get_success_rate</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span data-line="13"><span class="n">count</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get_request_count</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ema_alpha</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">float</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0.2</span></code></p></td>
<td><p>EMA smoothing factor for response times</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">window_duration_seconds</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">3600</span></code></p></td>
<td><p>Sliding window duration for counter resets</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get_metrics(proxy_id:</span> <span class="pre">UUID)</span> <span class="pre">-&gt;</span> <span class="pre">ProxyMetrics</span></code> - Get or create metrics for a proxy</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">record_success(proxy_id:</span> <span class="pre">UUID,</span> <span class="pre">response_time_ms:</span> <span class="pre">float)</span></code> - Record a successful request</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">record_failure(proxy_id:</span> <span class="pre">UUID)</span></code> - Record a failed request</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_ema_response_time(proxy_id:</span> <span class="pre">UUID)</span> <span class="pre">-&gt;</span> <span class="pre">float</span> <span class="pre">|</span> <span class="pre">None</span></code> - Get EMA response time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_success_rate(proxy_id:</span> <span class="pre">UUID)</span> <span class="pre">-&gt;</span> <span class="pre">float</span></code> - Get success rate (0.0-1.0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_request_count(proxy_id:</span> <span class="pre">UUID)</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code> - Get total request count</p></li>
</ul>
<p><strong>Thread Safety:</strong> Uses <code class="docutils literal notranslate"><span class="pre">threading.Lock</span></code> for all state mutations.</p>
</section>
<hr class="docutils" />
<section id="proxymetrics">
<h3>ProxyMetrics<a class="headerlink" href="#proxymetrics" title="Link to this heading">¶</a></h3>
<p>Per-proxy mutable metrics maintained by a strategy. Encapsulates performance metrics that a strategy tracks for each proxy independently from the <code class="docutils literal notranslate"><span class="pre">Proxy</span></code> model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyMetrics</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">metrics</span> <span class="o">=</span> <span class="n">ProxyMetrics</span><span class="p">()</span>
</span><span data-line="4"><span class="n">metrics</span><span class="o">.</span><span class="n">update_ema</span><span class="p">(</span><span class="n">response_time_ms</span><span class="o">=</span><span class="mf">150.0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</span><span data-line="5"><span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">success_rate</span><span class="p">)</span>  <span class="c1"># 0.0-1.0</span>
</span></pre></div>
</div>
<p><strong>Fields:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ema_response_time_ms</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">float</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>EMA of response times</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">total_requests</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>Total requests through this proxy</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">total_successes</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>Successful requests</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">total_failures</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>Failed requests</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">last_response_time_ms</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">float</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Most recent response time</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">window_start</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">datetime</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Start of current sliding window</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">update_ema(response_time_ms:</span> <span class="pre">float,</span> <span class="pre">alpha:</span> <span class="pre">float)</span></code> - Update EMA with new response time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">success_rate</span> <span class="pre">-&gt;</span> <span class="pre">float</span></code> - Calculate success rate (0.0-1.0)</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="data-models">
<h2>Data Models<a class="headerlink" href="#data-models" title="Link to this heading">¶</a></h2>
<section id="proxy">
<h3>Proxy<a class="headerlink" href="#proxy" title="Link to this heading">¶</a></h3>
<p>Represents a single proxy server with connection details, performance metrics, and metadata.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">Proxy</span>
</span><span data-line="2"><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">HealthStatus</span>
</span><span data-line="3"><span class="gp">&gt;&gt;&gt; </span><span class="n">proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="4"><span class="gp">&gt;&gt;&gt; </span><span class="n">proxy</span><span class="o">.</span><span class="n">protocol</span>
</span><span data-line="5"><span class="go">&#39;http&#39;</span>
</span><span data-line="6"><span class="gp">&gt;&gt;&gt; </span><span class="n">proxy</span><span class="o">.</span><span class="n">health_status</span>
</span><span data-line="7"><span class="go">&lt;HealthStatus.UNKNOWN: &#39;unknown&#39;&gt;</span>
</span></pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">Proxy</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecretStr</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">protocol</span><span class="o">=</span><span class="s2">&quot;http&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">username</span><span class="o">=</span><span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span>
</span><span data-line="8">    <span class="n">password</span><span class="o">=</span><span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;pass&quot;</span><span class="p">),</span>
</span><span data-line="9">    <span class="n">country_code</span><span class="o">=</span><span class="s2">&quot;US&quot;</span><span class="p">,</span>
</span><span data-line="10">    <span class="n">region</span><span class="o">=</span><span class="s2">&quot;California&quot;</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;premium&quot;</span><span class="p">,</span> <span class="s2">&quot;rotating&quot;</span><span class="p">},</span>
</span><span data-line="12">    <span class="n">cost_per_request</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">ttl</span><span class="o">=</span><span class="mi">3600</span>  <span class="c1"># Expire after 1 hour</span>
</span><span data-line="14"><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># Properties</span>
</span><span data-line="17"><span class="n">success_rate</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">success_rate</span>  <span class="c1"># Calculate success rate (0.0-1.0)</span>
</span><span data-line="18"><span class="n">is_healthy</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">is_healthy</span>  <span class="c1"># Check if proxy is healthy</span>
</span><span data-line="19"><span class="n">is_expired</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">is_expired</span>  <span class="c1"># Check if TTL expired</span>
</span><span data-line="20">
</span><span data-line="21"><span class="c1"># Track request lifecycle</span>
</span><span data-line="22"><span class="n">proxy</span><span class="o">.</span><span class="n">start_request</span><span class="p">()</span>  <span class="c1"># Increment requests_started, requests_active</span>
</span><span data-line="23"><span class="n">proxy</span><span class="o">.</span><span class="n">complete_request</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">response_time_ms</span><span class="o">=</span><span class="mf">150.0</span><span class="p">)</span>  <span class="c1"># Updates metrics, EMA</span>
</span></pre></div>
</div>
<p><strong>Core Fields:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> (UUID): Unique identifier (auto-generated)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">url</span></code> (str): Proxy URL (scheme://host:port)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">protocol</span></code> (Optional[Literal[“http”, “https”, “socks4”, “socks5”]]): Protocol type (auto-extracted from URL)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">username</span></code>, <code class="docutils literal notranslate"><span class="pre">password</span></code> (Optional[SecretStr]): Authentication credentials (secure storage)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">allow_local</span></code> (bool): Allow localhost/internal IPs (default: False for production)</p></li>
</ul>
<p><strong>Health &amp; Status:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">health_status</span></code> (HealthStatus): Current health state (UNKNOWN, HEALTHY, DEGRADED, UNHEALTHY, DEAD)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last_success_at</span></code>, <code class="docutils literal notranslate"><span class="pre">last_failure_at</span></code> (Optional[datetime]): Timestamp of last success/failure</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">consecutive_failures</span></code> (int): Consecutive failure count</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">consecutive_successes</span></code> (int): Consecutive success count (for health monitoring)</p></li>
</ul>
<p><strong>Request Tracking:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">requests_started</span></code> (int): Total requests initiated</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">requests_completed</span></code> (int): Total requests finished</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">requests_active</span></code> (int): Currently in-flight requests</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">total_requests</span></code>, <code class="docutils literal notranslate"><span class="pre">total_successes</span></code>, <code class="docutils literal notranslate"><span class="pre">total_failures</span></code> (int): Legacy counters</p></li>
</ul>
<p><strong>Performance Metrics:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">average_response_time_ms</span></code> (Optional[float]): Simple average response time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ema_response_time_ms</span></code> (Optional[float]): EMA response time (adaptive)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ema_alpha</span></code> (float): EMA smoothing factor (default: 0.2)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latency_ms</span></code> (Optional[float]): Last measured latency</p></li>
</ul>
<p><strong>Geo-Location:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">country_code</span></code> (Optional[str]): ISO 3166-1 alpha-2 code (e.g., “US”, “GB”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">region</span></code> (Optional[str]): Region/state within country</p></li>
</ul>
<p><strong>Health Monitoring (Feature 006):</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">last_health_check</span></code> (Optional[datetime]): Last health check timestamp</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">recovery_attempt</span></code> (int): Current recovery attempt count</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">next_check_time</span></code> (Optional[datetime]): Scheduled next health check</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last_health_error</span></code> (Optional[str]): Last health check error message</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">total_checks</span></code>, <code class="docutils literal notranslate"><span class="pre">total_health_failures</span></code> (int): Health check counters</p></li>
</ul>
<p><strong>Metadata:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tags</span></code> (set[str]): Custom tags for categorization</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code> (ProxySource): Origin type (USER, FETCHED, API, FILE)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source_url</span></code> (Optional[HttpUrl]): Source URL if fetched</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metadata</span></code> (dict[str, Any]): Custom metadata</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">created_at</span></code>, <code class="docutils literal notranslate"><span class="pre">updated_at</span></code> (datetime): Timestamps</p></li>
</ul>
<p><strong>TTL &amp; Expiration:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ttl</span></code> (Optional[int]): Time-to-live in seconds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expires_at</span></code> (Optional[datetime]): Absolute expiration timestamp (auto-set from TTL)</p></li>
</ul>
<p><strong>Cost:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cost_per_request</span></code> (Optional[float]): Cost per request (0.0 = free, higher = more expensive)</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">start_request()</span></code> - Mark proxy as handling a request (increments <code class="docutils literal notranslate"><span class="pre">requests_started</span></code>, <code class="docutils literal notranslate"><span class="pre">requests_active</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">complete_request(success:</span> <span class="pre">bool,</span> <span class="pre">response_time_ms:</span> <span class="pre">float)</span></code> - Complete request and update metrics (decrements <code class="docutils literal notranslate"><span class="pre">requests_active</span></code>, updates EMA, records success/failure)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">success_rate</span> <span class="pre">-&gt;</span> <span class="pre">float</span></code> - Calculate success rate (0.0-1.0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">is_healthy</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code> - Check if proxy is healthy (HEALTHY status only)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">is_expired</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code> - Check if proxy has expired based on TTL</p></li>
</ul>
<p><strong>Validators:</strong></p>
<ul class="simple">
<li><p>URL scheme validation (http, https, socks4, socks5)</p></li>
<li><p>Port range validation (1-65535)</p></li>
<li><p>Localhost/internal IP blocking (unless <code class="docutils literal notranslate"><span class="pre">allow_local=True</span></code>)</p></li>
<li><p>Credential consistency (username and password must both be present or both absent)</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="proxypool">
<h3>ProxyPool<a class="headerlink" href="#proxypool" title="Link to this heading">¶</a></h3>
<p>Collection of proxies with health filtering and statistics.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyPool</span><span class="p">,</span> <span class="n">Proxy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">pool</span> <span class="o">=</span> <span class="n">ProxyPool</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_pool&quot;</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="p">[</span><span class="n">proxy1</span><span class="p">,</span> <span class="n">proxy2</span><span class="p">])</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Add/remove proxies</span>
</span><span data-line="6"><span class="n">pool</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="n">proxy3</span><span class="p">)</span>
</span><span data-line="7"><span class="n">pool</span><span class="o">.</span><span class="n">remove_proxy</span><span class="p">(</span><span class="n">proxy1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Get proxies</span>
</span><span data-line="10"><span class="n">all_proxies</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">get_all_proxies</span><span class="p">()</span>
</span><span data-line="11"><span class="n">healthy_proxies</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">get_healthy_proxies</span><span class="p">()</span>  <span class="c1"># Only HEALTHY, UNKNOWN, DEGRADED</span>
</span><span data-line="12"><span class="n">proxy_by_id</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">get_proxy_by_id</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14"><span class="c1"># Statistics</span>
</span><span data-line="15"><span class="n">stats</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">get_source_breakdown</span><span class="p">()</span>  <span class="c1"># Count by source (USER, FETCHED, etc.)</span>
</span><span data-line="16"><span class="n">size</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">size</span>  <span class="c1"># Total proxy count</span>
</span><span data-line="17">
</span><span data-line="18"><span class="c1"># Cleanup</span>
</span><span data-line="19"><span class="n">removed_count</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">clear_unhealthy</span><span class="p">()</span>  <span class="c1"># Remove UNHEALTHY and DEAD proxies</span>
</span></pre></div>
</div>
<p><strong>Fields:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> (str): Pool name/identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proxies</span></code> (list[Proxy]): List of proxies in pool</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">add_proxy(proxy:</span> <span class="pre">Proxy)</span></code> - Add proxy to pool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">remove_proxy(proxy_id:</span> <span class="pre">UUID)</span></code> - Remove proxy by ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_proxy_by_id(proxy_id:</span> <span class="pre">UUID)</span> <span class="pre">-&gt;</span> <span class="pre">Optional[Proxy]</span></code> - Get proxy by ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_healthy_proxies()</span> <span class="pre">-&gt;</span> <span class="pre">list[Proxy]</span></code> - Get all healthy proxies (HEALTHY, UNKNOWN, DEGRADED)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_all_proxies()</span> <span class="pre">-&gt;</span> <span class="pre">list[Proxy]</span></code> - Get all proxies regardless of health</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">clear_unhealthy()</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code> - Remove UNHEALTHY and DEAD proxies, return count removed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_source_breakdown()</span> <span class="pre">-&gt;</span> <span class="pre">dict[str,</span> <span class="pre">int]</span></code> - Count proxies by source type (keys are source value strings)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">size</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code> - Get total proxy count</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="proxychain">
<h3>ProxyChain<a class="headerlink" href="#proxychain" title="Link to this heading">¶</a></h3>
<p>Sequence of proxies for multi-hop routing (chain/tunnel pattern).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyChain</span><span class="p">,</span> <span class="n">Proxy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">chain</span> <span class="o">=</span> <span class="n">ProxyChain</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;secure_chain&quot;</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">proxies</span><span class="o">=</span><span class="p">[</span><span class="n">proxy1</span><span class="p">,</span> <span class="n">proxy2</span><span class="p">,</span> <span class="n">proxy3</span><span class="p">],</span>
</span><span data-line="6">    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Three-hop proxy chain for anonymity&quot;</span>
</span><span data-line="7"><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Access chain properties</span>
</span><span data-line="10"><span class="n">entry_proxy</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">entry_proxy</span>  <span class="c1"># First proxy (client connects to this)</span>
</span><span data-line="11"><span class="n">exit_proxy</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">exit_proxy</span>  <span class="c1"># Last proxy (final hop before destination)</span>
</span><span data-line="12"><span class="n">length</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">chain_length</span>  <span class="c1"># Number of proxies in chain</span>
</span><span data-line="13"><span class="n">urls</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">get_chain_urls</span><span class="p">()</span>  <span class="c1"># List of all proxy URLs</span>
</span></pre></div>
</div>
<p><strong>Fields:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> (Optional[str]): Chain name/identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proxies</span></code> (list[Proxy]): Ordered list of proxies in chain (entry → exit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">description</span></code> (Optional[str]): Human-readable description</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">entry_proxy</span> <span class="pre">-&gt;</span> <span class="pre">Proxy</span></code> - Get first proxy in chain (entry point)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">exit_proxy</span> <span class="pre">-&gt;</span> <span class="pre">Proxy</span></code> - Get last proxy in chain (exit point)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">chain_length</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code> - Get number of proxies in chain</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_chain_urls()</span> <span class="pre">-&gt;</span> <span class="pre">list[str]</span></code> - Get all proxy URLs in order</p></li>
</ul>
<p><strong>Note:</strong> Full CONNECT tunneling implementation is not yet supported. Currently, only the entry proxy is used for routing, with chain metadata stored for future multi-hop implementation.</p>
</section>
<hr class="docutils" />
<section id="proxycredentials">
<h3>ProxyCredentials<a class="headerlink" href="#proxycredentials" title="Link to this heading">¶</a></h3>
<p>Secure credential storage for proxy authentication with httpx integration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyCredentials</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecretStr</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">creds</span> <span class="o">=</span> <span class="n">ProxyCredentials</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">username</span><span class="o">=</span><span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span>
</span><span data-line="6">    <span class="n">password</span><span class="o">=</span><span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;pass&quot;</span><span class="p">),</span>
</span><span data-line="7">    <span class="n">auth_type</span><span class="o">=</span><span class="s2">&quot;basic&quot;</span><span class="p">,</span>  <span class="c1"># or &quot;digest&quot;, &quot;bearer&quot;</span>
</span><span data-line="8">    <span class="n">additional_headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;X-Custom&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">}</span>
</span><span data-line="9"><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># Convert to httpx auth</span>
</span><span data-line="12"><span class="n">httpx_auth</span> <span class="o">=</span> <span class="n">creds</span><span class="o">.</span><span class="n">to_httpx_auth</span><span class="p">()</span>
</span><span data-line="13">
</span><span data-line="14"><span class="c1"># Export (redacted or revealed)</span>
</span><span data-line="15"><span class="n">dict_redacted</span> <span class="o">=</span> <span class="n">creds</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">reveal</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># {&quot;username&quot;: &quot;**********&quot;, ...}</span>
</span><span data-line="16"><span class="n">dict_revealed</span> <span class="o">=</span> <span class="n">creds</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">reveal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># {&quot;username&quot;: &quot;user&quot;, ...}</span>
</span></pre></div>
</div>
<p><strong>Fields:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">username</span></code> (SecretStr): Username (secure storage)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">password</span></code> (SecretStr): Password (secure storage)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">auth_type</span></code> (Literal[“basic”, “digest”, “bearer”]): Authentication type (default: “basic”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">additional_headers</span></code> (dict[str, str]): Additional HTTP headers for authentication</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">to_httpx_auth()</span> <span class="pre">-&gt;</span> <span class="pre">httpx.BasicAuth</span></code> - Convert to httpx BasicAuth object</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">to_dict(reveal:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False)</span> <span class="pre">-&gt;</span> <span class="pre">dict</span></code> - Serialize credentials (redacted by default)</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="proxyconfiguration">
<h3>ProxyConfiguration<a class="headerlink" href="#proxyconfiguration" title="Link to this heading">¶</a></h3>
<p>Configuration settings for ProxyWhirl and AsyncProxyWhirl.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyConfiguration</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">config</span> <span class="o">=</span> <span class="n">ProxyConfiguration</span><span class="p">(</span>
</span><span data-line="4">    <span class="c1"># HTTP settings</span>
</span><span data-line="5">    <span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">verify_ssl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">follow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="8">
</span><span data-line="9">    <span class="c1"># Connection pool settings</span>
</span><span data-line="10">    <span class="n">pool_connections</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">pool_max_keepalive</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
</span><span data-line="12">
</span><span data-line="13">    <span class="c1"># Logging settings</span>
</span><span data-line="14">    <span class="n">log_level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
</span><span data-line="15">    <span class="n">log_format</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>  <span class="c1"># or &quot;text&quot;</span>
</span><span data-line="16">    <span class="n">log_redact_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="17">
</span><span data-line="18">    <span class="c1"># Request queuing (optional)</span>
</span><span data-line="19">    <span class="n">queue_enabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="20">    <span class="n">queue_size</span><span class="o">=</span><span class="mi">100</span>
</span><span data-line="21"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>HTTP Settings:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">timeout</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">30</span></code></p></td>
<td><p>Request timeout in seconds</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">max_retries</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p></td>
<td><p>Maximum retry attempts</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">verify_ssl</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
<td><p>Verify SSL certificates</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">follow_redirects</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
<td><p>Follow HTTP redirects</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Connection Pool:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pool_connections</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">10</span></code></p></td>
<td><p>Maximum connections per proxy</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">pool_max_keepalive</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">20</span></code></p></td>
<td><p>Maximum keepalive connections</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pool_timeout</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">30</span></code></p></td>
<td><p>Pool timeout in seconds</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Health Checks:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">health_check_enabled</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
<td><p>Enable health checking</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">health_check_interval_seconds</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">300</span></code></p></td>
<td><p>Seconds between checks</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">health_check_url</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">HttpUrl</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">http://httpbin.org/ip</span></code></p></td>
<td><p>URL for health checks</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">health_check_timeout</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">10</span></code></p></td>
<td><p>Health check timeout (seconds)</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Logging:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">log_level</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">str</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;INFO&quot;</span></code></p></td>
<td><p>Log level</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">log_format</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Literal[&quot;json&quot;,</span> <span class="pre">&quot;text&quot;]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;json&quot;</span></code></p></td>
<td><p>Log output format</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">log_redact_credentials</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">True</span></code></p></td>
<td><p>Redact credentials in logs</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Storage:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">storage_backend</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Literal[&quot;memory&quot;,</span> <span class="pre">&quot;sqlite&quot;,</span> <span class="pre">&quot;file&quot;]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;memory&quot;</span></code></p></td>
<td><p>Storage backend type</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">storage_path</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Path</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Storage file path</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Request Queuing:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">queue_enabled</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">bool</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">False</span></code></p></td>
<td><p>Enable request queuing when rate limited</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">queue_size</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">100</span></code></p></td>
<td><p>Maximum queue size (1-10000)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For TOML file configuration, see <a class="reference internal" href="configuration.html"><span class="std std-doc">Configuration</span></a>.</p>
</div>
</section>
<hr class="docutils" />
<section id="selectioncontext">
<h3>SelectionContext<a class="headerlink" href="#selectioncontext" title="Link to this heading">¶</a></h3>
<p>Context information for proxy selection decisions, used by strategies to make intelligent selections.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">SelectionContext</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">context</span> <span class="o">=</span> <span class="n">SelectionContext</span><span class="p">(</span>
</span><span data-line="4">    <span class="c1"># Session tracking</span>
</span><span data-line="5">    <span class="n">session_id</span><span class="o">=</span><span class="s2">&quot;user-123&quot;</span><span class="p">,</span>
</span><span data-line="6">
</span><span data-line="7">    <span class="c1"># Target information</span>
</span><span data-line="8">    <span class="n">target_url</span><span class="o">=</span><span class="s2">&quot;https://example.com/api&quot;</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">target_country</span><span class="o">=</span><span class="s2">&quot;US&quot;</span><span class="p">,</span>  <span class="c1"># ISO 3166-1 alpha-2</span>
</span><span data-line="10">    <span class="n">target_region</span><span class="o">=</span><span class="s2">&quot;California&quot;</span><span class="p">,</span>
</span><span data-line="11">
</span><span data-line="12">    <span class="c1"># Request metadata</span>
</span><span data-line="13">    <span class="n">request_priority</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># 0-10, higher = more important</span>
</span><span data-line="14">    <span class="n">timeout_ms</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
</span><span data-line="15">
</span><span data-line="16">    <span class="c1"># Retry context</span>
</span><span data-line="17">    <span class="n">failed_proxy_ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;proxy-1&quot;</span><span class="p">,</span> <span class="s2">&quot;proxy-2&quot;</span><span class="p">],</span>  <span class="c1"># Proxies that have failed</span>
</span><span data-line="18">    <span class="n">attempt_number</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># Current attempt (1-indexed)</span>
</span><span data-line="19">
</span><span data-line="20">    <span class="c1"># Custom metadata</span>
</span><span data-line="21">    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;secret&quot;</span><span class="p">,</span> <span class="s2">&quot;user_tier&quot;</span><span class="p">:</span> <span class="s2">&quot;premium&quot;</span><span class="p">}</span>
</span><span data-line="22"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Fields:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">session_id</span></code> (Optional[str]): Unique session identifier for sticky sessions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">target_url</span></code> (Optional[str]): The URL being accessed (for domain-based routing)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">target_country</span></code> (Optional[str]): Preferred country for geo-targeting (ISO 3166-1 alpha-2)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">target_region</span></code> (Optional[str]): Preferred region for geo-targeting</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">request_priority</span></code> (Optional[int]): Priority level (0-10, higher = more important)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeout_ms</span></code> (Optional[float]): Request timeout in milliseconds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failed_proxy_ids</span></code> (list[str]): List of proxy IDs that have failed for this request</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attempt_number</span></code> (int): Current attempt number (1-indexed, default: 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metadata</span></code> (dict[str, Any]): Additional context for custom selection logic</p></li>
</ul>
<p><strong>Config:</strong> Allows extra fields for extensibility.</p>
</section>
<hr class="docutils" />
<section id="strategyconfig">
<h3>StrategyConfig<a class="headerlink" href="#strategyconfig" title="Link to this heading">¶</a></h3>
<p>Configuration for rotation strategies with support for all strategy types.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">StrategyConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">config</span> <span class="o">=</span> <span class="n">StrategyConfig</span><span class="p">(</span>
</span><span data-line="4">    <span class="c1"># Weighted strategy</span>
</span><span data-line="5">    <span class="n">weights</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;http://proxy1.com:8080&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s2">&quot;http://proxy2.com:8080&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span>
</span><span data-line="6">
</span><span data-line="7">    <span class="c1"># Performance-based strategy</span>
</span><span data-line="8">    <span class="n">ema_alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>  <span class="c1"># EMA smoothing factor (0-1)</span>
</span><span data-line="9">    <span class="n">exploration_count</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Min trials for new proxies</span>
</span><span data-line="10">
</span><span data-line="11">    <span class="c1"># Session persistence strategy</span>
</span><span data-line="12">    <span class="n">session_stickiness_duration_seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>  <span class="c1"># 1 hour TTL</span>
</span><span data-line="13">
</span><span data-line="14">    <span class="c1"># Geo-targeted strategy</span>
</span><span data-line="15">    <span class="n">preferred_countries</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;US&quot;</span><span class="p">,</span> <span class="s2">&quot;GB&quot;</span><span class="p">],</span>
</span><span data-line="16">    <span class="n">preferred_regions</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;North America&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe&quot;</span><span class="p">],</span>
</span><span data-line="17">    <span class="n">geo_fallback_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="18">    <span class="n">geo_secondary_strategy</span><span class="o">=</span><span class="s2">&quot;round_robin&quot;</span><span class="p">,</span>
</span><span data-line="19">
</span><span data-line="20">    <span class="c1"># Fallback strategy</span>
</span><span data-line="21">    <span class="n">fallback_strategy</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
</span><span data-line="22">
</span><span data-line="23">    <span class="c1"># Performance thresholds</span>
</span><span data-line="24">    <span class="n">max_response_time_ms</span><span class="o">=</span><span class="mf">5000.0</span><span class="p">,</span>
</span><span data-line="25">    <span class="n">min_success_rate</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
</span><span data-line="26">
</span><span data-line="27">    <span class="c1"># Sliding window</span>
</span><span data-line="28">    <span class="n">window_duration_seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>  <span class="c1"># 1 hour</span>
</span><span data-line="29">
</span><span data-line="30">    <span class="c1"># Generic metadata</span>
</span><span data-line="31">    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;custom_key&quot;</span><span class="p">:</span> <span class="s2">&quot;custom_value&quot;</span><span class="p">}</span>
</span><span data-line="32"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Fields:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">weights</span></code> (Optional[dict[str, float]]): Proxy weights keyed by URL for weighted strategies</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ema_alpha</span></code> (float): EMA smoothing factor (0-1, default: 0.2)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">session_stickiness_duration_seconds</span></code> (int): Session TTL in seconds (default: 300)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">preferred_countries</span></code> (Optional[list[str]]): Preferred country codes (ISO 3166-1 alpha-2)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">preferred_regions</span></code> (Optional[list[str]]): Preferred region names</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geo_fallback_enabled</span></code> (bool): Fallback to any proxy when target unavailable (default: True)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geo_secondary_strategy</span></code> (str): Secondary strategy for geo-filtered selection (default: “round_robin”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fallback_strategy</span></code> (Optional[str]): Strategy when primary fails (default: “random”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_response_time_ms</span></code> (Optional[float]): Maximum acceptable response time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min_success_rate</span></code> (Optional[float]): Minimum acceptable success rate (0-1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">window_duration_seconds</span></code> (int): Sliding window duration for counter resets (default: 3600)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">exploration_count</span></code> (int): Min trials for new proxies in performance-based strategy (default: 5)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">metadata</span></code> (dict[str, Any]): Additional custom metadata for strategy-specific configuration</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="session">
<h3>Session<a class="headerlink" href="#session" title="Link to this heading">¶</a></h3>
<p>Session tracking for sticky proxy assignments with TTL and usage tracking.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Session</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">session_id</span><span class="o">=</span><span class="s2">&quot;user-123&quot;</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">proxy_id</span><span class="o">=</span><span class="s2">&quot;proxy-uuid-here&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">created_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="8">    <span class="n">expires_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">300</span><span class="p">),</span>
</span><span data-line="9">    <span class="n">last_used_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="10">    <span class="n">request_count</span><span class="o">=</span><span class="mi">0</span>
</span><span data-line="11"><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># Check expiration</span>
</span><span data-line="14"><span class="n">is_expired</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">is_expired</span><span class="p">()</span>  <span class="c1"># True if current time &gt;= expires_at</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># Update last usage</span>
</span><span data-line="17"><span class="n">session</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span>  <span class="c1"># Updates last_used_at and increments request_count</span>
</span></pre></div>
</div>
<p><strong>Fields:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">session_id</span></code> (str): Unique session identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proxy_id</span></code> (str): ID of the proxy assigned to this session</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">created_at</span></code> (datetime): When the session was created</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expires_at</span></code> (datetime): When the session expires (TTL)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last_used_at</span></code> (datetime): Last time this session was used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">request_count</span></code> (int): Number of requests made in this session (default: 0)</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">is_expired()</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code> - Check if session has expired (current time &gt;= expires_at)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">touch()</span></code> - Update last_used_at timestamp and increment request_count</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="cache-components">
<h2>Cache Components<a class="headerlink" href="#cache-components" title="Link to this heading">¶</a></h2>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For detailed cache system documentation, see <a class="reference internal" href="cache-api.html"><span class="std std-doc">Cache API</span></a>. For cache configuration patterns, see <a class="reference internal" href="../guides/caching.html"><span class="std std-doc">Caching</span></a>.</p>
</div>
<section id="cachemanager">
<h3>CacheManager<a class="headerlink" href="#cachemanager" title="Link to this heading">¶</a></h3>
<p>Multi-tier caching system with L1 (memory), L2 (JSONL file), L3 (SQLite).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheManager</span><span class="p">,</span> <span class="n">CacheConfig</span><span class="p">,</span> <span class="n">CacheEntry</span><span class="p">,</span> <span class="n">CacheTierConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheConfig</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">l1_config</span><span class="o">=</span><span class="n">CacheTierConfig</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_entries</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
</span><span data-line="5">    <span class="n">l2_config</span><span class="o">=</span><span class="n">CacheTierConfig</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_entries</span><span class="o">=</span><span class="mi">10000</span><span class="p">),</span>
</span><span data-line="6">    <span class="n">l3_config</span><span class="o">=</span><span class="n">CacheTierConfig</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_entries</span><span class="o">=</span><span class="mi">100000</span><span class="p">),</span>
</span><span data-line="7">    <span class="n">enable_background_cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">health_check_invalidation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">3</span>
</span><span data-line="10"><span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12"><span class="n">manager</span> <span class="o">=</span> <span class="n">CacheManager</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14"><span class="c1"># Store and retrieve entries</span>
</span><span data-line="15"><span class="n">entry</span> <span class="o">=</span> <span class="n">CacheEntry</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span data-line="16"><span class="n">manager</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
</span><span data-line="17"><span class="n">retrieved</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19"><span class="c1"># Invalidation</span>
</span><span data-line="20"><span class="n">manager</span><span class="o">.</span><span class="n">invalidate_by_health</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="21"><span class="n">manager</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># Statistics</span>
</span><span data-line="24"><span class="n">stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>
</span><span data-line="25">
</span><span data-line="26"><span class="c1"># Export/import</span>
</span><span data-line="27"><span class="n">manager</span><span class="o">.</span><span class="n">export_to_file</span><span class="p">(</span><span class="s2">&quot;proxies.jsonl&quot;</span><span class="p">)</span>
</span><span data-line="28"><span class="n">manager</span><span class="o">.</span><span class="n">warm_from_file</span><span class="p">(</span><span class="s2">&quot;proxies.jsonl&quot;</span><span class="p">,</span> <span class="n">ttl_override</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
</span></pre></div>
</div>
<p>For complete CacheManager documentation including all methods, see <a class="reference internal" href="cache-api.html"><span class="std std-doc">Cache API</span></a>.</p>
</section>
<hr class="docutils" />
<section id="cachehealthstatus">
<h3>CacheHealthStatus<a class="headerlink" href="#cachehealthstatus" title="Link to this heading">¶</a></h3>
<p>Alias for <code class="docutils literal notranslate"><span class="pre">HealthStatus</span></code> from the cache module. Re-exported at the top level for convenience when working with cache entry health states.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheHealthStatus</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Same enum as proxywhirl.cache.models.HealthStatus</span>
</span><span data-line="4"><span class="n">status</span> <span class="o">=</span> <span class="n">CacheHealthStatus</span><span class="o">.</span><span class="n">HEALTHY</span>
</span><span data-line="5"><span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># &quot;healthy&quot;</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="healthmonitor">
<h3>HealthMonitor<a class="headerlink" href="#healthmonitor" title="Link to this heading">¶</a></h3>
<p>Continuous health monitoring for proxy pools with automatic eviction of failing proxies.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">HealthMonitor</span><span class="p">,</span> <span class="n">ProxyPool</span><span class="p">,</span> <span class="n">Proxy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">pool</span> <span class="o">=</span> <span class="n">ProxyPool</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;my_pool&quot;</span><span class="p">)</span>
</span><span data-line="4"><span class="n">pool</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">))</span>
</span><span data-line="5">
</span><span data-line="6"><span class="n">monitor</span> <span class="o">=</span> <span class="n">HealthMonitor</span><span class="p">(</span>
</span><span data-line="7">    <span class="n">pool</span><span class="o">=</span><span class="n">pool</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">check_interval</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>       <span class="c1"># Seconds between health checks</span>
</span><span data-line="9">    <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">3</span>       <span class="c1"># Consecutive failures before eviction</span>
</span><span data-line="10"><span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># Start/stop background monitoring</span>
</span><span data-line="13"><span class="k">await</span> <span class="n">monitor</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span data-line="14"><span class="c1"># ... proxies are monitored continuously ...</span>
</span><span data-line="15"><span class="k">await</span> <span class="n">monitor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pool</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">ProxyPool</span></code></p></td>
<td><p>Required</p></td>
<td><p>ProxyPool to monitor</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">check_interval</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">60</span></code></p></td>
<td><p>Seconds between health checks (must be &gt; 0)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">failure_threshold</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p></td>
<td><p>Consecutive failures before eviction (must be &gt; 0)</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">start()</span></code> - Start background health monitoring (idempotent)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">stop()</span></code> - Stop background health monitoring</p></li>
</ul>
<p><strong>Attributes:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">is_running</span></code> (bool) - Whether monitoring is active</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="sourcestats">
<h3>SourceStats<a class="headerlink" href="#sourcestats" title="Link to this heading">¶</a></h3>
<p>Statistics for a proxy source, tracking fetch results and errors.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">SourceStats</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">stats</span> <span class="o">=</span> <span class="n">SourceStats</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">source_url</span><span class="o">=</span><span class="s2">&quot;https://api.example.com/proxies&quot;</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">total_fetched</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">valid_count</span><span class="o">=</span><span class="mi">85</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">invalid_count</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">fetch_failure_count</span><span class="o">=</span><span class="mi">0</span>
</span><span data-line="9"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Fields:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">source_url</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">str</span></code></p></td>
<td><p>Required</p></td>
<td><p>URL of the proxy source</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">total_fetched</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>Total proxies fetched from this source</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">valid_count</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>Number of valid proxies</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">invalid_count</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>Number of invalid proxies</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">last_fetch_at</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">datetime</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Timestamp of last fetch</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last_fetch_duration_ms</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">float</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Duration of last fetch in ms</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">fetch_failure_count</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>Number of failed fetches</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">last_error</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">str</span> <span class="pre">|</span> <span class="pre">None</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p></td>
<td><p>Last error message</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<hr class="docutils" />
<section id="hourlyaggregate">
<h3>HourlyAggregate<a class="headerlink" href="#hourlyaggregate" title="Link to this heading">¶</a></h3>
<p>Hourly aggregated retry metrics for time-series monitoring.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">HourlyAggregate</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">aggregate</span> <span class="o">=</span> <span class="n">HourlyAggregate</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">hour</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="5">    <span class="n">total_requests</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">total_retries</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">avg_latency</span><span class="o">=</span><span class="mf">150.0</span>
</span><span data-line="8"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Fields:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">hour</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">datetime</span></code></p></td>
<td><p>Required</p></td>
<td><p>Hour timestamp (truncated)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">total_requests</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>Total requests in this hour</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">total_retries</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>Total retries in this hour</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">success_by_attempt</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dict[int,</span> <span class="pre">int]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">{}</span></code></p></td>
<td><p>Success count by attempt number</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">failure_by_reason</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">dict[str,</span> <span class="pre">int]</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">{}</span></code></p></td>
<td><p>Failure count by error reason</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">avg_latency</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">float</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">0.0</span></code></p></td>
<td><p>Average latency in ms</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<hr class="docutils" />
<section id="circuitbreakerevent">
<h3>CircuitBreakerEvent<a class="headerlink" href="#circuitbreakerevent" title="Link to this heading">¶</a></h3>
<p>Records a circuit breaker state change for monitoring and metrics.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreakerEvent</span><span class="p">,</span> <span class="n">CircuitBreakerState</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">event</span> <span class="o">=</span> <span class="n">CircuitBreakerEvent</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">proxy_id</span><span class="o">=</span><span class="s2">&quot;proxy-1&quot;</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">from_state</span><span class="o">=</span><span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">CLOSED</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">to_state</span><span class="o">=</span><span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">OPEN</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="9">    <span class="n">failure_count</span><span class="o">=</span><span class="mi">5</span>
</span><span data-line="10"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Fields:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Field</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">proxy_id</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">str</span></code></p></td>
<td><p>Proxy ID</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">from_state</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CircuitBreakerState</span></code></p></td>
<td><p>Previous state</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">to_state</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CircuitBreakerState</span></code></p></td>
<td><p>New state</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">timestamp</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">datetime</span></code></p></td>
<td><p>When state changed</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">failure_count</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p>Failure count at time of change</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<hr class="docutils" />
<section id="cacheconfig">
<h3>CacheConfig<a class="headerlink" href="#cacheconfig" title="Link to this heading">¶</a></h3>
<p>Configuration for CacheManager with tier settings, TTL, and encryption.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheConfig</span><span class="p">,</span> <span class="n">CacheTierConfig</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecretStr</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheConfig</span><span class="p">(</span>
</span><span data-line="5">    <span class="c1"># Tier configuration</span>
</span><span data-line="6">    <span class="n">l1_config</span><span class="o">=</span><span class="n">CacheTierConfig</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_entries</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">eviction_policy</span><span class="o">=</span><span class="s2">&quot;lru&quot;</span><span class="p">),</span>
</span><span data-line="7">    <span class="n">l2_config</span><span class="o">=</span><span class="n">CacheTierConfig</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_entries</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">eviction_policy</span><span class="o">=</span><span class="s2">&quot;lru&quot;</span><span class="p">),</span>
</span><span data-line="8">    <span class="n">l3_config</span><span class="o">=</span><span class="n">CacheTierConfig</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_entries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eviction_policy</span><span class="o">=</span><span class="s2">&quot;lru&quot;</span><span class="p">),</span>
</span><span data-line="9">
</span><span data-line="10">    <span class="c1"># Storage paths</span>
</span><span data-line="11">    <span class="n">l2_cache_dir</span><span class="o">=</span><span class="s2">&quot;~/.cache/proxywhirl&quot;</span><span class="p">,</span>
</span><span data-line="12">    <span class="n">l3_database_path</span><span class="o">=</span><span class="s2">&quot;~/.cache/proxywhirl/cache.db&quot;</span><span class="p">,</span>
</span><span data-line="13">
</span><span data-line="14">    <span class="c1"># TTL configuration</span>
</span><span data-line="15">    <span class="n">default_ttl_seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>  <span class="c1"># 1 hour default</span>
</span><span data-line="16">    <span class="n">enable_background_cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="17">    <span class="n">cleanup_interval_seconds</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
</span><span data-line="18">    <span class="n">per_source_ttl</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;premium_source&quot;</span><span class="p">:</span> <span class="mi">7200</span><span class="p">},</span>  <span class="c1"># Per-source TTL overrides</span>
</span><span data-line="19">
</span><span data-line="20">    <span class="c1"># Health integration</span>
</span><span data-line="21">    <span class="n">health_check_invalidation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="22">    <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span data-line="23">
</span><span data-line="24">    <span class="c1"># Encryption</span>
</span><span data-line="25">    <span class="n">encryption_key</span><span class="o">=</span><span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;your-fernet-key-here&quot;</span><span class="p">),</span>
</span><span data-line="26">
</span><span data-line="27">    <span class="c1"># Performance</span>
</span><span data-line="28">    <span class="n">enable_statistics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="29">    <span class="n">statistics_interval</span><span class="o">=</span><span class="mi">5</span>
</span><span data-line="30"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Tier Configuration:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">l1_config</span></code> (CacheTierConfig): L1 (memory) tier configuration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l2_config</span></code> (CacheTierConfig): L2 (JSONL file) tier configuration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l3_config</span></code> (CacheTierConfig): L3 (SQLite) tier configuration</p></li>
</ul>
<p><strong>Storage Paths:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">l2_cache_dir</span></code> (str): Directory for L2 JSONL file cache (default: “.cache/proxies”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l3_database_path</span></code> (str): SQLite database path for L3 (default: “.cache/db/proxywhirl.db”)</p></li>
</ul>
<p><strong>TTL Configuration:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">default_ttl_seconds</span></code> (int): Default TTL for cached proxies (default: 3600)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ttl_cleanup_interval</span></code> (int): Background cleanup interval (default: 60)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">enable_background_cleanup</span></code> (bool): Enable background TTL cleanup thread (default: False)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cleanup_interval_seconds</span></code> (int): Interval between cleanup runs (default: 60)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">per_source_ttl</span></code> (dict[str, int]): Per-source TTL overrides</p></li>
</ul>
<p><strong>Encryption:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">encryption_key</span></code> (Optional[SecretStr]): Fernet encryption key (from env: <code class="docutils literal notranslate"><span class="pre">PROXYWHIRL_CACHE_ENCRYPTION_KEY</span></code>)</p></li>
</ul>
<p><strong>Health Integration:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">health_check_invalidation</span></code> (bool): Auto-invalidate on health check failure (default: True)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failure_threshold</span></code> (int): Failures before health invalidation (default: 3)</p></li>
</ul>
<p><strong>Performance:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enable_statistics</span></code> (bool): Track cache statistics (default: True)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">statistics_interval</span></code> (int): Stats aggregation interval in seconds (default: 5)</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="cacheentry">
<h3>CacheEntry<a class="headerlink" href="#cacheentry" title="Link to this heading">¶</a></h3>
<p>Individual cache entry with TTL, health tracking, and secure credential storage.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheEntry</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">HealthStatus</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecretStr</span>
</span><span data-line="5">
</span><span data-line="6"><span class="n">entry</span> <span class="o">=</span> <span class="n">CacheEntry</span><span class="p">(</span>
</span><span data-line="7">    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;cache_key_123&quot;</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">proxy_url</span><span class="o">=</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">username</span><span class="o">=</span><span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span>
</span><span data-line="10">    <span class="n">password</span><span class="o">=</span><span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;pass&quot;</span><span class="p">),</span>
</span><span data-line="11">    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;premium_source&quot;</span><span class="p">,</span>
</span><span data-line="12">    <span class="n">fetch_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="13">    <span class="n">last_accessed</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="14">    <span class="n">access_count</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="15">    <span class="n">ttl_seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>
</span><span data-line="16">    <span class="n">expires_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">),</span>
</span><span data-line="17">    <span class="n">health_status</span><span class="o">=</span><span class="n">HealthStatus</span><span class="o">.</span><span class="n">HEALTHY</span><span class="p">,</span>
</span><span data-line="18">    <span class="n">failure_count</span><span class="o">=</span><span class="mi">0</span>
</span><span data-line="19"><span class="p">)</span>
</span><span data-line="20">
</span><span data-line="21"><span class="c1"># Check expiration</span>
</span><span data-line="22"><span class="n">is_expired</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_expired</span>  <span class="c1"># Property</span>
</span><span data-line="23"><span class="n">is_healthy</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_healthy</span>  <span class="c1"># Property</span>
</span></pre></div>
</div>
<p><strong>Fields:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> (str): Unique cache key (proxy URL hash)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proxy_url</span></code> (str): Full proxy URL (scheme://host:port)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">username</span></code>, <code class="docutils literal notranslate"><span class="pre">password</span></code> (Optional[SecretStr]): Proxy credentials (encrypted at rest)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code> (str): Proxy source identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fetch_time</span></code> (datetime): When proxy was fetched</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last_accessed</span></code> (datetime): Last cache access time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">access_count</span></code> (int): Number of cache hits (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ttl_seconds</span></code> (int): Time-to-live in seconds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expires_at</span></code> (datetime): Absolute expiration time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">health_status</span></code> (HealthStatus): Current health status (UNKNOWN, HEALTHY, DEGRADED, UNHEALTHY, DEAD)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failure_count</span></code> (int): Consecutive failures (default: 0)</p></li>
</ul>
<p><strong>Health Monitoring Fields (Feature 006):</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">last_health_check</span></code> (Optional[datetime]): Last health check timestamp</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">consecutive_health_failures</span></code> (int): Consecutive health check failures</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">consecutive_health_successes</span></code> (int): Consecutive successful health checks</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">recovery_attempt</span></code> (int): Current recovery attempt count</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">next_check_time</span></code> (Optional[datetime]): Scheduled next health check</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last_health_error</span></code> (Optional[str]): Last health check error message</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">total_health_checks</span></code> (int): Total health checks performed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">total_health_check_failures</span></code> (int): Total health check failures</p></li>
</ul>
<p><strong>Properties:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">is_expired</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code> - Check if entry has expired based on TTL</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">is_healthy</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code> - Check if proxy is healthy (health_status == HEALTHY)</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="cachestatistics">
<h3>CacheStatistics<a class="headerlink" href="#cachestatistics" title="Link to this heading">¶</a></h3>
<p>Aggregate cache statistics across all tiers with hit rates and promotions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheManager</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">manager</span> <span class="o">=</span> <span class="n">CacheManager</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span><span data-line="4"><span class="n">stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># L1 (memory) tier stats</span>
</span><span data-line="7"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L1 hits: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">l1_stats</span><span class="o">.</span><span class="n">hits</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="8"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L1 misses: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">l1_stats</span><span class="o">.</span><span class="n">misses</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="9"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L1 hit rate: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">l1_stats</span><span class="o">.</span><span class="n">hit_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Computed property</span>
</span><span data-line="10"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L1 current size: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">l1_stats</span><span class="o">.</span><span class="n">current_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="11"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L1 evictions: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">l1_stats</span><span class="o">.</span><span class="n">total_evictions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Computed property</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># L2 (file) tier stats</span>
</span><span data-line="14"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L2 hit rate: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">l2_stats</span><span class="o">.</span><span class="n">hit_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># L3 (SQLite) tier stats</span>
</span><span data-line="17"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L3 hit rate: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">l3_stats</span><span class="o">.</span><span class="n">hit_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19"><span class="c1"># Cross-tier operations</span>
</span><span data-line="20"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Promotions (L3→L2→L1): </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">promotions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="21"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Demotions (L1→L2→L3): </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">demotions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># Overall stats</span>
</span><span data-line="24"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall hit rate: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">overall_hit_rate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Computed property</span>
</span><span data-line="25"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total cached entries: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">total_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Computed property</span>
</span><span data-line="26">
</span><span data-line="27"><span class="c1"># Degradation tracking</span>
</span><span data-line="28"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L1 degraded: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">l1_degraded</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="29"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L2 degraded: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">l2_degraded</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="30"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L3 degraded: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">l3_degraded</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Fields:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">l1_stats</span></code> (TierStatistics): L1 tier statistics</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l2_stats</span></code> (TierStatistics): L2 tier statistics</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l3_stats</span></code> (TierStatistics): L3 tier statistics</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">promotions</span></code> (int): Cross-tier promotions (L3→L2→L1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">demotions</span></code> (int): Cross-tier demotions (L1→L2→L3)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l1_degraded</span></code>, <code class="docutils literal notranslate"><span class="pre">l2_degraded</span></code>, <code class="docutils literal notranslate"><span class="pre">l3_degraded</span></code> (bool): Tier degradation flags</p></li>
</ul>
<p><strong>Computed Properties:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">overall_hit_rate</span> <span class="pre">-&gt;</span> <span class="pre">float</span></code> - Overall hit rate across all tiers (0.0-1.0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">total_size</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code> - Total cached entries across all tiers</p></li>
</ul>
<p><strong>TierStatistics Fields:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hits</span></code> (int): Cache hits</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">misses</span></code> (int): Cache misses</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">current_size</span></code> (int): Current number of entries</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">evictions_lru</span></code> (int): LRU evictions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">evictions_ttl</span></code> (int): TTL expirations</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">evictions_health</span></code> (int): Health-based evictions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">evictions_corruption</span></code> (int): Corruption-based evictions</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">hit_rate</span> <span class="pre">-&gt;</span> <span class="pre">float</span></code> - Cache hit rate (0.0-1.0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;property</span> <span class="pre">total_evictions</span> <span class="pre">-&gt;</span> <span class="pre">int</span></code> - Total evictions across all reasons</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="retry-failover">
<h2>Retry &amp; Failover<a class="headerlink" href="#retry-failover" title="Link to this heading">¶</a></h2>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For retry and failover configuration patterns, see <a class="reference internal" href="../guides/retry-failover.html"><span class="std std-doc">Retry &amp; Failover</span></a>.</p>
</div>
<section id="retrypolicy">
<h3>RetryPolicy<a class="headerlink" href="#retrypolicy" title="Link to this heading">¶</a></h3>
<p>Configuration for retry behavior with configurable backoff strategies.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">RetryPolicy</span><span class="p">,</span> <span class="n">BackoffStrategy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">max_attempts</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># 1-10</span>
</span><span data-line="5">    <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">EXPONENTIAL</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">base_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Base delay in seconds</span>
</span><span data-line="7">    <span class="n">multiplier</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>  <span class="c1"># Backoff multiplier for exponential</span>
</span><span data-line="8">    <span class="n">max_backoff_delay</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>  <span class="c1"># Cap at 30 seconds</span>
</span><span data-line="9">    <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Add random jitter (0.5x-1.5x)</span>
</span><span data-line="10">    <span class="n">retry_status_codes</span><span class="o">=</span><span class="p">[</span><span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">],</span>  <span class="c1"># Retry on these 5xx errors</span>
</span><span data-line="11">    <span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>  <span class="c1"># Total timeout in seconds</span>
</span><span data-line="12">    <span class="n">retry_non_idempotent</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># Don&#39;t retry POST/PUT/PATCH by default</span>
</span><span data-line="13"><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Calculate delay for attempt</span>
</span><span data-line="16"><span class="n">delay</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">calculate_delay</span><span class="p">(</span><span class="n">attempt</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># First retry delay</span>
</span><span data-line="17"><span class="n">delay</span> <span class="o">=</span> <span class="n">policy</span><span class="o">.</span><span class="n">calculate_delay</span><span class="p">(</span><span class="n">attempt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Second retry delay</span>
</span></pre></div>
</div>
<p><strong>Fields:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_attempts</span></code> (int): Maximum retry attempts (1-10, default: 3)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">backoff_strategy</span></code> (BackoffStrategy): Timing strategy</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">EXPONENTIAL</span></code>: base_delay * (multiplier ^ attempt)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LINEAR</span></code>: base_delay * (attempt + 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FIXED</span></code>: base_delay (constant)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">base_delay</span></code> (float): Base delay in seconds ((0, 60], default: 1.0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">multiplier</span></code> (float): Backoff multiplier ((1, 10], default: 2.0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_backoff_delay</span></code> (float): Maximum backoff delay ((0, 300], default: 30.0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jitter</span></code> (bool): Add random jitter to delays (default: False)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">retry_status_codes</span></code> (list[int]): HTTP status codes to retry (default: [502, 503, 504])</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeout</span></code> (Optional[float]): Total timeout in seconds (optional)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">retry_non_idempotent</span></code> (bool): Retry non-idempotent methods (POST/PUT/PATCH, default: False)</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">calculate_delay(attempt:</span> <span class="pre">int,</span> <span class="pre">previous_delay:</span> <span class="pre">float</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None)</span> <span class="pre">-&gt;</span> <span class="pre">float</span></code> - Calculate delay for given attempt number (0-indexed)</p>
<ul>
<li><p>Applies backoff strategy</p></li>
<li><p>Caps at max_backoff_delay</p></li>
<li><p>Adds jitter if enabled using AWS decorrelated jitter algorithm: <code class="docutils literal notranslate"><span class="pre">delay</span> <span class="pre">=</span> <span class="pre">min(cap,</span> <span class="pre">random(base,</span> <span class="pre">previous_delay</span> <span class="pre">*</span> <span class="pre">3))</span></code></p></li>
</ul>
</li>
</ul>
<p><strong>Validators:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">retry_status_codes</span></code> must be 5xx errors (500-599)</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="retryexecutor">
<h3>RetryExecutor<a class="headerlink" href="#retryexecutor" title="Link to this heading">¶</a></h3>
<p>Execute requests with automatic retry logic, circuit breaker integration, and metrics collection.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">RetryExecutor</span><span class="p">,</span> <span class="n">RetryPolicy</span><span class="p">,</span> <span class="n">RetryMetrics</span><span class="p">,</span> <span class="n">CircuitBreaker</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span><span class="n">max_attempts</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span data-line="4"><span class="n">circuit_breakers</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="5">    <span class="s2">&quot;proxy-1&quot;</span><span class="p">:</span> <span class="n">CircuitBreaker</span><span class="p">(</span><span class="n">proxy_id</span><span class="o">=</span><span class="s2">&quot;proxy-1&quot;</span><span class="p">),</span>
</span><span data-line="6">    <span class="s2">&quot;proxy-2&quot;</span><span class="p">:</span> <span class="n">CircuitBreaker</span><span class="p">(</span><span class="n">proxy_id</span><span class="o">=</span><span class="s2">&quot;proxy-2&quot;</span><span class="p">)</span>
</span><span data-line="7"><span class="p">}</span>
</span><span data-line="8"><span class="n">metrics</span> <span class="o">=</span> <span class="n">RetryMetrics</span><span class="p">()</span>
</span><span data-line="9">
</span><span data-line="10"><span class="n">executor</span> <span class="o">=</span> <span class="n">RetryExecutor</span><span class="p">(</span><span class="n">policy</span><span class="p">,</span> <span class="n">circuit_breakers</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># Execute with retry</span>
</span><span data-line="13"><span class="k">def</span><span class="w"> </span><span class="nf">request_fn</span><span class="p">():</span>
</span><span data-line="14">    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="n">response</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">execute_with_retry</span><span class="p">(</span>
</span><span data-line="17">    <span class="n">request_fn</span><span class="p">,</span>
</span><span data-line="18">    <span class="n">proxy</span><span class="p">,</span>
</span><span data-line="19">    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
</span><span data-line="20">    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">,</span>
</span><span data-line="21">    <span class="n">request_id</span><span class="o">=</span><span class="s2">&quot;optional-request-id&quot;</span>
</span><span data-line="22"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">retry_policy</span></code> (RetryPolicy): Retry configuration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">circuit_breakers</span></code> (dict[str, CircuitBreaker]): Circuit breakers by proxy ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">retry_metrics</span></code> (RetryMetrics): Metrics collection instance</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">execute_with_retry(request_fn,</span> <span class="pre">proxy,</span> <span class="pre">method,</span> <span class="pre">url,</span> <span class="pre">request_id=None)</span> <span class="pre">-&gt;</span> <span class="pre">httpx.Response</span></code></p>
<ul>
<li><p>Executes request with retry logic</p></li>
<li><p>Checks circuit breaker state before each attempt</p></li>
<li><p>Records metrics for each attempt</p></li>
<li><p>Applies backoff delays between retries</p></li>
<li><p>Respects total timeout if configured</p></li>
<li><p>Raises <code class="docutils literal notranslate"><span class="pre">NonRetryableError</span></code> for non-retryable errors (e.g., auth failures)</p></li>
<li><p>Raises <code class="docutils literal notranslate"><span class="pre">ProxyConnectionError</span></code> if all retries exhausted</p></li>
</ul>
</li>
</ul>
<p><strong>Exceptions:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RetryableError</span></code>: Exception that triggers a retry</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NonRetryableError</span></code>: Exception that does not trigger a retry (e.g., authentication failures)</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="circuitbreaker">
<h3>CircuitBreaker<a class="headerlink" href="#circuitbreaker" title="Link to this heading">¶</a></h3>
<p>Circuit breaker pattern for proxy failure management with rolling failure window.</p>
<p>Implements three states: CLOSED (normal), OPEN (proxy excluded), HALF_OPEN (testing recovery).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreaker</span><span class="p">,</span> <span class="n">CircuitBreakerState</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">breaker</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">proxy_id</span><span class="o">=</span><span class="s2">&quot;proxy-1&quot;</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Open after 5 failures</span>
</span><span data-line="6">    <span class="n">window_duration</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>  <span class="c1"># 60s rolling window</span>
</span><span data-line="7">    <span class="n">timeout_duration</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>  <span class="c1"># Stay open for 30s</span>
</span><span data-line="8">    <span class="n">persist_state</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># Enable persistence across restarts</span>
</span><span data-line="9"><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># Check if proxy is available</span>
</span><span data-line="12"><span class="k">if</span> <span class="n">breaker</span><span class="o">.</span><span class="n">should_attempt_request</span><span class="p">():</span>
</span><span data-line="13">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="14">        <span class="c1"># Make request</span>
</span><span data-line="15">        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="16">        <span class="n">breaker</span><span class="o">.</span><span class="n">record_success</span><span class="p">()</span>  <span class="c1"># Close circuit if HALF_OPEN</span>
</span><span data-line="17">    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span data-line="18">        <span class="n">breaker</span><span class="o">.</span><span class="n">record_failure</span><span class="p">()</span>  <span class="c1"># May open circuit if threshold reached</span>
</span><span data-line="19">
</span><span data-line="20"><span class="c1"># Manual reset</span>
</span><span data-line="21"><span class="n">breaker</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>  <span class="c1"># Force CLOSED state</span>
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># Check state</span>
</span><span data-line="24"><span class="nb">print</span><span class="p">(</span><span class="n">breaker</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>  <span class="c1"># CLOSED, OPEN, or HALF_OPEN</span>
</span><span data-line="25"><span class="nb">print</span><span class="p">(</span><span class="n">breaker</span><span class="o">.</span><span class="n">failure_count</span><span class="p">)</span>
</span><span data-line="26"><span class="nb">print</span><span class="p">(</span><span class="n">breaker</span><span class="o">.</span><span class="n">next_test_time</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">proxy_id</span></code> (str): Unique proxy identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failure_threshold</span></code> (int): Number of failures before opening circuit (default: 5)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">window_duration</span></code> (float): Rolling window duration in seconds (default: 60.0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timeout_duration</span></code> (float): Circuit open duration in seconds (default: 30.0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">persist_state</span></code> (bool): Enable state persistence across restarts (default: False)</p></li>
</ul>
<p><strong>Fields:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">proxy_id</span></code> (str): Unique proxy identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">state</span></code> (CircuitBreakerState): Current state (CLOSED, OPEN, HALF_OPEN)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failure_count</span></code> (int): Current failure count in window</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failure_window</span></code> (deque[float]): Rolling window of failure timestamps</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">next_test_time</span></code> (Optional[float]): When to attempt recovery (OPEN → HALF_OPEN)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last_state_change</span></code> (datetime): When state last changed</p></li>
</ul>
<p><strong>States:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CLOSED</span></code>: Normal operation, proxy available</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OPEN</span></code>: Proxy excluded from rotation (too many failures)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HALF_OPEN</span></code>: Testing recovery with limited requests (one test request allowed)</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">record_failure()</span></code> - Record a failure and update state</p>
<ul>
<li><p>Adds failure to rolling window</p></li>
<li><p>Removes failures outside window (older than window_duration)</p></li>
<li><p>Transitions to OPEN if failure_count &gt;= failure_threshold</p></li>
<li><p>If in HALF_OPEN, transitions back to OPEN (test failed)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">record_success()</span></code> - Record a success</p>
<ul>
<li><p>If in HALF_OPEN, transitions to CLOSED (recovery successful)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">should_attempt_request()</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code> - Check if proxy is available for requests</p>
<ul>
<li><p>Returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if CLOSED</p></li>
<li><p>Returns <code class="docutils literal notranslate"><span class="pre">False</span></code> if OPEN (unless timeout elapsed, then transitions to HALF_OPEN and returns <code class="docutils literal notranslate"><span class="pre">True</span></code>)</p></li>
<li><p>Returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if HALF_OPEN</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">reset()</span></code> - Manually reset to CLOSED state (clears failure window)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">set_storage(storage)</span></code> - Set storage backend for state persistence</p></li>
</ul>
<p><strong>Factory Method:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&#64;classmethod</span> <span class="pre">async</span> <span class="pre">create_with_storage(proxy_id,</span> <span class="pre">storage=None,</span> <span class="pre">config=None,</span> <span class="pre">**kwargs)</span> <span class="pre">-&gt;</span> <span class="pre">CircuitBreaker</span></code></p>
<ul>
<li><p>Creates circuit breaker with optional state restoration from storage</p></li>
<li><p>Recommended for persistence-enabled circuit breakers</p></li>
</ul>
</li>
</ul>
<p><strong>Thread Safety:</strong> Uses <code class="docutils literal notranslate"><span class="pre">threading.Lock</span></code> for thread-safe state updates.</p>
</section>
<hr class="docutils" />
<section id="retrymetrics">
<h3>RetryMetrics<a class="headerlink" href="#retrymetrics" title="Link to this heading">¶</a></h3>
<p>Track retry attempts, circuit breaker events, and hourly aggregates for monitoring.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">RetryMetrics</span><span class="p">,</span> <span class="n">RetryAttempt</span><span class="p">,</span> <span class="n">RetryOutcome</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">metrics</span> <span class="o">=</span> <span class="n">RetryMetrics</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">retention_hours</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>  <span class="c1"># Keep data for 24 hours</span>
</span><span data-line="5">    <span class="n">max_current_attempts</span><span class="o">=</span><span class="mi">10000</span>  <span class="c1"># Max raw attempts before auto-eviction</span>
</span><span data-line="6"><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Record attempt (done automatically by RetryExecutor)</span>
</span><span data-line="9"><span class="n">attempt</span> <span class="o">=</span> <span class="n">RetryAttempt</span><span class="p">(</span>
</span><span data-line="10">    <span class="n">request_id</span><span class="o">=</span><span class="s2">&quot;req-123&quot;</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">attempt_number</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="12">    <span class="n">proxy_id</span><span class="o">=</span><span class="s2">&quot;proxy-1&quot;</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="14">    <span class="n">outcome</span><span class="o">=</span><span class="n">RetryOutcome</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">,</span>
</span><span data-line="15">    <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
</span><span data-line="16">    <span class="n">delay_before</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span data-line="17">    <span class="n">latency</span><span class="o">=</span><span class="mf">150.0</span><span class="p">,</span>
</span><span data-line="18">    <span class="n">error_message</span><span class="o">=</span><span class="kc">None</span>
</span><span data-line="19"><span class="p">)</span>
</span><span data-line="20"><span class="n">metrics</span><span class="o">.</span><span class="n">record_attempt</span><span class="p">(</span><span class="n">attempt</span><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22"><span class="c1"># Aggregate current attempts into hourly summaries</span>
</span><span data-line="23"><span class="n">metrics</span><span class="o">.</span><span class="n">aggregate_hourly</span><span class="p">()</span>
</span><span data-line="24">
</span><span data-line="25"><span class="c1"># Get summary statistics</span>
</span><span data-line="26"><span class="n">summary</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_summary</span><span class="p">()</span>
</span><span data-line="27"><span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
</span><span data-line="28"><span class="c1"># {</span>
</span><span data-line="29"><span class="c1">#     &quot;total_retries&quot;: 1234,</span>
</span><span data-line="30"><span class="c1">#     &quot;success_by_attempt&quot;: {0: 800, 1: 300, 2: 100},</span>
</span><span data-line="31"><span class="c1">#     &quot;circuit_breaker_events_count&quot;: 45,</span>
</span><span data-line="32"><span class="c1">#     &quot;retention_hours&quot;: 24</span>
</span><span data-line="33"><span class="c1"># }</span>
</span><span data-line="34">
</span><span data-line="35"><span class="c1"># Get time-series data</span>
</span><span data-line="36"><span class="n">timeseries</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_timeseries</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
</span><span data-line="37"><span class="c1"># [</span>
</span><span data-line="38"><span class="c1">#     {</span>
</span><span data-line="39"><span class="c1">#         &quot;timestamp&quot;: &quot;2023-01-01T00:00:00+00:00&quot;,</span>
</span><span data-line="40"><span class="c1">#         &quot;total_requests&quot;: 100,</span>
</span><span data-line="41"><span class="c1">#         &quot;total_retries&quot;: 120,</span>
</span><span data-line="42"><span class="c1">#         &quot;success_rate&quot;: 0.95,</span>
</span><span data-line="43"><span class="c1">#         &quot;avg_latency&quot;: 150.0</span>
</span><span data-line="44"><span class="c1">#     },</span>
</span><span data-line="45"><span class="c1">#     ...</span>
</span><span data-line="46"><span class="c1"># ]</span>
</span><span data-line="47">
</span><span data-line="48"><span class="c1"># Get per-proxy statistics</span>
</span><span data-line="49"><span class="n">by_proxy</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_by_proxy</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
</span><span data-line="50"><span class="c1"># {</span>
</span><span data-line="51"><span class="c1">#     &quot;proxy-1&quot;: {</span>
</span><span data-line="52"><span class="c1">#         &quot;total_attempts&quot;: 100,</span>
</span><span data-line="53"><span class="c1">#         &quot;success_count&quot;: 95,</span>
</span><span data-line="54"><span class="c1">#         &quot;failure_count&quot;: 5,</span>
</span><span data-line="55"><span class="c1">#         &quot;total_latency&quot;: 15000.0,</span>
</span><span data-line="56"><span class="c1">#         &quot;circuit_breaker_opens&quot;: 2</span>
</span><span data-line="57"><span class="c1">#     },</span>
</span><span data-line="58"><span class="c1">#     ...</span>
</span><span data-line="59"><span class="c1"># }</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">retention_hours</span></code> (int): How long to keep historical data (default: 24)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_current_attempts</span></code> (int): Max raw attempts before auto-eviction (default: 10000)</p></li>
</ul>
<p><strong>Fields:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">current_attempts</span></code> (deque[RetryAttempt]): Raw attempts in current period (bounded by <code class="docutils literal notranslate"><span class="pre">max_current_attempts</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hourly_aggregates</span></code> (dict[datetime, HourlyAggregate]): Historical hourly summaries</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">circuit_breaker_events</span></code> (list[CircuitBreakerEvent]): Circuit breaker state changes (max 1000)</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">record_attempt(attempt:</span> <span class="pre">RetryAttempt)</span></code> - Record a retry attempt (auto-evicts oldest when at max_current_attempts)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">record_circuit_breaker_event(event:</span> <span class="pre">CircuitBreakerEvent)</span></code> - Record circuit breaker state change</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aggregate_hourly()</span></code> - Aggregate current_attempts into hourly summaries (removes old data)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_summary()</span> <span class="pre">-&gt;</span> <span class="pre">dict</span></code> - Get metrics summary (total retries, success by attempt, circuit breaker events)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_timeseries(hours:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">24)</span> <span class="pre">-&gt;</span> <span class="pre">list[dict]</span></code> - Get time-series data for specified hours</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">get_by_proxy(hours:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">24)</span> <span class="pre">-&gt;</span> <span class="pre">dict</span></code> - Get per-proxy retry statistics</p></li>
</ul>
<p><strong>Data Models:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RetryAttempt</span></code>: Single retry attempt record</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">request_id</span></code> (str): Request identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attempt_number</span></code> (int): Attempt number (0-indexed)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proxy_id</span></code> (str): Proxy ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timestamp</span></code> (datetime): When attempt occurred</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outcome</span></code> (RetryOutcome): SUCCESS, FAILURE, TIMEOUT, or CIRCUIT_OPEN</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">status_code</span></code> (Optional[int]): HTTP status code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delay_before</span></code> (float): Delay before this attempt</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">latency</span></code> (float): Request latency</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_message</span></code> (Optional[str]): Error message if failed</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">RetryOutcome</span></code> (Enum): SUCCESS, FAILURE, TIMEOUT, CIRCUIT_OPEN</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CircuitBreakerEvent</span></code>: Circuit breaker state change</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">proxy_id</span></code> (str): Proxy ID</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from_state</span></code> (CircuitBreakerState): Previous state</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">to_state</span></code> (CircuitBreakerState): New state</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timestamp</span></code> (datetime): When state changed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failure_count</span></code> (int): Failure count at time of change</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">HourlyAggregate</span></code>: Hourly aggregated metrics</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">hour</span></code> (datetime): Hour timestamp (truncated)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">total_requests</span></code> (int): Total requests in this hour</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">total_retries</span></code> (int): Total retries in this hour</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">success_by_attempt</span></code> (dict[int, int]): Success count by attempt number</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failure_by_reason</span></code> (dict[str, int]): Failure count by error reason</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">avg_latency</span></code> (float): Average latency</p></li>
</ul>
</li>
</ul>
<p><strong>Thread Safety:</strong> Uses <code class="docutils literal notranslate"><span class="pre">threading.Lock</span></code> for thread-safe operations.</p>
</section>
</section>
<hr class="docutils" />
<section id="parsers">
<h2>Parsers<a class="headerlink" href="#parsers" title="Link to this heading">¶</a></h2>
<section id="jsonparser">
<h3>JSONParser<a class="headerlink" href="#jsonparser" title="Link to this heading">¶</a></h3>
<p>Parse JSON-formatted proxy lists with key extraction and field validation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">JSONParser</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Parse array directly</span>
</span><span data-line="4"><span class="n">parser</span> <span class="o">=</span> <span class="n">JSONParser</span><span class="p">()</span>
</span><span data-line="5"><span class="n">proxies</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;[{&quot;host&quot;: &quot;1.2.3.4&quot;, &quot;port&quot;: 8080}]&#39;</span><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Extract from key</span>
</span><span data-line="8"><span class="n">parser</span> <span class="o">=</span> <span class="n">JSONParser</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;proxies&quot;</span><span class="p">)</span>
</span><span data-line="9"><span class="n">proxies</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;{&quot;proxies&quot;: [{&quot;host&quot;: &quot;1.2.3.4&quot;, &quot;port&quot;: 8080}]}&#39;</span><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># Require specific fields</span>
</span><span data-line="12"><span class="n">parser</span> <span class="o">=</span> <span class="n">JSONParser</span><span class="p">(</span>
</span><span data-line="13">    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;proxies&quot;</span><span class="p">,</span>
</span><span data-line="14">    <span class="n">required_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="s2">&quot;protocol&quot;</span><span class="p">]</span>
</span><span data-line="15"><span class="p">)</span>
</span><span data-line="16"><span class="n">proxies</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;{&quot;proxies&quot;: [{&quot;host&quot;: &quot;1.2.3.4&quot;, &quot;port&quot;: 8080, &quot;protocol&quot;: &quot;http&quot;}]}&#39;</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> (Optional[str]): Optional key to extract from JSON object (if JSON is an object, not array)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">required_fields</span></code> (Optional[list[str]]): Fields that must be present in each proxy</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parse(data:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">list[dict]</span></code> - Parse JSON proxy data</p>
<ul>
<li><p>Validates JSON format</p></li>
<li><p>Extracts from key if specified</p></li>
<li><p>Ensures result is a list</p></li>
<li><p>Validates required fields if specified</p></li>
<li><p>Raises <code class="docutils literal notranslate"><span class="pre">ProxyFetchError</span></code> for invalid JSON</p></li>
<li><p>Raises <code class="docutils literal notranslate"><span class="pre">ProxyValidationError</span></code> for missing required fields</p></li>
</ul>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="csvparser">
<h3>CSVParser<a class="headerlink" href="#csvparser" title="Link to this heading">¶</a></h3>
<p>Parse CSV-formatted proxy lists with header detection and column mapping.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CSVParser</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Parse with header row</span>
</span><span data-line="4"><span class="n">parser</span> <span class="o">=</span> <span class="n">CSVParser</span><span class="p">(</span><span class="n">has_header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="5"><span class="n">proxies</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span data-line="6"><span class="s2">host,port,protocol</span>
</span><span data-line="7"><span class="s2">1.2.3.4,8080,http</span>
</span><span data-line="8"><span class="s2">2.3.4.5,8080,https</span>
</span><span data-line="9"><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># Parse without header (provide column names)</span>
</span><span data-line="12"><span class="n">parser</span> <span class="o">=</span> <span class="n">CSVParser</span><span class="p">(</span>
</span><span data-line="13">    <span class="n">has_header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="14">    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="s2">&quot;protocol&quot;</span><span class="p">]</span>
</span><span data-line="15"><span class="p">)</span>
</span><span data-line="16"><span class="n">proxies</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;1.2.3.4,8080,http&quot;</span><span class="p">)</span>
</span><span data-line="17">
</span><span data-line="18"><span class="c1"># Skip invalid rows</span>
</span><span data-line="19"><span class="n">parser</span> <span class="o">=</span> <span class="n">CSVParser</span><span class="p">(</span><span class="n">has_header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skip_invalid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="20"><span class="n">proxies</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">csv_data</span><span class="p">)</span>  <span class="c1"># Skips malformed rows</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">has_header</span></code> (bool): Whether CSV has header row (default: True)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns</span></code> (Optional[list[str]]): Column names if no header (required if <code class="docutils literal notranslate"><span class="pre">has_header=False</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">skip_invalid</span></code> (bool): Skip malformed rows instead of raising error (default: False)</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parse(data:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">list[dict]</span></code> - Parse CSV proxy data</p>
<ul>
<li><p>Returns list of dictionaries with column names as keys</p></li>
<li><p>Raises <code class="docutils literal notranslate"><span class="pre">ProxyFetchError</span></code> for malformed CSV (unless <code class="docutils literal notranslate"><span class="pre">skip_invalid=True</span></code>)</p></li>
</ul>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="plaintextparser">
<h3>PlainTextParser<a class="headerlink" href="#plaintextparser" title="Link to this heading">¶</a></h3>
<p>Parse plain text proxy lists (one proxy per line).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">PlainTextParser</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">parser</span> <span class="o">=</span> <span class="n">PlainTextParser</span><span class="p">(</span><span class="n">skip_invalid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="4">
</span><span data-line="5"><span class="n">proxies</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span data-line="6"><span class="s2">http://proxy1.example.com:8080</span>
</span><span data-line="7"><span class="s2">http://user:pass@proxy2.example.com:8080</span>
</span><span data-line="8"><span class="s2"># This is a comment (skipped)</span>
</span><span data-line="9">
</span><span data-line="10"><span class="s2">socks5://proxy3.example.com:1080</span>
</span><span data-line="11"><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</span><span data-line="12"><span class="c1"># Returns: [</span>
</span><span data-line="13"><span class="c1">#     {&quot;url&quot;: &quot;http://proxy1.example.com:8080&quot;},</span>
</span><span data-line="14"><span class="c1">#     {&quot;url&quot;: &quot;http://user:pass@proxy2.example.com:8080&quot;},</span>
</span><span data-line="15"><span class="c1">#     {&quot;url&quot;: &quot;socks5://proxy3.example.com:1080&quot;}</span>
</span><span data-line="16"><span class="c1"># ]</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">skip_invalid</span></code> (bool): Skip invalid URLs instead of raising error (default: False)</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parse(data:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">list[dict]</span></code> - Parse plain text proxy data</p>
<ul>
<li><p>Returns list of dictionaries with <code class="docutils literal notranslate"><span class="pre">url</span></code> key</p></li>
<li><p>Skips empty lines</p></li>
<li><p>Skips comments (lines starting with <code class="docutils literal notranslate"><span class="pre">#</span></code>)</p></li>
<li><p>Validates URL format (scheme and netloc required)</p></li>
<li><p>Raises <code class="docutils literal notranslate"><span class="pre">ProxyFetchError</span></code> for invalid URLs (unless <code class="docutils literal notranslate"><span class="pre">skip_invalid=True</span></code>)</p></li>
</ul>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="htmltableparser">
<h3>HTMLTableParser<a class="headerlink" href="#htmltableparser" title="Link to this heading">¶</a></h3>
<p>Parse HTML table-formatted proxy lists with CSS selector and column mapping.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">HTMLTableParser</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Parse with column indices</span>
</span><span data-line="4"><span class="n">parser</span> <span class="o">=</span> <span class="n">HTMLTableParser</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">table_selector</span><span class="o">=</span><span class="s2">&quot;table.proxies&quot;</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">column_indices</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;protocol&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</span><span data-line="7"><span class="p">)</span>
</span><span data-line="8"><span class="n">proxies</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">html_data</span><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Parse with header mapping</span>
</span><span data-line="11"><span class="n">parser</span> <span class="o">=</span> <span class="n">HTMLTableParser</span><span class="p">(</span>
</span><span data-line="12">    <span class="n">table_selector</span><span class="o">=</span><span class="s2">&quot;table#proxy-list&quot;</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">column_map</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;IP Address&quot;</span><span class="p">:</span> <span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;Port&quot;</span><span class="p">:</span> <span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;protocol&quot;</span><span class="p">}</span>
</span><span data-line="14"><span class="p">)</span>
</span><span data-line="15"><span class="n">proxies</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">html_data</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Constructor Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">table_selector</span></code> (str): CSS selector for table element (default: “table”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">column_map</span></code> (Optional[dict[str, str]]): Map header names to proxy fields (e.g., <code class="docutils literal notranslate"><span class="pre">{&quot;IP</span> <span class="pre">Address&quot;:</span> <span class="pre">&quot;host&quot;}</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">column_indices</span></code> (Optional[dict[str, int]]): Map field names to column indices (e.g., <code class="docutils literal notranslate"><span class="pre">{&quot;host&quot;:</span> <span class="pre">0}</span></code>)</p></li>
</ul>
<p><strong>Methods:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parse(data:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">list[dict]</span></code> - Parse HTML table proxy data</p>
<ul>
<li><p>Uses BeautifulSoup for HTML parsing</p></li>
<li><p>Returns list of dictionaries with extracted fields</p></li>
<li><p>Auto-detects header row (looks for <code class="docutils literal notranslate"><span class="pre">&lt;th&gt;</span></code> elements)</p></li>
<li><p>Returns empty list if table not found</p></li>
</ul>
</li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="utility-functions">
<h2>Utility Functions<a class="headerlink" href="#utility-functions" title="Link to this heading">¶</a></h2>
<section id="configure-logging">
<h3>configure_logging<a class="headerlink" href="#configure-logging" title="Link to this heading">¶</a></h3>
<p>Configure loguru logging with JSON formatting and credential redaction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">configure_logging</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># JSON logging (for production)</span>
</span><span data-line="4"><span class="n">configure_logging</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">format_type</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">redact_credentials</span><span class="o">=</span><span class="kc">True</span>
</span><span data-line="8"><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Text logging (for development)</span>
</span><span data-line="11"><span class="n">configure_logging</span><span class="p">(</span>
</span><span data-line="12">    <span class="n">level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">format_type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span data-line="14">    <span class="n">redact_credentials</span><span class="o">=</span><span class="kc">True</span>
</span><span data-line="15"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">level</span></code> (str): Log level (“DEBUG”, “INFO”, “WARNING”, “ERROR”, “CRITICAL”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">format_type</span></code> (str): “json” or “text”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">redact_credentials</span></code> (bool): Whether to redact sensitive data (passwords, tokens, API keys)</p></li>
</ul>
<p><strong>Features:</strong></p>
<ul class="simple">
<li><p>Removes default loguru handler</p></li>
<li><p>JSON format includes: timestamp, level, message, module, function, line, exception, extra</p></li>
<li><p>Text format includes: timestamp, level, name, function, line, message (with color)</p></li>
<li><p>Automatic credential redaction:</p>
<ul>
<li><p>SecretStr values → “***”</p></li>
<li><p>Dict keys containing “password”, “secret”, “token”, “api_key”, “credential”, “username” → “***”</p></li>
<li><p>Proxy URLs with credentials → masked</p></li>
</ul>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="is-valid-proxy-url">
<h3>is_valid_proxy_url<a class="headerlink" href="#is-valid-proxy-url" title="Link to this heading">¶</a></h3>
<p>Validate proxy URL format using regex pattern.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">is_valid_proxy_url</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Valid URLs</span>
</span><span data-line="4"><span class="n">is_valid_proxy_url</span><span class="p">(</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">)</span>  <span class="c1"># True</span>
</span><span data-line="5"><span class="n">is_valid_proxy_url</span><span class="p">(</span><span class="s2">&quot;socks5://user:pass@proxy.com:1080&quot;</span><span class="p">)</span>  <span class="c1"># True</span>
</span><span data-line="6"><span class="n">is_valid_proxy_url</span><span class="p">(</span><span class="s2">&quot;https://192.168.1.1:3128&quot;</span><span class="p">)</span>  <span class="c1"># True</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Invalid URLs</span>
</span><span data-line="9"><span class="n">is_valid_proxy_url</span><span class="p">(</span><span class="s2">&quot;http://proxy.com&quot;</span><span class="p">)</span>  <span class="c1"># False (no port)</span>
</span><span data-line="10"><span class="n">is_valid_proxy_url</span><span class="p">(</span><span class="s2">&quot;proxy.com:8080&quot;</span><span class="p">)</span>  <span class="c1"># False (no scheme)</span>
</span><span data-line="11"><span class="n">is_valid_proxy_url</span><span class="p">(</span><span class="s2">&quot;ftp://proxy.com:8080&quot;</span><span class="p">)</span>  <span class="c1"># False (unsupported scheme)</span>
</span></pre></div>
</div>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">url</span></code> (str): URL to validate</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bool</span></code>: True if valid proxy URL (scheme://[user:pass&#64;]host:port)</p></li>
</ul>
<p><strong>Supported Schemes:</strong> http, https, socks4, socks5</p>
</section>
<hr class="docutils" />
<section id="parse-proxy-url">
<h3>parse_proxy_url<a class="headerlink" href="#parse-proxy-url" title="Link to this heading">¶</a></h3>
<p>Parse proxy URL into components (protocol, host, port, credentials).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse_proxy_url</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">parsed</span> <span class="o">=</span> <span class="n">parse_proxy_url</span><span class="p">(</span><span class="s2">&quot;http://user:pass@proxy.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="4"><span class="c1"># Returns: {</span>
</span><span data-line="5"><span class="c1">#     &quot;protocol&quot;: &quot;http&quot;,</span>
</span><span data-line="6"><span class="c1">#     &quot;host&quot;: &quot;proxy.example.com&quot;,</span>
</span><span data-line="7"><span class="c1">#     &quot;port&quot;: 8080,</span>
</span><span data-line="8"><span class="c1">#     &quot;username&quot;: &quot;user&quot;,</span>
</span><span data-line="9"><span class="c1">#     &quot;password&quot;: &quot;pass&quot;</span>
</span><span data-line="10"><span class="c1"># }</span>
</span><span data-line="11">
</span><span data-line="12"><span class="n">parsed</span> <span class="o">=</span> <span class="n">parse_proxy_url</span><span class="p">(</span><span class="s2">&quot;socks5://proxy.com:1080&quot;</span><span class="p">)</span>
</span><span data-line="13"><span class="c1"># Returns: {</span>
</span><span data-line="14"><span class="c1">#     &quot;protocol&quot;: &quot;socks5&quot;,</span>
</span><span data-line="15"><span class="c1">#     &quot;host&quot;: &quot;proxy.com&quot;,</span>
</span><span data-line="16"><span class="c1">#     &quot;port&quot;: 1080,</span>
</span><span data-line="17"><span class="c1">#     &quot;username&quot;: None,</span>
</span><span data-line="18"><span class="c1">#     &quot;password&quot;: None</span>
</span><span data-line="19"><span class="c1"># }</span>
</span></pre></div>
</div>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">url</span></code> (str): Proxy URL to parse</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dict[str,</span> <span class="pre">Any]</span></code>: Dictionary with protocol, host, port, username, password</p></li>
</ul>
<p><strong>Raises:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ValueError</span></code>: If URL format is invalid</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="validate-proxy-model">
<h3>validate_proxy_model<a class="headerlink" href="#validate-proxy-model" title="Link to this heading">¶</a></h3>
<p>Validate a Proxy model instance and return list of validation errors.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">validate_proxy_model</span><span class="p">,</span> <span class="n">Proxy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="4"><span class="n">errors</span> <span class="o">=</span> <span class="n">validate_proxy_model</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
</span><span data-line="5">
</span><span data-line="6"><span class="k">if</span> <span class="n">errors</span><span class="p">:</span>
</span><span data-line="7">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Validation errors:&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="p">)</span>
</span><span data-line="8"><span class="k">else</span><span class="p">:</span>
</span><span data-line="9">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Proxy is valid&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">proxy</span></code> (Proxy): Proxy instance to validate</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">list[str]</span></code>: List of validation error messages (empty if valid)</p></li>
</ul>
<p><strong>Validations:</strong></p>
<ul class="simple">
<li><p>URL format</p></li>
<li><p>Credential consistency (both username and password or neither)</p></li>
<li><p>Stats consistency (total_requests &gt;= successes + failures)</p></li>
<li><p>Consecutive failures non-negative</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="encrypt-credentials-decrypt-credentials">
<h3>encrypt_credentials / decrypt_credentials<a class="headerlink" href="#encrypt-credentials-decrypt-credentials" title="Link to this heading">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Never hardcode encryption keys in source code. Use environment variables (<code class="docutils literal notranslate"><span class="pre">PROXYWHIRL_KEY</span></code>) or the auto-generated key file at <code class="docutils literal notranslate"><span class="pre">~/.config/proxywhirl/key.enc</span></code>. See <a class="reference internal" href="configuration.html"><span class="std std-doc">Configuration</span></a> for security best practices.</p>
</div>
<p>Encrypt/decrypt credentials using Fernet symmetric encryption.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">encrypt_credentials</span><span class="p">,</span> <span class="n">decrypt_credentials</span><span class="p">,</span> <span class="n">generate_encryption_key</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Generate key</span>
</span><span data-line="4"><span class="n">key</span> <span class="o">=</span> <span class="n">generate_encryption_key</span><span class="p">()</span>  <span class="c1"># Returns base64-encoded Fernet key</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># Encrypt</span>
</span><span data-line="7"><span class="n">encrypted</span> <span class="o">=</span> <span class="n">encrypt_credentials</span><span class="p">(</span><span class="s2">&quot;secret_password&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Decrypt</span>
</span><span data-line="10"><span class="n">decrypted</span> <span class="o">=</span> <span class="n">decrypt_credentials</span><span class="p">(</span><span class="n">encrypted</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span data-line="11"><span class="k">assert</span> <span class="n">decrypted</span> <span class="o">==</span> <span class="s2">&quot;secret_password&quot;</span>
</span></pre></div>
</div>
<p><strong>Functions:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">generate_encryption_key()</span> <span class="pre">-&gt;</span> <span class="pre">str</span></code> - Generate base64-encoded Fernet key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">encrypt_credentials(plaintext:</span> <span class="pre">str,</span> <span class="pre">key:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">None)</span> <span class="pre">-&gt;</span> <span class="pre">str</span></code> - Encrypt plaintext (generates new key if not provided)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">decrypt_credentials(ciphertext:</span> <span class="pre">str,</span> <span class="pre">key:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">str</span></code> - Decrypt ciphertext using key</p></li>
</ul>
<p><strong>Uses:</strong> Fernet symmetric encryption (AES 128 in CBC mode with HMAC for authentication)</p>
</section>
<hr class="docutils" />
<section id="proxy-to-dict">
<h3>proxy_to_dict<a class="headerlink" href="#proxy-to-dict" title="Link to this heading">¶</a></h3>
<p>Convert Proxy instance to dictionary (for serialization).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">proxy_to_dict</span><span class="p">,</span> <span class="n">Proxy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="4"><span class="n">data</span> <span class="o">=</span> <span class="n">proxy_to_dict</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">include_stats</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">proxy</span></code> (Proxy): Proxy instance to convert</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include_stats</span></code> (bool): Whether to include statistics (default: True)</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dict[str,</span> <span class="pre">Any]</span></code>: Dictionary representation of proxy</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="create-proxy-from-url">
<h3>create_proxy_from_url<a class="headerlink" href="#create-proxy-from-url" title="Link to this heading">¶</a></h3>
<p>Create Proxy instance from URL string with optional metadata.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_proxy_from_url</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxySource</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Simple URL</span>
</span><span data-line="5"><span class="n">proxy</span> <span class="o">=</span> <span class="n">create_proxy_from_url</span><span class="p">(</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># With credentials and metadata</span>
</span><span data-line="8"><span class="n">proxy</span> <span class="o">=</span> <span class="n">create_proxy_from_url</span><span class="p">(</span>
</span><span data-line="9">    <span class="s2">&quot;http://user:pass@proxy.example.com:8080&quot;</span><span class="p">,</span>
</span><span data-line="10">    <span class="n">source</span><span class="o">=</span><span class="n">ProxySource</span><span class="o">.</span><span class="n">USER</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;premium&quot;</span><span class="p">,</span> <span class="s2">&quot;fast&quot;</span><span class="p">},</span>
</span><span data-line="12">    <span class="n">country_code</span><span class="o">=</span><span class="s2">&quot;US&quot;</span>
</span><span data-line="13"><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">url</span></code> (str): Proxy URL (with or without credentials)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code> (ProxySource): Proxy source type (default: ProxySource.USER)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tags</span></code> (set[str]): Custom tags (optional)</p></li>
<li><p>Additional keyword arguments forwarded to Proxy constructor</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Proxy</span></code>: Proxy instance</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="deduplicate-proxies">
<h3>deduplicate_proxies<a class="headerlink" href="#deduplicate-proxies" title="Link to this heading">¶</a></h3>
<p>Deduplicate proxy list by URL+port combination (keeps first occurrence).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">deduplicate_proxies</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">proxies</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="4">    <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">},</span>
</span><span data-line="5">    <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">},</span>  <span class="c1"># Duplicate</span>
</span><span data-line="6">    <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">}</span>
</span><span data-line="7"><span class="p">]</span>
</span><span data-line="8">
</span><span data-line="9"><span class="n">unique_proxies</span> <span class="o">=</span> <span class="n">deduplicate_proxies</span><span class="p">(</span><span class="n">proxies</span><span class="p">)</span>
</span><span data-line="10"><span class="c1"># Returns: [</span>
</span><span data-line="11"><span class="c1">#     {&quot;url&quot;: &quot;http://proxy1.example.com:8080&quot;},</span>
</span><span data-line="12"><span class="c1">#     {&quot;url&quot;: &quot;http://proxy2.example.com:8080&quot;}</span>
</span><span data-line="13"><span class="c1"># ]</span>
</span></pre></div>
</div>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">proxies</span></code> (list[dict[str, Any]]): List of proxy dictionaries</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">list[dict[str,</span> <span class="pre">Any]]</span></code>: Deduplicated list (first occurrence kept)</p></li>
</ul>
<p><strong>Deduplication Key:</strong> host:port (from URL or explicit host/port fields)</p>
</section>
</section>
<hr class="docutils" />
<section id="enumerations">
<h2>Enumerations<a class="headerlink" href="#enumerations" title="Link to this heading">¶</a></h2>
<section id="healthstatus">
<h3>HealthStatus<a class="headerlink" href="#healthstatus" title="Link to this heading">¶</a></h3>
<p>Proxy health status states for tracking proxy availability.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">HealthStatus</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">HealthStatus</span><span class="o">.</span><span class="n">UNKNOWN</span>     <span class="c1"># Not yet tested (default)</span>
</span><span data-line="4"><span class="n">HealthStatus</span><span class="o">.</span><span class="n">HEALTHY</span>     <span class="c1"># Working normally</span>
</span><span data-line="5"><span class="n">HealthStatus</span><span class="o">.</span><span class="n">DEGRADED</span>    <span class="c1"># Partial functionality (some failures)</span>
</span><span data-line="6"><span class="n">HealthStatus</span><span class="o">.</span><span class="n">UNHEALTHY</span>   <span class="c1"># Experiencing issues (many failures)</span>
</span><span data-line="7"><span class="n">HealthStatus</span><span class="o">.</span><span class="n">DEAD</span>        <span class="c1"># Not responding (completely unusable)</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="proxysource">
<h3>ProxySource<a class="headerlink" href="#proxysource" title="Link to this heading">¶</a></h3>
<p>Origin type of proxy for tracking where proxies came from.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxySource</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">ProxySource</span><span class="o">.</span><span class="n">USER</span>      <span class="c1"># Manually added by user</span>
</span><span data-line="4"><span class="n">ProxySource</span><span class="o">.</span><span class="n">FETCHED</span>   <span class="c1"># Auto-fetched from proxy source</span>
</span><span data-line="5"><span class="n">ProxySource</span><span class="o">.</span><span class="n">API</span>       <span class="c1"># Retrieved from API</span>
</span><span data-line="6"><span class="n">ProxySource</span><span class="o">.</span><span class="n">FILE</span>      <span class="c1"># Loaded from file</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="proxyformat">
<h3>ProxyFormat<a class="headerlink" href="#proxyformat" title="Link to this heading">¶</a></h3>
<p>Supported proxy list formats for parsing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyFormat</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">ProxyFormat</span><span class="o">.</span><span class="n">JSON</span>          <span class="c1"># JSON format</span>
</span><span data-line="4"><span class="n">ProxyFormat</span><span class="o">.</span><span class="n">CSV</span>           <span class="c1"># CSV format</span>
</span><span data-line="5"><span class="n">ProxyFormat</span><span class="o">.</span><span class="n">TSV</span>           <span class="c1"># Tab-separated values</span>
</span><span data-line="6"><span class="n">ProxyFormat</span><span class="o">.</span><span class="n">PLAIN_TEXT</span>    <span class="c1"># Plain text (one per line)</span>
</span><span data-line="7"><span class="n">ProxyFormat</span><span class="o">.</span><span class="n">HTML_TABLE</span>    <span class="c1"># HTML table</span>
</span><span data-line="8"><span class="n">ProxyFormat</span><span class="o">.</span><span class="n">CUSTOM</span>        <span class="c1"># Custom parser</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="rendermode">
<h3>RenderMode<a class="headerlink" href="#rendermode" title="Link to this heading">¶</a></h3>
<p>Page rendering modes for fetching proxy lists.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">RenderMode</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">RenderMode</span><span class="o">.</span><span class="n">STATIC</span>       <span class="c1"># Static HTTP request (fast)</span>
</span><span data-line="4"><span class="n">RenderMode</span><span class="o">.</span><span class="n">JAVASCRIPT</span>   <span class="c1"># JavaScript evaluation needed</span>
</span><span data-line="5"><span class="n">RenderMode</span><span class="o">.</span><span class="n">BROWSER</span>      <span class="c1"># Full browser rendering with Playwright (slow but comprehensive)</span>
</span><span data-line="6"><span class="n">RenderMode</span><span class="o">.</span><span class="n">AUTO</span>         <span class="c1"># Automatic detection based on response</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="validationlevel">
<h3>ValidationLevel<a class="headerlink" href="#validationlevel" title="Link to this heading">¶</a></h3>
<p>Proxy validation strictness levels with different speed/accuracy tradeoffs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">ValidationLevel</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">ValidationLevel</span><span class="o">.</span><span class="n">BASIC</span>     <span class="c1"># Format + TCP connectivity (~100ms)</span>
</span><span data-line="4"><span class="n">ValidationLevel</span><span class="o">.</span><span class="n">STANDARD</span>  <span class="c1"># BASIC + HTTP request test (~500ms)</span>
</span><span data-line="5"><span class="n">ValidationLevel</span><span class="o">.</span><span class="n">FULL</span>      <span class="c1"># STANDARD + Anonymity check (~2s)</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="backoffstrategy">
<h3>BackoffStrategy<a class="headerlink" href="#backoffstrategy" title="Link to this heading">¶</a></h3>
<p>Retry backoff timing strategies for calculating delays between retry attempts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">BackoffStrategy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">EXPONENTIAL</span>  <span class="c1"># base_delay * (multiplier ^ attempt)</span>
</span><span data-line="4"><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">LINEAR</span>       <span class="c1"># base_delay * (attempt + 1)</span>
</span><span data-line="5"><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">FIXED</span>        <span class="c1"># base_delay (constant)</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="circuitbreakerstate">
<h3>CircuitBreakerState<a class="headerlink" href="#circuitbreakerstate" title="Link to this heading">¶</a></h3>
<p>Circuit breaker states for tracking proxy availability.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreakerState</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">CLOSED</span>      <span class="c1"># Normal operation, proxy available</span>
</span><span data-line="4"><span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">OPEN</span>        <span class="c1"># Proxy excluded from rotation (too many failures)</span>
</span><span data-line="5"><span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">HALF_OPEN</span>   <span class="c1"># Testing recovery with limited requests</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="built-in-proxy-sources">
<h2>Built-in Proxy Sources<a class="headerlink" href="#built-in-proxy-sources" title="Link to this heading">¶</a></h2>
<p>ProxyWhirl provides pre-configured proxy sources for immediate use.</p>
<section id="individual-sources">
<h3>Individual Sources<a class="headerlink" href="#individual-sources" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="2">    <span class="c1"># Geonode (API-based, geo-targeting)</span>
</span><span data-line="3">    <span class="n">GEONODE_HTTP</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">GEONODE_SOCKS4</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">GEONODE_SOCKS5</span><span class="p">,</span>
</span><span data-line="6">
</span><span data-line="7">    <span class="c1"># GitHub: TheSpeedX (community-maintained, large pool)</span>
</span><span data-line="8">    <span class="n">GITHUB_THESPEEDX_HTTP</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">GITHUB_THESPEEDX_SOCKS4</span><span class="p">,</span>
</span><span data-line="10">    <span class="n">GITHUB_THESPEEDX_SOCKS5</span><span class="p">,</span>
</span><span data-line="11">
</span><span data-line="12">    <span class="c1"># GitHub: monosans (frequently updated)</span>
</span><span data-line="13">    <span class="n">GITHUB_MONOSANS_HTTP</span><span class="p">,</span>
</span><span data-line="14">    <span class="n">GITHUB_MONOSANS_SOCKS4</span><span class="p">,</span>
</span><span data-line="15">    <span class="n">GITHUB_MONOSANS_SOCKS5</span><span class="p">,</span>
</span><span data-line="16">
</span><span data-line="17">    <span class="c1"># GitHub: Proxifly (validated proxies)</span>
</span><span data-line="18">    <span class="n">GITHUB_PROXIFLY_HTTP</span><span class="p">,</span>
</span><span data-line="19">    <span class="n">GITHUB_PROXIFLY_SOCKS4</span><span class="p">,</span>
</span><span data-line="20">    <span class="n">GITHUB_PROXIFLY_SOCKS5</span><span class="p">,</span>
</span><span data-line="21">
</span><span data-line="22">    <span class="c1"># GitHub: Komutan (reliable sources)</span>
</span><span data-line="23">    <span class="n">GITHUB_KOMUTAN_HTTP</span><span class="p">,</span>
</span><span data-line="24">    <span class="n">GITHUB_KOMUTAN_SOCKS4</span><span class="p">,</span>
</span><span data-line="25">    <span class="n">GITHUB_KOMUTAN_SOCKS5</span>
</span><span data-line="26"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="source-collections">
<h3>Source Collections<a class="headerlink" href="#source-collections" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="2">    <span class="n">ALL_HTTP_SOURCES</span><span class="p">,</span>      <span class="c1"># All HTTP proxy sources</span>
</span><span data-line="3">    <span class="n">ALL_SOCKS4_SOURCES</span><span class="p">,</span>    <span class="c1"># All SOCKS4 proxy sources</span>
</span><span data-line="4">    <span class="n">ALL_SOCKS5_SOURCES</span><span class="p">,</span>    <span class="c1"># All SOCKS5 proxy sources</span>
</span><span data-line="5">    <span class="n">ALL_SOURCES</span><span class="p">,</span>           <span class="c1"># All sources combined (HTTP + SOCKS4 + SOCKS5)</span>
</span><span data-line="6">    <span class="n">RECOMMENDED_SOURCES</span><span class="p">,</span>   <span class="c1"># Recommended high-quality sources (curated subset)</span>
</span><span data-line="7">    <span class="n">API_SOURCES</span>            <span class="c1"># API-based sources only (ProxyScrape, Geonode)</span>
</span><span data-line="8"><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Use with ProxyFetcher</span>
</span><span data-line="11"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyFetcher</span>
</span><span data-line="12">
</span><span data-line="13"><span class="n">fetcher</span> <span class="o">=</span> <span class="n">ProxyFetcher</span><span class="p">(</span><span class="n">sources</span><span class="o">=</span><span class="n">RECOMMENDED_SOURCES</span><span class="p">)</span>
</span><span data-line="14"><span class="n">proxies</span> <span class="o">=</span> <span class="k">await</span> <span class="n">fetcher</span><span class="o">.</span><span class="n">fetch_all</span><span class="p">(</span><span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">deduplicate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Recommended Usage:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RECOMMENDED_SOURCES</span></code>: Best balance of quality and quantity</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">API_SOURCES</span></code>: Most reliable but may have rate limits</p></li>
<li><p>Protocol-specific collections: Use when you need specific protocol support</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="exceptions">
<h2>Exceptions<a class="headerlink" href="#exceptions" title="Link to this heading">¶</a></h2>
<p>All ProxyWhirl exceptions inherit from <code class="docutils literal notranslate"><span class="pre">ProxyWhirlError</span></code> base exception.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="2">    <span class="n">ProxyWhirlError</span><span class="p">,</span>           <span class="c1"># Base exception for all ProxyWhirl errors</span>
</span><span data-line="3">    <span class="n">ProxyValidationError</span><span class="p">,</span>      <span class="c1"># Proxy validation failed</span>
</span><span data-line="4">    <span class="n">ProxyPoolEmptyError</span><span class="p">,</span>       <span class="c1"># No healthy proxies available</span>
</span><span data-line="5">    <span class="n">ProxyConnectionError</span><span class="p">,</span>      <span class="c1"># Proxy connection failed</span>
</span><span data-line="6">    <span class="n">ProxyAuthenticationError</span><span class="p">,</span>  <span class="c1"># Proxy authentication failed (401/407)</span>
</span><span data-line="7">    <span class="n">ProxyFetchError</span><span class="p">,</span>           <span class="c1"># Fetching proxies from source failed</span>
</span><span data-line="8">    <span class="n">ProxyStorageError</span><span class="p">,</span>         <span class="c1"># Storage operation failed</span>
</span><span data-line="9">    <span class="n">CacheCorruptionError</span><span class="p">,</span>      <span class="c1"># Cache data corruption detected</span>
</span><span data-line="10">    <span class="n">CacheStorageError</span><span class="p">,</span>         <span class="c1"># Cache storage operation failed</span>
</span><span data-line="11">    <span class="n">CacheValidationError</span><span class="p">,</span>      <span class="c1"># Cache validation failed</span>
</span><span data-line="12">    <span class="n">RequestQueueFullError</span>      <span class="c1"># Request queue is full (when queuing enabled)</span>
</span><span data-line="13"><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Usage</span>
</span><span data-line="16"><span class="k">try</span><span class="p">:</span>
</span><span data-line="17">    <span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="18"><span class="k">except</span> <span class="n">ProxyConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="19">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="20"><span class="k">except</span> <span class="n">ProxyPoolEmptyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="21">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No proxies available: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="22"><span class="k">except</span> <span class="n">ProxyAuthenticationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="23">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Authentication failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="24"><span class="k">except</span> <span class="n">ProxyWhirlError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="25">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ProxyWhirl error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Exception Hierarchy:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">Exception
</span><span data-line="2">├── ProxyWhirlError (base)
</span><span data-line="3">│   ├── ProxyValidationError
</span><span data-line="4">│   ├── ProxyPoolEmptyError
</span><span data-line="5">│   ├── ProxyConnectionError
</span><span data-line="6">│   ├── ProxyAuthenticationError
</span><span data-line="7">│   ├── ProxyFetchError
</span><span data-line="8">│   ├── ProxyStorageError
</span><span data-line="9">│   ├── CacheCorruptionError
</span><span data-line="10">│   ├── CacheStorageError
</span><span data-line="11">│   ├── CacheValidationError (also inherits ValueError)
</span><span data-line="12">│   └── RequestQueueFullError
</span><span data-line="13">├── RetryableError          (triggers retry in RetryExecutor)
</span><span data-line="14">├── NonRetryableError       (skips retry in RetryExecutor)
</span><span data-line="15">├── RegexTimeoutError       (ReDoS protection - regex timeout)
</span><span data-line="16">└── RegexComplexityError    (ReDoS protection - pattern rejected)
</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For comprehensive error handling patterns, see <a class="reference internal" href="exceptions.html"><span class="std std-doc">Exceptions</span></a>.</p>
</div>
</section>
<hr class="docutils" />
<section id="type-annotations">
<h2>Type Annotations<a class="headerlink" href="#type-annotations" title="Link to this heading">¶</a></h2>
<p>ProxyWhirl is fully type-annotated for use with type checkers (mypy, pyright, etc.).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span data-line="4">    <span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="5">        <span class="n">ProxyWhirl</span><span class="p">,</span>
</span><span data-line="6">        <span class="n">Proxy</span><span class="p">,</span>
</span><span data-line="7">        <span class="n">RotationStrategy</span><span class="p">,</span>
</span><span data-line="8">        <span class="n">RetryPolicy</span><span class="p">,</span>
</span><span data-line="9">        <span class="n">ProxyConfiguration</span>
</span><span data-line="10">    <span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12"><span class="k">def</span><span class="w"> </span><span class="nf">setup_rotator</span><span class="p">(</span>
</span><span data-line="13">    <span class="n">strategy</span><span class="p">:</span> <span class="n">RotationStrategy</span><span class="p">,</span>
</span><span data-line="14">    <span class="n">retry_policy</span><span class="p">:</span> <span class="n">RetryPolicy</span>
</span><span data-line="15"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProxyWhirl</span><span class="p">:</span>
</span><span data-line="16"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create and configure a ProxyWhirl instance.&quot;&quot;&quot;</span>
</span><span data-line="17">    <span class="n">rotator</span><span class="p">:</span> <span class="n">ProxyWhirl</span> <span class="o">=</span> <span class="n">ProxyWhirl</span><span class="p">(</span>
</span><span data-line="18">        <span class="n">strategy</span><span class="o">=</span><span class="n">strategy</span><span class="p">,</span>
</span><span data-line="19">        <span class="n">retry_policy</span><span class="o">=</span><span class="n">retry_policy</span>
</span><span data-line="20">    <span class="p">)</span>
</span><span data-line="21">    <span class="k">return</span> <span class="n">rotator</span>
</span><span data-line="22">
</span><span data-line="23"><span class="k">def</span><span class="w"> </span><span class="nf">add_proxy_to_rotator</span><span class="p">(</span>
</span><span data-line="24">    <span class="n">rotator</span><span class="p">:</span> <span class="n">ProxyWhirl</span><span class="p">,</span>
</span><span data-line="25">    <span class="n">proxy</span><span class="p">:</span> <span class="n">Proxy</span> <span class="o">|</span> <span class="nb">str</span>
</span><span data-line="26"><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="27"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a proxy to the rotator.&quot;&quot;&quot;</span>
</span><span data-line="28">    <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Protocol Types:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RotationStrategy</span></code>: Protocol for rotation strategies (runtime checkable)</p></li>
</ul>
<p><strong>Type Checking:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Install type checker</span>
</span><span data-line="2">pip<span class="w"> </span>install<span class="w"> </span>mypy
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Run type checking</span>
</span><span data-line="5">mypy<span class="w"> </span>your_code.py
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="version">
<h2>Version<a class="headerlink" href="#version" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">proxywhirl</span>
</span><span data-line="2">
</span><span data-line="3"><span class="nb">print</span><span class="p">(</span><span class="n">proxywhirl</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>  <span class="c1"># &quot;0.1.1&quot;</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="rest-api.html"><span class="std std-doc">REST API</span></a> – HTTP REST API documentation</p></li>
<li><p><a class="reference internal" href="cache-api.html"><span class="std std-doc">Cache API</span></a> – Detailed cache system documentation</p></li>
<li><p><a class="reference internal" href="rate-limiting-api.html"><span class="std std-doc">Rate Limiting API</span></a> – Rate limiting system reference</p></li>
<li><p><a class="reference internal" href="configuration.html"><span class="std std-doc">Configuration</span></a> – Configuration options</p></li>
<li><p><a class="reference internal" href="exceptions.html"><span class="std std-doc">Exceptions</span></a> – All exception types</p></li>
<li><p><a class="reference internal" href="../guides/async-client.html"><span class="std std-doc">Async Client</span></a> – Async client usage guide</p></li>
<li><p><a class="reference internal" href="../guides/advanced-strategies.html"><span class="std std-doc">Advanced Strategies</span></a> – Strategy selection guide</p></li>
<li><p><a class="reference internal" href="../guides/retry-failover.html"><span class="std std-doc">Retry &amp; Failover</span></a> – Retry and failover patterns</p></li>
<li><p><a class="reference internal" href="../guides/caching.html"><span class="std std-doc">Caching</span></a> – Caching configuration guide</p></li>
<li><p><a class="reference internal" href="../guides/deployment-security.html"><span class="std std-doc">Deployment Security</span></a> – Production deployment guide</p></li>
</ul>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="rest-api.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">ProxyWhirl REST API Usage Guide</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="configuration.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Configuration Reference</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2026, Wyatt Walsh</p>
  
  <p>
    Made with
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/wyattowalsh/proxywhirl" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=e259d695"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=cac61aee"></script></body>
</html>