<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Cache API Reference - ProxyWhirl Documentation</title><link rel="shortcut icon" href="../_static/favicon.svg"/><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Rate Limiting API Reference" href="rate-limiting-api.html" /><link rel="prev" title="Exceptions Reference" href="exceptions.html" />
      <link rel="canonical" href="https://www.proxywhirl.com/docs/reference/cache-api.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=44020203" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=b31b09b0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://www.proxywhirl.com/docs/reference/cache-api.html"/>
  <meta property="og:title" content="Cache API Reference"/>
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@wyaborern"/>
<meta name="twitter:site" content="@wyaborern"/>
  </head>
<body>
<a class="skip-link" href="#main-content">Skip to content</a>
<header class="pw-navbar">
  <div class="pw-navbar-inner">
    
    <button class="pw-navbar-sidebar-toggle js-menu" aria-controls="lside" aria-expanded="false" aria-label="Toggle navigation" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
    </button>

    
    <a href="../index.html" class="pw-navbar-brand">
      <svg class="pw-navbar-logo" viewBox="0 0 100 100" aria-hidden="true">
        <defs>
          <linearGradient id="pw-logo-grad" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#06b6d4"/>
            <stop offset="50%" stop-color="#3b82f6"/>
            <stop offset="100%" stop-color="#8b5cf6"/>
          </linearGradient>
        </defs>
        <circle cx="50" cy="50" r="44" fill="none" stroke="url(#pw-logo-grad)" stroke-width="6" stroke-linecap="round" stroke-dasharray="60 30"/>
        <g fill="url(#pw-logo-grad)">
          <path d="M50 18 L58 30 L52 30 L52 42 L48 42 L48 30 L42 30 Z"/>
          <path d="M82 50 L70 58 L70 52 L58 52 L58 48 L70 48 L70 42 Z"/>
          <path d="M50 82 L42 70 L48 70 L48 58 L52 58 L52 70 L58 70 Z"/>
          <path d="M18 50 L30 42 L30 48 L42 48 L42 52 L30 52 L30 58 Z"/>
        </g>
        <circle cx="50" cy="50" r="8" fill="url(#pw-logo-grad)"/>
      </svg>
      <strong>ProxyWhirl</strong>
    </a>

    
    <nav class="pw-navbar-links" aria-label="Main navigation">
      <a href="../getting-started/index.html" class="pw-navbar-link" data-section="getting-started">
        Getting Started
      </a>
      <a href="../guides/index.html" class="pw-navbar-link" data-section="guides">
        Guides
      </a>
      <a href="index.html" class="pw-navbar-link" data-section="reference">
        Reference
      </a>
      <a href="../project/index.html" class="pw-navbar-link" data-section="project">
        Project
      </a>
    </nav>

    
    <div class="pw-navbar-actions">
      
      <button class="pw-navbar-btn" id="pw-theme-toggle" type="button" aria-label="Toggle theme" aria-pressed="false">
        <svg class="pw-icon-sun" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
        <svg class="pw-icon-moon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
      </button>

      
      <a href="https://github.com/wyattowalsh/proxywhirl" class="pw-navbar-btn pw-navbar-github" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
      </a>
    </div>
  </div>
</header>
<div id="main-content"></div>

<script>
(function() {
  /* Theme toggle */
  var toggle = document.getElementById('pw-theme-toggle');
  if (toggle) {
    /* Set initial aria-pressed based on current theme */
    var currentlyDark = document.documentElement.classList.contains('dark');
    toggle.setAttribute('aria-pressed', currentlyDark ? 'true' : 'false');

    toggle.addEventListener('click', function() {
      var isDark = document.documentElement.classList.contains('dark');
      var next = isDark ? 'light' : 'dark';
      localStorage._theme = next;
      if (typeof setColorMode === 'function') {
        setColorMode(next);
      } else {
        var html = document.documentElement;
        html.classList.remove('dark', 'light');
        html.classList.add(next);
        html.setAttribute('data-color-mode', next);
      }
      toggle.setAttribute('aria-pressed', next === 'dark' ? 'true' : 'false');
    });
  }

  /* Active nav link detection — highlight current section */
  var path = window.location.pathname;
  var links = document.querySelectorAll('.pw-navbar-link[data-section]');
  links.forEach(function(link) {
    var section = link.getAttribute('data-section');
    if (path.indexOf('/' + section) !== -1) {
      link.classList.add('active');
    }
  });
  /* Mark home page — none active, or all inactive is fine */
})();
</script>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="2"><ul class="current">
<li class="toctree-l1 _expand"><a class="reference internal" href="../getting-started/index.html">Getting Started</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#what-youll-build">What You&#8217;ll Build</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#installation">Installation</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#quick-start">Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#basic-usage-sync">Basic Usage (sync)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#async-usage">Async Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#context-manager-pattern">Context Manager Pattern</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#authenticated-proxies">Authenticated Proxies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#using-free-proxy-lists">Using Free Proxy Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#fetching-proxies-programmatically">Fetching Proxies Programmatically</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#choosing-a-rotation-strategy">Choosing a Rotation Strategy</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#configuring-retry-and-circuit-breakers">Configuring Retry and Circuit Breakers</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#monitoring-your-pool">Monitoring Your Pool</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#next-steps">Next Steps</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#for-contributors">For Contributors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/rotation-strategies.html">Rotation Strategies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#bootstrap-a-rotator">Bootstrap a Rotator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#decision-matrix">Decision Matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#quick-pick-guide">Quick-Pick Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#strategy-reference">Strategy Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#comparison-at-a-glance">Comparison At a Glance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#hot-swapping-strategies">Hot-Swapping Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#observe-the-pool">Observe the Pool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#building-a-custom-strategy">Building a Custom Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#further-reading">Further Reading</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../guides/index.html">Guides</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/index.html#choosing-a-guide">Choosing a Guide</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/index.html#client-concurrency">Client &amp; Concurrency</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/index.html#resilience-caching">Resilience &amp; Caching</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/index.html#operations-deployment">Operations &amp; Deployment</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/index.html#automation-ai">Automation &amp; AI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html">Async Client Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#when-to-use-async-vs-sync">When to Use Async vs Sync</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#initialization">Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#context-manager-usage">Context Manager Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#http-request-methods">HTTP Request Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#proxy-management">Proxy Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#hot-swapping-strategies">Hot-Swapping Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#error-handling">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#concurrent-requests-with-asyncio-gather">Concurrent Requests with asyncio.gather</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#performance-considerations">Performance Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#asyncio-integration-patterns">Asyncio Integration Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#comparison-async-vs-sync">Comparison: Async vs Sync</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#best-practices-and-common-patterns">Best Practices and Common Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html">Advanced Rotation Strategies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#performance-based-strategy">Performance-Based Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#session-persistence-strategy">Session Persistence Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#geo-targeted-strategy">Geo-Targeted Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#cost-aware-strategy">Cost-Aware Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#composite-strategy">Composite Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#strategy-registry">Strategy Registry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#selectioncontext">SelectionContext</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#strategyconfig">StrategyConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#custom-strategy-implementation">Custom Strategy Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#strategyregistry-usage">StrategyRegistry Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id16">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#testing-strategies">Testing Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#performance-benchmarks">Performance Benchmarks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html">Caching Subsystem Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#architecture-overview">Architecture Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#core-components">Core Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#credential-encryption">Credential Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#ttl-and-expiration">TTL and Expiration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#health-invalidation">Health Invalidation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#migration-from-jsonl-l2-cache">Migration from JSONL L2 Cache</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#cache-warming">Cache Warming</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#performance-tuning">Performance Tuning</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#cli-integration">CLI Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#example-complete-cache-setup">Example: Complete Cache Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html">Retry &amp; Failover Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#architecture-overview">Architecture Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#when-to-use-retry-vs-failover">When to Use Retry vs Failover</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#retrypolicy-configuration">RetryPolicy Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#circuit-breaker-configuration">Circuit Breaker Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#intelligent-proxy-selection">Intelligent Proxy Selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#retrymetrics-and-observability">RetryMetrics and Observability</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#retryexecutor-deep-dive">RetryExecutor Deep Dive</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#integration-with-proxyrotator">Integration with ProxyRotator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#advanced-patterns">Advanced Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#performance-impact">Performance Impact</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#see-also">See Also</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/deployment-security.html">Deployment Security &amp; Reverse Proxy Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#x-forwarded-for-security">X-Forwarded-For Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#reverse-proxy-configurations">Reverse Proxy Configurations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#proxywhirl-configuration">ProxyWhirl Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#security-checklist">Security Checklist</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/deployment-security.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/cli-reference.html">CLI Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#global-options">Global Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#commands">Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#output-formats">Output Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#configuration-file">Configuration File</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#advanced-usage">Advanced Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#exit-codes">Exit Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/automation.html">Automation &amp; CI/CD Runbook</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#pre-flight-checks">Pre-flight Checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#github-actions-ci-pipeline">GitHub Actions CI Pipeline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#cron-based-proxy-fetching">Cron-Based Proxy Fetching</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#docker-deployment">Docker Deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#integration-testing-patterns">Integration Testing Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#smoke-tests-for-docs-examples">Smoke Tests for Docs Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#automating-releases">Automating Releases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#docsearch-credentials">DocSearch Credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#ci-stage-summary">CI Stage Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/automation.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html">MCP Server Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#quick-start">Quick Start</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#the-proxywhirl-tool">The <code class="docutils literal notranslate"><span class="pre">proxywhirl</span></code> Tool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#resources">Resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#prompts">Prompts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#authentication">Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#progress-reporting">Progress Reporting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#transport-options">Transport Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#integration-with-claude-desktop">Integration with Claude Desktop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#programmatic-usage">Programmatic Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#lifecycle-management">Lifecycle Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#error-handling">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Reference</a><ul class="current">
<li class="toctree-l2 _expand"><a class="reference internal" href="index.html#quick-lookup">Quick Lookup</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="index.html#api-surfaces">API Surfaces</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="index.html#configuration-error-handling">Configuration &amp; Error Handling</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#subsystem-apis">Subsystem APIs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="rest-api.html">ProxyWhirl REST API Usage Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#getting-started">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#authentication">Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#middleware">Middleware</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#endpoint-reference">Endpoint Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#rate-limiting">Rate Limiting</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#error-handling">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#performance-tips">Performance Tips</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#security-best-practices">Security Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#deployment-examples">Deployment Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#x-forwarded-for-security-checklist">X-Forwarded-For Security Checklist</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#security-references">Security References</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#see-also">See Also</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#support">Support</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="python-api.html">Python API Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#core-classes">Core Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#rotation-strategies">Rotation Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#data-models">Data Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#cache-components">Cache Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#retry-failover">Retry &amp; Failover</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#parsers">Parsers</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#utility-functions">Utility Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#enumerations">Enumerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#built-in-proxy-sources">Built-in Proxy Sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#exceptions">Exceptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#type-annotations">Type Annotations</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#version">Version</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html">Configuration Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#configuration-discovery">Configuration Discovery</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#toml-configuration-format">TOML Configuration Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#configuration-classes">Configuration Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#programmatic-configuration">Programmatic Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#validation-rules">Validation Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#security-best-practices">Security Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#configuration-examples">Configuration Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#migration-from-legacy-config">Migration from Legacy Config</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html">Exceptions Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#exception-hierarchy">Exception Hierarchy</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#proxyerrorcode-enum">ProxyErrorCode Enum</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#utility-functions">Utility Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#error-codes">Error Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#exception-reference">Exception Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#error-handling-patterns">Error Handling Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Cache API Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-models">Data Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tier-implementations">Tier Implementations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#utilities">Utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage-examples">Usage Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#performance-considerations">Performance Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#thread-safety">Thread Safety</a></li>
<li class="toctree-l4"><a class="reference internal" href="#error-handling">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rate-limiting-api.html">Rate Limiting API Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#core-classes">Core Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#data-models">Data Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#usage-examples">Usage Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#thread-safety">Thread Safety</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#performance-considerations">Performance Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#integration-with-monitoring">Integration with Monitoring</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#sphinx-integration">Sphinx Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#common-patterns">Common Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#faq">FAQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="rate-limiting-api.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../project/index.html">Project</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#development-setup">Development Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#clone-install">Clone &amp; Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#verify-installation">Verify Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#make-commands">Make Commands</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#contributing">Contributing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#workflow">Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#branch-naming">Branch Naming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#commit-convention">Commit Convention</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#code-style">Code Style</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#pre-commit-hooks">Pre-commit Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#testing-guidelines">Testing Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#extending-with-custom-strategies">Extending with Custom Strategies</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#ci-cd-pipelines">CI/CD Pipelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#quality-gate-pipeline">Quality Gate Pipeline</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#architecture">Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#module-map">Module Map</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#key-exports">Key Exports</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#current-health">Current Health</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#changelog-highlights">Changelog Highlights</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#recent">Recent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#phase-completion-status">Phase Completion Status</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#license">License</a></li>
</ul>
</li>
</ul>
        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#data-models">Data Models</a><ul>
<li><a class="reference internal" href="#cacheentry">CacheEntry</a><ul>
<li><a class="reference internal" href="#CacheEntry"><code class="docutils literal notranslate"><span class="pre">CacheEntry</span></code></a></li>
<li><a class="reference internal" href="#fields">Fields</a></li>
<li><a class="reference internal" href="#properties">Properties</a><ul>
<li><a class="reference internal" href="#is_expired"><code class="docutils literal notranslate"><span class="pre">is_expired</span></code></a></li>
<li><a class="reference internal" href="#is_healthy"><code class="docutils literal notranslate"><span class="pre">is_healthy</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#cacheconfig">CacheConfig</a><ul>
<li><a class="reference internal" href="#CacheConfig"><code class="docutils literal notranslate"><span class="pre">CacheConfig</span></code></a></li>
<li><a class="reference internal" href="#id1">Fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cachetierconfig">CacheTierConfig</a><ul>
<li><a class="reference internal" href="#CacheTierConfig"><code class="docutils literal notranslate"><span class="pre">CacheTierConfig</span></code></a></li>
<li><a class="reference internal" href="#id2">Fields</a></li>
<li><a class="reference internal" href="#validators">Validators</a><ul>
<li><a class="reference internal" href="#validate_policy"><code class="docutils literal notranslate"><span class="pre">validate_policy()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#cachestatistics">CacheStatistics</a><ul>
<li><a class="reference internal" href="#CacheStatistics"><code class="docutils literal notranslate"><span class="pre">CacheStatistics</span></code></a></li>
<li><a class="reference internal" href="#id3">Fields</a></li>
<li><a class="reference internal" href="#computed-properties">Computed Properties</a><ul>
<li><a class="reference internal" href="#overall_hit_rate"><code class="docutils literal notranslate"><span class="pre">overall_hit_rate</span></code></a></li>
<li><a class="reference internal" href="#total_size"><code class="docutils literal notranslate"><span class="pre">total_size</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#methods">Methods</a><ul>
<li><a class="reference internal" href="#to_metrics_dict"><code class="docutils literal notranslate"><span class="pre">to_metrics_dict()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#tierstatistics">TierStatistics</a><ul>
<li><a class="reference internal" href="#TierStatistics"><code class="docutils literal notranslate"><span class="pre">TierStatistics</span></code></a></li>
<li><a class="reference internal" href="#id4">Fields</a></li>
<li><a class="reference internal" href="#id5">Computed Properties</a><ul>
<li><a class="reference internal" href="#hit_rate"><code class="docutils literal notranslate"><span class="pre">hit_rate</span></code></a></li>
<li><a class="reference internal" href="#total_evictions"><code class="docutils literal notranslate"><span class="pre">total_evictions</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#healthstatus-enum">HealthStatus (Enum)</a><ul>
<li><a class="reference internal" href="#HealthStatus"><code class="docutils literal notranslate"><span class="pre">HealthStatus</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#cachetiertype-enum">CacheTierType (Enum)</a><ul>
<li><a class="reference internal" href="#CacheTierType"><code class="docutils literal notranslate"><span class="pre">CacheTierType</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#l2backendtype-enum">L2BackendType (Enum)</a><ul>
<li><a class="reference internal" href="#L2BackendType"><code class="docutils literal notranslate"><span class="pre">L2BackendType</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#tier-implementations">Tier Implementations</a><ul>
<li><a class="reference internal" href="#cachetier-abstract-base-class">CacheTier (Abstract Base Class)</a><ul>
<li><a class="reference internal" href="#CacheTier"><code class="docutils literal notranslate"><span class="pre">CacheTier</span></code></a></li>
<li><a class="reference internal" href="#constructor">Constructor</a><ul>
<li><a class="reference internal" href="#init__"><code class="docutils literal notranslate"><span class="pre">__init__()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#abstract-methods">Abstract Methods</a><ul>
<li><a class="reference internal" href="#get"><code class="docutils literal notranslate"><span class="pre">get()</span></code></a></li>
<li><a class="reference internal" href="#put"><code class="docutils literal notranslate"><span class="pre">put()</span></code></a></li>
<li><a class="reference internal" href="#delete"><code class="docutils literal notranslate"><span class="pre">delete()</span></code></a></li>
<li><a class="reference internal" href="#clear"><code class="docutils literal notranslate"><span class="pre">clear()</span></code></a></li>
<li><a class="reference internal" href="#size"><code class="docutils literal notranslate"><span class="pre">size()</span></code></a></li>
<li><a class="reference internal" href="#keys"><code class="docutils literal notranslate"><span class="pre">keys()</span></code></a></li>
<li><a class="reference internal" href="#cleanup_expired"><code class="docutils literal notranslate"><span class="pre">cleanup_expired()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#concrete-methods">Concrete Methods</a><ul>
<li><a class="reference internal" href="#handle_failure"><code class="docutils literal notranslate"><span class="pre">handle_failure()</span></code></a></li>
<li><a class="reference internal" href="#reset_failures"><code class="docutils literal notranslate"><span class="pre">reset_failures()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#memorycachetier">MemoryCacheTier</a><ul>
<li><a class="reference internal" href="#MemoryCacheTier"><code class="docutils literal notranslate"><span class="pre">MemoryCacheTier</span></code></a></li>
<li><a class="reference internal" href="#id6">Constructor</a></li>
<li><a class="reference internal" href="#features">Features</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jsonlcachetier">JsonlCacheTier</a><ul>
<li><a class="reference internal" href="#JsonlCacheTier"><code class="docutils literal notranslate"><span class="pre">JsonlCacheTier</span></code></a></li>
<li><a class="reference internal" href="#id7">Constructor</a></li>
<li><a class="reference internal" href="#file-structure">File Structure</a></li>
<li><a class="reference internal" href="#id8">Features</a></li>
<li><a class="reference internal" href="#when-to-use-jsonl-vs-sqlite">When to Use JSONL vs SQLite</a></li>
</ul>
</li>
<li><a class="reference internal" href="#diskcachetier">DiskCacheTier</a><ul>
<li><a class="reference internal" href="#DiskCacheTier"><code class="docutils literal notranslate"><span class="pre">DiskCacheTier</span></code></a></li>
<li><a class="reference internal" href="#id9">Constructor</a></li>
<li><a class="reference internal" href="#id10">Methods</a><ul>
<li><a class="reference internal" href="#migrate_from_jsonl"><code class="docutils literal notranslate"><span class="pre">migrate_from_jsonl()</span></code></a></li>
<li><a class="reference internal" href="#close"><code class="docutils literal notranslate"><span class="pre">close()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11">Features</a></li>
<li><a class="reference internal" href="#database-schema">Database Schema</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sqlitecachetier">SQLiteCacheTier</a><ul>
<li><a class="reference internal" href="#SQLiteCacheTier"><code class="docutils literal notranslate"><span class="pre">SQLiteCacheTier</span></code></a></li>
<li><a class="reference internal" href="#id12">Constructor</a></li>
<li><a class="reference internal" href="#id13">Features</a></li>
<li><a class="reference internal" href="#id14">Database Schema</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#utilities">Utilities</a><ul>
<li><a class="reference internal" href="#credentialencryptor">CredentialEncryptor</a><ul>
<li><a class="reference internal" href="#CredentialEncryptor"><code class="docutils literal notranslate"><span class="pre">CredentialEncryptor</span></code></a></li>
<li><a class="reference internal" href="#id15">Constructor</a></li>
<li><a class="reference internal" href="#id16">Methods</a><ul>
<li><a class="reference internal" href="#encrypt"><code class="docutils literal notranslate"><span class="pre">encrypt()</span></code></a></li>
<li><a class="reference internal" href="#decrypt"><code class="docutils literal notranslate"><span class="pre">decrypt()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#cachemanager">CacheManager</a><ul>
<li><a class="reference internal" href="#CacheManager"><code class="docutils literal notranslate"><span class="pre">CacheManager</span></code></a></li>
<li><a class="reference internal" href="#id17">Constructor</a></li>
<li><a class="reference internal" href="#id18">Methods</a><ul>
<li><a class="reference internal" href="#invalidate_by_health"><code class="docutils literal notranslate"><span class="pre">invalidate_by_health()</span></code></a></li>
<li><a class="reference internal" href="#get_statistics"><code class="docutils literal notranslate"><span class="pre">get_statistics()</span></code></a></li>
<li><a class="reference internal" href="#export_to_file"><code class="docutils literal notranslate"><span class="pre">export_to_file()</span></code></a></li>
<li><a class="reference internal" href="#warm_from_file"><code class="docutils literal notranslate"><span class="pre">warm_from_file()</span></code></a></li>
<li><a class="reference internal" href="#generate_cache_key"><code class="docutils literal notranslate"><span class="pre">generate_cache_key()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#crypto-utilities">Crypto Utilities</a><ul>
<li><a class="reference internal" href="#get-encryption-keys-list-bytes"><code class="docutils literal notranslate"><span class="pre">get_encryption_keys()</span> <span class="pre">-&gt;</span> <span class="pre">list[bytes]</span></code></a></li>
<li><a class="reference internal" href="#create-multi-fernet-multifernet"><code class="docutils literal notranslate"><span class="pre">create_multi_fernet()</span> <span class="pre">-&gt;</span> <span class="pre">MultiFernet</span></code></a></li>
<li><a class="reference internal" href="#rotate-key-new-key-str-none"><code class="docutils literal notranslate"><span class="pre">rotate_key(new_key:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#ttlmanager">TTLManager</a><ul>
<li><a class="reference internal" href="#TTLManager"><code class="docutils literal notranslate"><span class="pre">TTLManager</span></code></a></li>
<li><a class="reference internal" href="#id19">Constructor</a></li>
<li><a class="reference internal" href="#id20">Methods</a><ul>
<li><a class="reference internal" href="#start"><code class="docutils literal notranslate"><span class="pre">start()</span></code></a></li>
<li><a class="reference internal" href="#stop"><code class="docutils literal notranslate"><span class="pre">stop()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#attributes">Attributes</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#usage-examples">Usage Examples</a><ul>
<li><a class="reference internal" href="#working-with-cache-tiers-directly">Working with Cache Tiers Directly</a></li>
<li><a class="reference internal" href="#encryption-and-security">Encryption and Security</a></li>
<li><a class="reference internal" href="#migration-from-jsonl-to-sqlite-l2">Migration from JSONL to SQLite L2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-considerations">Performance Considerations</a><ul>
<li><a class="reference internal" href="#tier-selection">Tier Selection</a></li>
<li><a class="reference internal" href="#optimization-tips">Optimization Tips</a></li>
</ul>
</li>
<li><a class="reference internal" href="#thread-safety">Thread Safety</a></li>
<li><a class="reference internal" href="#error-handling">Error Handling</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">ProxyWhirl</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">Reference</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Cache API Reference</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <div class="copy-page-wrapper relative pb-4 lg:absolute lg:top-8 lg:right-6 xl:right-12">
  <div id="copy-page-trigger">
    <button
      type="button"
      class="js-copy px-3 py-1 inline-flex items-center gap-1"
      data-url="https://www.proxywhirl.com/docs/_sources/reference/cache-api.md.txt"
    >
      <i class="i-lucide" data-icon="copy"></i>
      <span>Copy page</span>
    </button>
    <button class="js-menu px-2 py-1" type="button" aria-label="More actions"
      aria-haspopup="menu" aria-expanded="false" aria-controls="copy-page-content">
      <i class="i-lucide chevron-down"></i>
    </button>
  </div>
  <div id="copy-page-content" role="menu" aria-orientation="vertical" aria-hidden="true">
    <div role="presentation">
      <div class="flex flex-col" role="group">
        <button class="js-copy" type="button" role="menuitem"
          data-url="https://www.proxywhirl.com/docs/_sources/reference/cache-api.md.txt">
          <span class="iconify-icon">
            <i class="i-lucide" data-icon="copy"></i>
          </span>
          <span>Copy page</span>
        </button>
        <a role="menuitem" href="https://www.proxywhirl.com/docs/_sources/reference/cache-api.md.txt" target="_blank" rel="nofollow"><iconify-icon icon="bi:markdown"></iconify-icon>
            <span>View as Markdown</span></a><a role="menuitem" href="https://chatgpt.com/?hints=search&q=Read%20https%3A//www.proxywhirl.com/docs/_sources/reference/cache-api.md.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:openai"></iconify-icon>
          <span>Open in ChatGPT</span>
        </a><a role="menuitem" href="https://claude.ai/new?q=Read%20https%3A//www.proxywhirl.com/docs/_sources/reference/cache-api.md.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:claude"></iconify-icon>
          <span>Open in Claude</span>
        </a></div>
    </div>
  </div>
</div><article class="yue dark-code" role="main">
          <section id="cache-api-reference">
<h1>Cache API Reference<a class="headerlink" href="#cache-api-reference" title="Link to this heading">¶</a></h1>
<p>Complete reference for ProxyWhirl’s multi-tier caching system with L1 (memory), L2 (disk), and L3 (SQLite) support.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For cache configuration patterns and optimization tips, see <a class="reference internal" href="../guides/caching.html"><span class="std std-doc">Caching</span></a>. For TOML cache configuration options, see <a class="reference internal" href="configuration.html"><span class="std std-doc">Configuration</span></a>.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="2">    <span class="n">CacheManager</span><span class="p">,</span>
</span><span data-line="3">    <span class="n">CacheConfig</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">CacheEntry</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">HealthStatus</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">CacheTierType</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">MemoryCacheTier</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">DiskCacheTier</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">SQLiteCacheTier</span><span class="p">,</span>
</span><span data-line="10">    <span class="n">CredentialEncryptor</span><span class="p">,</span>
</span><span data-line="11"><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># L2BackendType and JsonlCacheTier are available via submodule imports:</span>
</span><span data-line="14"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">L2BackendType</span>
</span><span data-line="15"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache.tiers</span><span class="w"> </span><span class="kn">import</span> <span class="n">JsonlCacheTier</span>
</span></pre></div>
</div>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>The cache subsystem provides three-tier storage for proxies with automatic promotion, credential encryption, TTL management, and health-based invalidation. It supports graceful degradation when tiers fail and provides comprehensive statistics for monitoring.</p>
<p><strong>Architecture:</strong></p>
<ul class="simple">
<li><p><strong>L1 (Memory)</strong>: Fast in-memory cache using OrderedDict with LRU eviction</p></li>
<li><p><strong>L2 (Disk)</strong>: Configurable persistent cache with two backend options:</p>
<ul>
<li><p><strong>JSONL</strong> (default): File-based using sharded JSON Lines files, human-readable, portable, best for &lt;10K entries</p></li>
<li><p><strong>SQLite</strong>: Database-based with indexed lookups, faster for &gt;10K entries with O(log n) performance</p></li>
</ul>
</li>
<li><p><strong>L3 (SQLite)</strong>: Full database cache with SQL indexing, health history tracking, and complete queryability</p></li>
</ul>
</section>
<section id="data-models">
<h2>Data Models<a class="headerlink" href="#data-models" title="Link to this heading">¶</a></h2>
<section id="cacheentry">
<h3>CacheEntry<a class="headerlink" href="#cacheentry" title="Link to this heading">¶</a></h3>
<p>Container for a single cached proxy with metadata, TTL, and health tracking.</p>
<dl class="py class">
<dt class="sig sig-object py" id="CacheEntry">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">CacheEntry</span></span><a class="headerlink" href="#CacheEntry" title="Link to this definition">¶</a></dt>
<dd><p>Pydantic model that stores proxy information with TTL, health status, and access tracking.
Credentials are SecretStr in memory, encrypted at rest in L2/L3.</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheEntry</span><span class="p">,</span> <span class="n">HealthStatus</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecretStr</span>
</span><span data-line="4">
</span><span data-line="5"><span class="n">entry</span> <span class="o">=</span> <span class="n">CacheEntry</span><span class="p">(</span>
</span><span data-line="6">    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">proxy_url</span><span class="o">=</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">username</span><span class="o">=</span><span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span>
</span><span data-line="9">    <span class="n">password</span><span class="o">=</span><span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;pass&quot;</span><span class="p">),</span>
</span><span data-line="10">    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;api&quot;</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">fetch_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="12">    <span class="n">last_accessed</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="13">    <span class="n">ttl_seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>
</span><span data-line="14">    <span class="n">expires_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">),</span>
</span><span data-line="15">    <span class="n">health_status</span><span class="o">=</span><span class="n">HealthStatus</span><span class="o">.</span><span class="n">HEALTHY</span>
</span><span data-line="16"><span class="p">)</span>
</span><span data-line="17">
</span><span data-line="18"><span class="c1"># Check expiration</span>
</span><span data-line="19"><span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_expired</span><span class="p">:</span>
</span><span data-line="20">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Entry has expired&quot;</span><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22"><span class="c1"># Check health</span>
</span><span data-line="23"><span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_healthy</span><span class="p">:</span>
</span><span data-line="24">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Proxy is healthy&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</dd></dl>

<section id="fields">
<h4>Fields<a class="headerlink" href="#fields" title="Link to this heading">¶</a></h4>
<p><strong>Identity:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> (str): Unique cache key (proxy URL hash)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proxy_url</span></code> (str): Full proxy URL (scheme://host:port)</p></li>
</ul>
<p><strong>Credentials (encrypted at rest in L2/L3):</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">username</span></code> (SecretStr | None): Proxy username</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">password</span></code> (SecretStr | None): Proxy password</p></li>
</ul>
<p><strong>Metadata:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code> (str): Proxy source identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fetch_time</span></code> (datetime): When proxy was fetched</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last_accessed</span></code> (datetime): Last cache access time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">access_count</span></code> (int): Number of cache hits (default: 0)</p></li>
</ul>
<p><strong>TTL &amp; Health:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ttl_seconds</span></code> (int): Time-to-live in seconds (≥0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">expires_at</span></code> (datetime): Absolute expiration time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">health_status</span></code> (HealthStatus): Current health status (default: UNKNOWN)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failure_count</span></code> (int): Consecutive failures (≥0, default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">evicted_from_l1</span></code> (bool): Whether entry was evicted from L1 cache (default: False)</p></li>
</ul>
<p><strong>Health Monitoring (Feature 006):</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">last_health_check</span></code> (datetime | None): Last health check timestamp</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">consecutive_health_failures</span></code> (int): Consecutive health check failures (≥0, default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">consecutive_health_successes</span></code> (int): Consecutive successful health checks (≥0, default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">recovery_attempt</span></code> (int): Current recovery attempt count (≥0, default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">next_check_time</span></code> (datetime | None): Scheduled next health check</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last_health_error</span></code> (str | None): Last health check error message</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">total_health_checks</span></code> (int): Total health checks performed (≥0, default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">total_health_check_failures</span></code> (int): Total health check failures (≥0, default: 0)</p></li>
</ul>
</section>
<section id="properties">
<h4>Properties<a class="headerlink" href="#properties" title="Link to this heading">¶</a></h4>
<dl class="py property">
<dt class="sig sig-object py" id="is_expired">
<span class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">is_expired</span></span><span class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span><a class="headerlink" href="#is_expired" title="Link to this definition">¶</a></dt>
<dd><p>Check if entry has expired based on TTL.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>True if current time ≥ expires_at, False otherwise</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="is_healthy">
<span class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">is_healthy</span></span><span class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span><a class="headerlink" href="#is_healthy" title="Link to this definition">¶</a></dt>
<dd><p>Check if proxy is healthy enough to use.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>True if health_status == HEALTHY, False otherwise</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<hr class="docutils" />
<section id="cacheconfig">
<h3>CacheConfig<a class="headerlink" href="#cacheconfig" title="Link to this heading">¶</a></h3>
<p>Configuration for cache behavior and tier settings.</p>
<dl class="py class">
<dt class="sig sig-object py" id="CacheConfig">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">CacheConfig</span></span><a class="headerlink" href="#CacheConfig" title="Link to this definition">¶</a></dt>
<dd><p>Pydantic model that aggregates configuration for all three tiers plus global settings
like TTL, cleanup intervals, and storage paths.</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheConfig</span><span class="p">,</span> <span class="n">CacheTierConfig</span><span class="p">,</span> <span class="n">L2BackendType</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecretStr</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Default JSONL backend (file-based, portable)</span>
</span><span data-line="5"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheConfig</span><span class="p">(</span>
</span><span data-line="6">    <span class="c1"># Tier configurations</span>
</span><span data-line="7">    <span class="n">l1_config</span><span class="o">=</span><span class="n">CacheTierConfig</span><span class="p">(</span>
</span><span data-line="8">        <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="9">        <span class="n">max_entries</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span data-line="10">        <span class="n">eviction_policy</span><span class="o">=</span><span class="s2">&quot;lru&quot;</span>
</span><span data-line="11">    <span class="p">),</span>
</span><span data-line="12">    <span class="n">l2_config</span><span class="o">=</span><span class="n">CacheTierConfig</span><span class="p">(</span>
</span><span data-line="13">        <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="14">        <span class="n">max_entries</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
</span><span data-line="15">        <span class="n">eviction_policy</span><span class="o">=</span><span class="s2">&quot;lru&quot;</span>
</span><span data-line="16">    <span class="p">),</span>
</span><span data-line="17">    <span class="n">l2_backend</span><span class="o">=</span><span class="n">L2BackendType</span><span class="o">.</span><span class="n">JSONL</span><span class="p">,</span>  <span class="c1"># or L2BackendType.SQLITE for large caches</span>
</span><span data-line="18">    <span class="n">l3_config</span><span class="o">=</span><span class="n">CacheTierConfig</span><span class="p">(</span>
</span><span data-line="19">        <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="20">        <span class="n">max_entries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># Unlimited</span>
</span><span data-line="21">        <span class="n">eviction_policy</span><span class="o">=</span><span class="s2">&quot;lru&quot;</span>
</span><span data-line="22">    <span class="p">),</span>
</span><span data-line="23">
</span><span data-line="24">    <span class="c1"># TTL Configuration</span>
</span><span data-line="25">    <span class="n">default_ttl_seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>
</span><span data-line="26">    <span class="n">ttl_cleanup_interval</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
</span><span data-line="27">    <span class="n">enable_background_cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="28">    <span class="n">cleanup_interval_seconds</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
</span><span data-line="29">    <span class="n">per_source_ttl</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="30">        <span class="s2">&quot;api&quot;</span><span class="p">:</span> <span class="mi">7200</span><span class="p">,</span>      <span class="c1"># API sources: 2 hours</span>
</span><span data-line="31">        <span class="s2">&quot;scraper&quot;</span><span class="p">:</span> <span class="mi">1800</span>   <span class="c1"># Scrapers: 30 minutes</span>
</span><span data-line="32">    <span class="p">},</span>
</span><span data-line="33">
</span><span data-line="34">    <span class="c1"># Storage Paths</span>
</span><span data-line="35">    <span class="n">l2_cache_dir</span><span class="o">=</span><span class="s2">&quot;.cache/proxies&quot;</span><span class="p">,</span>
</span><span data-line="36">    <span class="n">l3_database_path</span><span class="o">=</span><span class="s2">&quot;.cache/db/proxywhirl.db&quot;</span><span class="p">,</span>
</span><span data-line="37">
</span><span data-line="38">    <span class="c1"># Encryption</span>
</span><span data-line="39">    <span class="n">encryption_key</span><span class="o">=</span><span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;your-32-byte-url-safe-base64-key&quot;</span><span class="p">),</span>
</span><span data-line="40">
</span><span data-line="41">    <span class="c1"># Health Integration</span>
</span><span data-line="42">    <span class="n">health_check_invalidation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="43">    <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span data-line="44">
</span><span data-line="45">    <span class="c1"># Performance Tuning</span>
</span><span data-line="46">    <span class="n">enable_statistics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="47">    <span class="n">statistics_interval</span><span class="o">=</span><span class="mi">5</span>
</span><span data-line="48"><span class="p">)</span>
</span><span data-line="49">
</span><span data-line="50"><span class="c1"># SQLite backend for large caches (&gt;10K entries)</span>
</span><span data-line="51"><span class="n">large_cache_config</span> <span class="o">=</span> <span class="n">CacheConfig</span><span class="p">(</span>
</span><span data-line="52">    <span class="n">l2_backend</span><span class="o">=</span><span class="n">L2BackendType</span><span class="o">.</span><span class="n">SQLITE</span><span class="p">,</span>
</span><span data-line="53">    <span class="n">l2_config</span><span class="o">=</span><span class="n">CacheTierConfig</span><span class="p">(</span><span class="n">max_entries</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span>
</span><span data-line="54"><span class="p">)</span>
</span></pre></div>
</div>
</dd></dl>

<section id="id1">
<h4>Fields<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h4>
<p><strong>Tier Configuration:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">l1_config</span></code> (CacheTierConfig): L1 (Memory) configuration (default: max_entries=1000)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l2_config</span></code> (CacheTierConfig): L2 (Disk) configuration (default: max_entries=5000)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l2_backend</span></code> (L2BackendType): L2 storage backend - “jsonl” or “sqlite” (default: JSONL)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l3_config</span></code> (CacheTierConfig): L3 (SQLite) configuration (default: max_entries=None)</p></li>
</ul>
<p><strong>TTL Configuration:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">default_ttl_seconds</span></code> (int): Default TTL for cached proxies (≥60, default: 3600)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ttl_cleanup_interval</span></code> (int): Background cleanup interval (≥10, default: 60)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">enable_background_cleanup</span></code> (bool): Enable background TTL cleanup thread (default: False)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cleanup_interval_seconds</span></code> (int): Interval between cleanup runs (≥5, default: 60)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">per_source_ttl</span></code> (dict[str, int]): Per-source TTL overrides (default: empty dict)</p></li>
</ul>
<p><strong>Storage Paths:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">l2_cache_dir</span></code> (str): Directory for L2 cache (JSONL shards or SQLite database) (default: “.cache/proxies”)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l3_database_path</span></code> (str): SQLite database path for L3 (default: “.cache/db/proxywhirl.db”)</p></li>
</ul>
<p><strong>Encryption:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">encryption_key</span></code> (SecretStr | None): Fernet encryption key (from env: PROXYWHIRL_CACHE_ENCRYPTION_KEY)</p></li>
</ul>
<p><strong>Health Integration:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">health_check_invalidation</span></code> (bool): Auto-invalidate on health check failure (default: True)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failure_threshold</span></code> (int): Failures before health invalidation (≥1, default: 3)</p></li>
</ul>
<p><strong>Performance Tuning:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enable_statistics</span></code> (bool): Track cache statistics (default: True)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">statistics_interval</span></code> (int): Stats aggregation interval (≥1, default: 5)</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="cachetierconfig">
<h3>CacheTierConfig<a class="headerlink" href="#cachetierconfig" title="Link to this heading">¶</a></h3>
<p>Configuration for a single cache tier.</p>
<dl class="py class">
<dt class="sig sig-object py" id="CacheTierConfig">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">CacheTierConfig</span></span><a class="headerlink" href="#CacheTierConfig" title="Link to this definition">¶</a></dt>
<dd><p>Pydantic model that defines capacity, eviction policy, and enable/disable state for
one tier (L1, L2, or L3).</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheTierConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheTierConfig</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">max_entries</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">eviction_policy</span><span class="o">=</span><span class="s2">&quot;lru&quot;</span>  <span class="c1"># &quot;lru&quot;, &quot;lfu&quot;, or &quot;fifo&quot;</span>
</span><span data-line="7"><span class="p">)</span>
</span></pre></div>
</div>
</dd></dl>

<section id="id2">
<h4>Fields<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code> (bool): Enable this tier (default: True)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">max_entries</span></code> (int | None): Max entries (None=unlimited, default: None)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eviction_policy</span></code> (str): Eviction policy: “lru”, “lfu”, or “fifo” (default: “lru”)</p></li>
</ul>
</section>
<section id="validators">
<h4>Validators<a class="headerlink" href="#validators" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py" id="validate_policy">
<span class="property"><span class="k"><span class="pre">classmethod</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">validate_policy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">v</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></span><a class="headerlink" href="#validate_policy" title="Link to this definition">¶</a></dt>
<dd><p>Validate eviction policy is supported.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>v</strong> – Policy name to validate</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If policy is not one of [“lru”, “lfu”, “fifo”]</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Validated policy name</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<hr class="docutils" />
<section id="cachestatistics">
<h3>CacheStatistics<a class="headerlink" href="#cachestatistics" title="Link to this heading">¶</a></h3>
<p>Aggregate cache statistics across all tiers.</p>
<dl class="py class">
<dt class="sig sig-object py" id="CacheStatistics">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">CacheStatistics</span></span><a class="headerlink" href="#CacheStatistics" title="Link to this definition">¶</a></dt>
<dd><p>Pydantic model that combines tier-level statistics and tracks cross-tier operations
like promotions and demotions.</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheStatistics</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">stats</span> <span class="o">=</span> <span class="n">CacheStatistics</span><span class="p">()</span>
</span><span data-line="4"><span class="n">stats</span><span class="o">.</span><span class="n">l1_stats</span><span class="o">.</span><span class="n">hits</span> <span class="o">=</span> <span class="mi">100</span>
</span><span data-line="5"><span class="n">stats</span><span class="o">.</span><span class="n">l1_stats</span><span class="o">.</span><span class="n">misses</span> <span class="o">=</span> <span class="mi">20</span>
</span><span data-line="6">
</span><span data-line="7"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L1 hit rate: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">l1_stats</span><span class="o">.</span><span class="n">hit_rate</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="8"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall hit rate: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">overall_hit_rate</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="9"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total size: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">total_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># Export to monitoring</span>
</span><span data-line="12"><span class="n">metrics</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">to_metrics_dict</span><span class="p">()</span>
</span></pre></div>
</div>
</dd></dl>

<section id="id3">
<h4>Fields<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h4>
<p><strong>Per-Tier Statistics:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">l1_stats</span></code> (TierStatistics): L1 statistics (default: empty TierStatistics)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l2_stats</span></code> (TierStatistics): L2 statistics (default: empty TierStatistics)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l3_stats</span></code> (TierStatistics): L3 statistics (default: empty TierStatistics)</p></li>
</ul>
<p><strong>Cross-Tier Operations:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">promotions</span></code> (int): L3→L2→L1 promotions (≥0, default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">demotions</span></code> (int): L1→L2→L3 demotions (≥0, default: 0)</p></li>
</ul>
<p><strong>Degradation Tracking:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">l1_degraded</span></code> (bool): L1 tier unavailable (default: False)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l2_degraded</span></code> (bool): L2 tier unavailable (default: False)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">l3_degraded</span></code> (bool): L3 tier unavailable (default: False)</p></li>
</ul>
</section>
<section id="computed-properties">
<h4>Computed Properties<a class="headerlink" href="#computed-properties" title="Link to this heading">¶</a></h4>
<dl class="py property">
<dt class="sig sig-object py" id="overall_hit_rate">
<span class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">overall_hit_rate</span></span><span class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)"><span class="pre">float</span></a></span><a class="headerlink" href="#overall_hit_rate" title="Link to this definition">¶</a></dt>
<dd><p>Overall hit rate across all tiers (0.0 to 1.0).</p>
<p>Uses max of per-tier misses to avoid triple-counting misses that cascade
through L1→L2→L3 lookups.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="total_size">
<span class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">total_size</span></span><span class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span><a class="headerlink" href="#total_size" title="Link to this definition">¶</a></dt>
<dd><p>Total cached entries across all tiers.</p>
</dd></dl>

</section>
<section id="methods">
<h4>Methods<a class="headerlink" href="#methods" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py" id="to_metrics_dict">
<span class="sig-name descname"><span class="pre">to_metrics_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#to_metrics_dict" title="Link to this definition">¶</a></dt>
<dd><p>Convert to flat metrics dict for monitoring systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dictionary with metric names and float values</p>
</dd>
</dl>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">metrics</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">to_metrics_dict</span><span class="p">()</span>
</span><span data-line="2"><span class="c1"># {</span>
</span><span data-line="3"><span class="c1">#     &quot;cache.l1.hit_rate&quot;: 0.85,</span>
</span><span data-line="4"><span class="c1">#     &quot;cache.l2.hit_rate&quot;: 0.60,</span>
</span><span data-line="5"><span class="c1">#     &quot;cache.l3.hit_rate&quot;: 0.40,</span>
</span><span data-line="6"><span class="c1">#     &quot;cache.overall.hit_rate&quot;: 0.75,</span>
</span><span data-line="7"><span class="c1">#     &quot;cache.total_size&quot;: 1500.0,</span>
</span><span data-line="8"><span class="c1">#     &quot;cache.promotions&quot;: 250.0,</span>
</span><span data-line="9"><span class="c1">#     &quot;cache.demotions&quot;: 150.0,</span>
</span><span data-line="10"><span class="c1">#     &quot;cache.l1.size&quot;: 1000.0,</span>
</span><span data-line="11"><span class="c1">#     &quot;cache.l2.size&quot;: 450.0,</span>
</span><span data-line="12"><span class="c1">#     &quot;cache.l3.size&quot;: 50.0</span>
</span><span data-line="13"><span class="c1"># }</span>
</span></pre></div>
</div>
</dd></dl>

</section>
</section>
<hr class="docutils" />
<section id="tierstatistics">
<h3>TierStatistics<a class="headerlink" href="#tierstatistics" title="Link to this heading">¶</a></h3>
<p>Statistics for a single cache tier.</p>
<dl class="py class">
<dt class="sig sig-object py" id="TierStatistics">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">TierStatistics</span></span><a class="headerlink" href="#TierStatistics" title="Link to this definition">¶</a></dt>
<dd><p>Pydantic model that tracks hits, misses, evictions by reason, and computes hit rate.</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">TierStatistics</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">stats</span> <span class="o">=</span> <span class="n">TierStatistics</span><span class="p">(</span><span class="n">hits</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">misses</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span data-line="4"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hit rate: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">hit_rate</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># 83.33%</span>
</span><span data-line="5"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total evictions: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">total_evictions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</dd></dl>

<section id="id4">
<h4>Fields<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hits</span></code> (int): Cache hits (≥0, default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">misses</span></code> (int): Cache misses (≥0, default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">current_size</span></code> (int): Current number of entries (≥0, default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">evictions_lru</span></code> (int): LRU evictions (≥0, default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">evictions_ttl</span></code> (int): TTL-based evictions (≥0, default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">evictions_health</span></code> (int): Health-based evictions (≥0, default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">evictions_corruption</span></code> (int): Corruption-based evictions (≥0, default: 0)</p></li>
</ul>
</section>
<section id="id5">
<h4>Computed Properties<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h4>
<dl class="py property">
<dt class="sig sig-object py" id="hit_rate">
<span class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">hit_rate</span></span><span class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.14)"><span class="pre">float</span></a></span><a class="headerlink" href="#hit_rate" title="Link to this definition">¶</a></dt>
<dd><p>Cache hit rate (0.0 to 1.0).</p>
<dl class="field-list simple">
<dt class="field-odd">Formula<span class="colon">:</span></dt>
<dd class="field-odd"><p>hits / (hits + misses) if total &gt; 0, else 0.0</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="total_evictions">
<span class="property"><span class="k"><span class="pre">property</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">total_evictions</span></span><span class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span><a class="headerlink" href="#total_evictions" title="Link to this definition">¶</a></dt>
<dd><p>Total evictions across all reasons.</p>
<dl class="field-list simple">
<dt class="field-odd">Formula<span class="colon">:</span></dt>
<dd class="field-odd"><p>evictions_lru + evictions_ttl + evictions_health + evictions_corruption</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<hr class="docutils" />
<section id="healthstatus-enum">
<h3>HealthStatus (Enum)<a class="headerlink" href="#healthstatus-enum" title="Link to this heading">¶</a></h3>
<p>Proxy health status for cache entries (imported from <code class="docutils literal notranslate"><span class="pre">proxywhirl.models</span></code>).</p>
<dl class="py class">
<dt class="sig sig-object py" id="HealthStatus">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">HealthStatus</span></span><a class="headerlink" href="#HealthStatus" title="Link to this definition">¶</a></dt>
<dd><p>String enum representing proxy health status with 5 states.</p>
<p><strong>Values:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">UNKNOWN</span> <span class="pre">=</span> <span class="pre">&quot;unknown&quot;</span></code> - Not yet tested (default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">HEALTHY</span> <span class="pre">=</span> <span class="pre">&quot;healthy&quot;</span></code> - Working normally</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DEGRADED</span> <span class="pre">=</span> <span class="pre">&quot;degraded&quot;</span></code> - Partial functionality (some failures)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UNHEALTHY</span> <span class="pre">=</span> <span class="pre">&quot;unhealthy&quot;</span></code> - Experiencing issues (many failures)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DEAD</span> <span class="pre">=</span> <span class="pre">&quot;dead&quot;</span></code> - Not responding (completely unusable)</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">HealthStatus</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">status</span> <span class="o">=</span> <span class="n">HealthStatus</span><span class="o">.</span><span class="n">HEALTHY</span>
</span><span data-line="4"><span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># &quot;healthy&quot;</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># All 5 states are available</span>
</span><span data-line="7"><span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">HealthStatus</span><span class="p">:</span>
</span><span data-line="8">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">state</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</dd></dl>

</section>
<hr class="docutils" />
<section id="cachetiertype-enum">
<h3>CacheTierType (Enum)<a class="headerlink" href="#cachetiertype-enum" title="Link to this heading">¶</a></h3>
<p>Type of cache tier.</p>
<dl class="py class">
<dt class="sig sig-object py" id="CacheTierType">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">CacheTierType</span></span><a class="headerlink" href="#CacheTierType" title="Link to this definition">¶</a></dt>
<dd><p>String enum representing cache tier types.</p>
<p><strong>Values:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">L1</span> <span class="pre">=</span> <span class="pre">&quot;l1&quot;</span></code> - Memory tier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">L2</span> <span class="pre">=</span> <span class="pre">&quot;l2&quot;</span></code> - Disk tier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">L3</span> <span class="pre">=</span> <span class="pre">&quot;l3&quot;</span></code> - SQLite tier</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheTierType</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">tier</span> <span class="o">=</span> <span class="n">CacheTierType</span><span class="o">.</span><span class="n">L1</span>
</span><span data-line="4"><span class="nb">print</span><span class="p">(</span><span class="n">tier</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>  <span class="c1"># &quot;l1&quot;</span>
</span></pre></div>
</div>
</dd></dl>

</section>
<hr class="docutils" />
<section id="l2backendtype-enum">
<h3>L2BackendType (Enum)<a class="headerlink" href="#l2backendtype-enum" title="Link to this heading">¶</a></h3>
<p>L2 cache backend type selection.</p>
<dl class="py class">
<dt class="sig sig-object py" id="L2BackendType">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">L2BackendType</span></span><a class="headerlink" href="#L2BackendType" title="Link to this definition">¶</a></dt>
<dd><p>String enum for selecting the L2 disk cache storage backend.</p>
<p><strong>Values:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">JSONL</span> <span class="pre">=</span> <span class="pre">&quot;jsonl&quot;</span></code> - File-based JSONL with sharding (default, best for &lt;10K entries)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SQLITE</span> <span class="pre">=</span> <span class="pre">&quot;sqlite&quot;</span></code> - SQLite database (faster for &gt;10K entries)</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheConfig</span><span class="p">,</span> <span class="n">L2BackendType</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Default JSONL backend</span>
</span><span data-line="4"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheConfig</span><span class="p">()</span>
</span><span data-line="5"><span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">l2_backend</span> <span class="o">==</span> <span class="n">L2BackendType</span><span class="o">.</span><span class="n">JSONL</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># SQLite backend for large caches</span>
</span><span data-line="8"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheConfig</span><span class="p">(</span><span class="n">l2_backend</span><span class="o">=</span><span class="n">L2BackendType</span><span class="o">.</span><span class="n">SQLITE</span><span class="p">)</span>
</span></pre></div>
</div>
</dd></dl>

<p><strong>When to use each backend:</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Backend</p></th>
<th class="head"><p>Best For</p></th>
<th class="head"><p>Performance</p></th>
<th class="head"><p>Features</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>JSONL</p></td>
<td><p>&lt;10K entries</p></td>
<td><p>O(n) lookups</p></td>
<td><p>Human-readable, portable, simple debugging</p></td>
</tr>
<tr class="row-odd"><td><p>SQLite</p></td>
<td><p>&gt;10K entries</p></td>
<td><p>O(log n) lookups</p></td>
<td><p>Indexed queries, faster batch operations</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<hr class="docutils" />
<section id="tier-implementations">
<h2>Tier Implementations<a class="headerlink" href="#tier-implementations" title="Link to this heading">¶</a></h2>
<section id="cachetier-abstract-base-class">
<h3>CacheTier (Abstract Base Class)<a class="headerlink" href="#cachetier-abstract-base-class" title="Link to this heading">¶</a></h3>
<p>Abstract base class for cache tier implementations.</p>
<dl class="py class">
<dt class="sig sig-object py" id="CacheTier">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">CacheTier</span></span><a class="headerlink" href="#CacheTier" title="Link to this definition">¶</a></dt>
<dd><p>Defines the interface that all cache tiers (L1, L2, L3) must implement,
including graceful degradation on repeated failures.</p>
<p><strong>Attributes:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">config</span></code> (CacheTierConfig) - Configuration for this tier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tier_type</span></code> (TierType) - Type of tier (L1/L2/L3)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code> (bool) - Whether tier is operational</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failure_count</span></code> (int) - Consecutive failures for degradation tracking</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failure_threshold</span></code> (int) - Failures before auto-disabling tier (default: 3)</p></li>
</ul>
</dd></dl>

<section id="constructor">
<h4>Constructor<a class="headerlink" href="#constructor" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py" id="init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#CacheTierConfig" title="CacheTierConfig"><span class="pre">CacheTierConfig</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">tier_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">TierType</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="headerlink" href="#init__" title="Link to this definition">¶</a></dt>
<dd><p>Initialize cache tier with configuration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – Configuration for this tier</p></li>
<li><p><strong>tier_type</strong> – Type of tier (L1/L2/L3)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="abstract-methods">
<h4>Abstract Methods<a class="headerlink" href="#abstract-methods" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py" id="get">
<span class="property"><span class="k"><span class="pre">abstractmethod</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#CacheEntry" title="CacheEntry"><span class="pre">CacheEntry</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="headerlink" href="#get" title="Link to this definition">¶</a></dt>
<dd><p>Retrieve entry by key, None if not found or expired.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>key</strong> – Cache key to lookup</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>CacheEntry if found and valid, None otherwise</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="put">
<span class="property"><span class="k"><span class="pre">abstractmethod</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">put</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">entry</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#CacheEntry" title="CacheEntry"><span class="pre">CacheEntry</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span></span><a class="headerlink" href="#put" title="Link to this definition">¶</a></dt>
<dd><p>Store entry, return True if successful.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> – Cache key for entry</p></li>
<li><p><strong>entry</strong> – CacheEntry to store</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if stored successfully, False otherwise</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="delete">
<span class="property"><span class="k"><span class="pre">abstractmethod</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span></span><a class="headerlink" href="#delete" title="Link to this definition">¶</a></dt>
<dd><p>Remove entry by key, return True if existed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>key</strong> – Cache key to delete</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if entry existed and was deleted, False if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="clear">
<span class="property"><span class="k"><span class="pre">abstractmethod</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></span><a class="headerlink" href="#clear" title="Link to this definition">¶</a></dt>
<dd><p>Clear all entries, return count of removed entries.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Number of entries removed</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="size">
<span class="property"><span class="k"><span class="pre">abstractmethod</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">size</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></span><a class="headerlink" href="#size" title="Link to this definition">¶</a></dt>
<dd><p>Return current number of entries.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Number of entries in tier</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="keys">
<span class="property"><span class="k"><span class="pre">abstractmethod</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.14)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#keys" title="Link to this definition">¶</a></dt>
<dd><p>Return list of all keys.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>List of cache keys</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="cleanup_expired">
<span class="property"><span class="k"><span class="pre">abstractmethod</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">cleanup_expired</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></span><a class="headerlink" href="#cleanup_expired" title="Link to this definition">¶</a></dt>
<dd><p>Remove all expired entries in bulk.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Number of entries removed</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="concrete-methods">
<h4>Concrete Methods<a class="headerlink" href="#concrete-methods" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py" id="handle_failure">
<span class="sig-name descname"><span class="pre">handle_failure</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">error</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#Exception" title="(in Python v3.14)"><span class="pre">Exception</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="headerlink" href="#handle_failure" title="Link to this definition">¶</a></dt>
<dd><p>Handle tier operation failure for graceful degradation.</p>
<p>Increments failure count and disables tier if threshold exceeded.
Called by implementations when operations fail.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>error</strong> – Exception that occurred</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="reset_failures">
<span class="sig-name descname"><span class="pre">reset_failures</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="headerlink" href="#reset_failures" title="Link to this definition">¶</a></dt>
<dd><p>Reset failure count on successful operation.</p>
<p>Re-enables tier if previously disabled and resets failure counter.
Implementations should call this after successful operations.</p>
</dd></dl>

</section>
</section>
<hr class="docutils" />
<section id="memorycachetier">
<h3>MemoryCacheTier<a class="headerlink" href="#memorycachetier" title="Link to this heading">¶</a></h3>
<p>L1 in-memory cache using OrderedDict for LRU tracking.</p>
<dl class="py class">
<dt class="sig sig-object py" id="MemoryCacheTier">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">MemoryCacheTier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">CacheTier</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#MemoryCacheTier" title="Link to this definition">¶</a></dt>
<dd><p>Provides O(1) lookups with automatic LRU eviction when max_entries exceeded.</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache.tiers</span><span class="w"> </span><span class="kn">import</span> <span class="n">MemoryCacheTier</span><span class="p">,</span> <span class="n">TierType</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheTierConfig</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheTierConfig</span><span class="p">(</span><span class="n">max_entries</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">eviction_policy</span><span class="o">=</span><span class="s2">&quot;lru&quot;</span><span class="p">)</span>
</span><span data-line="5"><span class="n">tier</span> <span class="o">=</span> <span class="n">MemoryCacheTier</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">TierType</span><span class="o">.</span><span class="n">L1_MEMORY</span><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Store entry</span>
</span><span data-line="8"><span class="n">tier</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Retrieve entry (moves to end for LRU)</span>
</span><span data-line="11"><span class="n">cached</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># Delete entry</span>
</span><span data-line="14"><span class="n">deleted</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># Get all keys</span>
</span><span data-line="17"><span class="n">keys</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span data-line="18">
</span><span data-line="19"><span class="c1"># Get size</span>
</span><span data-line="20"><span class="n">size</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span data-line="21">
</span><span data-line="22"><span class="c1"># Clear all</span>
</span><span data-line="23"><span class="n">cleared</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span data-line="24">
</span><span data-line="25"><span class="c1"># Cleanup expired</span>
</span><span data-line="26"><span class="n">removed</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">cleanup_expired</span><span class="p">()</span>
</span></pre></div>
</div>
</dd></dl>

<section id="id6">
<h4>Constructor<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#CacheTierConfig" title="CacheTierConfig"><span class="pre">CacheTierConfig</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">tier_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">TierType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">on_evict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span><span class="p"><span class="pre">[</span></span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#CacheEntry" title="CacheEntry"><span class="pre">CacheEntry</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span></dt>
<dd><p>Initialize memory cache with LRU tracking.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – Tier configuration</p></li>
<li><p><strong>tier_type</strong> – Type of tier (L1/L2/L3)</p></li>
<li><p><strong>on_evict</strong> – Optional callback when entry is evicted (key, entry)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="features">
<h4>Features<a class="headerlink" href="#features" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>O(1) lookups</p></li>
<li><p>Automatic LRU eviction when max_entries exceeded</p></li>
<li><p>Thread-safe with failure tracking</p></li>
<li><p>No persistence</p></li>
<li><p>Callbacks on eviction for demotion to L2</p></li>
</ul>
</section>
</section>
<hr class="docutils" />
<section id="jsonlcachetier">
<h3>JsonlCacheTier<a class="headerlink" href="#jsonlcachetier" title="Link to this heading">¶</a></h3>
<p>L2 file-based cache using sharded JSONL files with encryption.</p>
<dl class="py class">
<dt class="sig sig-object py" id="JsonlCacheTier">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">JsonlCacheTier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">CacheTier</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#JsonlCacheTier" title="Link to this definition">¶</a></dt>
<dd><p>File-based cache tier using JSON Lines format with consistent-hash sharding.
Best for &lt;10K entries. Human-readable, portable, and git-friendly.</p>
<p>Uses sharded JSONL files with:</p>
<ul class="simple">
<li><p>Consistent hash sharding (default 16 shards)</p></li>
<li><p>In-memory index for O(1) key→shard lookups</p></li>
<li><p>File locking (portalocker) for concurrent access safety</p></li>
<li><p>Fernet encryption for credentials at rest</p></li>
<li><p>Human-readable JSON Lines format</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache.tiers</span><span class="w"> </span><span class="kn">import</span> <span class="n">JsonlCacheTier</span><span class="p">,</span> <span class="n">TierType</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheTierConfig</span><span class="p">,</span> <span class="n">CredentialEncryptor</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span data-line="4">
</span><span data-line="5"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheTierConfig</span><span class="p">(</span><span class="n">max_entries</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">eviction_policy</span><span class="o">=</span><span class="s2">&quot;lru&quot;</span><span class="p">)</span>
</span><span data-line="6"><span class="n">encryptor</span> <span class="o">=</span> <span class="n">CredentialEncryptor</span><span class="p">()</span>
</span><span data-line="7"><span class="n">cache_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.cache/proxies&quot;</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="n">tier</span> <span class="o">=</span> <span class="n">JsonlCacheTier</span><span class="p">(</span>
</span><span data-line="10">    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">tier_type</span><span class="o">=</span><span class="n">TierType</span><span class="o">.</span><span class="n">L2_FILE</span><span class="p">,</span>
</span><span data-line="12">    <span class="n">cache_dir</span><span class="o">=</span><span class="n">cache_dir</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">encryptor</span><span class="o">=</span><span class="n">encryptor</span><span class="p">,</span>
</span><span data-line="14">    <span class="n">num_shards</span><span class="o">=</span><span class="mi">16</span>  <span class="c1"># Default</span>
</span><span data-line="15"><span class="p">)</span>
</span><span data-line="16">
</span><span data-line="17"><span class="c1"># Store entry (writes to appropriate shard file)</span>
</span><span data-line="18"><span class="n">tier</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20"><span class="c1"># Retrieve entry (uses in-memory index for O(1) shard lookup)</span>
</span><span data-line="21"><span class="n">cached</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># Delete entry</span>
</span><span data-line="24"><span class="n">deleted</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="25">
</span><span data-line="26"><span class="c1"># Get all keys (from index)</span>
</span><span data-line="27"><span class="n">keys</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span data-line="28">
</span><span data-line="29"><span class="c1"># Get size</span>
</span><span data-line="30"><span class="n">size</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span data-line="31">
</span><span data-line="32"><span class="c1"># Clear all (removes all shard files)</span>
</span><span data-line="33"><span class="n">cleared</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span data-line="34">
</span><span data-line="35"><span class="c1"># Cleanup expired entries</span>
</span><span data-line="36"><span class="n">removed</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">cleanup_expired</span><span class="p">()</span>
</span></pre></div>
</div>
</dd></dl>

<section id="id7">
<h4>Constructor<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#CacheTierConfig" title="CacheTierConfig"><span class="pre">CacheTierConfig</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">tier_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">TierType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encryptor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#CredentialEncryptor" title="CredentialEncryptor"><span class="pre">CredentialEncryptor</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_shards</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">16</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span></dt>
<dd><p>Initialize JSONL file cache with sharding and encryption.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – Tier configuration</p></li>
<li><p><strong>tier_type</strong> – Type of tier (L1/L2/L3)</p></li>
<li><p><strong>cache_dir</strong> – Directory for shard files</p></li>
<li><p><strong>encryptor</strong> – Optional encryptor for credentials</p></li>
<li><p><strong>num_shards</strong> – Number of shard files (default: 16)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="file-structure">
<h4>File Structure<a class="headerlink" href="#file-structure" title="Link to this heading">¶</a></h4>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span data-line="1">.cache/proxies/
</span><span data-line="2">├── shard_00.jsonl
</span><span data-line="3">├── shard_01.jsonl
</span><span data-line="4">├── ...
</span><span data-line="5">└── shard_15.jsonl
</span></pre></div>
</div>
<p>Each shard file contains JSON Lines entries:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span data-line="1">{&quot;key&quot;: &quot;abc123&quot;, &quot;proxy_url&quot;: &quot;http://proxy:8080&quot;, &quot;source&quot;: &quot;free-proxy-list&quot;, &quot;ttl_seconds&quot;: 3600, ...}
</span><span data-line="2">{&quot;key&quot;: &quot;def456&quot;, &quot;proxy_url&quot;: &quot;socks5://proxy:1080&quot;, &quot;source&quot;: &quot;geonode&quot;, &quot;ttl_seconds&quot;: 7200, ...}
</span></pre></div>
</div>
</section>
<section id="id8">
<h4>Features<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Human-readable JSON Lines format</p></li>
<li><p>Portable (can copy/move files)</p></li>
<li><p>Git-friendly for version control</p></li>
<li><p>Consistent-hash sharding for distribution</p></li>
<li><p>In-memory index for fast lookups</p></li>
<li><p>File locking for concurrent access</p></li>
<li><p>Encrypted credentials at rest</p></li>
<li><p>Best for &lt;10K entries</p></li>
</ul>
</section>
<section id="when-to-use-jsonl-vs-sqlite">
<h4>When to Use JSONL vs SQLite<a class="headerlink" href="#when-to-use-jsonl-vs-sqlite" title="Link to this heading">¶</a></h4>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Factor</p></th>
<th class="head"><p>JSONL (JsonlCacheTier)</p></th>
<th class="head"><p>SQLite (DiskCacheTier)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Entry count</p></td>
<td><p>&lt;10K entries</p></td>
<td><p>&gt;10K entries</p></td>
</tr>
<tr class="row-odd"><td><p>Lookup speed</p></td>
<td><p>O(n) per shard</p></td>
<td><p>O(log n) indexed</p></td>
</tr>
<tr class="row-even"><td><p>Portability</p></td>
<td><p>Copy files anywhere</p></td>
<td><p>Single .db file</p></td>
</tr>
<tr class="row-odd"><td><p>Git-friendly</p></td>
<td><p>Yes</p></td>
<td><p>Not recommended</p></td>
</tr>
<tr class="row-even"><td><p>Human-readable</p></td>
<td><p>Yes</p></td>
<td><p>No (binary)</p></td>
</tr>
<tr class="row-odd"><td><p>Concurrent writes</p></td>
<td><p>File locking</p></td>
<td><p>WAL mode</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<hr class="docutils" />
<section id="diskcachetier">
<h3>DiskCacheTier<a class="headerlink" href="#diskcachetier" title="Link to this heading">¶</a></h3>
<p>L2 SQLite-based cache with encryption and indexed lookups.</p>
<dl class="py class">
<dt class="sig sig-object py" id="DiskCacheTier">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">DiskCacheTier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">CacheTier</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#DiskCacheTier" title="Link to this definition">¶</a></dt>
<dd><p>Optimized for &gt;10K entries using SQLite with B-tree indexes instead of JSONL.
Provides O(log n) lookups vs O(n) for JSONL, achieving &lt;10ms reads for 10K+ entries.</p>
<p>Uses a lightweight SQLite database with:</p>
<ul class="simple">
<li><p>Primary key index on cache key for fast lookups</p></li>
<li><p>Encrypted credentials stored as BLOB</p></li>
<li><p>Efficient bulk operations (cleanup, size, keys)</p></li>
<li><p>File-based persistence without complex sharding</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache.tiers</span><span class="w"> </span><span class="kn">import</span> <span class="n">DiskCacheTier</span><span class="p">,</span> <span class="n">TierType</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheTierConfig</span><span class="p">,</span> <span class="n">CredentialEncryptor</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span data-line="4">
</span><span data-line="5"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheTierConfig</span><span class="p">(</span><span class="n">max_entries</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">eviction_policy</span><span class="o">=</span><span class="s2">&quot;lru&quot;</span><span class="p">)</span>
</span><span data-line="6"><span class="n">encryptor</span> <span class="o">=</span> <span class="n">CredentialEncryptor</span><span class="p">()</span>
</span><span data-line="7"><span class="n">cache_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.cache/proxies&quot;</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="n">tier</span> <span class="o">=</span> <span class="n">DiskCacheTier</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">TierType</span><span class="o">.</span><span class="n">L2_FILE</span><span class="p">,</span> <span class="n">cache_dir</span><span class="p">,</span> <span class="n">encryptor</span><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># Same interface as MemoryCacheTier</span>
</span><span data-line="12"><span class="n">tier</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
</span><span data-line="13"><span class="n">cached</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></pre></div>
</div>
</dd></dl>

<section id="id9">
<h4>Constructor<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#CacheTierConfig" title="CacheTierConfig"><span class="pre">CacheTierConfig</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">tier_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">TierType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encryptor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#CredentialEncryptor" title="CredentialEncryptor"><span class="pre">CredentialEncryptor</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span></dt>
<dd><p>Initialize SQLite-based L2 cache.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – Tier configuration</p></li>
<li><p><strong>tier_type</strong> – Type of tier (should be L2_FILE)</p></li>
<li><p><strong>cache_dir</strong> – Directory for cache database</p></li>
<li><p><strong>encryptor</strong> – Credential encryptor for username/password</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="id10">
<h4>Methods<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py" id="migrate_from_jsonl">
<span class="sig-name descname"><span class="pre">migrate_from_jsonl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">jsonl_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></span><a class="headerlink" href="#migrate_from_jsonl" title="Link to this definition">¶</a></dt>
<dd><p>Migrate existing JSONL shard files to SQLite L2 cache.</p>
<p>This method provides a migration path from the old JSONL-based L2 cache
to the new SQLite-based implementation. It reads all shard_*.jsonl files
from the specified directory and imports them into the SQLite database.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>jsonl_dir</strong> – Directory containing shard_*.jsonl files (defaults to self.cache_dir)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Number of entries successfully migrated</p>
</dd>
</dl>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">tier</span> <span class="o">=</span> <span class="n">DiskCacheTier</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">TierType</span><span class="o">.</span><span class="n">L2_FILE</span><span class="p">,</span> <span class="n">cache_dir</span><span class="p">)</span>
</span><span data-line="2"><span class="n">migrated</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">migrate_from_jsonl</span><span class="p">()</span>
</span><span data-line="3"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Migrated </span><span class="si">{</span><span class="n">migrated</span><span class="si">}</span><span class="s2"> entries from JSONL to SQLite&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="close">
<span class="sig-name descname"><span class="pre">close</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="headerlink" href="#close" title="Link to this definition">¶</a></dt>
<dd><p>Close the persistent SQLite connection and release database resources.</p>
<p>Should be called when the cache tier is no longer needed to properly
release database resources and file locks. Safe to call multiple times.
Thread-safe via internal lock.</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">tier</span> <span class="o">=</span> <span class="n">DiskCacheTier</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">TierType</span><span class="o">.</span><span class="n">L2_FILE</span><span class="p">,</span> <span class="n">cache_dir</span><span class="p">,</span> <span class="n">encryptor</span><span class="p">)</span>
</span><span data-line="2"><span class="k">try</span><span class="p">:</span>
</span><span data-line="3">    <span class="n">tier</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
</span><span data-line="4">    <span class="n">cached</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="5"><span class="k">finally</span><span class="p">:</span>
</span><span data-line="6">    <span class="n">tier</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></pre></div>
</div>
</dd></dl>

</section>
<section id="id11">
<h4>Features<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>O(log n) indexed lookups using SQLite B-tree</p></li>
<li><p>Encrypted credential storage (BLOB fields)</p></li>
<li><p>Atomic operations with SQLite transactions</p></li>
<li><p>Efficient bulk cleanup using SQL DELETE</p></li>
<li><p>Simple file-based persistence (single .db file)</p></li>
<li><p>Automatic schema initialization</p></li>
</ul>
</section>
<section id="database-schema">
<h4>Database Schema<a class="headerlink" href="#database-schema" title="Link to this heading">¶</a></h4>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">l2_cache</span><span class="w"> </span><span class="p">(</span>
</span><span data-line="2"><span class="w">    </span><span class="k">key</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span data-line="3"><span class="w">    </span><span class="n">proxy_url</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="4"><span class="w">    </span><span class="n">username_encrypted</span><span class="w"> </span><span class="nb">BLOB</span><span class="p">,</span>
</span><span data-line="5"><span class="w">    </span><span class="n">password_encrypted</span><span class="w"> </span><span class="nb">BLOB</span><span class="p">,</span>
</span><span data-line="6"><span class="w">    </span><span class="k">source</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="7"><span class="w">    </span><span class="n">fetch_time</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="8"><span class="w">    </span><span class="n">last_accessed</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="9"><span class="w">    </span><span class="n">access_count</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="10"><span class="w">    </span><span class="n">ttl_seconds</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="11"><span class="w">    </span><span class="n">expires_at</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="12"><span class="w">    </span><span class="n">health_status</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span data-line="13"><span class="w">    </span><span class="n">failure_count</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="14"><span class="w">    </span><span class="n">evicted_from_l1</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span>
</span><span data-line="15"><span class="p">);</span>
</span><span data-line="16">
</span><span data-line="17"><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_l2_expires_at</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">l2_cache</span><span class="p">(</span><span class="n">expires_at</span><span class="p">);</span>
</span><span data-line="18"><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_l2_source</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">l2_cache</span><span class="p">(</span><span class="k">source</span><span class="p">);</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="sqlitecachetier">
<h3>SQLiteCacheTier<a class="headerlink" href="#sqlitecachetier" title="Link to this heading">¶</a></h3>
<p>L3 SQLite database cache with encrypted credentials and health history.</p>
<dl class="py class">
<dt class="sig sig-object py" id="SQLiteCacheTier">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">SQLiteCacheTier</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">CacheTier</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SQLiteCacheTier" title="Link to this definition">¶</a></dt>
<dd><p>Provides durable persistence with SQL indexing for fast lookups and comprehensive
health history tracking.</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache.tiers</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLiteCacheTier</span><span class="p">,</span> <span class="n">TierType</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheTierConfig</span><span class="p">,</span> <span class="n">CredentialEncryptor</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span data-line="4">
</span><span data-line="5"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheTierConfig</span><span class="p">(</span><span class="n">max_entries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">eviction_policy</span><span class="o">=</span><span class="s2">&quot;lru&quot;</span><span class="p">)</span>  <span class="c1"># Unlimited</span>
</span><span data-line="6"><span class="n">encryptor</span> <span class="o">=</span> <span class="n">CredentialEncryptor</span><span class="p">()</span>
</span><span data-line="7"><span class="n">db_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.cache/db/proxywhirl.db&quot;</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="n">tier</span> <span class="o">=</span> <span class="n">SQLiteCacheTier</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">TierType</span><span class="o">.</span><span class="n">L3_SQLITE</span><span class="p">,</span> <span class="n">db_path</span><span class="p">,</span> <span class="n">encryptor</span><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># Same interface as other tiers</span>
</span><span data-line="12"><span class="n">tier</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
</span><span data-line="13"><span class="n">cached</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Optimized bulk cleanup with SQL DELETE</span>
</span><span data-line="16"><span class="n">removed</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">cleanup_expired</span><span class="p">()</span>  <span class="c1"># O(1) instead of O(n)</span>
</span></pre></div>
</div>
</dd></dl>

<section id="id12">
<h4>Constructor<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#CacheTierConfig" title="CacheTierConfig"><span class="pre">CacheTierConfig</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">tier_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">TierType</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">db_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">encryptor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#CredentialEncryptor" title="CredentialEncryptor"><span class="pre">CredentialEncryptor</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span></dt>
<dd><p>Initialize SQLite cache.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config</strong> – Tier configuration</p></li>
<li><p><strong>tier_type</strong> – Type of tier (should be L3_SQLITE)</p></li>
<li><p><strong>db_path</strong> – Path to SQLite database file</p></li>
<li><p><strong>encryptor</strong> – Credential encryptor for username/password</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="id13">
<h4>Features<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p>Full persistence</p></li>
<li><p>SQL indexing for fast lookups</p></li>
<li><p>Health history tracking with separate table</p></li>
<li><p>Automatic schema migration</p></li>
<li><p>Optimized bulk cleanup (O(1) using SQL DELETE)</p></li>
<li><p>Credential encryption with BLOB storage</p></li>
<li><p>Foreign key constraints</p></li>
</ul>
</section>
<section id="id14">
<h4>Database Schema<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h4>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">cache_entries</span><span class="w"> </span><span class="p">(</span>
</span><span data-line="2"><span class="w">    </span><span class="k">key</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
</span><span data-line="3"><span class="w">    </span><span class="n">proxy_url</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="4"><span class="w">    </span><span class="n">username_encrypted</span><span class="w"> </span><span class="nb">BLOB</span><span class="p">,</span>
</span><span data-line="5"><span class="w">    </span><span class="n">password_encrypted</span><span class="w"> </span><span class="nb">BLOB</span><span class="p">,</span>
</span><span data-line="6"><span class="w">    </span><span class="k">source</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="7"><span class="w">    </span><span class="n">fetch_time</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="8"><span class="w">    </span><span class="n">last_accessed</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="9"><span class="w">    </span><span class="n">access_count</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="10"><span class="w">    </span><span class="n">ttl_seconds</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="11"><span class="w">    </span><span class="n">expires_at</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="12"><span class="w">    </span><span class="n">health_status</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span data-line="13"><span class="w">    </span><span class="n">failure_count</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="14"><span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="15"><span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="16"><span class="w">    </span><span class="c1">-- Health monitoring fields</span>
</span><span data-line="17"><span class="w">    </span><span class="n">last_health_check</span><span class="w"> </span><span class="nb">REAL</span><span class="p">,</span>
</span><span data-line="18"><span class="w">    </span><span class="n">consecutive_health_failures</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="19"><span class="w">    </span><span class="n">consecutive_health_successes</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="20"><span class="w">    </span><span class="n">recovery_attempt</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="21"><span class="w">    </span><span class="n">next_check_time</span><span class="w"> </span><span class="nb">REAL</span><span class="p">,</span>
</span><span data-line="22"><span class="w">    </span><span class="n">last_health_error</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span data-line="23"><span class="w">    </span><span class="n">total_health_checks</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="24"><span class="w">    </span><span class="n">total_health_check_failures</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span data-line="25"><span class="w">    </span><span class="n">evicted_from_l1</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span>
</span><span data-line="26"><span class="p">);</span>
</span><span data-line="27">
</span><span data-line="28"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">health_history</span><span class="w"> </span><span class="p">(</span>
</span><span data-line="29"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="n">AUTOINCREMENT</span><span class="p">,</span>
</span><span data-line="30"><span class="w">    </span><span class="n">proxy_key</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="31"><span class="w">    </span><span class="n">check_time</span><span class="w"> </span><span class="nb">REAL</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="32"><span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="33"><span class="w">    </span><span class="n">response_time_ms</span><span class="w"> </span><span class="nb">REAL</span><span class="p">,</span>
</span><span data-line="34"><span class="w">    </span><span class="n">error_message</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
</span><span data-line="35"><span class="w">    </span><span class="n">check_url</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span data-line="36"><span class="w">    </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">proxy_key</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">cache_entries</span><span class="p">(</span><span class="k">key</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
</span><span data-line="37"><span class="p">);</span>
</span><span data-line="38">
</span><span data-line="39"><span class="c1">-- Indexes</span>
</span><span data-line="40"><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_expires_at</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">cache_entries</span><span class="p">(</span><span class="n">expires_at</span><span class="p">);</span>
</span><span data-line="41"><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_source</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">cache_entries</span><span class="p">(</span><span class="k">source</span><span class="p">);</span>
</span><span data-line="42"><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_health_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">cache_entries</span><span class="p">(</span><span class="n">health_status</span><span class="p">);</span>
</span><span data-line="43"><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_last_accessed</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">cache_entries</span><span class="p">(</span><span class="n">last_accessed</span><span class="p">);</span>
</span><span data-line="44"><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_health_history_proxy</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">health_history</span><span class="p">(</span><span class="n">proxy_key</span><span class="p">);</span>
</span><span data-line="45"><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_health_history_time</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">health_history</span><span class="p">(</span><span class="n">check_time</span><span class="p">);</span>
</span></pre></div>
</div>
</section>
</section>
</section>
<hr class="docutils" />
<section id="utilities">
<h2>Utilities<a class="headerlink" href="#utilities" title="Link to this heading">¶</a></h2>
<section id="credentialencryptor">
<h3>CredentialEncryptor<a class="headerlink" href="#credentialencryptor" title="Link to this heading">¶</a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If no encryption key is provided and the <code class="docutils literal notranslate"><span class="pre">PROXYWHIRL_CACHE_ENCRYPTION_KEY</span></code> environment variable is not set, a new key is generated automatically. This means cached data encrypted with a previous key will be unreadable. Always persist your encryption key for production use.</p>
</div>
<p>Handles encryption/decryption of proxy credentials using Fernet symmetric encryption (AES-128-CBC + HMAC). Supports <strong>key rotation</strong> via <code class="docutils literal notranslate"><span class="pre">MultiFernet</span></code>: set <code class="docutils literal notranslate"><span class="pre">PROXYWHIRL_CACHE_KEY_PREVIOUS</span></code> to the old key when rotating, allowing decryption of data encrypted with either key while new encryptions use the current key.</p>
<dl class="py class">
<dt class="sig sig-object py" id="CredentialEncryptor">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">CredentialEncryptor</span></span><a class="headerlink" href="#CredentialEncryptor" title="Link to this definition">¶</a></dt>
<dd><p>Provides Fernet symmetric encryption for proxy credentials at rest (L2/L3 tiers).
Uses environment variable PROXYWHIRL_CACHE_ENCRYPTION_KEY for key management.</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CredentialEncryptor</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecretStr</span>
</span><span data-line="3"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Option 1: Use environment variable</span>
</span><span data-line="6"><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PROXYWHIRL_CACHE_ENCRYPTION_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;your-32-byte-url-safe-base64-key&quot;</span>
</span><span data-line="7"><span class="n">encryptor</span> <span class="o">=</span> <span class="n">CredentialEncryptor</span><span class="p">()</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Option 2: Provide key directly</span>
</span><span data-line="10"><span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.fernet</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fernet</span>
</span><span data-line="11"><span class="n">key</span> <span class="o">=</span> <span class="n">Fernet</span><span class="o">.</span><span class="n">generate_key</span><span class="p">()</span>
</span><span data-line="12"><span class="n">encryptor</span> <span class="o">=</span> <span class="n">CredentialEncryptor</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14"><span class="c1"># Encrypt credentials</span>
</span><span data-line="15"><span class="n">plaintext</span> <span class="o">=</span> <span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;mypassword&quot;</span><span class="p">)</span>
</span><span data-line="16"><span class="n">encrypted</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">plaintext</span><span class="p">)</span>  <span class="c1"># bytes</span>
</span><span data-line="17">
</span><span data-line="18"><span class="c1"># Decrypt credentials</span>
</span><span data-line="19"><span class="n">decrypted</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>  <span class="c1"># SecretStr</span>
</span><span data-line="20"><span class="nb">print</span><span class="p">(</span><span class="n">decrypted</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">())</span>  <span class="c1"># &quot;mypassword&quot;</span>
</span></pre></div>
</div>
</dd></dl>

<section id="id15">
<h4>Constructor<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.14)"><span class="pre">bytes</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span></dt>
<dd><p>Initialize encryptor with Fernet key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>key</strong> – Optional Fernet key (32 url-safe base64-encoded bytes).
If None, reads from PROXYWHIRL_CACHE_ENCRYPTION_KEY env var.
If env var not set, generates a new key (WARNING: regenerated keys
cannot decrypt existing cached data).</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If provided key is invalid for Fernet</p>
</dd>
</dl>
<p><strong>Attributes:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> (bytes) - Fernet encryption key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_cipher</span></code> (Fernet) - Fernet cipher instance</p></li>
</ul>
</dd></dl>

</section>
<section id="id16">
<h4>Methods<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py" id="encrypt">
<span class="sig-name descname"><span class="pre">encrypt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">secret</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">SecretStr</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.14)"><span class="pre">bytes</span></a></span></span><a class="headerlink" href="#encrypt" title="Link to this definition">¶</a></dt>
<dd><p>Encrypt a SecretStr to bytes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>secret</strong> – SecretStr containing plaintext to encrypt</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Encrypted bytes suitable for storage in BLOB fields</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If encryption fails</p>
</dd>
</dl>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">encrypted</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;password123&quot;</span><span class="p">))</span>
</span><span data-line="2"><span class="c1"># b&#39;gAAAAA...&#39;</span>
</span></pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="decrypt">
<span class="sig-name descname"><span class="pre">decrypt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">encrypted</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.14)"><span class="pre">bytes</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">SecretStr</span></span></span><a class="headerlink" href="#decrypt" title="Link to this definition">¶</a></dt>
<dd><p>Decrypt encrypted bytes back to SecretStr.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>encrypted</strong> – Encrypted bytes from storage</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>SecretStr containing decrypted plaintext (never logs value)</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.14)"><strong>ValueError</strong></a> – If decryption fails (wrong key, corrupted data)</p>
</dd>
</dl>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">decrypted</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_bytes</span><span class="p">)</span>
</span><span data-line="2"><span class="nb">print</span><span class="p">(</span><span class="n">decrypted</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">())</span>  <span class="c1"># &quot;password123&quot;</span>
</span></pre></div>
</div>
</dd></dl>

</section>
</section>
<hr class="docutils" />
<section id="cachemanager">
<h3>CacheManager<a class="headerlink" href="#cachemanager" title="Link to this heading">¶</a></h3>
<p>Main orchestrator for multi-tier proxy caching with automatic promotion/demotion, TTL management, and health-based invalidation.</p>
<dl class="py class">
<dt class="sig sig-object py" id="CacheManager">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">CacheManager</span></span><a class="headerlink" href="#CacheManager" title="Link to this definition">¶</a></dt>
<dd><p>Manages caching across three tiers:</p>
<ul class="simple">
<li><p><strong>L1 (Memory)</strong>: Fast in-memory cache using OrderedDict (LRU)</p></li>
<li><p><strong>L2 (Disk)</strong>: Persistent cache with configurable backend (JSONL or SQLite)</p></li>
<li><p><strong>L3 (SQLite)</strong>: Database cache for cold storage with full queryability</p></li>
</ul>
<p>Supports TTL-based expiration, health-based invalidation, and graceful
degradation when tiers fail. Thread-safe via <code class="docutils literal notranslate"><span class="pre">threading.RLock</span></code>.</p>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheManager</span><span class="p">,</span> <span class="n">CacheConfig</span><span class="p">,</span> <span class="n">CacheEntry</span><span class="p">,</span> <span class="n">HealthStatus</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheConfig</span><span class="p">()</span>
</span><span data-line="5"><span class="n">manager</span> <span class="o">=</span> <span class="n">CacheManager</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Store an entry</span>
</span><span data-line="8"><span class="n">entry</span> <span class="o">=</span> <span class="n">CacheEntry</span><span class="p">(</span>
</span><span data-line="9">    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;abc123&quot;</span><span class="p">,</span>
</span><span data-line="10">    <span class="n">proxy_url</span><span class="o">=</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;api&quot;</span><span class="p">,</span>
</span><span data-line="12">    <span class="n">fetch_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="13">    <span class="n">last_accessed</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="14">    <span class="n">ttl_seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>
</span><span data-line="15">    <span class="n">expires_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">),</span>
</span><span data-line="16">    <span class="n">health_status</span><span class="o">=</span><span class="n">HealthStatus</span><span class="o">.</span><span class="n">HEALTHY</span>
</span><span data-line="17"><span class="p">)</span>
</span><span data-line="18"><span class="n">manager</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20"><span class="c1"># Retrieve (promotes to higher tiers on hit)</span>
</span><span data-line="21"><span class="n">retrieved</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># Delete from all tiers</span>
</span><span data-line="24"><span class="n">manager</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="25">
</span><span data-line="26"><span class="c1"># Statistics</span>
</span><span data-line="27"><span class="n">stats</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>
</span><span data-line="28"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall hit rate: </span><span class="si">{</span><span class="n">stats</span><span class="o">.</span><span class="n">overall_hit_rate</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="29">
</span><span data-line="30"><span class="c1"># Export/import</span>
</span><span data-line="31"><span class="n">manager</span><span class="o">.</span><span class="n">export_to_file</span><span class="p">(</span><span class="s2">&quot;proxies.jsonl&quot;</span><span class="p">)</span>
</span><span data-line="32"><span class="n">manager</span><span class="o">.</span><span class="n">warm_from_file</span><span class="p">(</span><span class="s2">&quot;proxies.jsonl&quot;</span><span class="p">,</span> <span class="n">ttl_override</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
</span></pre></div>
</div>
</dd></dl>

<section id="id17">
<h4>Constructor<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#CacheConfig" title="CacheConfig"><span class="pre">CacheConfig</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span></dt>
<dd><p>Initialize cache manager with configuration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> – Cache configuration with tier settings (required)</p>
</dd>
</dl>
<p>Initializes L1 (memory), L2 (disk), and L3 (SQLite) tiers based on config.
Starts background TTL cleanup if <code class="docutils literal notranslate"><span class="pre">enable_background_cleanup</span></code> is True.</p>
</dd></dl>

</section>
<section id="id18">
<h4>Methods<a class="headerlink" href="#id18" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">get</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#CacheEntry" title="CacheEntry"><span class="pre">CacheEntry</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span></dt>
<dd><p>Retrieve entry from cache with tier promotion.</p>
<p>Checks L1 → L2 → L3 in order. Promotes entries to higher tiers on hit.
Updates <code class="docutils literal notranslate"><span class="pre">access_count</span></code> and <code class="docutils literal notranslate"><span class="pre">last_accessed</span></code> on successful retrieval.
Expired entries are automatically deleted from all tiers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>key</strong> – Cache key to retrieve</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>CacheEntry if found and not expired, None otherwise</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">put</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">entry</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#CacheEntry" title="CacheEntry"><span class="pre">CacheEntry</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span></span></dt>
<dd><p>Store entry in all enabled tiers.</p>
<p>Writes to all tiers for redundancy. Credentials are automatically
redacted in logs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> – Cache key</p></li>
<li><p><strong>entry</strong> – CacheEntry to store</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if stored in at least one tier, False otherwise</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">delete</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.14)"><span class="pre">bool</span></a></span></span></dt>
<dd><p>Delete entry from all tiers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>key</strong> – Cache key to delete</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if deleted from at least one tier, False if not found</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">clear</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span></span></dt>
<dd><p>Clear all entries from all tiers.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Total number of entries cleared</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="invalidate_by_health">
<span class="sig-name descname"><span class="pre">invalidate_by_health</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="headerlink" href="#invalidate_by_health" title="Link to this definition">¶</a></dt>
<dd><p>Mark proxy as unhealthy and evict if failure threshold reached.</p>
<p>Increments the <code class="docutils literal notranslate"><span class="pre">failure_count</span></code> and sets <code class="docutils literal notranslate"><span class="pre">health_status</span></code> to UNHEALTHY.
If <code class="docutils literal notranslate"><span class="pre">failure_count</span></code> reaches the configured <code class="docutils literal notranslate"><span class="pre">failure_threshold</span></code>, the proxy
is removed from all cache tiers.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>key</strong> – Cache key to invalidate</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="get_statistics">
<span class="sig-name descname"><span class="pre">get_statistics</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#CacheStatistics" title="CacheStatistics"><span class="pre">CacheStatistics</span></a></span></span><a class="headerlink" href="#get_statistics" title="Link to this definition">¶</a></dt>
<dd><p>Get current cache statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>CacheStatistics with hit rates, sizes, and tier degradation status</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="export_to_file">
<span class="sig-name descname"><span class="pre">export_to_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filepath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#export_to_file" title="Link to this definition">¶</a></dt>
<dd><p>Export all cache entries to a JSONL file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>filepath</strong> – Path to export file</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict with <code class="docutils literal notranslate"><span class="pre">exported</span></code> and <code class="docutils literal notranslate"><span class="pre">failed</span></code> counts</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="warm_from_file">
<span class="sig-name descname"><span class="pre">warm_from_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ttl_override</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.14)"><span class="pre">dict</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#warm_from_file" title="Link to this definition">¶</a></dt>
<dd><p>Load proxies from a file to pre-populate the cache.</p>
<p>Supports JSON (array), JSONL (newline-delimited), and CSV formats.
Invalid entries are skipped with warnings logged.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_path</strong> – Path to file containing proxy data</p></li>
<li><p><strong>ttl_override</strong> – Optional TTL in seconds (overrides <code class="docutils literal notranslate"><span class="pre">default_ttl_seconds</span></code>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict with <code class="docutils literal notranslate"><span class="pre">loaded</span></code>, <code class="docutils literal notranslate"><span class="pre">skipped</span></code>, and <code class="docutils literal notranslate"><span class="pre">failed</span></code> counts</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="generate_cache_key">
<span class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">generate_cache_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">proxy_url</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.14)"><span class="pre">str</span></a></span></span><a class="headerlink" href="#generate_cache_key" title="Link to this definition">¶</a></dt>
<dd><p>Generate cache key from proxy URL using SHA256 hash.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>proxy_url</strong> – Proxy URL to hash</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Hex-encoded SHA256 hash (first 16 chars)</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<hr class="docutils" />
<section id="crypto-utilities">
<h3>Crypto Utilities<a class="headerlink" href="#crypto-utilities" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">proxywhirl.cache.crypto</span></code> module provides helper functions for encryption key management and rotation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache.crypto</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_encryption_keys</span><span class="p">,</span> <span class="n">create_multi_fernet</span><span class="p">,</span> <span class="n">rotate_key</span>
</span></pre></div>
</div>
<section id="get-encryption-keys-list-bytes">
<h4><code class="docutils literal notranslate"><span class="pre">get_encryption_keys()</span> <span class="pre">-&gt;</span> <span class="pre">list[bytes]</span></code><a class="headerlink" href="#get-encryption-keys-list-bytes" title="Link to this heading">¶</a></h4>
<p>Get all valid encryption keys for MultiFernet. Returns keys in priority order: current key first, then previous key. Reads from <code class="docutils literal notranslate"><span class="pre">PROXYWHIRL_CACHE_ENCRYPTION_KEY</span></code> and <code class="docutils literal notranslate"><span class="pre">PROXYWHIRL_CACHE_KEY_PREVIOUS</span></code> environment variables. Generates a new key if no env vars are set.</p>
</section>
<section id="create-multi-fernet-multifernet">
<h4><code class="docutils literal notranslate"><span class="pre">create_multi_fernet()</span> <span class="pre">-&gt;</span> <span class="pre">MultiFernet</span></code><a class="headerlink" href="#create-multi-fernet-multifernet" title="Link to this heading">¶</a></h4>
<p>Create a <code class="docutils literal notranslate"><span class="pre">MultiFernet</span></code> instance with all valid encryption keys. MultiFernet tries keys in order for decryption (newest first). All new encryptions use the first (current) key.</p>
</section>
<section id="rotate-key-new-key-str-none">
<h4><code class="docutils literal notranslate"><span class="pre">rotate_key(new_key:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code><a class="headerlink" href="#rotate-key-new-key-str-none" title="Link to this heading">¶</a></h4>
<p>Rotate encryption keys by setting a new current key. Moves the current <code class="docutils literal notranslate"><span class="pre">PROXYWHIRL_CACHE_ENCRYPTION_KEY</span></code> to <code class="docutils literal notranslate"><span class="pre">PROXYWHIRL_CACHE_KEY_PREVIOUS</span></code> and sets the new key as current. This allows gradual migration: new data uses the new key, old data can still be decrypted with the previous key.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.fernet</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fernet</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache.crypto</span><span class="w"> </span><span class="kn">import</span> <span class="n">rotate_key</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Generate new key and rotate</span>
</span><span data-line="5"><span class="n">new_key</span> <span class="o">=</span> <span class="n">Fernet</span><span class="o">.</span><span class="n">generate_key</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span data-line="6"><span class="n">rotate_key</span><span class="p">(</span><span class="n">new_key</span><span class="p">)</span>
</span><span data-line="7"><span class="c1"># Old data remains readable via PROXYWHIRL_CACHE_KEY_PREVIOUS</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="ttlmanager">
<h3>TTLManager<a class="headerlink" href="#ttlmanager" title="Link to this heading">¶</a></h3>
<p>Manages TTL-based expiration with hybrid lazy + background cleanup. Used internally by <code class="docutils literal notranslate"><span class="pre">CacheManager</span></code> when <code class="docutils literal notranslate"><span class="pre">enable_background_cleanup=True</span></code>.</p>
<dl class="py class">
<dt class="sig sig-object py" id="TTLManager">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-name descname"><span class="pre">TTLManager</span></span><a class="headerlink" href="#TTLManager" title="Link to this definition">¶</a></dt>
<dd><p>Combines two cleanup strategies:</p>
<ul class="simple">
<li><p><strong>Lazy expiration</strong>: Check TTL on every <code class="docutils literal notranslate"><span class="pre">get()</span></code> operation</p></li>
<li><p><strong>Background cleanup</strong>: Periodic scan of all tiers to remove expired entries</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache.manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">TTLManager</span><span class="p">,</span> <span class="n">CacheManager</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheConfig</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheConfig</span><span class="p">(</span><span class="n">enable_background_cleanup</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="5"><span class="n">manager</span> <span class="o">=</span> <span class="n">CacheManager</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Manually create and start TTL manager</span>
</span><span data-line="8"><span class="n">ttl_mgr</span> <span class="o">=</span> <span class="n">TTLManager</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">cleanup_interval</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</span><span data-line="9"><span class="n">ttl_mgr</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># ... later ...</span>
</span><span data-line="12"><span class="n">ttl_mgr</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span></pre></div>
</div>
</dd></dl>

<section id="id19">
<h4>Constructor<a class="headerlink" href="#id19" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache_manager</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#CacheManager" title="CacheManager"><span class="pre">CacheManager</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">cleanup_interval</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.14)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">60</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cache_manager</strong> – Parent CacheManager instance</p></li>
<li><p><strong>cleanup_interval</strong> – Seconds between cleanup runs (default: 60)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="id20">
<h4>Methods<a class="headerlink" href="#id20" title="Link to this heading">¶</a></h4>
<dl class="py method">
<dt class="sig sig-object py" id="start">
<span class="sig-name descname"><span class="pre">start</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="headerlink" href="#start" title="Link to this definition">¶</a></dt>
<dd><p>Start background cleanup thread. Idempotent.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="stop">
<span class="sig-name descname"><span class="pre">stop</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.14)"><span class="pre">None</span></a></span></span><a class="headerlink" href="#stop" title="Link to this definition">¶</a></dt>
<dd><p>Stop background cleanup thread. Safe to call if not running.</p>
</dd></dl>

</section>
<section id="attributes">
<h4>Attributes<a class="headerlink" href="#attributes" title="Link to this heading">¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">enabled</span></code> (bool): Whether background cleanup is running</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cleanup_interval</span></code> (int): Seconds between cleanup runs</p></li>
</ul>
</section>
</section>
</section>
<hr class="docutils" />
<section id="usage-examples">
<h2>Usage Examples<a class="headerlink" href="#usage-examples" title="Link to this heading">¶</a></h2>
<section id="working-with-cache-tiers-directly">
<h3>Working with Cache Tiers Directly<a class="headerlink" href="#working-with-cache-tiers-directly" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache.tiers</span><span class="w"> </span><span class="kn">import</span> <span class="n">MemoryCacheTier</span><span class="p">,</span> <span class="n">DiskCacheTier</span><span class="p">,</span> <span class="n">SQLiteCacheTier</span><span class="p">,</span> <span class="n">TierType</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheTierConfig</span><span class="p">,</span> <span class="n">CacheEntry</span><span class="p">,</span> <span class="n">CredentialEncryptor</span><span class="p">,</span> <span class="n">HealthStatus</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span><span class="p">,</span> <span class="n">timedelta</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span data-line="5"><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecretStr</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Initialize tiers</span>
</span><span data-line="8"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheTierConfig</span><span class="p">(</span><span class="n">max_entries</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">eviction_policy</span><span class="o">=</span><span class="s2">&quot;lru&quot;</span><span class="p">)</span>
</span><span data-line="9"><span class="n">encryptor</span> <span class="o">=</span> <span class="n">CredentialEncryptor</span><span class="p">()</span>
</span><span data-line="10">
</span><span data-line="11"><span class="n">l1</span> <span class="o">=</span> <span class="n">MemoryCacheTier</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">TierType</span><span class="o">.</span><span class="n">L1_MEMORY</span><span class="p">)</span>
</span><span data-line="12"><span class="n">l2</span> <span class="o">=</span> <span class="n">DiskCacheTier</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">TierType</span><span class="o">.</span><span class="n">L2_FILE</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.cache/l2&quot;</span><span class="p">),</span> <span class="n">encryptor</span><span class="p">)</span>
</span><span data-line="13"><span class="n">l3</span> <span class="o">=</span> <span class="n">SQLiteCacheTier</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">TierType</span><span class="o">.</span><span class="n">L3_SQLITE</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.cache/l3.db&quot;</span><span class="p">),</span> <span class="n">encryptor</span><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Create entry</span>
</span><span data-line="16"><span class="n">entry</span> <span class="o">=</span> <span class="n">CacheEntry</span><span class="p">(</span>
</span><span data-line="17">    <span class="n">key</span><span class="o">=</span><span class="s2">&quot;proxy1&quot;</span><span class="p">,</span>
</span><span data-line="18">    <span class="n">proxy_url</span><span class="o">=</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">,</span>
</span><span data-line="19">    <span class="n">username</span><span class="o">=</span><span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">),</span>
</span><span data-line="20">    <span class="n">password</span><span class="o">=</span><span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;pass&quot;</span><span class="p">),</span>
</span><span data-line="21">    <span class="n">source</span><span class="o">=</span><span class="s2">&quot;api&quot;</span><span class="p">,</span>
</span><span data-line="22">    <span class="n">fetch_time</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="23">    <span class="n">last_accessed</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="24">    <span class="n">ttl_seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>
</span><span data-line="25">    <span class="n">expires_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">3600</span><span class="p">),</span>
</span><span data-line="26">    <span class="n">health_status</span><span class="o">=</span><span class="n">HealthStatus</span><span class="o">.</span><span class="n">HEALTHY</span>
</span><span data-line="27"><span class="p">)</span>
</span><span data-line="28">
</span><span data-line="29"><span class="c1"># Store in L1</span>
</span><span data-line="30"><span class="n">l1</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
</span><span data-line="31">
</span><span data-line="32"><span class="c1"># Retrieve from L1 (O(1) lookup)</span>
</span><span data-line="33"><span class="n">cached</span> <span class="o">=</span> <span class="n">l1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="34"><span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
</span><span data-line="35">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L1 hit: </span><span class="si">{</span><span class="n">cached</span><span class="o">.</span><span class="n">proxy_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="36">
</span><span data-line="37"><span class="c1"># Store in L2 (persisted to disk)</span>
</span><span data-line="38"><span class="n">l2</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
</span><span data-line="39">
</span><span data-line="40"><span class="c1"># Retrieve from L2 (O(log n) SQLite lookup)</span>
</span><span data-line="41"><span class="n">cached</span> <span class="o">=</span> <span class="n">l2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span data-line="42"><span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
</span><span data-line="43">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L2 hit: </span><span class="si">{</span><span class="n">cached</span><span class="o">.</span><span class="n">proxy_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="44">
</span><span data-line="45"><span class="c1"># Store in L3 (full database persistence)</span>
</span><span data-line="46"><span class="n">l3</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
</span><span data-line="47">
</span><span data-line="48"><span class="c1"># Cleanup expired entries</span>
</span><span data-line="49"><span class="n">removed_l1</span> <span class="o">=</span> <span class="n">l1</span><span class="o">.</span><span class="n">cleanup_expired</span><span class="p">()</span>
</span><span data-line="50"><span class="n">removed_l2</span> <span class="o">=</span> <span class="n">l2</span><span class="o">.</span><span class="n">cleanup_expired</span><span class="p">()</span>
</span><span data-line="51"><span class="n">removed_l3</span> <span class="o">=</span> <span class="n">l3</span><span class="o">.</span><span class="n">cleanup_expired</span><span class="p">()</span>
</span><span data-line="52"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed: L1=</span><span class="si">{</span><span class="n">removed_l1</span><span class="si">}</span><span class="s2">, L2=</span><span class="si">{</span><span class="n">removed_l2</span><span class="si">}</span><span class="s2">, L3=</span><span class="si">{</span><span class="n">removed_l3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="encryption-and-security">
<h3>Encryption and Security<a class="headerlink" href="#encryption-and-security" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CredentialEncryptor</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.fernet</span><span class="w"> </span><span class="kn">import</span> <span class="n">Fernet</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecretStr</span>
</span><span data-line="4"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># Generate and save encryption key</span>
</span><span data-line="7"><span class="n">key</span> <span class="o">=</span> <span class="n">Fernet</span><span class="o">.</span><span class="n">generate_key</span><span class="p">()</span>
</span><span data-line="8"><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PROXYWHIRL_CACHE_ENCRYPTION_KEY&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Initialize encryptor</span>
</span><span data-line="11"><span class="n">encryptor</span> <span class="o">=</span> <span class="n">CredentialEncryptor</span><span class="p">()</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># Encrypt credentials</span>
</span><span data-line="14"><span class="n">username</span> <span class="o">=</span> <span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">)</span>
</span><span data-line="15"><span class="n">password</span> <span class="o">=</span> <span class="n">SecretStr</span><span class="p">(</span><span class="s2">&quot;secret123&quot;</span><span class="p">)</span>
</span><span data-line="16">
</span><span data-line="17"><span class="n">encrypted_user</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
</span><span data-line="18"><span class="n">encrypted_pass</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encrypted username: </span><span class="si">{</span><span class="n">encrypted_user</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="21"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encrypted password: </span><span class="si">{</span><span class="n">encrypted_pass</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># Decrypt credentials</span>
</span><span data-line="24"><span class="n">decrypted_user</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_user</span><span class="p">)</span>
</span><span data-line="25"><span class="n">decrypted_pass</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_pass</span><span class="p">)</span>
</span><span data-line="26">
</span><span data-line="27"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Decrypted: </span><span class="si">{</span><span class="n">decrypted_user</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># &quot;admin&quot;</span>
</span><span data-line="28"><span class="c1"># Password value never logged by SecretStr</span>
</span></pre></div>
</div>
<hr class="docutils" />
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you have more than 10,000 cache entries, migrating from JSONL to SQLite L2 backend can significantly improve lookup performance (O(log n) vs O(n)).</p>
</div>
</section>
<section id="migration-from-jsonl-to-sqlite-l2">
<h3>Migration from JSONL to SQLite L2<a class="headerlink" href="#migration-from-jsonl-to-sqlite-l2" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache.tiers</span><span class="w"> </span><span class="kn">import</span> <span class="n">DiskCacheTier</span><span class="p">,</span> <span class="n">TierType</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.cache</span><span class="w"> </span><span class="kn">import</span> <span class="n">CacheTierConfig</span><span class="p">,</span> <span class="n">CredentialEncryptor</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Initialize new SQLite-based L2 tier</span>
</span><span data-line="6"><span class="n">config</span> <span class="o">=</span> <span class="n">CacheTierConfig</span><span class="p">(</span><span class="n">max_entries</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</span><span data-line="7"><span class="n">encryptor</span> <span class="o">=</span> <span class="n">CredentialEncryptor</span><span class="p">()</span>
</span><span data-line="8"><span class="n">cache_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.cache/proxies&quot;</span><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10"><span class="n">tier</span> <span class="o">=</span> <span class="n">DiskCacheTier</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">TierType</span><span class="o">.</span><span class="n">L2_FILE</span><span class="p">,</span> <span class="n">cache_dir</span><span class="p">,</span> <span class="n">encryptor</span><span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># Migrate from old JSONL shards</span>
</span><span data-line="13"><span class="n">migrated</span> <span class="o">=</span> <span class="n">tier</span><span class="o">.</span><span class="n">migrate_from_jsonl</span><span class="p">()</span>
</span><span data-line="14"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully migrated </span><span class="si">{</span><span class="n">migrated</span><span class="si">}</span><span class="s2"> entries from JSONL to SQLite&quot;</span><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># Old JSONL files can now be safely removed</span>
</span><span data-line="17"><span class="c1"># for shard in cache_dir.glob(&quot;shard_*.jsonl&quot;):</span>
</span><span data-line="18"><span class="c1">#     shard.unlink()</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="performance-considerations">
<h2>Performance Considerations<a class="headerlink" href="#performance-considerations" title="Link to this heading">¶</a></h2>
<section id="tier-selection">
<h3>Tier Selection<a class="headerlink" href="#tier-selection" title="Link to this heading">¶</a></h3>
<p><strong>L1 (Memory):</strong></p>
<ul class="simple">
<li><p>Fastest (O(1) lookup)</p></li>
<li><p>Limited capacity (default: 1000 entries)</p></li>
<li><p>Use for hot proxies</p></li>
</ul>
<p><strong>L2 (Disk/SQLite):</strong></p>
<ul class="simple">
<li><p>Medium speed (O(log n) indexed lookup)</p></li>
<li><p>Moderate capacity (default: 5000 entries)</p></li>
<li><p>Persistent across restarts</p></li>
<li><p>Use for warm proxies</p></li>
</ul>
<p><strong>L3 (SQLite):</strong></p>
<ul class="simple">
<li><p>Slower (database overhead, but indexed)</p></li>
<li><p>Unlimited capacity</p></li>
<li><p>Full health history tracking</p></li>
<li><p>Use for cold storage and analytics</p></li>
</ul>
</section>
<section id="optimization-tips">
<h3>Optimization Tips<a class="headerlink" href="#optimization-tips" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p><strong>Tune tier sizes</strong> based on workload</p></li>
<li><p><strong>Enable background cleanup</strong> to avoid lazy cleanup overhead</p></li>
<li><p><strong>Use encryption</strong> for sensitive credentials in L2/L3</p></li>
<li><p><strong>Monitor failure rates</strong> for graceful degradation</p></li>
<li><p><strong>Leverage indexes</strong> in L2/L3 for fast queries</p></li>
</ol>
</section>
</section>
<hr class="docutils" />
<section id="thread-safety">
<h2>Thread Safety<a class="headerlink" href="#thread-safety" title="Link to this heading">¶</a></h2>
<p>All tier implementations use internal locking for thread-safe operations. The <code class="docutils literal notranslate"><span class="pre">CacheTier</span></code> base class provides <code class="docutils literal notranslate"><span class="pre">handle_failure()</span></code> and <code class="docutils literal notranslate"><span class="pre">reset_failures()</span></code> methods for graceful degradation tracking.</p>
</section>
<hr class="docutils" />
<section id="error-handling">
<h2>Error Handling<a class="headerlink" href="#error-handling" title="Link to this heading">¶</a></h2>
<p>Tiers implement graceful degradation:</p>
<ul class="simple">
<li><p>After 3 consecutive failures, tier auto-disables (<code class="docutils literal notranslate"><span class="pre">enabled</span> <span class="pre">=</span> <span class="pre">False</span></code>)</p></li>
<li><p>Successful operations reset failure counter</p></li>
<li><p>Operations on disabled tiers return failure without attempting</p></li>
<li><p>Parent cache manager can detect degraded tiers via tier.enabled</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="python-api.html"><span class="std std-doc">Python API</span></a> – Main ProxyRotator API (CacheManager, CacheConfig usage)</p></li>
<li><p><a class="reference internal" href="configuration.html"><span class="std std-doc">Configuration</span></a> – TOML cache configuration options</p></li>
<li><p><a class="reference internal" href="exceptions.html"><span class="std std-doc">Exceptions</span></a> – Cache-specific exceptions (CacheCorruptionError, CacheStorageError, CacheValidationError)</p></li>
<li><p><a class="reference internal" href="rate-limiting-api.html"><span class="std std-doc">Rate Limiting API</span></a> – Rate limiting integration</p></li>
<li><p><a class="reference internal" href="../guides/caching.html"><span class="std std-doc">Caching</span></a> – Cache configuration patterns and optimization</p></li>
<li><p><a class="reference internal" href="../guides/deployment-security.html"><span class="std std-doc">Deployment Security</span></a> – Production cache security</p></li>
<li><p><a class="reference internal" href="../getting-started/index.html"><span class="std std-doc">Getting Started</span></a> – Getting started guide</p></li>
</ul>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="exceptions.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Exceptions Reference</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="rate-limiting-api.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Rate Limiting API Reference</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2026, Wyatt Walsh</p>
  
  <p>
    Made with
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/wyattowalsh/proxywhirl" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=a58bc63e"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=cac61aee"></script></body>
</html>