<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Rate Limiting API Reference - ProxyWhirl Documentation</title><link rel="shortcut icon" href="../_static/favicon.svg"/><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Project Status &amp; Roadmap" href="../project/index.html" /><link rel="prev" title="Cache API Reference" href="cache-api.html" />
      <link rel="canonical" href="https://proxywhirl.readthedocs.io/reference/rate-limiting-api.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=d140fbf8" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=cdf0d3ca" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/>
<meta property="og:url" content="https://proxywhirl.readthedocs.io/reference/rate-limiting-api.html"/>
<meta property="og:title" content="Rate Limiting API Reference"/>
<meta name="twitter:card" content="summary"/>
<meta property="og:image" content="https://proxywhirl.readthedocs.io/_static/og-image.png"/>
<meta name="twitter:creator" content="@@wyaborern"/>
<meta name="twitter:site" content="@@wyaborern"/>
  </head>
<body><div class="announcement">
    <div class="announcement-inner">
      <p><span style="background: linear-gradient(90deg, #6d64ff, #c86bff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 600;">ðŸš€ ProxyWhirl 1.0</span> â€” Intelligent rotation, REST API, and brand-new docs!</p>
      <button class="announcement-close" aria-label="Close announcement">
        <i class="i-lucide close"></i>
      </button>
    </div>
  </div><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      <img class="light-logo" src="../_static/logo.svg" alt="ProxyWhirl" height="28" loading="lazy" />
      <img class="dark-logo" src="../_static/logo.svg" alt="ProxyWhirl" height="28" loading="lazy" />
      <strong>ProxyWhirl</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul><li class="link"><a href="../getting-started/index.html">Quickstart</a></li><li class="link"><a href="../guides/index.html">Guides</a></li><li class="link"><a href="index.html">API</a></li><li class="link"><a href="../project/index.html">Project</a></li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/wyattowalsh/proxywhirl" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="2"><ul class="current">
<li class="toctree-l1 _expand"><a class="reference internal" href="../getting-started/index.html">Getting Started</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#installation">Installation</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#quick-start">Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#async-usage">Async Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#using-free-proxy-lists">Using Free Proxy Lists</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#rotation-strategies">Rotation Strategies</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#next-steps">Next Steps</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#for-contributors">For Contributors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/rotation-strategies.html">Rotation Strategies Quickstart</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#bootstrap-a-rotator">Bootstrap a rotator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#strategy-selector">Strategy selector</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#strategy-recipes">Strategy recipes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#observe-the-pool">Observe the pool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#advanced-strategies-preview">Advanced strategies (preview)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../getting-started/rotation-strategies.html">Rotation Strategies Quickstart</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/rotation-strategies.html#bootstrap-a-rotator">Bootstrap a rotator</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/rotation-strategies.html#strategy-selector">Strategy selector</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/rotation-strategies.html#strategy-recipes">Strategy recipes</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/rotation-strategies.html#observe-the-pool">Observe the pool</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/rotation-strategies.html#advanced-strategies-preview">Advanced strategies (preview)</a></li>
</ul>
</li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../guides/index.html">Guides</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/async-client.html">Async Client Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html#when-to-use-async-vs-sync">When to Use Async vs Sync</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#use-asyncproxyrotator-when">Use AsyncProxyRotator when:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#use-proxyrotator-sync-when">Use ProxyRotator (sync) when:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html#initialization">Initialization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#basic-initialization">Basic Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#with-initial-proxies">With Initial Proxies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#with-custom-strategy">With Custom Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#with-custom-configuration">With Custom Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html#context-manager-usage">Context Manager Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#async-context-manager-recommended">Async Context Manager (Recommended)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#manual-lifecycle-management-advanced">Manual Lifecycle Management (Advanced)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html#http-request-methods">HTTP Request Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#all-http-methods">All HTTP Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#request-parameters">Request Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html#proxy-management">Proxy Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#adding-proxies">Adding Proxies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#removing-proxies">Removing Proxies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#getting-proxy-statistics">Getting Proxy Statistics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html#hot-swapping-strategies">Hot-Swapping Strategies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html#error-handling">Error Handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#basic-exception-handling">Basic Exception Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#retry-policy-override">Retry Policy Override</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#circuit-breaker-management">Circuit Breaker Management</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html#concurrent-requests-with-asyncio-gather">Concurrent Requests with asyncio.gather</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#parallel-requests-to-different-urls">Parallel Requests to Different URLs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#rate-limited-concurrent-scraping">Rate-Limited Concurrent Scraping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#production-scale-web-scraping">Production-Scale Web Scraping</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html#performance-considerations">Performance Considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#connection-pooling">Connection Pooling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#connection-limits">Connection Limits</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#memory-management">Memory Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#performance-benchmarks">Performance Benchmarks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html#asyncio-integration-patterns">Asyncio Integration Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#with-fastapi">With FastAPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#with-aiohttp">With aiohttp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#advanced-httpx-integration">Advanced httpx Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#with-asyncio-queue">With asyncio.Queue</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html#comparison-async-vs-sync">Comparison: Async vs Sync</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#feature-parity">Feature Parity</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#key-differences">Key Differences</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#migration-example">Migration Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html#best-practices-and-common-patterns">Best Practices and Common Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#always-use-context-managers">1. Always Use Context Managers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#use-semaphores-for-concurrency-control">2. Use Semaphores for Concurrency Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#handle-exceptions-gracefully">3. Handle Exceptions Gracefully</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#reuse-rotator-instances">4. Reuse Rotator Instances</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#monitor-circuit-breaker-states">5. Monitor Circuit Breaker States</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#use-appropriate-retry-policies">6. Use Appropriate Retry Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#profile-and-optimize-connection-pooling">7. Profile and Optimize Connection Pooling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#use-strategy-hot-swapping-for-adaptive-behavior">8. Use Strategy Hot-Swapping for Adaptive Behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#clean-up-resources-properly">9. Clean Up Resources Properly</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/async-client.html#avoid-common-pitfalls">10. Avoid Common Pitfalls</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/async-client.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/advanced-strategies.html">Advanced Rotation Strategies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#overview">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#available-strategies">Available Strategies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#performance-based-strategy">Performance-Based Strategy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#when-to-use">When to Use</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#performance-characteristics">Performance Characteristics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#how-it-works">How It Works</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#warmup-period">Warmup Period</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#adaptation-example">Adaptation Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#success-criteria">Success Criteria</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#session-persistence-strategy">Session Persistence Strategy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id1">When to Use</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id2">Performance Characteristics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id3">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#session-lifecycle">Session Lifecycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#session-management">Session Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#failover-behavior">Failover Behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#ttl-and-expiration">TTL and Expiration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#lru-eviction">LRU Eviction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id4">Success Criteria</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#geo-targeted-strategy">Geo-Targeted Strategy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id5">When to Use</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id6">Performance Characteristics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id7">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#country-codes">Country Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#filtering-logic">Filtering Logic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#fallback-modes">Fallback Modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#secondary-selection-strategies">Secondary Selection Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#retry-integration">Retry Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id8">Success Criteria</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#cost-aware-strategy">Cost-Aware Strategy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id9">When to Use</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id10">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#weight-calculation">Weight Calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#cost-threshold-filtering">Cost Threshold Filtering</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#best-practices">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#composite-strategy">Composite Strategy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id11">When to Use</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id12">Performance Characteristics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#architecture">Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#basic-composition">Basic Composition</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#common-patterns">Common Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#configuration-from-dict">Configuration from Dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#validation-example">Validation Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#performance-considerations">Performance Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id13">Success Criteria</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#strategy-registry">Strategy Registry</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#registration">Registration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#validation">Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#thread-safety">Thread Safety</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#listing-strategies">Listing Strategies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#selectioncontext">SelectionContext</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#fields">Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#usage-with-strategies">Usage with Strategies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#strategyconfig">StrategyConfig</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id14">Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#per-strategy-configuration">Per-Strategy Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#custom-strategy-implementation">Custom Strategy Implementation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#implementing-the-protocol">Implementing the Protocol</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#registering-custom-strategies">Registering Custom Strategies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#strategyregistry-usage">StrategyRegistry Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#registration-and-validation">Registration and Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#strategy-validation">Strategy Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id15">Thread Safety</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#unregistering-strategies">Unregistering Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#testing-with-registry-reset">Testing with Registry Reset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#performance-requirements">Performance Requirements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#id16">Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#choose-the-right-strategy">1. Choose the Right Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#warm-up-performance-based-strategies">2. Warm Up Performance-Based Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#monitor-session-memory">3. Monitor Session Memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#use-selectioncontext-consistently">4. Use SelectionContext Consistently</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#validate-geo-data-availability">5. Validate Geo Data Availability</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#proxypoolemptyerror-no-proxies-with-ema-data">ProxyPoolEmptyError: No proxies with EMA data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#sessionpersistencestrategy-requires-selectioncontext-with-session-id">SessionPersistenceStrategy requires SelectionContext with session_id</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#geo-targeting-returns-unexpected-proxies">Geo-targeting returns unexpected proxies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#composite-strategy-too-slow">Composite strategy too slow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#testing-strategies">Testing Strategies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#performance-benchmarks">Performance Benchmarks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#selection-time">Selection Time</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#memory-usage">Memory Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/advanced-strategies.html#id17">Success Criteria</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/advanced-strategies.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/caching.html">Caching Subsystem Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html#architecture-overview">Architecture Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#tier-promotion-demotion">Tier Promotion &amp; Demotion</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#l2-vs-l3-sqlite-differences">L2 vs L3 SQLite Differences</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html#core-components">Core Components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#cachemanager">CacheManager</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#cacheentry">CacheEntry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#cacheconfig">CacheConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#cachestatistics">CacheStatistics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html#credential-encryption">Credential Encryption</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#encryption-setup">Encryption Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#key-rotation">Key Rotation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#encryption-behavior">Encryption Behavior</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html#ttl-and-expiration">TTL and Expiration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#ttl-configuration">TTL Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#expiration-strategies">Expiration Strategies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html#health-invalidation">Health Invalidation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#invalidation-workflow">Invalidation Workflow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html#migration-from-jsonl-l2-cache">Migration from JSONL L2 Cache</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#migrating-legacy-jsonl-caches">Migrating Legacy JSONL Caches</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html#cache-warming">Cache Warming</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#supported-formats">Supported Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#warming-from-file">Warming from File</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html#performance-tuning">Performance Tuning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#tier-sizing-recommendations">Tier Sizing Recommendations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#eviction-policy-selection">Eviction Policy Selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#performance-characteristics">Performance Characteristics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#graceful-degradation">Graceful Degradation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html#cli-integration">CLI Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html#best-practices">Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#security">Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#performance">Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#reliability">Reliability</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html#example-complete-cache-setup">Example: Complete Cache Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#low-hit-rates">Low Hit Rates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#high-memory-usage">High Memory Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#encryption-errors">Encryption Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/caching.html#tier-degradation">Tier Degradation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/caching.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/retry-failover.html">Retry &amp; Failover Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#architecture-overview">Architecture Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#when-to-use-retry-vs-failover">When to Use Retry vs Failover</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#retry-same-proxy">Retry (Same Proxy)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#failover-different-proxy">Failover (Different Proxy)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#retrypolicy-configuration">RetryPolicy Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#basic-configuration">Basic Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#backoff-strategies">Backoff Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#jitter-explained">Jitter Explained</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#retryable-status-codes">Retryable Status Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#timeout-behavior">Timeout Behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#non-idempotent-requests">Non-Idempotent Requests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#circuit-breaker-configuration">Circuit Breaker Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#sync-vs-async-circuit-breakers">Sync vs Async Circuit Breakers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#state-machine">State Machine</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#thresholds-and-configuration">Thresholds and Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#circuit-breaker-persistence">Circuit Breaker Persistence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#state-transitions">State Transitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#rolling-window-behavior">Rolling Window Behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#manual-reset">Manual Reset</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#intelligent-proxy-selection">Intelligent Proxy Selection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#selection-algorithm">Selection Algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#example-performance-based-selection">Example: Performance-Based Selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#example-geo-targeted-selection">Example: Geo-Targeted Selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#exclusion-rules">Exclusion Rules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#retrymetrics-and-observability">RetryMetrics and Observability</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#collecting-metrics">Collecting Metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#summary-statistics">Summary Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#time-series-data">Time-Series Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#per-proxy-statistics">Per-Proxy Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#circuit-breaker-events">Circuit Breaker Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#hourly-aggregation">Hourly Aggregation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#retention-configuration">Retention Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#retryexecutor-deep-dive">RetryExecutor Deep Dive</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#how-retries-work-internally">How Retries Work Internally</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#retryable-vs-non-retryable-errors">Retryable vs Non-Retryable Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#direct-retryexecutor-usage">Direct RetryExecutor Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#integration-with-proxyrotator">Integration with ProxyRotator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#custom-error-handling">Custom Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#monitoring-circuit-breakers">Monitoring Circuit Breakers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#manual-circuit-reset">Manual Circuit Reset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#integration-with-rotation-strategies">Integration with Rotation Strategies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#advanced-patterns">Advanced Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#adaptive-retry-policy">Adaptive Retry Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#circuit-breaker-alerts">Circuit Breaker Alerts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#request-level-retry-override">Request-Level Retry Override</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#best-practices">Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#start-conservative-tune-later">1. Start Conservative, Tune Later</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#always-use-jitter-in-production">2. Always Use Jitter in Production</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#monitor-circuit-breaker-opens">3. Monitor Circuit Breaker Opens</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#set-timeouts-for-time-sensitive-requests">4. Set Timeouts for Time-Sensitive Requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#use-metrics-for-capacity-planning">5. Use Metrics for Capacity Planning</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#all-retries-exhausted">All Retries Exhausted</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#high-latency">High Latency</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/retry-failover.html#non-retryable-errors">Non-Retryable Errors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#performance-impact">Performance Impact</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#related-documentation">Related Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/retry-failover.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/cli-reference.html">CLI Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guides/cli-reference.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/cli-reference.html#global-options">Global Options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#config-auto-discovery">Config Auto-Discovery</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/cli-reference.html#commands">Commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#request">request</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#pool">pool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#config">config</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#health">health</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#fetch">fetch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#export">export</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#setup-geoip">setup-geoip</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#sources">sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#stats">stats</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/cli-reference.html#output-formats">Output Formats</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#text-default">Text (default)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#json">JSON</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#csv">CSV</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/cli-reference.html#configuration-file">Configuration File</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/cli-reference.html#advanced-usage">Advanced Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#scripting-with-json-output">Scripting with JSON Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#automated-proxy-refresh">Automated Proxy Refresh</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#ci-cd-integration">CI/CD Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#multi-environment-configuration">Multi-Environment Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/cli-reference.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#configuration-not-found">Configuration Not Found</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#lock-file-issues">Lock File Issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#slow-validation">Slow Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#geoip-enrichment-not-working">GeoIP Enrichment Not Working</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/cli-reference.html#ssrf-protection-blocking-local-tests">SSRF Protection Blocking Local Tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/cli-reference.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/cli-reference.html#exit-codes">Exit Codes</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/automation.html">Automation &amp; CI Runbook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guides/automation.html#pre-flight-checks">Pre-flight checks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/automation.html#smoke-tests-for-docs-examples">Smoke tests for docs examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/automation.html#docsearch-credentials">DocSearch credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/automation.html#automating-releases">Automating releases</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/automation.html#suggested-ci-stages">Suggested CI stages</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../guides/mcp-server.html">MCP Server Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#quick-start">Quick Start</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#running-the-server">Running the Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#auto-loading-proxies">Auto-Loading Proxies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#cli-options">CLI Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#the-proxywhirl-tool">The <code class="docutils literal notranslate"><span class="pre">proxywhirl</span></code> Tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#available-actions">Available Actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#action-examples">Action Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#resources">Resources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#resource-proxywhirl-health">resource://proxywhirl/health</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#resource-proxywhirl-config">resource://proxywhirl/config</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#prompts">Prompts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#proxy-selection-workflow">proxy_selection_workflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#troubleshooting-workflow">troubleshooting_workflow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#authentication">Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#enabling-authentication">Enabling Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#authenticated-tool-calls">Authenticated Tool Calls</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#auth-middleware">Auth Middleware</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#disabling-authentication">Disabling Authentication</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#progress-reporting">Progress Reporting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#transport-options">Transport Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#integration-with-claude-desktop">Integration with Claude Desktop</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#macos">macOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#windows">Windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#with-uvx-recommended">With uvx (Recommended)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#with-transport-options">With Transport Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#programmatic-usage">Programmatic Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#custom-rotator-configuration">Custom Rotator Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#lifecycle-management">Lifecycle Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#how-lifespan-works">How Lifespan Works</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#server-class-usage">Server Class Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#error-handling">Error Handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#common-error-codes">Common Error Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#example-error-responses">Example Error Responses</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#best-practices">Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#always-check-pool-health-first">1. Always Check Pool Health First</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#use-recommendations-for-critical-requests">2. Use Recommendations for Critical Requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#monitor-circuit-breaker-states">3. Monitor Circuit Breaker States</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#handle-errors-gracefully">4. Handle Errors Gracefully</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#clean-up-resources">5. Clean Up Resources</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#server-wont-start">Server Won&#8217;t Start</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#no-proxies-available">No Proxies Available</a></li>
<li class="toctree-l4"><a class="reference internal" href="../guides/mcp-server.html#authentication-failures">Authentication Failures</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../guides/mcp-server.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Reference</a><ul class="current">
<li class="toctree-l2 _expand"><a class="reference internal" href="rest-api.html">ProxyWhirl REST API Usage Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="rest-api.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="rest-api.html#getting-started">Getting Started</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#starting-the-api-server">Starting the API Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#using-docker">Using Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#accessing-documentation">Accessing Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rest-api.html#authentication">Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#no-authentication-default">No Authentication (Default)</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#api-key-authentication">API Key Authentication</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rest-api.html#endpoint-reference">Endpoint Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#rotation-strategy-configuration">Rotation Strategy Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#proxied-requests">Proxied Requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#pool-management">Pool Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#monitoring">Monitoring</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#configuration">Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rest-api.html#rate-limiting">Rate Limiting</a></li>
<li class="toctree-l3"><a class="reference internal" href="rest-api.html#error-handling">Error Handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#error-codes">Error Codes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rest-api.html#performance-tips">Performance Tips</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#use-connection-pooling">1. Use Connection Pooling</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#enable-response-compression">2. Enable Response Compression</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#use-health-checks-efficiently">3. Use Health Checks Efficiently</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#monitor-metrics">4. Monitor Metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#configure-appropriate-timeouts">5. Configure Appropriate Timeouts</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#use-persistent-storage">6. Use Persistent Storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#optimize-retry-logic">7. Optimize Retry Logic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rest-api.html#security-best-practices">Security Best Practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="rest-api.html#deployment-examples">Deployment Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#nginx-reverse-proxy">Nginx Reverse Proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#kubernetes-deployment">Kubernetes Deployment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rest-api.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#api-wont-start">API Won&#8217;t Start</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#proxies-not-working">Proxies Not Working</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#rate-limiting-issues">Rate Limiting Issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="rest-api.html#high-latency">High Latency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rest-api.html#support">Support</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="python-api.html">Python API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="python-api.html#core-classes">Core Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#proxyrotator">ProxyRotator</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#asyncproxyrotator">AsyncProxyRotator</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#proxyfetcher">ProxyFetcher</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#proxyvalidator">ProxyValidator</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#browserrenderer">BrowserRenderer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="python-api.html#rotation-strategies">Rotation Strategies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#roundrobinstrategy">RoundRobinStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#randomstrategy">RandomStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#weightedstrategy">WeightedStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#leastusedstrategy">LeastUsedStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#performancebasedstrategy">PerformanceBasedStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#sessionpersistencestrategy">SessionPersistenceStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#geotargetedstrategy">GeoTargetedStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#costawarestrategy">CostAwareStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#compositestrategy">CompositeStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#strategyregistry">StrategyRegistry</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="python-api.html#data-models">Data Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#proxy">Proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#proxypool">ProxyPool</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#proxychain">ProxyChain</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#proxycredentials">ProxyCredentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#proxyconfiguration">ProxyConfiguration</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#selectioncontext">SelectionContext</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#strategyconfig">StrategyConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#session">Session</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="python-api.html#cache-components">Cache Components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#cachemanager">CacheManager</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#cacheconfig">CacheConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#cacheentry">CacheEntry</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#cachestatistics">CacheStatistics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="python-api.html#retry-failover">Retry &amp; Failover</a><ul>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#retrypolicy">RetryPolicy</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#retryexecutor">RetryExecutor</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#circuitbreaker">CircuitBreaker</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#retrymetrics">RetryMetrics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="python-api.html#parsers">Parsers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#jsonparser">JSONParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#csvparser">CSVParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#plaintextparser">PlainTextParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#htmltableparser">HTMLTableParser</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="python-api.html#utility-functions">Utility Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#configure-logging">configure_logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#is-valid-proxy-url">is_valid_proxy_url</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#parse-proxy-url">parse_proxy_url</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#validate-proxy-model">validate_proxy_model</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#encrypt-credentials-decrypt-credentials">encrypt_credentials / decrypt_credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#proxy-to-dict">proxy_to_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#create-proxy-from-url">create_proxy_from_url</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#deduplicate-proxies">deduplicate_proxies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="python-api.html#enumerations">Enumerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#healthstatus">HealthStatus</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#proxysource">ProxySource</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#proxyformat">ProxyFormat</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#rendermode">RenderMode</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#validationlevel">ValidationLevel</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#backoffstrategy">BackoffStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#circuitbreakerstate">CircuitBreakerState</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="python-api.html#built-in-proxy-sources">Built-in Proxy Sources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#individual-sources">Individual Sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="python-api.html#source-collections">Source Collections</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="python-api.html#exceptions">Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="python-api.html#type-annotations">Type Annotations</a></li>
<li class="toctree-l3"><a class="reference internal" href="python-api.html#version">Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="python-api.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="configuration.html">Configuration Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#configuration-discovery">Configuration Discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#toml-configuration-format">TOML Configuration Format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#file-locations">File Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#complete-configuration-example">Complete Configuration Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#environment-variables">Environment Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#security-encryption">Security &amp; Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#rest-api-configuration">REST API Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#configuration-classes">Configuration Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#cliconfig">CLIConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#datastorageconfig">DataStorageConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#proxyconfig">ProxyConfig</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#programmatic-configuration">Programmatic Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#loading-configuration">Loading Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#creating-configuration">Creating Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#saving-configuration">Saving Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#validation-rules">Validation Rules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#rotation-strategy">Rotation Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#output-format">Output Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#proxy-url-schemes">Proxy URL Schemes</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#numeric-constraints">Numeric Constraints</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#security-best-practices">Security Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#credential-encryption">Credential Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#config-file-permissions">Config File Permissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#api-key-security">API Key Security</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#configuration-examples">Configuration Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#minimal-configuration">Minimal Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#high-performance-configuration">High-Performance Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#privacy-focused-configuration">Privacy-Focused Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#analytics-enabled-configuration">Analytics-Enabled Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#migration-from-legacy-config">Migration from Legacy Config</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#config-file-not-found">Config File Not Found</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#invalid-toml-syntax">Invalid TOML Syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="configuration.html#encryption-key-issues">Encryption Key Issues</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html#related-documentation">Related Documentation</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="exceptions.html">Exceptions Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html#exception-hierarchy">Exception Hierarchy</a></li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html#proxyerrorcode-enum">ProxyErrorCode Enum</a><ul>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html#utility-functions">Utility Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#redact-url">redact_url()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html#error-codes">Error Codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html#exception-reference">Exception Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#proxywhirlerror">ProxyWhirlError</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#proxyvalidationerror">ProxyValidationError</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#proxypoolemptyerror">ProxyPoolEmptyError</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#proxyconnectionerror">ProxyConnectionError</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#proxyauthenticationerror">ProxyAuthenticationError</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#proxyfetcherror">ProxyFetchError</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#proxystorageerror">ProxyStorageError</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#cachecorruptionerror">CacheCorruptionError</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#cachestorageerror">CacheStorageError</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#cachevalidationerror">CacheValidationError</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#requestqueuefullerror">RequestQueueFullError</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html#error-handling-patterns">Error Handling Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#basic-error-handling">Basic Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#catch-all-error-handling">Catch-All Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#retry-logic-based-on-error-type">Retry Logic Based on Error Type</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#async-error-handling">Async Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#rest-api-error-handling">REST API Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#context-manager-pattern">Context Manager Pattern</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#error-aggregation">Error Aggregation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html#best-practices">Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#use-specific-exceptions">1. Use Specific Exceptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#check-retry-recommended-flag">2. Check retry_recommended Flag</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#use-error-codes-for-programmatic-handling">3. Use Error Codes for Programmatic Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#log-structured-error-data">4. Log Structured Error Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#implement-circuit-breaker-pattern">5. Implement Circuit Breaker Pattern</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#provide-user-friendly-error-messages">6. Provide User-Friendly Error Messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#test-error-handling">7. Test Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#monitor-error-rates">8. Monitor Error Rates</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#handle-async-errors-properly">9. Handle Async Errors Properly</a></li>
<li class="toctree-l4"><a class="reference internal" href="exceptions.html#document-error-handling">10. Document Error Handling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="exceptions.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="cache-api.html">Cache API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cache-api.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="cache-api.html#data-models">Data Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#cacheentry">CacheEntry</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#cacheconfig">CacheConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#cachetierconfig">CacheTierConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#cachestatistics">CacheStatistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#tierstatistics">TierStatistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#healthstatus-enum">HealthStatus (Enum)</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#cachetiertype-enum">CacheTierType (Enum)</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#l2backendtype-enum">L2BackendType (Enum)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cache-api.html#tier-implementations">Tier Implementations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#cachetier-abstract-base-class">CacheTier (Abstract Base Class)</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#memorycachetier">MemoryCacheTier</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#jsonlcachetier">JsonlCacheTier</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#diskcachetier">DiskCacheTier</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#sqlitecachetier">SQLiteCacheTier</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cache-api.html#utilities">Utilities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#credentialencryptor">CredentialEncryptor</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#cachemanager">CacheManager</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cache-api.html#usage-examples">Usage Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#working-with-cache-tiers-directly">Working with Cache Tiers Directly</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#encryption-and-security">Encryption and Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#migration-from-jsonl-to-sqlite-l2">Migration from JSONL to SQLite L2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cache-api.html#performance-considerations">Performance Considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#tier-selection">Tier Selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache-api.html#optimization-tips">Optimization Tips</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cache-api.html#thread-safety">Thread Safety</a></li>
<li class="toctree-l3"><a class="reference internal" href="cache-api.html#error-handling">Error Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="cache-api.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Rate Limiting API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#core-classes">Core Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ratelimiter">RateLimiter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#data-models">Data Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ratelimit">RateLimit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ratelimitevent">RateLimitEvent</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#usage-examples">Usage Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-rate-limiting">Basic Rate Limiting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#global-per-proxy-limits">Global + Per-Proxy Limits</a></li>
<li class="toctree-l4"><a class="reference internal" href="#burst-handling">Burst Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-limit-adjustment">Dynamic Limit Adjustment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#integration-with-proxyrotator">Integration with ProxyRotator</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monitoring-and-logging">Monitoring and Logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#retry-with-backoff">Retry with Backoff</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#thread-safety">Thread Safety</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance-considerations">Performance Considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#token-bucket-algorithm">Token Bucket Algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#memory-usage">Memory Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#concurrency">Concurrency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#integration-with-monitoring">Integration with Monitoring</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prometheus-metrics">Prometheus Metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datadog-integration">DataDog Integration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sphinx-integration">Sphinx Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#common-patterns">Common Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fallback-to-different-proxy">Fallback to Different Proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#batch-requests-with-rate-limiting">Batch Requests with Rate Limiting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#circuit-breaker-integration">Circuit Breaker Integration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#faq">FAQ</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../project/index.html">Project Status &amp; Roadmap</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#current-health">Current health</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#collaboration-checklists">Collaboration checklists</a></li>
</ul>
</li>
</ul>
        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#core-classes">Core Classes</a><ul>
<li><a class="reference internal" href="#ratelimiter">RateLimiter</a><ul>
<li><a class="reference internal" href="#constructor">Constructor</a></li>
<li><a class="reference internal" href="#methods">Methods</a><ul>
<li><a class="reference internal" href="#set-proxy-limit-proxy-id-str-limit-ratelimit-none"><code class="docutils literal notranslate"><span class="pre">set_proxy_limit(proxy_id:</span> <span class="pre">str,</span> <span class="pre">limit:</span> <span class="pre">RateLimit)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code></a></li>
<li><a class="reference internal" href="#check-limit-proxy-id-str-bool-async"><code class="docutils literal notranslate"><span class="pre">check_limit(proxy_id:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code> (async)</a></li>
<li><a class="reference internal" href="#acquire-proxy-id-str-bool-async"><code class="docutils literal notranslate"><span class="pre">acquire(proxy_id:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code> (async)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#data-models">Data Models</a><ul>
<li><a class="reference internal" href="#ratelimit">RateLimit</a><ul>
<li><a class="reference internal" href="#fields">Fields</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ratelimitevent">RateLimitEvent</a><ul>
<li><a class="reference internal" href="#id1">Fields</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#usage-examples">Usage Examples</a><ul>
<li><a class="reference internal" href="#basic-rate-limiting">Basic Rate Limiting</a></li>
<li><a class="reference internal" href="#global-per-proxy-limits">Global + Per-Proxy Limits</a></li>
<li><a class="reference internal" href="#burst-handling">Burst Handling</a></li>
<li><a class="reference internal" href="#dynamic-limit-adjustment">Dynamic Limit Adjustment</a></li>
<li><a class="reference internal" href="#integration-with-proxyrotator">Integration with ProxyRotator</a></li>
<li><a class="reference internal" href="#monitoring-and-logging">Monitoring and Logging</a></li>
<li><a class="reference internal" href="#retry-with-backoff">Retry with Backoff</a></li>
</ul>
</li>
<li><a class="reference internal" href="#thread-safety">Thread Safety</a></li>
<li><a class="reference internal" href="#performance-considerations">Performance Considerations</a><ul>
<li><a class="reference internal" href="#token-bucket-algorithm">Token Bucket Algorithm</a></li>
<li><a class="reference internal" href="#memory-usage">Memory Usage</a></li>
<li><a class="reference internal" href="#concurrency">Concurrency</a></li>
</ul>
</li>
<li><a class="reference internal" href="#integration-with-monitoring">Integration with Monitoring</a><ul>
<li><a class="reference internal" href="#prometheus-metrics">Prometheus Metrics</a></li>
<li><a class="reference internal" href="#datadog-integration">DataDog Integration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sphinx-integration">Sphinx Integration</a></li>
<li><a class="reference internal" href="#common-patterns">Common Patterns</a><ul>
<li><a class="reference internal" href="#fallback-to-different-proxy">Fallback to Different Proxy</a></li>
<li><a class="reference internal" href="#batch-requests-with-rate-limiting">Batch Requests with Rate Limiting</a></li>
<li><a class="reference internal" href="#circuit-breaker-integration">Circuit Breaker Integration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#faq">FAQ</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">ProxyWhirl</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">Reference</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Rate Limiting API Reference</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="rate-limiting-api-reference">
<h1>Rate Limiting API Reference<a class="headerlink" href="#rate-limiting-api-reference" title="Link to this heading">Â¶</a></h1>
<p>Complete reference for ProxyWhirlâ€™s rate limiting system with per-proxy and global rate limits using token bucket algorithm.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">,</span> <span class="n">RateLimitEvent</span>
</span></pre></div>
</div>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">Â¶</a></h2>
<p>The rate limiting subsystem provides flexible request throttling for proxies with:</p>
<ul class="simple">
<li><p><strong>Per-proxy limits</strong>: Individual rate limits for each proxy</p></li>
<li><p><strong>Global limits</strong>: Aggregate rate limit across all proxies</p></li>
<li><p><strong>Token bucket algorithm</strong>: Burst capacity with sustained rate limiting</p></li>
<li><p><strong>Thread-safe</strong>: Safe for concurrent access</p></li>
<li><p><strong>Async support</strong>: Fully async/await compatible</p></li>
</ul>
<p>Built on top of <code class="docutils literal notranslate"><span class="pre">pyrate-limiter</span></code> for robust, production-ready rate limiting.</p>
</section>
<section id="core-classes">
<h2>Core Classes<a class="headerlink" href="#core-classes" title="Link to this heading">Â¶</a></h2>
<section id="ratelimiter">
<h3>RateLimiter<a class="headerlink" href="#ratelimiter" title="Link to this heading">Â¶</a></h3>
<p>Main rate limiter with per-proxy and global limits using token bucket algorithm.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Initialize with global limit</span>
</span><span data-line="4"><span class="n">global_limit</span> <span class="o">=</span> <span class="n">RateLimit</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">max_requests</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">time_window</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>  <span class="c1"># 1000 requests per 60 seconds</span>
</span><span data-line="7">    <span class="n">burst_allowance</span><span class="o">=</span><span class="mi">100</span>  <span class="c1"># Allow bursts up to 100 requests</span>
</span><span data-line="8"><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">(</span><span class="n">global_limit</span><span class="o">=</span><span class="n">global_limit</span><span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># Set per-proxy limits</span>
</span><span data-line="13"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span>
</span><span data-line="14">    <span class="s2">&quot;proxy1&quot;</span><span class="p">,</span>
</span><span data-line="15">    <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 10 req/sec</span>
</span><span data-line="16"><span class="p">)</span>
</span><span data-line="17">
</span><span data-line="18"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span>
</span><span data-line="19">    <span class="s2">&quot;proxy2&quot;</span><span class="p">,</span>
</span><span data-line="20">    <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 20 req/sec</span>
</span><span data-line="21"><span class="p">)</span>
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># Check if request is allowed</span>
</span><span data-line="24"><span class="n">allowed</span> <span class="o">=</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">)</span>
</span><span data-line="25"><span class="k">if</span> <span class="n">allowed</span><span class="p">:</span>
</span><span data-line="26">    <span class="c1"># Make request</span>
</span><span data-line="27">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">make_request_with_proxy</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">)</span>
</span><span data-line="28"><span class="k">else</span><span class="p">:</span>
</span><span data-line="29">    <span class="c1"># Rate limited, wait or use different proxy</span>
</span><span data-line="30">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rate limit exceeded for proxy1&quot;</span><span class="p">)</span>
</span><span data-line="31">
</span><span data-line="32"><span class="c1"># Acquire permission (same as check_limit)</span>
</span><span data-line="33"><span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">):</span>
</span><span data-line="34">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">make_request_with_proxy</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<section id="constructor">
<h4>Constructor<a class="headerlink" href="#constructor" title="Link to this heading">Â¶</a></h4>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">global_limit</span></code> (RateLimit | None): Global rate limit across all proxies (default: None)</p></li>
</ul>
<p><strong>Attributes:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">global_limit</span></code> (RateLimit | None): Global rate limit configuration</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_proxy_limiters</span></code> (dict[str, Limiter]): Per-proxy limiter instances</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_global_limiter</span></code> (Limiter | None): Global limiter instance</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_lock</span></code> (RLock): Thread-safe lock for limiter access</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># No limits</span>
</span><span data-line="2"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Global limit only</span>
</span><span data-line="5"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">(</span>
</span><span data-line="6">    <span class="n">global_limit</span><span class="o">=</span><span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</span><span data-line="7"><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Per-proxy limits added later</span>
</span><span data-line="10"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="methods">
<h4>Methods<a class="headerlink" href="#methods" title="Link to this heading">Â¶</a></h4>
<section id="set-proxy-limit-proxy-id-str-limit-ratelimit-none">
<h5><code class="docutils literal notranslate"><span class="pre">set_proxy_limit(proxy_id:</span> <span class="pre">str,</span> <span class="pre">limit:</span> <span class="pre">RateLimit)</span> <span class="pre">-&gt;</span> <span class="pre">None</span></code><a class="headerlink" href="#set-proxy-limit-proxy-id-str-limit-ratelimit-none" title="Link to this heading">Â¶</a></h5>
<p>Set rate limit for a specific proxy.</p>
<p><strong>Behavior:</strong></p>
<ul class="simple">
<li><p>Creates a new token bucket limiter for the proxy</p></li>
<li><p>Overwrites existing limit if proxy_id already has one</p></li>
<li><p>Thread-safe with lock protection</p></li>
<li><p>Logs limit configuration at INFO level</p></li>
</ul>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">proxy_id</span></code> (str): Unique proxy identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">limit</span></code> (RateLimit): Rate limit configuration</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Set different limits for different proxies</span>
</span><span data-line="6"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span>
</span><span data-line="7">    <span class="s2">&quot;premium_proxy&quot;</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 100 req/sec</span>
</span><span data-line="9"><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span>
</span><span data-line="12">    <span class="s2">&quot;free_proxy&quot;</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 5 req/sec</span>
</span><span data-line="14"><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># Update existing limit</span>
</span><span data-line="17"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span>
</span><span data-line="18">    <span class="s2">&quot;premium_proxy&quot;</span><span class="p">,</span>
</span><span data-line="19">    <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Increase to 200 req/sec</span>
</span><span data-line="20"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="check-limit-proxy-id-str-bool-async">
<h5><code class="docutils literal notranslate"><span class="pre">check_limit(proxy_id:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code> (async)<a class="headerlink" href="#check-limit-proxy-id-str-bool-async" title="Link to this heading">Â¶</a></h5>
<p>Check if request is allowed for proxy.</p>
<p><strong>Flow:</strong></p>
<ol class="arabic simple">
<li><p>Check per-proxy limit (if set)</p></li>
<li><p>Check global limit (if set)</p></li>
<li><p>Return True if both allow, False if either denies</p></li>
</ol>
<p><strong>Behavior:</strong></p>
<ul class="simple">
<li><p>Consumes a token from the bucket if allowed</p></li>
<li><p>Logs warning at WARNING level if rate limit exceeded</p></li>
<li><p>Thread-safe with lock protection for limiter access</p></li>
<li><p>Non-blocking (returns immediately)</p></li>
</ul>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">proxy_id</span></code> (str): Unique proxy identifier</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if request is allowed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">False</span></code> if rate limit exceeded (either per-proxy or global)</p></li>
</ul>
<p><strong>Logs:</strong></p>
<ul class="simple">
<li><p>WARNING: â€œRate limit exceeded for proxy {proxy_id}â€ (per-proxy limit)</p></li>
<li><p>WARNING: â€œGlobal rate limit exceededâ€ (global limit)</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">global_limit</span><span class="o">=</span><span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</span><span data-line="5"><span class="p">)</span>
</span><span data-line="6"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Check before making request</span>
</span><span data-line="9"><span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">):</span>
</span><span data-line="10">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Request allowed&quot;</span><span class="p">)</span>
</span><span data-line="11">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">make_request</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">)</span>
</span><span data-line="12"><span class="k">else</span><span class="p">:</span>
</span><span data-line="13">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rate limited, try again later&quot;</span><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Check multiple times rapidly</span>
</span><span data-line="16"><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="17"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">):</span>
</span><span data-line="18">    <span class="n">allowed</span> <span class="o">=</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">)</span>
</span><span data-line="19">    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">allowed</span><span class="p">)</span>
</span><span data-line="20">
</span><span data-line="21"><span class="c1"># First 10 will be True, remaining will be False</span>
</span><span data-line="22"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allowed: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2">/15&quot;</span><span class="p">)</span>  <span class="c1"># &quot;Allowed: 10/15&quot;</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="acquire-proxy-id-str-bool-async">
<h5><code class="docutils literal notranslate"><span class="pre">acquire(proxy_id:</span> <span class="pre">str)</span> <span class="pre">-&gt;</span> <span class="pre">bool</span></code> (async)<a class="headerlink" href="#acquire-proxy-id-str-bool-async" title="Link to this heading">Â¶</a></h5>
<p>Acquire permission to make a request (alias for check_limit).</p>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">proxy_id</span></code> (str): Unique proxy identifier</p></li>
</ul>
<p><strong>Returns:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">True</span></code> if request is allowed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">False</span></code> if rate limit exceeded</p></li>
</ul>
<p><strong>Example:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Same as check_limit</span>
</span><span data-line="2"><span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">):</span>
</span><span data-line="3">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">make_request</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
</section>
</section>
<hr class="docutils" />
<section id="data-models">
<h2>Data Models<a class="headerlink" href="#data-models" title="Link to this heading">Â¶</a></h2>
<section id="ratelimit">
<h3>RateLimit<a class="headerlink" href="#ratelimit" title="Link to this heading">Â¶</a></h3>
<p>Rate limit configuration for token bucket algorithm.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimit</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Basic rate limit</span>
</span><span data-line="4"><span class="n">limit</span> <span class="o">=</span> <span class="n">RateLimit</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">max_requests</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">time_window</span><span class="o">=</span><span class="mi">60</span>  <span class="c1"># 100 requests per 60 seconds</span>
</span><span data-line="7"><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># With burst allowance</span>
</span><span data-line="10"><span class="n">limit</span> <span class="o">=</span> <span class="n">RateLimit</span><span class="p">(</span>
</span><span data-line="11">    <span class="n">max_requests</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span data-line="12">    <span class="n">time_window</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">burst_allowance</span><span class="o">=</span><span class="mi">20</span>  <span class="c1"># Allow bursts up to 20 requests beyond sustained rate</span>
</span><span data-line="14"><span class="p">)</span>
</span></pre></div>
</div>
<section id="fields">
<h4>Fields<a class="headerlink" href="#fields" title="Link to this heading">Â¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">max_requests</span></code> (int): Maximum requests allowed in time window</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">time_window</span></code> (int): Time window in seconds</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">burst_allowance</span></code> (int | None): Burst capacity for token bucket (default: None)</p></li>
</ul>
<p><strong>Token Bucket Behavior:</strong></p>
<ul class="simple">
<li><p><strong>Sustained rate</strong>: <code class="docutils literal notranslate"><span class="pre">max_requests</span> <span class="pre">/</span> <span class="pre">time_window</span></code> requests per second</p></li>
<li><p><strong>Burst capacity</strong>: Up to <code class="docutils literal notranslate"><span class="pre">burst_allowance</span></code> additional requests can be consumed rapidly</p></li>
<li><p><strong>Refill rate</strong>: Tokens refill at sustained rate</p></li>
</ul>
<p><strong>Example Scenarios:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Scenario 1: Strict 10 req/sec (no bursts)</span>
</span><span data-line="2"><span class="n">limit</span> <span class="o">=</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="3"><span class="c1"># Allows exactly 10 requests per second</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Scenario 2: 100 req/min with 20-request burst</span>
</span><span data-line="6"><span class="n">limit</span> <span class="o">=</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">burst_allowance</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span data-line="7"><span class="c1"># Sustained: ~1.67 req/sec</span>
</span><span data-line="8"><span class="c1"># Can burst up to 20 requests immediately, then throttled to sustained rate</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Scenario 3: 1000 req/hour</span>
</span><span data-line="11"><span class="n">limit</span> <span class="o">=</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
</span><span data-line="12"><span class="c1"># Sustained: ~0.28 req/sec or ~16.67 req/min</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="ratelimitevent">
<h3>RateLimitEvent<a class="headerlink" href="#ratelimitevent" title="Link to this heading">Â¶</a></h3>
<p>Rate limit event for logging and monitoring.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimitEvent</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">event</span> <span class="o">=</span> <span class="n">RateLimitEvent</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="6">    <span class="n">proxy_id</span><span class="o">=</span><span class="s2">&quot;proxy1&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;throttled&quot;</span><span class="p">,</span>  <span class="c1"># or &quot;exceeded&quot;, &quot;adaptive_change&quot;</span>
</span><span data-line="8">    <span class="n">details</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="9">        <span class="s2">&quot;requests_in_window&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span data-line="10">        <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span data-line="11">        <span class="s2">&quot;time_window&quot;</span><span class="p">:</span> <span class="mi">1</span>
</span><span data-line="12">    <span class="p">}</span>
</span><span data-line="13"><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Event: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">event_type</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">proxy_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="16"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Details: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<section id="id1">
<h4>Fields<a class="headerlink" href="#id1" title="Link to this heading">Â¶</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">timestamp</span></code> (datetime): When event occurred</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proxy_id</span></code> (str): Proxy identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">event_type</span></code> (str): Event type</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;throttled&quot;</span></code>: Request was throttled (rate limit applied)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;exceeded&quot;</span></code>: Rate limit exceeded</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;adaptive_change&quot;</span></code>: Rate limit adjusted automatically</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">details</span></code> (dict): Event-specific details</p></li>
</ul>
<p><strong>Usage:</strong></p>
<ul class="simple">
<li><p>Log to file/database for analysis</p></li>
<li><p>Send to monitoring system (Prometheus, DataDog)</p></li>
<li><p>Trigger alerts on excessive throttling</p></li>
</ul>
</section>
</section>
</section>
<hr class="docutils" />
<section id="usage-examples">
<h2>Usage Examples<a class="headerlink" href="#usage-examples" title="Link to this heading">Â¶</a></h2>
<section id="basic-rate-limiting">
<h3>Basic Rate Limiting<a class="headerlink" href="#basic-rate-limiting" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Create limiter</span>
</span><span data-line="4"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># Set per-proxy limits</span>
</span><span data-line="7"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span>
</span><span data-line="8">    <span class="s2">&quot;proxy1&quot;</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 10 req/sec</span>
</span><span data-line="10"><span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># Check limit before each request</span>
</span><span data-line="13"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">make_safe_request</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span><span data-line="14">    <span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="15">        <span class="k">return</span> <span class="k">await</span> <span class="n">httpx_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="n">get_proxy_url</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">))</span>
</span><span data-line="16">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="17">        <span class="k">raise</span> <span class="n">RateLimitExceeded</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rate limit exceeded for </span><span class="si">{</span><span class="n">proxy_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19"><span class="c1"># Use in loop</span>
</span><span data-line="20"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
</span><span data-line="21">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="22">        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">make_safe_request</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">,</span> <span class="s2">&quot;https://api.example.com&quot;</span><span class="p">)</span>
</span><span data-line="23">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="24">    <span class="k">except</span> <span class="n">RateLimitExceeded</span><span class="p">:</span>
</span><span data-line="25">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Rate limited&quot;</span><span class="p">)</span>
</span><span data-line="26">        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Wait before retry</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="global-per-proxy-limits">
<h3>Global + Per-Proxy Limits<a class="headerlink" href="#global-per-proxy-limits" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Global limit: 1000 req/min across all proxies</span>
</span><span data-line="4"><span class="c1"># Per-proxy limit: 10 req/sec per proxy</span>
</span><span data-line="5"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">(</span>
</span><span data-line="6">    <span class="n">global_limit</span><span class="o">=</span><span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</span><span data-line="7"><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="k">for</span> <span class="n">proxy_id</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;proxy1&quot;</span><span class="p">,</span> <span class="s2">&quot;proxy2&quot;</span><span class="p">,</span> <span class="s2">&quot;proxy3&quot;</span><span class="p">]:</span>
</span><span data-line="10">    <span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span>
</span><span data-line="11">        <span class="n">proxy_id</span><span class="p">,</span>
</span><span data-line="12">        <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="13">    <span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Request will be limited by whichever constraint is hit first</span>
</span><span data-line="16"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">make_request</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="17">    <span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="18">        <span class="c1"># Both per-proxy and global limits allow this request</span>
</span><span data-line="19">        <span class="k">return</span> <span class="k">await</span> <span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com&quot;</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">)</span>
</span><span data-line="20">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="21">        <span class="c1"># Either per-proxy or global limit exceeded</span>
</span><span data-line="22">        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="burst-handling">
<h3>Burst Handling<a class="headerlink" href="#burst-handling" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Allow bursts up to 50 requests, then throttle to 10 req/sec</span>
</span><span data-line="4"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span data-line="5"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span>
</span><span data-line="6">    <span class="s2">&quot;proxy1&quot;</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">RateLimit</span><span class="p">(</span>
</span><span data-line="8">        <span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span data-line="9">        <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span data-line="10">        <span class="n">burst_allowance</span><span class="o">=</span><span class="mi">50</span>  <span class="c1"># Can burst 50 requests immediately</span>
</span><span data-line="11">    <span class="p">)</span>
</span><span data-line="12"><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14"><span class="c1"># Burst scenario</span>
</span><span data-line="15"><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="16"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span data-line="17">    <span class="n">allowed</span> <span class="o">=</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">)</span>
</span><span data-line="18">    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">allowed</span><span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20"><span class="c1"># First ~50 will be True (burst), then throttled to 10/sec</span>
</span><span data-line="21"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Allowed: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2">/100&quot;</span><span class="p">)</span>
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># Wait for bucket to refill</span>
</span><span data-line="24"><span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Wait 5 seconds</span>
</span><span data-line="25">
</span><span data-line="26"><span class="c1"># Can burst again</span>
</span><span data-line="27"><span class="n">allowed</span> <span class="o">=</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">)</span>
</span><span data-line="28"><span class="k">assert</span> <span class="n">allowed</span> <span class="ow">is</span> <span class="kc">True</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="dynamic-limit-adjustment">
<h3>Dynamic Limit Adjustment<a class="headerlink" href="#dynamic-limit-adjustment" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Start with conservative limit</span>
</span><span data-line="6"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span>
</span><span data-line="7">    <span class="s2">&quot;proxy1&quot;</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="9"><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># Monitor success rate and adjust</span>
</span><span data-line="12"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">adaptive_request</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="13">    <span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="14">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="15">            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com&quot;</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">)</span>
</span><span data-line="16">
</span><span data-line="17">            <span class="c1"># Success - increase limit</span>
</span><span data-line="18">            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span data-line="19">                <span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span>
</span><span data-line="20">                    <span class="n">proxy_id</span><span class="p">,</span>
</span><span data-line="21">                    <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="22">                <span class="p">)</span>
</span><span data-line="23">
</span><span data-line="24">            <span class="k">return</span> <span class="n">response</span>
</span><span data-line="25">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="26">            <span class="c1"># Failure - decrease limit</span>
</span><span data-line="27">            <span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span>
</span><span data-line="28">                <span class="n">proxy_id</span><span class="p">,</span>
</span><span data-line="29">                <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="30">            <span class="p">)</span>
</span><span data-line="31">            <span class="k">raise</span>
</span><span data-line="32">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="33">        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="integration-with-proxyrotator">
<h3>Integration with ProxyRotator<a class="headerlink" href="#integration-with-proxyrotator" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyRotator</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Create rotator and limiter</span>
</span><span data-line="5"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">()</span>
</span><span data-line="6"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">(</span>
</span><span data-line="7">    <span class="n">global_limit</span><span class="o">=</span><span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</span><span data-line="8"><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Add proxies with individual limits</span>
</span><span data-line="11"><span class="n">proxies</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="12">    <span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
</span><span data-line="13">    <span class="p">(</span><span class="s2">&quot;proxy2&quot;</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
</span><span data-line="14">    <span class="p">(</span><span class="s2">&quot;proxy3&quot;</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span>
</span><span data-line="15"><span class="p">]</span>
</span><span data-line="16">
</span><span data-line="17"><span class="k">for</span> <span class="n">proxy_id</span><span class="p">,</span> <span class="n">limit</span> <span class="ow">in</span> <span class="n">proxies</span><span class="p">:</span>
</span><span data-line="18">    <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">proxy_id</span><span class="si">}</span><span class="s2">.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="19">    <span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
</span><span data-line="20">
</span><span data-line="21"><span class="c1"># Make requests with rate limiting</span>
</span><span data-line="22"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">make_request_with_rate_limit</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span data-line="23">    <span class="c1"># Get proxy from rotator</span>
</span><span data-line="24">    <span class="n">proxy</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
</span><span data-line="25">    <span class="n">proxy_id</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">id</span>
</span><span data-line="26">
</span><span data-line="27">    <span class="c1"># Check rate limit</span>
</span><span data-line="28">    <span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="29">        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="30">        <span class="k">return</span> <span class="n">response</span>
</span><span data-line="31">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="32">        <span class="c1"># Rate limited, try different proxy</span>
</span><span data-line="33">        <span class="k">return</span> <span class="k">await</span> <span class="n">make_request_with_rate_limit</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="34">
</span><span data-line="35"><span class="c1"># Use in application</span>
</span><span data-line="36"><span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">make_request_with_rate_limit</span><span class="p">(</span><span class="s2">&quot;https://api.example.com&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="monitoring-and-logging">
<h3>Monitoring and Logging<a class="headerlink" href="#monitoring-and-logging" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">,</span> <span class="n">RateLimitEvent</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">loguru</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>
</span><span data-line="4">
</span><span data-line="5"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span data-line="6"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Track rate limit events</span>
</span><span data-line="9"><span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="10">
</span><span data-line="11"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">make_request_with_monitoring</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span><span data-line="12">    <span class="n">allowed</span> <span class="o">=</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14">    <span class="k">if</span> <span class="n">allowed</span><span class="p">:</span>
</span><span data-line="15">        <span class="c1"># Request allowed</span>
</span><span data-line="16">        <span class="n">event</span> <span class="o">=</span> <span class="n">RateLimitEvent</span><span class="p">(</span>
</span><span data-line="17">            <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="18">            <span class="n">proxy_id</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">,</span>
</span><span data-line="19">            <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;allowed&quot;</span><span class="p">,</span>
</span><span data-line="20">            <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">}</span>
</span><span data-line="21">        <span class="p">)</span>
</span><span data-line="22">        <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span data-line="23">        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request allowed for </span><span class="si">{</span><span class="n">proxy_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="24">        <span class="k">return</span> <span class="k">await</span> <span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">)</span>
</span><span data-line="25">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="26">        <span class="c1"># Rate limited</span>
</span><span data-line="27">        <span class="n">event</span> <span class="o">=</span> <span class="n">RateLimitEvent</span><span class="p">(</span>
</span><span data-line="28">            <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">),</span>
</span><span data-line="29">            <span class="n">proxy_id</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">,</span>
</span><span data-line="30">            <span class="n">event_type</span><span class="o">=</span><span class="s2">&quot;exceeded&quot;</span><span class="p">,</span>
</span><span data-line="31">            <span class="n">details</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">}</span>
</span><span data-line="32">        <span class="p">)</span>
</span><span data-line="33">        <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span data-line="34">        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rate limit exceeded for </span><span class="si">{</span><span class="n">proxy_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="35">        <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="36">
</span><span data-line="37"><span class="c1"># Analyze events</span>
</span><span data-line="38"><span class="n">throttled_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">events</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="s2">&quot;exceeded&quot;</span><span class="p">)</span>
</span><span data-line="39"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Throttled requests: </span><span class="si">{</span><span class="n">throttled_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="retry-with-backoff">
<h3>Retry with Backoff<a class="headerlink" href="#retry-with-backoff" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span>
</span><span data-line="2"><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span data-line="5"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span data-line="6">
</span><span data-line="7"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">make_request_with_retry</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
</span><span data-line="8">    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
</span><span data-line="9">        <span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="10">            <span class="k">try</span><span class="p">:</span>
</span><span data-line="11">                <span class="k">return</span> <span class="k">await</span> <span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">)</span>
</span><span data-line="12">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="13">                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span data-line="14">                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span>  <span class="c1"># Exponential backoff</span>
</span><span data-line="15">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="16">                    <span class="k">raise</span>
</span><span data-line="17">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="18">            <span class="c1"># Rate limited, wait before retry</span>
</span><span data-line="19">            <span class="n">wait_time</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mi">10</span>  <span class="c1"># 1 / (requests per second)</span>
</span><span data-line="20">            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22">    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed after </span><span class="si">{</span><span class="n">max_retries</span><span class="si">}</span><span class="s2"> retries&quot;</span><span class="p">)</span>
</span><span data-line="23">
</span><span data-line="24"><span class="c1"># Use</span>
</span><span data-line="25"><span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">make_request_with_retry</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">,</span> <span class="s2">&quot;https://api.example.com&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="thread-safety">
<h2>Thread Safety<a class="headerlink" href="#thread-safety" title="Link to this heading">Â¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">RateLimiter</span></code> is thread-safe using <code class="docutils literal notranslate"><span class="pre">threading.RLock</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span data-line="5"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span data-line="6">
</span><span data-line="7"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">worker</span><span class="p">(</span><span class="n">worker_id</span><span class="p">):</span>
</span><span data-line="8">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
</span><span data-line="9">        <span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">):</span>
</span><span data-line="10">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2">: Request </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> allowed&quot;</span><span class="p">)</span>
</span><span data-line="11">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="12">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Worker </span><span class="si">{</span><span class="n">worker_id</span><span class="si">}</span><span class="s2">: Request </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> rate limited&quot;</span><span class="p">)</span>
</span><span data-line="13">        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Run concurrent workers</span>
</span><span data-line="16"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span data-line="17">    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">worker</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</span><span data-line="18">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20"><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="performance-considerations">
<h2>Performance Considerations<a class="headerlink" href="#performance-considerations" title="Link to this heading">Â¶</a></h2>
<section id="token-bucket-algorithm">
<h3>Token Bucket Algorithm<a class="headerlink" href="#token-bucket-algorithm" title="Link to this heading">Â¶</a></h3>
<p><strong>Advantages:</strong></p>
<ul class="simple">
<li><p>Allows burst traffic up to bucket capacity</p></li>
<li><p>Smooth rate limiting over time</p></li>
<li><p>Low overhead (O(1) per request)</p></li>
<li><p>No memory growth with large request volumes</p></li>
</ul>
<p><strong>Tuning:</strong></p>
<ol class="arabic">
<li><p><strong>High-throughput APIs:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Allow high sustained rate with moderate bursts</span>
</span><span data-line="2"><span class="n">RateLimit</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">max_requests</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">burst_allowance</span><span class="o">=</span><span class="mi">200</span>
</span><span data-line="6"><span class="p">)</span>
</span></pre></div>
</div>
</li>
<li><p><strong>Rate-limited APIs:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Strict limit with small burst</span>
</span><span data-line="2"><span class="n">RateLimit</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">burst_allowance</span><span class="o">=</span><span class="mi">2</span>
</span><span data-line="6"><span class="p">)</span>
</span></pre></div>
</div>
</li>
<li><p><strong>Bursty workloads:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Low sustained rate, high burst capacity</span>
</span><span data-line="2"><span class="n">RateLimit</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">max_requests</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">time_window</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>  <span class="c1"># ~1.67 req/sec sustained</span>
</span><span data-line="5">    <span class="n">burst_allowance</span><span class="o">=</span><span class="mi">50</span>  <span class="c1"># Can handle sudden spikes</span>
</span><span data-line="6"><span class="p">)</span>
</span></pre></div>
</div>
</li>
</ol>
</section>
<section id="memory-usage">
<h3>Memory Usage<a class="headerlink" href="#memory-usage" title="Link to this heading">Â¶</a></h3>
<p><strong>Per-Proxy Limiters:</strong></p>
<ul class="simple">
<li><p>Each proxy with a limit creates a <code class="docutils literal notranslate"><span class="pre">Limiter</span></code> instance</p></li>
<li><p>Memory: ~1KB per limiter</p></li>
<li><p>1000 proxies â‰ˆ 1MB memory overhead</p></li>
</ul>
<p><strong>Optimization:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Option 1: Use global limit only (minimal memory)</span>
</span><span data-line="2"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">global_limit</span><span class="o">=</span><span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
</span><span data-line="4"><span class="p">)</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># Option 2: Set limits only for high-traffic proxies</span>
</span><span data-line="7"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span data-line="8"><span class="k">for</span> <span class="n">proxy_id</span> <span class="ow">in</span> <span class="n">high_traffic_proxies</span><span class="p">:</span>
</span><span data-line="9">    <span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span></pre></div>
</div>
</section>
<section id="concurrency">
<h3>Concurrency<a class="headerlink" href="#concurrency" title="Link to this heading">Â¶</a></h3>
<p><strong>Async/Await:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">check_limit()</span></code> and <code class="docutils literal notranslate"><span class="pre">acquire()</span></code> are async-safe</p></li>
<li><p>Lock contention is minimal (only during limiter access)</p></li>
<li><p>No blocking I/O</p></li>
</ul>
<p><strong>Best Practices:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Good: Check limit before expensive operation</span>
</span><span data-line="2"><span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="3">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">expensive_api_call</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">)</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Bad: Check limit inside expensive operation</span>
</span><span data-line="6"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">expensive_api_call</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="7">    <span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>  <span class="c1"># Too late</span>
</span><span data-line="8">        <span class="k">return</span> <span class="k">await</span> <span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="integration-with-monitoring">
<h2>Integration with Monitoring<a class="headerlink" href="#integration-with-monitoring" title="Link to this heading">Â¶</a></h2>
<section id="prometheus-metrics">
<h3>Prometheus Metrics<a class="headerlink" href="#prometheus-metrics" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">prometheus_client</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">Gauge</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Define metrics</span>
</span><span data-line="5"><span class="n">rate_limit_allowed</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span>
</span><span data-line="6">    <span class="s1">&#39;rate_limit_allowed_total&#39;</span><span class="p">,</span>
</span><span data-line="7">    <span class="s1">&#39;Total requests allowed&#39;</span><span class="p">,</span>
</span><span data-line="8">    <span class="p">[</span><span class="s1">&#39;proxy_id&#39;</span><span class="p">]</span>
</span><span data-line="9"><span class="p">)</span>
</span><span data-line="10"><span class="n">rate_limit_exceeded</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span>
</span><span data-line="11">    <span class="s1">&#39;rate_limit_exceeded_total&#39;</span><span class="p">,</span>
</span><span data-line="12">    <span class="s1">&#39;Total requests rate limited&#39;</span><span class="p">,</span>
</span><span data-line="13">    <span class="p">[</span><span class="s1">&#39;proxy_id&#39;</span><span class="p">]</span>
</span><span data-line="14"><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span data-line="17">
</span><span data-line="18"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">make_request_with_metrics</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span><span data-line="19">    <span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="20">        <span class="n">rate_limit_allowed</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="n">proxy_id</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">)</span><span class="o">.</span><span class="n">inc</span><span class="p">()</span>
</span><span data-line="21">        <span class="k">return</span> <span class="k">await</span> <span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">)</span>
</span><span data-line="22">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="23">        <span class="n">rate_limit_exceeded</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="n">proxy_id</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">)</span><span class="o">.</span><span class="n">inc</span><span class="p">()</span>
</span><span data-line="24">        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="datadog-integration">
<h3>DataDog Integration<a class="headerlink" href="#datadog-integration" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">datadog</span><span class="w"> </span><span class="kn">import</span> <span class="n">statsd</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span data-line="5">
</span><span data-line="6"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">make_request_with_datadog</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span><span data-line="7">    <span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="8">        <span class="n">statsd</span><span class="o">.</span><span class="n">increment</span><span class="p">(</span><span class="s1">&#39;rate_limit.allowed&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;proxy:</span><span class="si">{</span><span class="n">proxy_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
</span><span data-line="9">        <span class="k">return</span> <span class="k">await</span> <span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">)</span>
</span><span data-line="10">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="11">        <span class="n">statsd</span><span class="o">.</span><span class="n">increment</span><span class="p">(</span><span class="s1">&#39;rate_limit.exceeded&#39;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;proxy:</span><span class="si">{</span><span class="n">proxy_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
</span><span data-line="12">        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="sphinx-integration">
<h2>Sphinx Integration<a class="headerlink" href="#sphinx-integration" title="Link to this heading">Â¶</a></h2>
<p>Add to your <code class="docutils literal notranslate"><span class="pre">conf.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="2">    <span class="s1">&#39;sphinx.ext.autodoc&#39;</span><span class="p">,</span>
</span><span data-line="3">    <span class="s1">&#39;sphinx.ext.napoleon&#39;</span><span class="p">,</span>
</span><span data-line="4">    <span class="s1">&#39;sphinx_autodoc_typehints&#39;</span><span class="p">,</span>
</span><span data-line="5"><span class="p">]</span>
</span><span data-line="6">
</span><span data-line="7"><span class="n">autodoc_default_options</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="8">    <span class="s1">&#39;members&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="9">    <span class="s1">&#39;undoc-members&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="10">    <span class="s1">&#39;show-inheritance&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="11"><span class="p">}</span>
</span></pre></div>
</div>
<p>In your RST files:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="gh">Rate Limiting API</span>
</span><span data-line="2"><span class="gh">=================</span>
</span><span data-line="3">
</span><span data-line="4"><span class="p">..</span> <span class="ow">automodule</span><span class="p">::</span> proxywhirl.rate_limiting
</span><span data-line="5">   <span class="nc">:members:</span>
</span><span data-line="6">   <span class="nc">:undoc-members:</span>
</span><span data-line="7">   <span class="nc">:show-inheritance:</span>
</span><span data-line="8">
</span><span data-line="9"><span class="gh">RateLimiter</span>
</span><span data-line="10"><span class="gh">-----------</span>
</span><span data-line="11">
</span><span data-line="12"><span class="p">..</span> <span class="ow">autoclass</span><span class="p">::</span> proxywhirl.rate_limiting.RateLimiter
</span><span data-line="13">   <span class="nc">:members:</span>
</span><span data-line="14">   <span class="nc">:undoc-members:</span>
</span><span data-line="15">   <span class="nc">:show-inheritance:</span>
</span><span data-line="16">
</span><span data-line="17"><span class="gh">Models</span>
</span><span data-line="18"><span class="gh">------</span>
</span><span data-line="19">
</span><span data-line="20"><span class="p">..</span> <span class="ow">autoclass</span><span class="p">::</span> proxywhirl.rate_limiting.RateLimit
</span><span data-line="21">   <span class="nc">:members:</span>
</span><span data-line="22">   <span class="nc">:undoc-members:</span>
</span><span data-line="23">
</span><span data-line="24"><span class="p">..</span> <span class="ow">autoclass</span><span class="p">::</span> proxywhirl.rate_limiting.RateLimitEvent
</span><span data-line="25">   <span class="nc">:members:</span>
</span><span data-line="26">   <span class="nc">:undoc-members:</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="common-patterns">
<h2>Common Patterns<a class="headerlink" href="#common-patterns" title="Link to this heading">Â¶</a></h2>
<section id="fallback-to-different-proxy">
<h3>Fallback to Different Proxy<a class="headerlink" href="#fallback-to-different-proxy" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">make_request_with_fallback</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxy_ids</span><span class="p">):</span>
</span><span data-line="2">    <span class="k">for</span> <span class="n">proxy_id</span> <span class="ow">in</span> <span class="n">proxy_ids</span><span class="p">:</span>
</span><span data-line="3">        <span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="4">            <span class="k">try</span><span class="p">:</span>
</span><span data-line="5">                <span class="k">return</span> <span class="k">await</span> <span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">)</span>
</span><span data-line="6">            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span data-line="7">                <span class="k">continue</span>
</span><span data-line="8">
</span><span data-line="9">    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;All proxies rate limited or failed&quot;</span><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># Use</span>
</span><span data-line="12"><span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">make_request_with_fallback</span><span class="p">(</span>
</span><span data-line="13">    <span class="s2">&quot;https://api.example.com&quot;</span><span class="p">,</span>
</span><span data-line="14">    <span class="p">[</span><span class="s2">&quot;proxy1&quot;</span><span class="p">,</span> <span class="s2">&quot;proxy2&quot;</span><span class="p">,</span> <span class="s2">&quot;proxy3&quot;</span><span class="p">]</span>
</span><span data-line="15"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="batch-requests-with-rate-limiting">
<h3>Batch Requests with Rate Limiting<a class="headerlink" href="#batch-requests-with-rate-limiting" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">batch_request_with_rate_limit</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">proxy_id</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
</span><span data-line="2">    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="3">
</span><span data-line="4">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
</span><span data-line="5">        <span class="n">batch</span> <span class="o">=</span> <span class="n">urls</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>
</span><span data-line="6">
</span><span data-line="7">        <span class="c1"># Check if we can make batch_size requests</span>
</span><span data-line="8">        <span class="n">allowed_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="9">        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)):</span>
</span><span data-line="10">            <span class="k">if</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="11">                <span class="n">allowed_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span data-line="12">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="13">                <span class="k">break</span>
</span><span data-line="14">
</span><span data-line="15">        <span class="c1"># Make allowed requests</span>
</span><span data-line="16">        <span class="n">batch_results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
</span><span data-line="17">            <span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">)</span>
</span><span data-line="18">            <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">[:</span><span class="n">allowed_count</span><span class="p">]</span>
</span><span data-line="19">        <span class="p">])</span>
</span><span data-line="20">        <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch_results</span><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22">        <span class="c1"># Wait if rate limited</span>
</span><span data-line="23">        <span class="k">if</span> <span class="n">allowed_count</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch</span><span class="p">):</span>
</span><span data-line="24">            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</span><span data-line="25">
</span><span data-line="26">    <span class="k">return</span> <span class="n">results</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="circuit-breaker-integration">
<h3>Circuit Breaker Integration<a class="headerlink" href="#circuit-breaker-integration" title="Link to this heading">Â¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.rate_limiting</span><span class="w"> </span><span class="kn">import</span> <span class="n">RateLimiter</span><span class="p">,</span> <span class="n">RateLimit</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreaker</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">limiter</span> <span class="o">=</span> <span class="n">RateLimiter</span><span class="p">()</span>
</span><span data-line="5"><span class="n">circuit_breakers</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="6">
</span><span data-line="7"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">make_request_with_circuit_breaker</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span><span data-line="8">    <span class="c1"># Initialize circuit breaker if needed</span>
</span><span data-line="9">    <span class="k">if</span> <span class="n">proxy_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">circuit_breakers</span><span class="p">:</span>
</span><span data-line="10">        <span class="n">circuit_breakers</span><span class="p">[</span><span class="n">proxy_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span>
</span><span data-line="11">            <span class="n">proxy_id</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">,</span>
</span><span data-line="12">            <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span data-line="13">            <span class="n">window_duration</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
</span><span data-line="14">            <span class="n">timeout_duration</span><span class="o">=</span><span class="mf">30.0</span>
</span><span data-line="15">        <span class="p">)</span>
</span><span data-line="16">
</span><span data-line="17">    <span class="n">breaker</span> <span class="o">=</span> <span class="n">circuit_breakers</span><span class="p">[</span><span class="n">proxy_id</span><span class="p">]</span>
</span><span data-line="18">
</span><span data-line="19">    <span class="c1"># Check circuit breaker</span>
</span><span data-line="20">    <span class="k">if</span> <span class="ow">not</span> <span class="n">breaker</span><span class="o">.</span><span class="n">should_attempt_request</span><span class="p">():</span>
</span><span data-line="21">        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Circuit breaker open for </span><span class="si">{</span><span class="n">proxy_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="22">
</span><span data-line="23">    <span class="c1"># Check rate limit</span>
</span><span data-line="24">    <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="25">        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rate limit exceeded for </span><span class="si">{</span><span class="n">proxy_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="26">
</span><span data-line="27">    <span class="c1"># Make request</span>
</span><span data-line="28">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="29">        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="n">proxy_id</span><span class="p">)</span>
</span><span data-line="30">        <span class="n">breaker</span><span class="o">.</span><span class="n">record_success</span><span class="p">()</span>
</span><span data-line="31">        <span class="k">return</span> <span class="n">response</span>
</span><span data-line="32">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="33">        <span class="n">breaker</span><span class="o">.</span><span class="n">record_failure</span><span class="p">()</span>
</span><span data-line="34">        <span class="k">raise</span>
</span></pre></div>
</div>
</section>
</section>
<hr class="docutils" />
<section id="faq">
<h2>FAQ<a class="headerlink" href="#faq" title="Link to this heading">Â¶</a></h2>
<p><strong>Q: Whatâ€™s the difference between <code class="docutils literal notranslate"><span class="pre">check_limit()</span></code> and <code class="docutils literal notranslate"><span class="pre">acquire()</span></code>?</strong></p>
<p>A: They are identical. <code class="docutils literal notranslate"><span class="pre">acquire()</span></code> is an alias for <code class="docutils literal notranslate"><span class="pre">check_limit()</span></code> for API consistency with other rate limiting libraries.</p>
<p><strong>Q: Can I remove a per-proxy limit?</strong></p>
<p>A: Currently, no. You can set it to a very high value effectively disabling it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span><span class="s2">&quot;proxy1&quot;</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span></pre></div>
</div>
<p><strong>Q: Does the limiter persist state across restarts?</strong></p>
<p>A: No, all state is in-memory. Rate limits reset on process restart.</p>
<p><strong>Q: Can I use this with synchronous code?</strong></p>
<p>A: The current implementation is async-only. For sync code, wrap in <code class="docutils literal notranslate"><span class="pre">asyncio.run()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">def</span><span class="w"> </span><span class="nf">sync_check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">):</span>
</span><span data-line="4">    <span class="k">return</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">limiter</span><span class="o">.</span><span class="n">check_limit</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">))</span>
</span></pre></div>
</div>
<p><strong>Q: How do I calculate the right rate limit for an API?</strong></p>
<p>A: Check the APIâ€™s documentation for rate limits. Common formats:</p>
<ul class="simple">
<li><p>â€œ100 requests per minuteâ€ â†’ <code class="docutils literal notranslate"><span class="pre">RateLimit(max_requests=100,</span> <span class="pre">time_window=60)</span></code></p></li>
<li><p>â€œ10 requests per secondâ€ â†’ <code class="docutils literal notranslate"><span class="pre">RateLimit(max_requests=10,</span> <span class="pre">time_window=1)</span></code></p></li>
<li><p>â€œ1000 requests per hourâ€ â†’ <code class="docutils literal notranslate"><span class="pre">RateLimit(max_requests=1000,</span> <span class="pre">time_window=3600)</span></code></p></li>
</ul>
<p><strong>Q: Can I set different limits for different endpoints?</strong></p>
<p>A: Not directly. Create separate <code class="docutils literal notranslate"><span class="pre">RateLimiter</span></code> instances or use <code class="docutils literal notranslate"><span class="pre">proxy_id</span></code> to encode endpoint information:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span><span class="s2">&quot;proxy1_api_v1&quot;</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span data-line="2"><span class="n">limiter</span><span class="o">.</span><span class="n">set_proxy_limit</span><span class="p">(</span><span class="s2">&quot;proxy1_api_v2&quot;</span><span class="p">,</span> <span class="n">RateLimit</span><span class="p">(</span><span class="n">max_requests</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">time_window</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span></pre></div>
</div>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="cache-api.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Cache API Reference</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="../project/index.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Project Status &amp; Roadmap</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2026, Wyatt Walsh</p>
  
  <p>
    Made with
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/wyattowalsh/proxywhirl" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=a58bc63e"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=9b0e4dde"></script></body>
</html>