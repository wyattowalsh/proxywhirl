<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Async Client Guide - ProxyWhirl Documentation</title><link rel="shortcut icon" href="../_static/favicon.svg"/><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Advanced Rotation Strategies" href="advanced-strategies.html" /><link rel="prev" title="Guides" href="index.html" />
      <link rel="canonical" href="https://proxywhirl.readthedocs.io/guides/async-client.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=44020203" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=b31b09b0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://proxywhirl.readthedocs.io/guides/async-client.html"/>
  <meta property="og:title" content="Async Client Guide"/>
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@wyaborern"/>
<meta name="twitter:site" content="@wyaborern"/>
  </head>
<body>
<a class="skip-link" href="#main-content">Skip to content</a>
<header class="pw-navbar">
  <div class="pw-navbar-inner">
    
    <button class="pw-navbar-sidebar-toggle js-menu" aria-controls="lside" aria-expanded="false" aria-label="Toggle navigation" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
    </button>

    
    <a href="../index.html" class="pw-navbar-brand">
      <svg class="pw-navbar-logo" viewBox="0 0 100 100" aria-hidden="true">
        <defs>
          <linearGradient id="pw-logo-grad" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#06b6d4"/>
            <stop offset="50%" stop-color="#3b82f6"/>
            <stop offset="100%" stop-color="#8b5cf6"/>
          </linearGradient>
        </defs>
        <circle cx="50" cy="50" r="44" fill="none" stroke="url(#pw-logo-grad)" stroke-width="6" stroke-linecap="round" stroke-dasharray="60 30"/>
        <g fill="url(#pw-logo-grad)">
          <path d="M50 18 L58 30 L52 30 L52 42 L48 42 L48 30 L42 30 Z"/>
          <path d="M82 50 L70 58 L70 52 L58 52 L58 48 L70 48 L70 42 Z"/>
          <path d="M50 82 L42 70 L48 70 L48 58 L52 58 L52 70 L58 70 Z"/>
          <path d="M18 50 L30 42 L30 48 L42 48 L42 52 L30 52 L30 58 Z"/>
        </g>
        <circle cx="50" cy="50" r="8" fill="url(#pw-logo-grad)"/>
      </svg>
      <strong>ProxyWhirl</strong>
    </a>

    
    <nav class="pw-navbar-links" aria-label="Main navigation">
      <a href="../getting-started/index.html" class="pw-navbar-link" data-section="getting-started">
        Getting Started
      </a>
      <a href="index.html" class="pw-navbar-link" data-section="guides">
        Guides
      </a>
      <a href="../reference/index.html" class="pw-navbar-link" data-section="reference">
        Reference
      </a>
      <a href="../project/index.html" class="pw-navbar-link" data-section="project">
        Project
      </a>
    </nav>

    
    <div class="pw-navbar-actions">
      
      <button class="pw-navbar-btn" id="pw-theme-toggle" type="button" aria-label="Toggle theme" aria-pressed="false">
        <svg class="pw-icon-sun" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
        <svg class="pw-icon-moon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
      </button>

      
      <a href="https://github.com/wyattowalsh/proxywhirl" class="pw-navbar-btn pw-navbar-github" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
      </a>
    </div>
  </div>
</header>
<div id="main-content"></div>

<script>
(function() {
  /* Theme toggle */
  var toggle = document.getElementById('pw-theme-toggle');
  if (toggle) {
    /* Set initial aria-pressed based on current theme */
    var currentlyDark = document.documentElement.classList.contains('dark');
    toggle.setAttribute('aria-pressed', currentlyDark ? 'true' : 'false');

    toggle.addEventListener('click', function() {
      var isDark = document.documentElement.classList.contains('dark');
      var next = isDark ? 'light' : 'dark';
      localStorage._theme = next;
      if (typeof setColorMode === 'function') {
        setColorMode(next);
      } else {
        var html = document.documentElement;
        html.classList.remove('dark', 'light');
        html.classList.add(next);
        html.setAttribute('data-color-mode', next);
      }
      toggle.setAttribute('aria-pressed', next === 'dark' ? 'true' : 'false');
    });
  }

  /* Active nav link detection — highlight current section */
  var path = window.location.pathname;
  var links = document.querySelectorAll('.pw-navbar-link[data-section]');
  links.forEach(function(link) {
    var section = link.getAttribute('data-section');
    if (path.indexOf('/' + section) !== -1) {
      link.classList.add('active');
    }
  });
  /* Mark home page — none active, or all inactive is fine */
})();
</script>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="2"><ul class="current">
<li class="toctree-l1 _expand"><a class="reference internal" href="../getting-started/index.html">Getting Started</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#what-youll-build">What You&#8217;ll Build</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#installation">Installation</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#quick-start">Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#basic-usage-sync">Basic Usage (sync)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#async-usage">Async Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#context-manager-pattern">Context Manager Pattern</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#authenticated-proxies">Authenticated Proxies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#using-free-proxy-lists">Using Free Proxy Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#fetching-proxies-programmatically">Fetching Proxies Programmatically</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#choosing-a-rotation-strategy">Choosing a Rotation Strategy</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#configuring-retry-and-circuit-breakers">Configuring Retry and Circuit Breakers</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#monitoring-your-pool">Monitoring Your Pool</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#next-steps">Next Steps</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#for-contributors">For Contributors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/rotation-strategies.html">Rotation Strategies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#bootstrap-a-rotator">Bootstrap a Rotator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#decision-matrix">Decision Matrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#quick-pick-guide">Quick-Pick Guide</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#strategy-reference">Strategy Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#comparison-at-a-glance">Comparison At a Glance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#hot-swapping-strategies">Hot-Swapping Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#observe-the-pool">Observe the Pool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#building-a-custom-strategy">Building a Custom Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#further-reading">Further Reading</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Guides</a><ul class="current">
<li class="toctree-l2 _expand"><a class="reference internal" href="index.html#choosing-a-guide">Choosing a Guide</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="index.html#client-concurrency">Client &amp; Concurrency</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="index.html#resilience-caching">Resilience &amp; Caching</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="index.html#operations-deployment">Operations &amp; Deployment</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#automation-ai">Automation &amp; AI</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Async Client Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#when-to-use-async-vs-sync">When to Use Async vs Sync</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initialization">Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#context-manager-usage">Context Manager Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#http-request-methods">HTTP Request Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#proxy-management">Proxy Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hot-swapping-strategies">Hot-Swapping Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#error-handling">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#concurrent-requests-with-asyncio-gather">Concurrent Requests with asyncio.gather</a></li>
<li class="toctree-l4"><a class="reference internal" href="#performance-considerations">Performance Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#asyncio-integration-patterns">Asyncio Integration Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#comparison-async-vs-sync">Comparison: Async vs Sync</a></li>
<li class="toctree-l4"><a class="reference internal" href="#best-practices-and-common-patterns">Best Practices and Common Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html">Advanced Rotation Strategies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#performance-based-strategy">Performance-Based Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#session-persistence-strategy">Session Persistence Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#geo-targeted-strategy">Geo-Targeted Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#cost-aware-strategy">Cost-Aware Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#composite-strategy">Composite Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#strategy-registry">Strategy Registry</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#selectioncontext">SelectionContext</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#strategyconfig">StrategyConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#custom-strategy-implementation">Custom Strategy Implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#strategyregistry-usage">StrategyRegistry Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id16">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#testing-strategies">Testing Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#performance-benchmarks">Performance Benchmarks</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="caching.html">Caching Subsystem Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="caching.html#architecture-overview">Architecture Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#core-components">Core Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#credential-encryption">Credential Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#ttl-and-expiration">TTL and Expiration</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#health-invalidation">Health Invalidation</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#migration-from-jsonl-l2-cache">Migration from JSONL L2 Cache</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#cache-warming">Cache Warming</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#performance-tuning">Performance Tuning</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#cli-integration">CLI Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#example-complete-cache-setup">Example: Complete Cache Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="retry-failover.html">Retry &amp; Failover Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#architecture-overview">Architecture Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#when-to-use-retry-vs-failover">When to Use Retry vs Failover</a></li>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#retrypolicy-configuration">RetryPolicy Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#circuit-breaker-configuration">Circuit Breaker Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#intelligent-proxy-selection">Intelligent Proxy Selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#retrymetrics-and-observability">RetryMetrics and Observability</a></li>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#retryexecutor-deep-dive">RetryExecutor Deep Dive</a></li>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#integration-with-proxyrotator">Integration with ProxyRotator</a></li>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#advanced-patterns">Advanced Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#performance-impact">Performance Impact</a></li>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#see-also">See Also</a></li>
<li class="toctree-l4"><a class="reference internal" href="retry-failover.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="deployment-security.html">Deployment Security &amp; Reverse Proxy Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#x-forwarded-for-security">X-Forwarded-For Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#reverse-proxy-configurations">Reverse Proxy Configurations</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#proxywhirl-configuration">ProxyWhirl Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#security-checklist">Security Checklist</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cli-reference.html">CLI Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#global-options">Global Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#commands">Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#output-formats">Output Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#configuration-file">Configuration File</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#advanced-usage">Advanced Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#exit-codes">Exit Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="automation.html">Automation &amp; CI/CD Runbook</a><ul>
<li class="toctree-l4"><a class="reference internal" href="automation.html#pre-flight-checks">Pre-flight Checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="automation.html#github-actions-ci-pipeline">GitHub Actions CI Pipeline</a></li>
<li class="toctree-l4"><a class="reference internal" href="automation.html#cron-based-proxy-fetching">Cron-Based Proxy Fetching</a></li>
<li class="toctree-l4"><a class="reference internal" href="automation.html#docker-deployment">Docker Deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="automation.html#integration-testing-patterns">Integration Testing Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="automation.html#smoke-tests-for-docs-examples">Smoke Tests for Docs Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="automation.html#automating-releases">Automating Releases</a></li>
<li class="toctree-l4"><a class="reference internal" href="automation.html#docsearch-credentials">DocSearch Credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="automation.html#ci-stage-summary">CI Stage Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="automation.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html">MCP Server Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#quick-start">Quick Start</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#the-proxywhirl-tool">The <code class="docutils literal notranslate"><span class="pre">proxywhirl</span></code> Tool</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#resources">Resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#prompts">Prompts</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#authentication">Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#progress-reporting">Progress Reporting</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#transport-options">Transport Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#integration-with-claude-desktop">Integration with Claude Desktop</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#programmatic-usage">Programmatic Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#lifecycle-management">Lifecycle Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#error-handling">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../reference/index.html">Reference</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../reference/index.html#quick-lookup">Quick Lookup</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../reference/index.html#api-surfaces">API Surfaces</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../reference/index.html#configuration-error-handling">Configuration &amp; Error Handling</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../reference/index.html#subsystem-apis">Subsystem APIs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html">ProxyWhirl REST API Usage Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#getting-started">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#authentication">Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#middleware">Middleware</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#endpoint-reference">Endpoint Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#rate-limiting">Rate Limiting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#error-handling">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#performance-tips">Performance Tips</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#security-best-practices">Security Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#deployment-examples">Deployment Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#x-forwarded-for-security-checklist">X-Forwarded-For Security Checklist</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#security-references">Security References</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#see-also">See Also</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#support">Support</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html">Python API Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#core-classes">Core Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#rotation-strategies">Rotation Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#data-models">Data Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#cache-components">Cache Components</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#retry-failover">Retry &amp; Failover</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#parsers">Parsers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#utility-functions">Utility Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#enumerations">Enumerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#built-in-proxy-sources">Built-in Proxy Sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#exceptions">Exceptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#type-annotations">Type Annotations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#version">Version</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration.html">Configuration Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#configuration-discovery">Configuration Discovery</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#toml-configuration-format">TOML Configuration Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#configuration-classes">Configuration Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#programmatic-configuration">Programmatic Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#validation-rules">Validation Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#security-best-practices">Security Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#configuration-examples">Configuration Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#migration-from-legacy-config">Migration from Legacy Config</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/exceptions.html">Exceptions Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#exception-hierarchy">Exception Hierarchy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#proxyerrorcode-enum">ProxyErrorCode Enum</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#utility-functions">Utility Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#error-codes">Error Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#exception-reference">Exception Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#error-handling-patterns">Error Handling Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#best-practices">Best Practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#summary">Summary</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cache-api.html">Cache API Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#data-models">Data Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#tier-implementations">Tier Implementations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#utilities">Utilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#usage-examples">Usage Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#performance-considerations">Performance Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#thread-safety">Thread Safety</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#error-handling">Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rate-limiting-api.html">Rate Limiting API Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#core-classes">Core Classes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#data-models">Data Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#usage-examples">Usage Examples</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#thread-safety">Thread Safety</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#performance-considerations">Performance Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#integration-with-monitoring">Integration with Monitoring</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#sphinx-integration">Sphinx Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#common-patterns">Common Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#faq">FAQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../project/index.html">Project</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#development-setup">Development Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#clone-install">Clone &amp; Install</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#verify-installation">Verify Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#make-commands">Make Commands</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#contributing">Contributing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#workflow">Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#branch-naming">Branch Naming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#commit-convention">Commit Convention</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#code-style">Code Style</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#pre-commit-hooks">Pre-commit Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#testing-guidelines">Testing Guidelines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#extending-with-custom-strategies">Extending with Custom Strategies</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#ci-cd-pipelines">CI/CD Pipelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#quality-gate-pipeline">Quality Gate Pipeline</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#architecture">Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#module-map">Module Map</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#key-exports">Key Exports</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#current-health">Current Health</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#changelog-highlights">Changelog Highlights</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#recent">Recent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project/index.html#phase-completion-status">Phase Completion Status</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#license">License</a></li>
</ul>
</li>
</ul>
        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#when-to-use-async-vs-sync">When to Use Async vs Sync</a><ul>
<li><a class="reference internal" href="#use-asyncproxyrotator-when">Use AsyncProxyRotator when:</a></li>
<li><a class="reference internal" href="#use-proxyrotator-sync-when">Use ProxyRotator (sync) when:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#initialization">Initialization</a><ul>
<li><a class="reference internal" href="#basic-initialization">Basic Initialization</a></li>
<li><a class="reference internal" href="#with-initial-proxies">With Initial Proxies</a></li>
<li><a class="reference internal" href="#with-custom-strategy">With Custom Strategy</a></li>
<li><a class="reference internal" href="#with-custom-configuration">With Custom Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#context-manager-usage">Context Manager Usage</a><ul>
<li><a class="reference internal" href="#async-context-manager-recommended">Async Context Manager (Recommended)</a></li>
<li><a class="reference internal" href="#manual-lifecycle-management-advanced">Manual Lifecycle Management (Advanced)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http-request-methods">HTTP Request Methods</a><ul>
<li><a class="reference internal" href="#all-http-methods">All HTTP Methods</a></li>
<li><a class="reference internal" href="#request-parameters">Request Parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#proxy-management">Proxy Management</a><ul>
<li><a class="reference internal" href="#adding-proxies">Adding Proxies</a></li>
<li><a class="reference internal" href="#removing-proxies">Removing Proxies</a></li>
<li><a class="reference internal" href="#getting-proxy-statistics">Getting Proxy Statistics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hot-swapping-strategies">Hot-Swapping Strategies</a></li>
<li><a class="reference internal" href="#error-handling">Error Handling</a><ul>
<li><a class="reference internal" href="#basic-exception-handling">Basic Exception Handling</a></li>
<li><a class="reference internal" href="#retry-policy-override">Retry Policy Override</a></li>
<li><a class="reference internal" href="#circuit-breaker-management">Circuit Breaker Management</a></li>
</ul>
</li>
<li><a class="reference internal" href="#concurrent-requests-with-asyncio-gather">Concurrent Requests with asyncio.gather</a><ul>
<li><a class="reference internal" href="#parallel-requests-to-different-urls">Parallel Requests to Different URLs</a></li>
<li><a class="reference internal" href="#rate-limited-concurrent-scraping">Rate-Limited Concurrent Scraping</a></li>
<li><a class="reference internal" href="#production-scale-web-scraping">Production-Scale Web Scraping</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-considerations">Performance Considerations</a><ul>
<li><a class="reference internal" href="#connection-pooling">Connection Pooling</a></li>
<li><a class="reference internal" href="#connection-limits">Connection Limits</a></li>
<li><a class="reference internal" href="#memory-management">Memory Management</a></li>
<li><a class="reference internal" href="#performance-benchmarks">Performance Benchmarks</a><ul>
<li><a class="reference internal" href="#real-world-performance-example">Real-World Performance Example</a></li>
<li><a class="reference internal" href="#when-async-shines">When Async Shines</a></li>
<li><a class="reference internal" href="#when-sync-is-fine">When Sync is Fine</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#asyncio-integration-patterns">Asyncio Integration Patterns</a><ul>
<li><a class="reference internal" href="#with-fastapi">With FastAPI</a></li>
<li><a class="reference internal" href="#with-aiohttp">With aiohttp</a></li>
<li><a class="reference internal" href="#advanced-httpx-integration">Advanced httpx Integration</a></li>
<li><a class="reference internal" href="#with-asyncio-queue">With asyncio.Queue</a></li>
</ul>
</li>
<li><a class="reference internal" href="#comparison-async-vs-sync">Comparison: Async vs Sync</a><ul>
<li><a class="reference internal" href="#feature-parity">Feature Parity</a></li>
<li><a class="reference internal" href="#key-differences">Key Differences</a></li>
<li><a class="reference internal" href="#migration-example">Migration Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#best-practices-and-common-patterns">Best Practices and Common Patterns</a><ul>
<li><a class="reference internal" href="#always-use-context-managers">1. Always Use Context Managers</a></li>
<li><a class="reference internal" href="#use-semaphores-for-concurrency-control">2. Use Semaphores for Concurrency Control</a></li>
<li><a class="reference internal" href="#handle-exceptions-gracefully">3. Handle Exceptions Gracefully</a></li>
<li><a class="reference internal" href="#reuse-rotator-instances">4. Reuse Rotator Instances</a></li>
<li><a class="reference internal" href="#monitor-circuit-breaker-states">5. Monitor Circuit Breaker States</a></li>
<li><a class="reference internal" href="#use-appropriate-retry-policies">6. Use Appropriate Retry Policies</a></li>
<li><a class="reference internal" href="#profile-and-optimize-connection-pooling">7. Profile and Optimize Connection Pooling</a></li>
<li><a class="reference internal" href="#use-strategy-hot-swapping-for-adaptive-behavior">8. Use Strategy Hot-Swapping for Adaptive Behavior</a></li>
<li><a class="reference internal" href="#clean-up-resources-properly">9. Clean Up Resources Properly</a></li>
<li><a class="reference internal" href="#avoid-common-pitfalls">10. Avoid Common Pitfalls</a></li>
</ul>
</li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">ProxyWhirl</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">Guides</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Async Client Guide</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <div class="copy-page-wrapper relative pb-4 lg:absolute lg:top-8 lg:right-6 xl:right-12">
  <div id="copy-page-trigger">
    <button
      type="button"
      class="js-copy px-3 py-1 inline-flex items-center gap-1"
      data-url="https://proxywhirl.readthedocs.io/_sources/guides/async-client.md.txt"
    >
      <i class="i-lucide" data-icon="copy"></i>
      <span>Copy page</span>
    </button>
    <button class="js-menu px-2 py-1" type="button" aria-label="More actions"
      aria-haspopup="menu" aria-expanded="false" aria-controls="copy-page-content">
      <i class="i-lucide chevron-down"></i>
    </button>
  </div>
  <div id="copy-page-content" role="menu" aria-orientation="vertical" aria-hidden="true">
    <div role="presentation">
      <div class="flex flex-col" role="group">
        <button class="js-copy" type="button" role="menuitem"
          data-url="https://proxywhirl.readthedocs.io/_sources/guides/async-client.md.txt">
          <span class="iconify-icon">
            <i class="i-lucide" data-icon="copy"></i>
          </span>
          <span>Copy page</span>
        </button>
        <a role="menuitem" href="https://proxywhirl.readthedocs.io/_sources/guides/async-client.md.txt" target="_blank" rel="nofollow"><iconify-icon icon="bi:markdown"></iconify-icon>
            <span>View as Markdown</span></a><a role="menuitem" href="https://chatgpt.com/?hints=search&q=Read%20https%3A//proxywhirl.readthedocs.io/_sources/guides/async-client.md.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:openai"></iconify-icon>
          <span>Open in ChatGPT</span>
        </a><a role="menuitem" href="https://claude.ai/new?q=Read%20https%3A//proxywhirl.readthedocs.io/_sources/guides/async-client.md.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:claude"></iconify-icon>
          <span>Open in Claude</span>
        </a></div>
    </div>
  </div>
</div><article class="yue dark-code" role="main">
          <section id="async-client-guide">
<h1>Async Client Guide<a class="headerlink" href="#async-client-guide" title="Link to this heading">¶</a></h1>
<p>ProxyWhirl provides <code class="docutils literal notranslate"><span class="pre">AsyncProxyRotator</span></code>, a fully async implementation of proxy rotation built on <code class="docutils literal notranslate"><span class="pre">httpx.AsyncClient</span></code>. This guide covers when to use async vs sync, initialization patterns, async/await usage, and performance considerations.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#when-to-use-async-vs-sync" id="id1">When to Use Async vs Sync</a></p>
<ul>
<li><p><a class="reference internal" href="#use-asyncproxyrotator-when" id="id2">Use AsyncProxyRotator when:</a></p></li>
<li><p><a class="reference internal" href="#use-proxyrotator-sync-when" id="id3">Use ProxyRotator (sync) when:</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#initialization" id="id4">Initialization</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-initialization" id="id5">Basic Initialization</a></p></li>
<li><p><a class="reference internal" href="#with-initial-proxies" id="id6">With Initial Proxies</a></p></li>
<li><p><a class="reference internal" href="#with-custom-strategy" id="id7">With Custom Strategy</a></p></li>
<li><p><a class="reference internal" href="#with-custom-configuration" id="id8">With Custom Configuration</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#context-manager-usage" id="id9">Context Manager Usage</a></p>
<ul>
<li><p><a class="reference internal" href="#async-context-manager-recommended" id="id10">Async Context Manager (Recommended)</a></p></li>
<li><p><a class="reference internal" href="#manual-lifecycle-management-advanced" id="id11">Manual Lifecycle Management (Advanced)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#http-request-methods" id="id12">HTTP Request Methods</a></p>
<ul>
<li><p><a class="reference internal" href="#all-http-methods" id="id13">All HTTP Methods</a></p></li>
<li><p><a class="reference internal" href="#request-parameters" id="id14">Request Parameters</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#proxy-management" id="id15">Proxy Management</a></p>
<ul>
<li><p><a class="reference internal" href="#adding-proxies" id="id16">Adding Proxies</a></p></li>
<li><p><a class="reference internal" href="#removing-proxies" id="id17">Removing Proxies</a></p></li>
<li><p><a class="reference internal" href="#getting-proxy-statistics" id="id18">Getting Proxy Statistics</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#hot-swapping-strategies" id="id19">Hot-Swapping Strategies</a></p></li>
<li><p><a class="reference internal" href="#error-handling" id="id20">Error Handling</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-exception-handling" id="id21">Basic Exception Handling</a></p></li>
<li><p><a class="reference internal" href="#retry-policy-override" id="id22">Retry Policy Override</a></p></li>
<li><p><a class="reference internal" href="#circuit-breaker-management" id="id23">Circuit Breaker Management</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#concurrent-requests-with-asyncio-gather" id="id24">Concurrent Requests with asyncio.gather</a></p>
<ul>
<li><p><a class="reference internal" href="#parallel-requests-to-different-urls" id="id25">Parallel Requests to Different URLs</a></p></li>
<li><p><a class="reference internal" href="#rate-limited-concurrent-scraping" id="id26">Rate-Limited Concurrent Scraping</a></p></li>
<li><p><a class="reference internal" href="#production-scale-web-scraping" id="id27">Production-Scale Web Scraping</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#performance-considerations" id="id28">Performance Considerations</a></p>
<ul>
<li><p><a class="reference internal" href="#connection-pooling" id="id29">Connection Pooling</a></p></li>
<li><p><a class="reference internal" href="#connection-limits" id="id30">Connection Limits</a></p></li>
<li><p><a class="reference internal" href="#memory-management" id="id31">Memory Management</a></p></li>
<li><p><a class="reference internal" href="#performance-benchmarks" id="id32">Performance Benchmarks</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#asyncio-integration-patterns" id="id33">Asyncio Integration Patterns</a></p>
<ul>
<li><p><a class="reference internal" href="#with-fastapi" id="id34">With FastAPI</a></p></li>
<li><p><a class="reference internal" href="#with-aiohttp" id="id35">With aiohttp</a></p></li>
<li><p><a class="reference internal" href="#advanced-httpx-integration" id="id36">Advanced httpx Integration</a></p></li>
<li><p><a class="reference internal" href="#with-asyncio-queue" id="id37">With asyncio.Queue</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#comparison-async-vs-sync" id="id38">Comparison: Async vs Sync</a></p>
<ul>
<li><p><a class="reference internal" href="#feature-parity" id="id39">Feature Parity</a></p></li>
<li><p><a class="reference internal" href="#key-differences" id="id40">Key Differences</a></p></li>
<li><p><a class="reference internal" href="#migration-example" id="id41">Migration Example</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#best-practices-and-common-patterns" id="id42">Best Practices and Common Patterns</a></p>
<ul>
<li><p><a class="reference internal" href="#always-use-context-managers" id="id43">1. Always Use Context Managers</a></p></li>
<li><p><a class="reference internal" href="#use-semaphores-for-concurrency-control" id="id44">2. Use Semaphores for Concurrency Control</a></p></li>
<li><p><a class="reference internal" href="#handle-exceptions-gracefully" id="id45">3. Handle Exceptions Gracefully</a></p></li>
<li><p><a class="reference internal" href="#reuse-rotator-instances" id="id46">4. Reuse Rotator Instances</a></p></li>
<li><p><a class="reference internal" href="#monitor-circuit-breaker-states" id="id47">5. Monitor Circuit Breaker States</a></p></li>
<li><p><a class="reference internal" href="#use-appropriate-retry-policies" id="id48">6. Use Appropriate Retry Policies</a></p></li>
<li><p><a class="reference internal" href="#profile-and-optimize-connection-pooling" id="id49">7. Profile and Optimize Connection Pooling</a></p></li>
<li><p><a class="reference internal" href="#use-strategy-hot-swapping-for-adaptive-behavior" id="id50">8. Use Strategy Hot-Swapping for Adaptive Behavior</a></p></li>
<li><p><a class="reference internal" href="#clean-up-resources-properly" id="id51">9. Clean Up Resources Properly</a></p></li>
<li><p><a class="reference internal" href="#avoid-common-pitfalls" id="id52">10. Avoid Common Pitfalls</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#see-also" id="id53">See Also</a></p></li>
</ul>
</nav>
<section id="when-to-use-async-vs-sync">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">When to Use Async vs Sync</a><a class="headerlink" href="#when-to-use-async-vs-sync" title="Link to this heading">¶</a></h2>
<section id="use-asyncproxyrotator-when">
<h3><a class="toc-backref" href="#id2" role="doc-backlink">Use AsyncProxyRotator when:</a><a class="headerlink" href="#use-asyncproxyrotator-when" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>High concurrency</strong>: Making many requests in parallel (100+ concurrent requests)</p></li>
<li><p><strong>I/O-bound workloads</strong>: Most time spent waiting for network responses</p></li>
<li><p><strong>Existing async code</strong>: Integrating with FastAPI, aiohttp, or other async frameworks</p></li>
<li><p><strong>Resource efficiency</strong>: Need to handle thousands of connections with minimal memory</p></li>
<li><p><strong>Web scraping at scale</strong>: Concurrent crawling of multiple sites</p></li>
</ul>
</section>
<section id="use-proxyrotator-sync-when">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Use ProxyRotator (sync) when:</a><a class="headerlink" href="#use-proxyrotator-sync-when" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Simple scripts</strong>: Quick one-off tasks or small automation scripts</p></li>
<li><p><strong>Sequential processing</strong>: Requests must happen one at a time</p></li>
<li><p><strong>Existing sync code</strong>: Integrating with Flask, requests, or other sync frameworks</p></li>
<li><p><strong>Simpler debugging</strong>: Sync code is easier to debug and reason about</p></li>
<li><p><strong>Low concurrency</strong>: Making fewer than 10 concurrent requests</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Both <code class="docutils literal notranslate"><span class="pre">AsyncProxyRotator</span></code> and <code class="docutils literal notranslate"><span class="pre">ProxyRotator</span></code> share the same strategy system, retry logic, and circuit breaker implementation. The only difference is the async/sync execution model. See <a class="reference internal" href="advanced-strategies.html"><span class="doc">Advanced Rotation Strategies</span></a> for strategy details and <a class="reference internal" href="retry-failover.html"><span class="doc">Retry &amp; Failover Guide</span></a> for circuit breaker configuration.</p>
</div>
</section>
</section>
<section id="initialization">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Initialization</a><a class="headerlink" href="#initialization" title="Link to this heading">¶</a></h2>
<section id="basic-initialization">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Basic Initialization</a><a class="headerlink" href="#basic-initialization" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Default initialization (round-robin strategy)</span>
</span><span data-line="4"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="5">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="6">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="9">    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span></pre></div>
</div>
</section>
<section id="with-initial-proxies">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">With Initial Proxies</a><a class="headerlink" href="#with-initial-proxies" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span><span class="p">,</span> <span class="n">Proxy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Pre-populate proxy pool</span>
</span><span data-line="4"><span class="n">proxies</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="5">    <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">),</span>
</span><span data-line="6">    <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">),</span>
</span><span data-line="7">    <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy3.example.com:8080&quot;</span><span class="p">),</span>
</span><span data-line="8"><span class="p">]</span>
</span><span data-line="9">
</span><span data-line="10"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span><span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">)</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="11">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="with-custom-strategy">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">With Custom Strategy</a><a class="headerlink" href="#with-custom-strategy" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Strategy from string (4 strategies available at init)</span>
</span><span data-line="4"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="5">    <span class="c1"># Uses RandomStrategy</span>
</span><span data-line="6">    <span class="k">pass</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Available strategies at init:</span>
</span><span data-line="9"><span class="c1"># - &quot;round-robin&quot; (default)</span>
</span><span data-line="10"><span class="c1"># - &quot;random&quot;</span>
</span><span data-line="11"><span class="c1"># - &quot;weighted&quot;</span>
</span><span data-line="12"><span class="c1"># - &quot;least-used&quot;</span>
</span><span data-line="13"><span class="c1">#</span>
</span><span data-line="14"><span class="c1"># For other strategies (performance-based, session-persistence, geo-targeted,</span>
</span><span data-line="15"><span class="c1"># cost-aware, composite), use set_strategy() after init or pass a strategy</span>
</span><span data-line="16"><span class="c1"># instance directly:</span>
</span><span data-line="17"><span class="c1">#   from proxywhirl.strategies import PerformanceBasedStrategy</span>
</span><span data-line="18"><span class="c1">#   async with AsyncProxyRotator(strategy=PerformanceBasedStrategy()) as rotator:</span>
</span></pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For detailed strategy configuration including EMA tuning, session persistence, geo-targeting, cost-aware selection, and composite strategies, see <a class="reference internal" href="advanced-strategies.html"><span class="doc">Advanced Rotation Strategies</span></a>.</p>
</div>
</section>
<section id="with-custom-configuration">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">With Custom Configuration</a><a class="headerlink" href="#with-custom-configuration" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span><span class="p">,</span> <span class="n">ProxyConfiguration</span><span class="p">,</span> <span class="n">RetryPolicy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">config</span> <span class="o">=</span> <span class="n">ProxyConfiguration</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">verify_ssl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">pool_connections</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">pool_max_keepalive</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
</span><span data-line="8"><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10"><span class="n">retry_policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="11">    <span class="n">max_attempts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span data-line="12">    <span class="n">base_delay</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span data-line="13"><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span>
</span><span data-line="16">    <span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;round-robin&quot;</span><span class="p">,</span>
</span><span data-line="17">    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
</span><span data-line="18">    <span class="n">retry_policy</span><span class="o">=</span><span class="n">retry_policy</span>
</span><span data-line="19"><span class="p">)</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="20">    <span class="c1"># Hot-swap to performance-based after init if needed</span>
</span><span data-line="21">    <span class="n">rotator</span><span class="o">.</span><span class="n">set_strategy</span><span class="p">(</span><span class="s2">&quot;performance-based&quot;</span><span class="p">)</span>
</span><span data-line="22">    <span class="k">pass</span>
</span></pre></div>
</div>
</section>
</section>
<section id="context-manager-usage">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Context Manager Usage</a><a class="headerlink" href="#context-manager-usage" title="Link to this heading">¶</a></h2>
<section id="async-context-manager-recommended">
<h3><a class="toc-backref" href="#id10" role="doc-backlink">Async Context Manager (Recommended)</a><a class="headerlink" href="#async-context-manager-recommended" title="Link to this heading">¶</a></h3>
<p>Always use <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">with</span></code> to ensure proper cleanup of HTTP clients and background threads:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span data-line="5">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="6">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8">        <span class="c1"># Make requests</span>
</span><span data-line="9">        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11">        <span class="c1"># Client is automatically closed on exit</span>
</span><span data-line="12">
</span><span data-line="13">    <span class="c1"># All resources cleaned up here</span>
</span><span data-line="14">
</span><span data-line="15"><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></pre></div>
</div>
</section>
<section id="manual-lifecycle-management-advanced">
<h3><a class="toc-backref" href="#id11" role="doc-backlink">Manual Lifecycle Management (Advanced)</a><a class="headerlink" href="#manual-lifecycle-management-advanced" title="Link to this heading">¶</a></h3>
<p>For advanced use cases where you need explicit control:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">rotator</span> <span class="o">=</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Manually enter context</span>
</span><span data-line="4"><span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="fm">__aenter__</span><span class="p">()</span>
</span><span data-line="5">
</span><span data-line="6"><span class="k">try</span><span class="p">:</span>
</span><span data-line="7">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="8">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="9"><span class="k">finally</span><span class="p">:</span>
</span><span data-line="10">    <span class="c1"># Manually exit context</span>
</span><span data-line="11">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="fm">__aexit__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Manual lifecycle management requires careful exception handling to prevent resource leaks. Always prefer <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">with</span></code> unless you have a specific reason not to.</p>
</div>
</section>
</section>
<section id="http-request-methods">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">HTTP Request Methods</a><a class="headerlink" href="#http-request-methods" title="Link to this heading">¶</a></h2>
<section id="all-http-methods">
<h3><a class="toc-backref" href="#id13" role="doc-backlink">All HTTP Methods</a><a class="headerlink" href="#all-http-methods" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">AsyncProxyRotator</span></code> provides async versions of all standard HTTP methods:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="2">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="3">
</span><span data-line="4">    <span class="c1"># GET request</span>
</span><span data-line="5">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7">    <span class="c1"># POST request with JSON body</span>
</span><span data-line="8">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span data-line="9">        <span class="s2">&quot;https://api.example.com/submit&quot;</span><span class="p">,</span>
</span><span data-line="10">        <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">}</span>
</span><span data-line="11">    <span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13">    <span class="c1"># PUT request</span>
</span><span data-line="14">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
</span><span data-line="15">        <span class="s2">&quot;https://api.example.com/resource/123&quot;</span><span class="p">,</span>
</span><span data-line="16">        <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">}</span>
</span><span data-line="17">    <span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19">    <span class="c1"># DELETE request</span>
</span><span data-line="20">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/resource/123&quot;</span><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22">    <span class="c1"># PATCH request</span>
</span><span data-line="23">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
</span><span data-line="24">        <span class="s2">&quot;https://api.example.com/resource/123&quot;</span><span class="p">,</span>
</span><span data-line="25">        <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;partial&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span><span class="p">}</span>
</span><span data-line="26">    <span class="p">)</span>
</span><span data-line="27">
</span><span data-line="28">    <span class="c1"># HEAD request</span>
</span><span data-line="29">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/resource&quot;</span><span class="p">)</span>
</span><span data-line="30">
</span><span data-line="31">    <span class="c1"># OPTIONS request</span>
</span><span data-line="32">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/resource&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="request-parameters">
<h3><a class="toc-backref" href="#id14" role="doc-backlink">Request Parameters</a><a class="headerlink" href="#request-parameters" title="Link to this heading">¶</a></h3>
<p>All methods accept standard <code class="docutils literal notranslate"><span class="pre">httpx</span></code> parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="2">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="3">
</span><span data-line="4">    <span class="c1"># Headers</span>
</span><span data-line="5">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span data-line="6">        <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
</span><span data-line="7">        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;MyBot/1.0&quot;</span><span class="p">}</span>
</span><span data-line="8">    <span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10">    <span class="c1"># Query parameters</span>
</span><span data-line="11">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span data-line="12">        <span class="s2">&quot;https://api.example.com/search&quot;</span><span class="p">,</span>
</span><span data-line="13">        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
</span><span data-line="14">    <span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16">    <span class="c1"># Form data</span>
</span><span data-line="17">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span data-line="18">        <span class="s2">&quot;https://api.example.com/form&quot;</span><span class="p">,</span>
</span><span data-line="19">        <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;field1&quot;</span><span class="p">:</span> <span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="s2">&quot;field2&quot;</span><span class="p">:</span> <span class="s2">&quot;value2&quot;</span><span class="p">}</span>
</span><span data-line="20">    <span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22">    <span class="c1"># JSON body</span>
</span><span data-line="23">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span data-line="24">        <span class="s2">&quot;https://api.example.com/api&quot;</span><span class="p">,</span>
</span><span data-line="25">        <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">}</span>
</span><span data-line="26">    <span class="p">)</span>
</span><span data-line="27">
</span><span data-line="28">    <span class="c1"># Cookies</span>
</span><span data-line="29">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span data-line="30">        <span class="s2">&quot;https://api.example.com/protected&quot;</span><span class="p">,</span>
</span><span data-line="31">        <span class="n">cookies</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;session&quot;</span><span class="p">:</span> <span class="s2">&quot;abc123&quot;</span><span class="p">}</span>
</span><span data-line="32">    <span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="proxy-management">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Proxy Management</a><a class="headerlink" href="#proxy-management" title="Link to this heading">¶</a></h2>
<section id="adding-proxies">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Adding Proxies</a><a class="headerlink" href="#adding-proxies" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span><span class="p">,</span> <span class="n">Proxy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="4">    <span class="c1"># Add from URL string</span>
</span><span data-line="5">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7">    <span class="c1"># Add from Proxy object</span>
</span><span data-line="8">    <span class="n">proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span>
</span><span data-line="9">        <span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">,</span>
</span><span data-line="10">        <span class="n">username</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
</span><span data-line="11">        <span class="n">password</span><span class="o">=</span><span class="s2">&quot;pass&quot;</span>
</span><span data-line="12">    <span class="p">)</span>
</span><span data-line="13">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15">    <span class="c1"># Check pool size</span>
</span><span data-line="16">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pool size: </span><span class="si">{</span><span class="n">rotator</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="removing-proxies">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Removing Proxies</a><a class="headerlink" href="#removing-proxies" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="2">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="3">    <span class="n">proxy</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
</span><span data-line="4">
</span><span data-line="5">    <span class="c1"># Remove by proxy ID</span>
</span><span data-line="6">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">remove_proxy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
</span><span data-line="7">
</span><span data-line="8">    <span class="c1"># Cleanup unhealthy proxies</span>
</span><span data-line="9">    <span class="n">removed_count</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">clear_unhealthy_proxies</span><span class="p">()</span>
</span><span data-line="10">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="n">removed_count</span><span class="si">}</span><span class="s2"> unhealthy proxies&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="getting-proxy-statistics">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Getting Proxy Statistics</a><a class="headerlink" href="#getting-proxy-statistics" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="2">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="3">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="4">
</span><span data-line="5">    <span class="c1"># Pool statistics</span>
</span><span data-line="6">    <span class="n">stats</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_pool_stats</span><span class="p">()</span>
</span><span data-line="7">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total proxies: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_proxies&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="8">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Healthy proxies: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;healthy_proxies&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="9">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average success rate: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;average_success_rate&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11">    <span class="c1"># Comprehensive statistics with source breakdown</span>
</span><span data-line="12">    <span class="n">stats</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>
</span><span data-line="13">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Source breakdown: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;source_breakdown&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="hot-swapping-strategies">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">Hot-Swapping Strategies</a><a class="headerlink" href="#hot-swapping-strategies" title="Link to this heading">¶</a></h2>
<p>Change rotation strategies at runtime without restarting. For a full list of available strategies and their configuration options, see <a class="reference internal" href="advanced-strategies.html"><span class="doc">Advanced Rotation Strategies</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;round-robin&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="2">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="3">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="4">
</span><span data-line="5">    <span class="c1"># Make some requests with round-robin</span>
</span><span data-line="6">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8">    <span class="c1"># Hot-swap to performance-based strategy</span>
</span><span data-line="9">    <span class="n">rotator</span><span class="o">.</span><span class="n">set_strategy</span><span class="p">(</span><span class="s2">&quot;performance-based&quot;</span><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11">    <span class="c1"># New requests use performance-based strategy</span>
</span><span data-line="12">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Strategy hot-swapping completes in &lt;100ms and is thread-safe. In-flight requests complete with their original strategy.</p>
</div>
</section>
<section id="error-handling">
<h2><a class="toc-backref" href="#id20" role="doc-backlink">Error Handling</a><a class="headerlink" href="#error-handling" title="Link to this heading">¶</a></h2>
<section id="basic-exception-handling">
<h3><a class="toc-backref" href="#id21" role="doc-backlink">Basic Exception Handling</a><a class="headerlink" href="#basic-exception-handling" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="2">    <span class="n">AsyncProxyRotator</span><span class="p">,</span>
</span><span data-line="3">    <span class="n">ProxyPoolEmptyError</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">ProxyConnectionError</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">ProxyAuthenticationError</span>
</span><span data-line="6"><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="9">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="10">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="11">        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="12">        <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span><span data-line="13">
</span><span data-line="14">    <span class="k">except</span> <span class="n">ProxyPoolEmptyError</span><span class="p">:</span>
</span><span data-line="15">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No healthy proxies available&quot;</span><span class="p">)</span>
</span><span data-line="16">
</span><span data-line="17">    <span class="k">except</span> <span class="n">ProxyAuthenticationError</span><span class="p">:</span>
</span><span data-line="18">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Proxy authentication failed&quot;</span><span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20">    <span class="k">except</span> <span class="n">ProxyConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="21">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="retry-policy-override">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Retry Policy Override</a><a class="headerlink" href="#retry-policy-override" title="Link to this heading">¶</a></h3>
<p>Override retry behavior per request. See <a class="reference internal" href="retry-failover.html"><span class="doc">Retry &amp; Failover Guide</span></a> for complete retry policy configuration, backoff strategies, and circuit breaker details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span><span class="p">,</span> <span class="n">RetryPolicy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="4">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="5">
</span><span data-line="6">    <span class="c1"># Custom retry policy for this request</span>
</span><span data-line="7">    <span class="n">custom_policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span><span class="n">max_attempts</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">base_delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span data-line="10">        <span class="s2">&quot;https://api.example.com/flaky-endpoint&quot;</span><span class="p">,</span>
</span><span data-line="11">        <span class="n">retry_policy</span><span class="o">=</span><span class="n">custom_policy</span>
</span><span data-line="12">    <span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="circuit-breaker-management">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Circuit Breaker Management</a><a class="headerlink" href="#circuit-breaker-management" title="Link to this heading">¶</a></h3>
<p>For detailed circuit breaker configuration, state transitions, and persistence options, see <a class="reference internal" href="retry-failover.html"><span class="doc">Retry &amp; Failover Guide</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="2">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="3">    <span class="n">proxy</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
</span><span data-line="4">
</span><span data-line="5">    <span class="c1"># Get circuit breaker states</span>
</span><span data-line="6">    <span class="n">states</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_circuit_breaker_states</span><span class="p">()</span>
</span><span data-line="7">    <span class="k">for</span> <span class="n">proxy_id</span><span class="p">,</span> <span class="n">breaker</span> <span class="ow">in</span> <span class="n">states</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="8">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Proxy </span><span class="si">{</span><span class="n">proxy_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">breaker</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10">    <span class="c1"># Manually reset a circuit breaker</span>
</span><span data-line="11">    <span class="n">rotator</span><span class="o">.</span><span class="n">reset_circuit_breaker</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
</span></pre></div>
</div>
</section>
</section>
<section id="concurrent-requests-with-asyncio-gather">
<h2><a class="toc-backref" href="#id24" role="doc-backlink">Concurrent Requests with asyncio.gather</a><a class="headerlink" href="#concurrent-requests-with-asyncio-gather" title="Link to this heading">¶</a></h2>
<section id="parallel-requests-to-different-urls">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Parallel Requests to Different URLs</a><a class="headerlink" href="#parallel-requests-to-different-urls" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_url</span><span class="p">(</span><span class="n">rotator</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch a single URL through the proxy pool.&quot;&quot;&quot;</span>
</span><span data-line="6">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="7">        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="8">        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()}</span>
</span><span data-line="9">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="10">        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
</span><span data-line="11">
</span><span data-line="12"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span data-line="13">    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="14">        <span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">,</span>
</span><span data-line="15">        <span class="s2">&quot;https://httpbin.org/user-agent&quot;</span><span class="p">,</span>
</span><span data-line="16">        <span class="s2">&quot;https://httpbin.org/headers&quot;</span><span class="p">,</span>
</span><span data-line="17">        <span class="s2">&quot;https://httpbin.org/get&quot;</span><span class="p">,</span>
</span><span data-line="18">    <span class="p">]</span>
</span><span data-line="19">
</span><span data-line="20">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;round-robin&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="21">        <span class="c1"># Add proxy pool</span>
</span><span data-line="22">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="23">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="24">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy3.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="25">
</span><span data-line="26">        <span class="c1"># Fetch all URLs concurrently</span>
</span><span data-line="27">        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">fetch_url</span><span class="p">(</span><span class="n">rotator</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
</span><span data-line="28">        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
</span><span data-line="29">
</span><span data-line="30">        <span class="c1"># Process results</span>
</span><span data-line="31">        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span><span data-line="32">            <span class="k">if</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span data-line="33">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="34">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="35">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Success: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Status </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="36">
</span><span data-line="37"><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></pre></div>
</div>
</section>
<section id="rate-limited-concurrent-scraping">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Rate-Limited Concurrent Scraping</a><a class="headerlink" href="#rate-limited-concurrent-scraping" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">scrape_with_semaphore</span><span class="p">(</span><span class="n">rotator</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">semaphore</span><span class="p">):</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Scrape with concurrency limit.&quot;&quot;&quot;</span>
</span><span data-line="6">    <span class="k">async</span> <span class="k">with</span> <span class="n">semaphore</span><span class="p">:</span>
</span><span data-line="7">        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="8">        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span data-line="9">
</span><span data-line="10"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span data-line="11">    <span class="c1"># Limit to 10 concurrent requests</span>
</span><span data-line="12">    <span class="n">semaphore</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14">    <span class="c1"># Generate 100 URLs to scrape</span>
</span><span data-line="15">    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;https://httpbin.org/delay/</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>
</span><span data-line="16">
</span><span data-line="17">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;least-used&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="18">        <span class="c1"># Add proxy pool</span>
</span><span data-line="19">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span><span data-line="20">            <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;http://proxy</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22">        <span class="c1"># Scrape with rate limiting</span>
</span><span data-line="23">        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">scrape_with_semaphore</span><span class="p">(</span><span class="n">rotator</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">semaphore</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
</span><span data-line="24">        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="25">
</span><span data-line="26">        <span class="c1"># Count successes and failures</span>
</span><span data-line="27">        <span class="n">successes</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">))</span>
</span><span data-line="28">        <span class="n">failures</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">-</span> <span class="n">successes</span>
</span><span data-line="29">
</span><span data-line="30">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed: </span><span class="si">{</span><span class="n">successes</span><span class="si">}</span><span class="s2"> successes, </span><span class="si">{</span><span class="n">failures</span><span class="si">}</span><span class="s2"> failures&quot;</span><span class="p">)</span>
</span><span data-line="31">
</span><span data-line="32"><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></pre></div>
</div>
</section>
<section id="production-scale-web-scraping">
<h3><a class="toc-backref" href="#id27" role="doc-backlink">Production-Scale Web Scraping</a><a class="headerlink" href="#production-scale-web-scraping" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span><span class="p">,</span> <span class="n">ProxyConfiguration</span>
</span><span data-line="5">
</span><span data-line="6"><span class="nd">@dataclass</span>
</span><span data-line="7"><span class="k">class</span><span class="w"> </span><span class="nc">ScrapedPage</span><span class="p">:</span>
</span><span data-line="8">    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="9">    <span class="n">status_code</span><span class="p">:</span> <span class="nb">int</span>
</span><span data-line="10">    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="11">    <span class="n">proxy_used</span><span class="p">:</span> <span class="nb">str</span>
</span><span data-line="12">
</span><span data-line="13"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">scrape_page</span><span class="p">(</span><span class="n">rotator</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScrapedPage</span><span class="p">:</span>
</span><span data-line="14"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Scrape a single page with error handling.&quot;&quot;&quot;</span>
</span><span data-line="15">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="16">        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span>
</span><span data-line="17">        <span class="n">proxy</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
</span><span data-line="18">
</span><span data-line="19">        <span class="k">return</span> <span class="n">ScrapedPage</span><span class="p">(</span>
</span><span data-line="20">            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
</span><span data-line="21">            <span class="n">status_code</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span><span data-line="22">            <span class="n">content</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
</span><span data-line="23">            <span class="n">proxy_used</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="24">        <span class="p">)</span>
</span><span data-line="25">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="26">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to scrape </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="27">        <span class="k">raise</span>
</span><span data-line="28">
</span><span data-line="29"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">batch_scrape</span><span class="p">(</span><span class="n">urls</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">max_concurrent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">):</span>
</span><span data-line="30"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Scrape URLs in batches with concurrency control.&quot;&quot;&quot;</span>
</span><span data-line="31">    <span class="n">config</span> <span class="o">=</span> <span class="n">ProxyConfiguration</span><span class="p">(</span>
</span><span data-line="32">        <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
</span><span data-line="33">        <span class="n">pool_connections</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span data-line="34">        <span class="n">pool_max_keepalive</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
</span><span data-line="35">    <span class="p">)</span>
</span><span data-line="36">
</span><span data-line="37">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="38">        <span class="c1"># Use performance-based strategy (swap after init)</span>
</span><span data-line="39">        <span class="n">rotator</span><span class="o">.</span><span class="n">set_strategy</span><span class="p">(</span><span class="s2">&quot;performance-based&quot;</span><span class="p">)</span>
</span><span data-line="40">
</span><span data-line="41">        <span class="c1"># Add proxy pool</span>
</span><span data-line="42">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="43">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="44">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy3.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="45">
</span><span data-line="46">        <span class="c1"># Create semaphore for rate limiting</span>
</span><span data-line="47">        <span class="n">semaphore</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="n">max_concurrent</span><span class="p">)</span>
</span><span data-line="48">
</span><span data-line="49">        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">scrape_with_limit</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span data-line="50">            <span class="k">async</span> <span class="k">with</span> <span class="n">semaphore</span><span class="p">:</span>
</span><span data-line="51">                <span class="k">return</span> <span class="k">await</span> <span class="n">scrape_page</span><span class="p">(</span><span class="n">rotator</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span data-line="52">
</span><span data-line="53">        <span class="c1"># Scrape all URLs</span>
</span><span data-line="54">        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">scrape_with_limit</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
</span><span data-line="55">        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="56">
</span><span data-line="57">        <span class="c1"># Filter successful results</span>
</span><span data-line="58">        <span class="n">pages</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">ScrapedPage</span><span class="p">)]</span>
</span><span data-line="59">        <span class="n">errors</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">)]</span>
</span><span data-line="60">
</span><span data-line="61">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scraped </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pages</span><span class="p">)</span><span class="si">}</span><span class="s2"> pages successfully&quot;</span><span class="p">)</span>
</span><span data-line="62">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="si">}</span><span class="s2"> pages&quot;</span><span class="p">)</span>
</span><span data-line="63">
</span><span data-line="64">        <span class="c1"># Get performance statistics</span>
</span><span data-line="65">        <span class="n">stats</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_pool_stats</span><span class="p">()</span>
</span><span data-line="66">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average success rate: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;average_success_rate&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="67">
</span><span data-line="68">        <span class="k">return</span> <span class="n">pages</span>
</span><span data-line="69">
</span><span data-line="70"><span class="c1"># Usage</span>
</span><span data-line="71"><span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;https://example.com/page/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
</span><span data-line="72"><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">batch_scrape</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">max_concurrent</span><span class="o">=</span><span class="mi">50</span><span class="p">))</span>
</span></pre></div>
</div>
</section>
</section>
<section id="performance-considerations">
<h2><a class="toc-backref" href="#id28" role="doc-backlink">Performance Considerations</a><a class="headerlink" href="#performance-considerations" title="Link to this heading">¶</a></h2>
<section id="connection-pooling">
<h3><a class="toc-backref" href="#id29" role="doc-backlink">Connection Pooling</a><a class="headerlink" href="#connection-pooling" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">AsyncProxyRotator</span></code> maintains an LRU cache of <code class="docutils literal notranslate"><span class="pre">httpx.AsyncClient</span></code> instances:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Client pool caches up to 100 clients (default)</span>
</span><span data-line="4"><span class="c1"># LRU eviction prevents unbounded memory growth</span>
</span><span data-line="5"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="6">    <span class="c1"># Add many proxies</span>
</span><span data-line="7">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
</span><span data-line="8">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;http://proxy</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10">    <span class="c1"># Only 100 most recently used clients are cached</span>
</span><span data-line="11">    <span class="c1"># Older clients are automatically closed and evicted</span>
</span></pre></div>
</div>
</section>
<section id="connection-limits">
<h3><a class="toc-backref" href="#id30" role="doc-backlink">Connection Limits</a><a class="headerlink" href="#connection-limits" title="Link to this heading">¶</a></h3>
<p>Configure connection pooling per client:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span><span class="p">,</span> <span class="n">ProxyConfiguration</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">config</span> <span class="o">=</span> <span class="n">ProxyConfiguration</span><span class="p">(</span>
</span><span data-line="4">    <span class="n">pool_connections</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>        <span class="c1"># Max concurrent connections per proxy</span>
</span><span data-line="5">    <span class="n">pool_max_keepalive</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>      <span class="c1"># Max keep-alive connections per proxy</span>
</span><span data-line="6"><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="9">    <span class="c1"># Each proxy client has 50 max connections</span>
</span><span data-line="10">    <span class="c1"># And keeps 20 connections alive for reuse</span>
</span><span data-line="11">    <span class="k">pass</span>
</span></pre></div>
</div>
</section>
<section id="memory-management">
<h3><a class="toc-backref" href="#id31" role="doc-backlink">Memory Management</a><a class="headerlink" href="#memory-management" title="Link to this heading">¶</a></h3>
<p>The async client automatically manages memory:</p>
<ul class="simple">
<li><p><strong>LRU client pool</strong>: Limits total cached clients to 100</p></li>
<li><p><strong>Automatic eviction</strong>: Least recently used clients are closed when limit reached</p></li>
<li><p><strong>Circuit breaker cleanup</strong>: Removed proxies have their circuit breakers deleted</p></li>
<li><p><strong>Background thread cleanup</strong>: Metrics aggregation thread is stopped on exit</p></li>
</ul>
</section>
<section id="performance-benchmarks">
<h3><a class="toc-backref" href="#id32" role="doc-backlink">Performance Benchmarks</a><a class="headerlink" href="#performance-benchmarks" title="Link to this heading">¶</a></h3>
<p>Expected performance characteristics:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Metric</p></th>
<th class="head"><p>AsyncProxyRotator</p></th>
<th class="head"><p>ProxyRotator (sync)</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Strategy hot-swap</p></td>
<td><p>&lt;100ms</p></td>
<td><p>&lt;100ms</p></td>
<td><p>Both use atomic reference swap</p></td>
</tr>
<tr class="row-odd"><td><p>Request overhead</p></td>
<td><p>~1-2ms</p></td>
<td><p>~1-2ms</p></td>
<td><p>Minimal proxy selection overhead</p></td>
</tr>
<tr class="row-even"><td><p>Max concurrent requests</p></td>
<td><p>1000+</p></td>
<td><p>~50-100</p></td>
<td><p>Async scales better with I/O</p></td>
</tr>
<tr class="row-odd"><td><p>Memory per proxy client</p></td>
<td><p>~50KB</p></td>
<td><p>~50KB</p></td>
<td><p>Similar client footprint</p></td>
</tr>
<tr class="row-even"><td><p>Client pool eviction</p></td>
<td><p>O(1)</p></td>
<td><p>O(1)</p></td>
<td><p>Both use OrderedDict</p></td>
</tr>
<tr class="row-odd"><td><p>Throughput (10 proxies, 100 URLs)</p></td>
<td><p>~10-20 req/sec</p></td>
<td><p>~5-10 req/sec</p></td>
<td><p>Async is 2x faster</p></td>
</tr>
<tr class="row-even"><td><p>Latency (single request)</p></td>
<td><p>~100-200ms</p></td>
<td><p>~100-200ms</p></td>
<td><p>Similar for single requests</p></td>
</tr>
<tr class="row-odd"><td><p>Memory overhead</p></td>
<td><p>~5-10MB</p></td>
<td><p>~5-10MB</p></td>
<td><p>Similar baseline</p></td>
</tr>
<tr class="row-even"><td><p>CPU usage (100 concurrent)</p></td>
<td><p>~10-20%</p></td>
<td><p>~20-40%</p></td>
<td><p>Async is more efficient</p></td>
</tr>
</tbody>
</table>
</div>
<section id="real-world-performance-example">
<h4>Real-World Performance Example<a class="headerlink" href="#real-world-performance-example" title="Link to this heading">¶</a></h4>
<p>Here’s a simple benchmark comparing async vs sync:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span data-line="2"><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span><span class="p">,</span> <span class="n">ProxyRotator</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">benchmark_async</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">proxy_url</span><span class="p">):</span>
</span><span data-line="6"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Benchmark async implementation.&quot;&quot;&quot;</span>
</span><span data-line="7">    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span data-line="8">
</span><span data-line="9">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="10">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="n">proxy_url</span><span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12">        <span class="c1"># Concurrent requests with semaphore</span>
</span><span data-line="13">        <span class="n">semaphore</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15">        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_with_limit</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span data-line="16">            <span class="k">async</span> <span class="k">with</span> <span class="n">semaphore</span><span class="p">:</span>
</span><span data-line="17">                <span class="k">try</span><span class="p">:</span>
</span><span data-line="18">                    <span class="k">return</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
</span><span data-line="19">                <span class="k">except</span><span class="p">:</span>
</span><span data-line="20">                    <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="21">
</span><span data-line="22">        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">fetch_with_limit</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
</span><span data-line="23">        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="24">
</span><span data-line="25">    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
</span><span data-line="26">    <span class="n">successes</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="27">
</span><span data-line="28">    <span class="k">return</span> <span class="p">{</span>
</span><span data-line="29">        <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="n">elapsed</span><span class="p">,</span>
</span><span data-line="30">        <span class="s2">&quot;successes&quot;</span><span class="p">:</span> <span class="n">successes</span><span class="p">,</span>
</span><span data-line="31">        <span class="s2">&quot;requests_per_second&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span> <span class="o">/</span> <span class="n">elapsed</span>
</span><span data-line="32">    <span class="p">}</span>
</span><span data-line="33">
</span><span data-line="34"><span class="k">def</span><span class="w"> </span><span class="nf">benchmark_sync</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">proxy_url</span><span class="p">):</span>
</span><span data-line="35"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Benchmark sync implementation.&quot;&quot;&quot;</span>
</span><span data-line="36">    <span class="kn">import</span><span class="w"> </span><span class="nn">concurrent.futures</span>
</span><span data-line="37">
</span><span data-line="38">    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span data-line="39">
</span><span data-line="40">    <span class="k">with</span> <span class="n">ProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="41">        <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="n">proxy_url</span><span class="p">)</span>
</span><span data-line="42">
</span><span data-line="43">        <span class="c1"># Threaded concurrent requests</span>
</span><span data-line="44">        <span class="k">def</span><span class="w"> </span><span class="nf">fetch</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span data-line="45">            <span class="k">try</span><span class="p">:</span>
</span><span data-line="46">                <span class="k">return</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
</span><span data-line="47">            <span class="k">except</span><span class="p">:</span>
</span><span data-line="48">                <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="49">
</span><span data-line="50">        <span class="k">with</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
</span><span data-line="51">            <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">fetch</span><span class="p">,</span> <span class="n">urls</span><span class="p">))</span>
</span><span data-line="52">
</span><span data-line="53">    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
</span><span data-line="54">    <span class="n">successes</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="55">
</span><span data-line="56">    <span class="k">return</span> <span class="p">{</span>
</span><span data-line="57">        <span class="s2">&quot;total_time&quot;</span><span class="p">:</span> <span class="n">elapsed</span><span class="p">,</span>
</span><span data-line="58">        <span class="s2">&quot;successes&quot;</span><span class="p">:</span> <span class="n">successes</span><span class="p">,</span>
</span><span data-line="59">        <span class="s2">&quot;requests_per_second&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span> <span class="o">/</span> <span class="n">elapsed</span>
</span><span data-line="60">    <span class="p">}</span>
</span><span data-line="61">
</span><span data-line="62"><span class="c1"># Run benchmark</span>
</span><span data-line="63"><span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;https://httpbin.org/delay/</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>
</span><span data-line="64">
</span><span data-line="65"><span class="c1"># Async version</span>
</span><span data-line="66"><span class="n">async_results</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">benchmark_async</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">))</span>
</span><span data-line="67"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Async: </span><span class="si">{</span><span class="n">async_results</span><span class="p">[</span><span class="s1">&#39;requests_per_second&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> req/s in </span><span class="si">{</span><span class="n">async_results</span><span class="p">[</span><span class="s1">&#39;total_time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span data-line="68">
</span><span data-line="69"><span class="c1"># Sync version</span>
</span><span data-line="70"><span class="n">sync_results</span> <span class="o">=</span> <span class="n">benchmark_sync</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="71"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sync: </span><span class="si">{</span><span class="n">sync_results</span><span class="p">[</span><span class="s1">&#39;requests_per_second&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> req/s in </span><span class="si">{</span><span class="n">sync_results</span><span class="p">[</span><span class="s1">&#39;total_time&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span><span data-line="72">
</span><span data-line="73"><span class="c1"># Speedup</span>
</span><span data-line="74"><span class="n">speedup</span> <span class="o">=</span> <span class="n">async_results</span><span class="p">[</span><span class="s1">&#39;requests_per_second&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">sync_results</span><span class="p">[</span><span class="s1">&#39;requests_per_second&#39;</span><span class="p">]</span>
</span><span data-line="75"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Async is </span><span class="si">{</span><span class="n">speedup</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">x faster&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Expected Output:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">Async</span><span class="p">:</span> <span class="mf">18.52</span> <span class="n">req</span><span class="o">/</span><span class="n">s</span> <span class="ow">in</span> <span class="mf">5.40</span><span class="n">s</span>
</span><span data-line="2"><span class="n">Sync</span><span class="p">:</span> <span class="mf">9.23</span> <span class="n">req</span><span class="o">/</span><span class="n">s</span> <span class="ow">in</span> <span class="mf">10.83</span><span class="n">s</span>
</span><span data-line="3"><span class="n">Async</span> <span class="ow">is</span> <span class="mf">2.01</span><span class="n">x</span> <span class="n">faster</span>
</span></pre></div>
</div>
</section>
<section id="when-async-shines">
<h4>When Async Shines<a class="headerlink" href="#when-async-shines" title="Link to this heading">¶</a></h4>
<p>Async provides the most benefit when:</p>
<ol class="arabic simple">
<li><p><strong>High I/O wait time</strong>: Network requests with 100ms+ latency</p></li>
<li><p><strong>Many concurrent operations</strong>: 50+ concurrent requests</p></li>
<li><p><strong>Large-scale scraping</strong>: 1000+ URLs to fetch</p></li>
<li><p><strong>Real-time applications</strong>: WebSocket servers, API gateways</p></li>
<li><p><strong>Resource-constrained environments</strong>: Lower CPU usage than threading</p></li>
</ol>
</section>
<section id="when-sync-is-fine">
<h4>When Sync is Fine<a class="headerlink" href="#when-sync-is-fine" title="Link to this heading">¶</a></h4>
<p>Sync is sufficient when:</p>
<ol class="arabic simple">
<li><p><strong>Low concurrency</strong>: &lt;10 concurrent requests</p></li>
<li><p><strong>Simple scripts</strong>: One-off automation tasks</p></li>
<li><p><strong>Sequential processing</strong>: Requests must happen in order</p></li>
<li><p><strong>Simpler debugging</strong>: Stack traces are easier to read</p></li>
<li><p><strong>Existing sync codebase</strong>: Integration with Flask, Django, etc.</p></li>
</ol>
</section>
</section>
</section>
<section id="asyncio-integration-patterns">
<h2><a class="toc-backref" href="#id33" role="doc-backlink">Asyncio Integration Patterns</a><a class="headerlink" href="#asyncio-integration-patterns" title="Link to this heading">¶</a></h2>
<section id="with-fastapi">
<h3><a class="toc-backref" href="#id34" role="doc-backlink">With FastAPI</a><a class="headerlink" href="#with-fastapi" title="Link to this heading">¶</a></h3>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For production FastAPI deployments, see <a class="reference internal" href="deployment-security.html"><span class="doc">Deployment Security &amp; Reverse Proxy Configuration</span></a> for reverse proxy configuration and rate limiting setup.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastAPI</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># Initialize rotator at startup</span>
</span><span data-line="7"><span class="nd">@app</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;startup&quot;</span><span class="p">)</span>
</span><span data-line="8"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">startup</span><span class="p">():</span>
</span><span data-line="9">    <span class="n">app</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">rotator</span> <span class="o">=</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;round-robin&quot;</span><span class="p">)</span>
</span><span data-line="10">    <span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">rotator</span><span class="o">.</span><span class="fm">__aenter__</span><span class="p">()</span>
</span><span data-line="11">    <span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">rotator</span><span class="o">.</span><span class="n">set_strategy</span><span class="p">(</span><span class="s2">&quot;performance-based&quot;</span><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13">    <span class="c1"># Add proxies</span>
</span><span data-line="14">    <span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="15">    <span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="16">
</span><span data-line="17"><span class="nd">@app</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;shutdown&quot;</span><span class="p">)</span>
</span><span data-line="18"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">():</span>
</span><span data-line="19">    <span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">rotator</span><span class="o">.</span><span class="fm">__aexit__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="20">
</span><span data-line="21"><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/fetch&quot;</span><span class="p">)</span>
</span><span data-line="22"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_url</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span data-line="23">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">app</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="24">    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span></pre></div>
</div>
</section>
<section id="with-aiohttp">
<h3><a class="toc-backref" href="#id35" role="doc-backlink">With aiohttp</a><a class="headerlink" href="#with-aiohttp" title="Link to this heading">¶</a></h3>
<p>ProxyWhirl can work alongside aiohttp for more advanced use cases:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_with_aiohttp</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Use ProxyWhirl to select proxy, then use aiohttp for request.&quot;&quot;&quot;</span>
</span><span data-line="6">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="7">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="8">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10">        <span class="c1"># Get next proxy from pool</span>
</span><span data-line="11">        <span class="n">proxy</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
</span><span data-line="12">        <span class="n">proxy_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14">        <span class="c1"># Add credentials if present</span>
</span><span data-line="15">        <span class="k">if</span> <span class="n">proxy</span><span class="o">.</span><span class="n">username</span> <span class="ow">and</span> <span class="n">proxy</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
</span><span data-line="16">            <span class="n">username</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
</span><span data-line="17">            <span class="n">password</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">password</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
</span><span data-line="18">            <span class="n">proxy_auth</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">BasicAuth</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</span><span data-line="19">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="20">            <span class="n">proxy_auth</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="21">
</span><span data-line="22">        <span class="c1"># Use proxy with aiohttp</span>
</span><span data-line="23">        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span data-line="24">            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span data-line="25">                <span class="n">url</span><span class="p">,</span>
</span><span data-line="26">                <span class="n">proxy</span><span class="o">=</span><span class="n">proxy_url</span><span class="p">,</span>
</span><span data-line="27">                <span class="n">proxy_auth</span><span class="o">=</span><span class="n">proxy_auth</span>
</span><span data-line="28">            <span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span><span data-line="29">                <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span data-line="30">
</span><span data-line="31"><span class="c1"># Advanced: Rotate proxies with aiohttp for each request</span>
</span><span data-line="32"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_multiple_with_rotation</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
</span><span data-line="33"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch multiple URLs, rotating proxies with aiohttp.&quot;&quot;&quot;</span>
</span><span data-line="34">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;least-used&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="35">        <span class="c1"># Add proxy pool</span>
</span><span data-line="36">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="37">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="38">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy3.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="39">
</span><span data-line="40">        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="41">        <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span data-line="42">            <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
</span><span data-line="43">                <span class="c1"># Get next proxy for this request</span>
</span><span data-line="44">                <span class="n">proxy</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
</span><span data-line="45">                <span class="n">proxy_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="46">
</span><span data-line="47">                <span class="k">try</span><span class="p">:</span>
</span><span data-line="48">                    <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="n">proxy_url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
</span><span data-line="49">                        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span data-line="50">                        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">})</span>
</span><span data-line="51">
</span><span data-line="52">                        <span class="c1"># Record success</span>
</span><span data-line="53">                        <span class="n">rotator</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">record_result</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">response_time_ms</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span><span data-line="54">                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="55">                    <span class="c1"># Record failure</span>
</span><span data-line="56">                    <span class="n">rotator</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">record_result</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">response_time_ms</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span><span data-line="57">                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span data-line="58">
</span><span data-line="59">        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>While ProxyWhirl’s built-in HTTP methods use httpx, you can use the proxy selection logic with any HTTP library. Just call <code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">rotator.get_proxy()</span></code> to get the next proxy and use it with your preferred client.</p>
</div>
</section>
<section id="advanced-httpx-integration">
<h3><a class="toc-backref" href="#id36" role="doc-backlink">Advanced httpx Integration</a><a class="headerlink" href="#advanced-httpx-integration" title="Link to this heading">¶</a></h3>
<p>Since ProxyWhirl uses httpx internally, you can access advanced httpx features:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">advanced_httpx_example</span><span class="p">():</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Use ProxyWhirl&#39;s built-in methods with advanced httpx features.&quot;&quot;&quot;</span>
</span><span data-line="6">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="7">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9">        <span class="c1"># Custom headers</span>
</span><span data-line="10">        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span data-line="11">            <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
</span><span data-line="12">            <span class="n">headers</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="13">                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;Mozilla/5.0 (ProxyWhirl/1.0)&quot;</span><span class="p">,</span>
</span><span data-line="14">                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span data-line="15">                <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="s2">&quot;Bearer token123&quot;</span>
</span><span data-line="16">            <span class="p">}</span>
</span><span data-line="17">        <span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19">        <span class="c1"># Streaming responses (useful for large files)</span>
</span><span data-line="20">        <span class="c1"># Note: ProxyWhirl returns httpx.Response objects</span>
</span><span data-line="21">        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">stream_download</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span data-line="22">            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="23">
</span><span data-line="24">            <span class="c1"># Access the underlying response</span>
</span><span data-line="25">            <span class="k">async</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">aiter_bytes</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
</span><span data-line="26">                <span class="c1"># Process chunk</span>
</span><span data-line="27">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span><span class="si">}</span><span class="s2"> bytes&quot;</span><span class="p">)</span>
</span><span data-line="28">
</span><span data-line="29">        <span class="c1"># Custom timeout per request</span>
</span><span data-line="30">        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span data-line="31">            <span class="s2">&quot;https://slow-api.example.com/data&quot;</span><span class="p">,</span>
</span><span data-line="32">            <span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span>  <span class="c1"># Override default timeout</span>
</span><span data-line="33">        <span class="p">)</span>
</span><span data-line="34">
</span><span data-line="35">        <span class="c1"># Follow redirects (enabled by default)</span>
</span><span data-line="36">        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span data-line="37">            <span class="s2">&quot;https://example.com/redirect&quot;</span><span class="p">,</span>
</span><span data-line="38">            <span class="n">follow_redirects</span><span class="o">=</span><span class="kc">True</span>
</span><span data-line="39">        <span class="p">)</span>
</span><span data-line="40">
</span><span data-line="41">        <span class="c1"># Access response details</span>
</span><span data-line="42">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Status: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="43">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Headers: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="44">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Encoding: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">encoding</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="45">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;URL: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  <span class="c1"># Final URL after redirects</span>
</span><span data-line="46">
</span><span data-line="47"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">custom_httpx_client</span><span class="p">():</span>
</span><span data-line="48"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Use custom httpx client configuration with ProxyWhirl proxy selection.&quot;&quot;&quot;</span>
</span><span data-line="49">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="50">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="51">
</span><span data-line="52">        <span class="c1"># Get proxy for manual httpx usage</span>
</span><span data-line="53">        <span class="n">proxy</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
</span><span data-line="54">        <span class="n">proxy_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="55">
</span><span data-line="56">        <span class="c1"># Create custom httpx client with advanced settings</span>
</span><span data-line="57">        <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span>
</span><span data-line="58">            <span class="n">proxy</span><span class="o">=</span><span class="n">proxy_url</span><span class="p">,</span>
</span><span data-line="59">            <span class="n">timeout</span><span class="o">=</span><span class="n">httpx</span><span class="o">.</span><span class="n">Timeout</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">connect</span><span class="o">=</span><span class="mf">5.0</span><span class="p">),</span>
</span><span data-line="60">            <span class="n">limits</span><span class="o">=</span><span class="n">httpx</span><span class="o">.</span><span class="n">Limits</span><span class="p">(</span><span class="n">max_keepalive_connections</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
</span><span data-line="61">            <span class="n">http2</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Enable HTTP/2</span>
</span><span data-line="62">            <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Disable SSL verification</span>
</span><span data-line="63">        <span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
</span><span data-line="64">            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="65">            <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span><span data-line="66">
</span><span data-line="67">            <span class="c1"># Record result in ProxyWhirl&#39;s strategy</span>
</span><span data-line="68">            <span class="n">rotator</span><span class="o">.</span><span class="n">strategy</span><span class="o">.</span><span class="n">record_result</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">response_time_ms</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="with-asyncio-queue">
<h3><a class="toc-backref" href="#id37" role="doc-backlink">With asyncio.Queue</a><a class="headerlink" href="#with-asyncio-queue" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">worker</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">rotator</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Worker that processes URLs from queue.&quot;&quot;&quot;</span>
</span><span data-line="6">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span data-line="7">        <span class="n">url</span> <span class="o">=</span> <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span data-line="8">
</span><span data-line="9">        <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Sentinel for shutdown</span>
</span><span data-line="10">            <span class="k">break</span>
</span><span data-line="11">
</span><span data-line="12">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="13">            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="14">            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">})</span>
</span><span data-line="15">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="16">            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>
</span><span data-line="17">        <span class="k">finally</span><span class="p">:</span>
</span><span data-line="18">            <span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
</span><span data-line="19">
</span><span data-line="20"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span data-line="21">    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;https://httpbin.org/delay/</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">3</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>
</span><span data-line="22">    <span class="n">queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Queue</span><span class="p">()</span>
</span><span data-line="23">    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="24">
</span><span data-line="25">    <span class="c1"># Populate queue</span>
</span><span data-line="26">    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
</span><span data-line="27">        <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="28">
</span><span data-line="29">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="30">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="31">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="32">
</span><span data-line="33">        <span class="c1"># Create workers</span>
</span><span data-line="34">        <span class="n">num_workers</span> <span class="o">=</span> <span class="mi">10</span>
</span><span data-line="35">        <span class="n">workers</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="36">            <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">worker</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="n">rotator</span><span class="p">,</span> <span class="n">results</span><span class="p">))</span>
</span><span data-line="37">            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span>
</span><span data-line="38">        <span class="p">]</span>
</span><span data-line="39">
</span><span data-line="40">        <span class="c1"># Wait for all tasks to complete</span>
</span><span data-line="41">        <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span data-line="42">
</span><span data-line="43">        <span class="c1"># Stop workers</span>
</span><span data-line="44">        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_workers</span><span class="p">):</span>
</span><span data-line="45">            <span class="k">await</span> <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span data-line="46">
</span><span data-line="47">        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">workers</span><span class="p">)</span>
</span><span data-line="48">
</span><span data-line="49">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> URLs&quot;</span><span class="p">)</span>
</span><span data-line="50">
</span><span data-line="51"><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></pre></div>
</div>
</section>
</section>
<section id="comparison-async-vs-sync">
<h2><a class="toc-backref" href="#id38" role="doc-backlink">Comparison: Async vs Sync</a><a class="headerlink" href="#comparison-async-vs-sync" title="Link to this heading">¶</a></h2>
<section id="feature-parity">
<h3><a class="toc-backref" href="#id39" role="doc-backlink">Feature Parity</a><a class="headerlink" href="#feature-parity" title="Link to this heading">¶</a></h3>
<p>Both <code class="docutils literal notranslate"><span class="pre">AsyncProxyRotator</span></code> and <code class="docutils literal notranslate"><span class="pre">ProxyRotator</span></code> support:</p>
<ul class="simple">
<li><p>✅ All rotation strategies (round-robin, random, weighted, etc.)</p></li>
<li><p>✅ Retry logic with configurable backoff</p></li>
<li><p>✅ Circuit breakers for automatic failover</p></li>
<li><p>✅ Connection pooling and keep-alive</p></li>
<li><p>✅ Hot-swapping strategies</p></li>
<li><p>✅ Health monitoring and statistics</p></li>
<li><p>✅ Proxy authentication</p></li>
<li><p>✅ SSL verification control</p></li>
<li><p>✅ Custom timeouts and configuration</p></li>
</ul>
</section>
<section id="key-differences">
<h3><a class="toc-backref" href="#id40" role="doc-backlink">Key Differences</a><a class="headerlink" href="#key-differences" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Feature</p></th>
<th class="head"><p>AsyncProxyRotator</p></th>
<th class="head"><p>ProxyRotator</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Execution Model</strong></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">async</span></code>/<code class="docutils literal notranslate"><span class="pre">await</span></code></p></td>
<td><p>Synchronous</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Concurrency</strong></p></td>
<td><p>Native (asyncio)</p></td>
<td><p>Threading</p></td>
</tr>
<tr class="row-even"><td><p><strong>HTTP Client</strong></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">httpx.AsyncClient</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">httpx.Client</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><strong>Context Manager</strong></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">with</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">with</span></code></p></td>
</tr>
<tr class="row-even"><td><p><strong>Method Calls</strong></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">await</span> <span class="pre">rotator.get()</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">rotator.get()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><strong>Background Tasks</strong></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">asyncio.Event</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">threading.Timer</span></code></p></td>
</tr>
<tr class="row-even"><td><p><strong>Client Pool Lock</strong></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">asyncio.Lock</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">threading.Lock</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><strong>Best For</strong></p></td>
<td><p>I/O-bound, high concurrency</p></td>
<td><p>CPU-bound, simple scripts</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="migration-example">
<h3><a class="toc-backref" href="#id41" role="doc-backlink">Migration Example</a><a class="headerlink" href="#migration-example" title="Link to this heading">¶</a></h3>
<p>Converting sync to async is straightforward:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Sync version</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyRotator</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">with</span> <span class="n">ProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="5">    <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="6">    <span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="7">    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span></pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Async version</span>
</span><span data-line="2"><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span data-line="6">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="7">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="8">        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="9">        <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span><span data-line="10">
</span><span data-line="11"><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></pre></div>
</div>
<p>Changes required:</p>
<ol class="arabic simple">
<li><p>Add <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">asyncio</span></code></p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">ProxyRotator</span></code> → <code class="docutils literal notranslate"><span class="pre">AsyncProxyRotator</span></code></p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">with</span></code> → <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">with</span></code></p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">await</span></code> before async method calls (<code class="docutils literal notranslate"><span class="pre">add_proxy</span></code>, <code class="docutils literal notranslate"><span class="pre">get</span></code>, etc.)</p></li>
<li><p>Wrap in <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span> <span class="pre">main()</span></code> and call with <code class="docutils literal notranslate"><span class="pre">asyncio.run(main())</span></code></p></li>
</ol>
</section>
</section>
<section id="best-practices-and-common-patterns">
<h2><a class="toc-backref" href="#id42" role="doc-backlink">Best Practices and Common Patterns</a><a class="headerlink" href="#best-practices-and-common-patterns" title="Link to this heading">¶</a></h2>
<section id="always-use-context-managers">
<h3><a class="toc-backref" href="#id43" role="doc-backlink">1. Always Use Context Managers</a><a class="headerlink" href="#always-use-context-managers" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># ✅ GOOD: Automatic cleanup</span>
</span><span data-line="2"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="3">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="4">    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># ❌ BAD: Manual cleanup required, easy to forget</span>
</span><span data-line="7"><span class="n">rotator</span> <span class="o">=</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span>
</span><span data-line="8"><span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="fm">__aenter__</span><span class="p">()</span>
</span><span data-line="9"><span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="10"><span class="c1"># Forgot to call __aexit__! Resources leaked!</span>
</span></pre></div>
</div>
</section>
<section id="use-semaphores-for-concurrency-control">
<h3><a class="toc-backref" href="#id44" role="doc-backlink">2. Use Semaphores for Concurrency Control</a><a class="headerlink" href="#use-semaphores-for-concurrency-control" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># ✅ GOOD: Controlled concurrency</span>
</span><span data-line="2"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">scrape_urls</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
</span><span data-line="3">    <span class="n">semaphore</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Semaphore</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>  <span class="c1"># Max 50 concurrent requests</span>
</span><span data-line="4">
</span><span data-line="5">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_with_limit</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span data-line="6">        <span class="k">async</span> <span class="k">with</span> <span class="n">semaphore</span><span class="p">:</span>
</span><span data-line="7">            <span class="k">return</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="10">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="11">        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">fetch_with_limit</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
</span><span data-line="12">        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14"><span class="c1"># ❌ BAD: Unbounded concurrency can crash your program</span>
</span><span data-line="15"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">scrape_urls_bad</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
</span><span data-line="16">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="17">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="18">        <span class="c1"># Creating 10,000 tasks at once! Memory explosion!</span>
</span><span data-line="19">        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
</span><span data-line="20">        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="handle-exceptions-gracefully">
<h3><a class="toc-backref" href="#id45" role="doc-backlink">3. Handle Exceptions Gracefully</a><a class="headerlink" href="#handle-exceptions-gracefully" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># ✅ GOOD: Per-request error handling with gather</span>
</span><span data-line="2"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_all</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
</span><span data-line="3">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="4">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="5">
</span><span data-line="6">        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">safe_fetch</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span data-line="7">            <span class="k">try</span><span class="p">:</span>
</span><span data-line="8">                <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">)</span>
</span><span data-line="9">                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()}</span>
</span><span data-line="10">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="11">                <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>
</span><span data-line="12">
</span><span data-line="13">        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">safe_fetch</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
</span><span data-line="14">        <span class="c1"># return_exceptions=True keeps going even if some fail</span>
</span><span data-line="15">        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="16">
</span><span data-line="17"><span class="c1"># ❌ BAD: One failure stops everything</span>
</span><span data-line="18"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_all_bad</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
</span><span data-line="19">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="20">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="21">        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">]</span>
</span><span data-line="22">        <span class="c1"># First exception stops all other tasks!</span>
</span><span data-line="23">        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="reuse-rotator-instances">
<h3><a class="toc-backref" href="#id46" role="doc-backlink">4. Reuse Rotator Instances</a><a class="headerlink" href="#reuse-rotator-instances" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># ✅ GOOD: Single rotator for entire application</span>
</span><span data-line="2"><span class="k">class</span><span class="w"> </span><span class="nc">Application</span><span class="p">:</span>
</span><span data-line="3">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="4">        <span class="bp">self</span><span class="o">.</span><span class="n">rotator</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="5">
</span><span data-line="6">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">startup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="7">        <span class="bp">self</span><span class="o">.</span><span class="n">rotator</span> <span class="o">=</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;round-robin&quot;</span><span class="p">)</span>
</span><span data-line="8">        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotator</span><span class="o">.</span><span class="fm">__aenter__</span><span class="p">()</span>
</span><span data-line="9">        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotator</span><span class="o">.</span><span class="n">set_strategy</span><span class="p">(</span><span class="s2">&quot;performance-based&quot;</span><span class="p">)</span>
</span><span data-line="10">        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="11">        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="14">        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotator</span><span class="o">.</span><span class="fm">__aexit__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span><span data-line="17">        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19"><span class="c1"># ❌ BAD: Creating new rotator for each request</span>
</span><span data-line="20"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_bad</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span data-line="21">    <span class="c1"># Expensive: creates new clients, circuit breakers, metrics every time!</span>
</span><span data-line="22">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="23">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="24">        <span class="k">return</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="monitor-circuit-breaker-states">
<h3><a class="toc-backref" href="#id47" role="doc-backlink">5. Monitor Circuit Breaker States</a><a class="headerlink" href="#monitor-circuit-breaker-states" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># ✅ GOOD: Check circuit breakers periodically</span>
</span><span data-line="2"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">health_check_task</span><span class="p">(</span><span class="n">rotator</span><span class="p">):</span>
</span><span data-line="3"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Background task to monitor proxy health.&quot;&quot;&quot;</span>
</span><span data-line="4">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span data-line="5">        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>  <span class="c1"># Check every minute</span>
</span><span data-line="6">
</span><span data-line="7">        <span class="n">states</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_circuit_breaker_states</span><span class="p">()</span>
</span><span data-line="8">        <span class="n">open_breakers</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="9">            <span class="n">proxy_id</span> <span class="k">for</span> <span class="n">proxy_id</span><span class="p">,</span> <span class="n">cb</span> <span class="ow">in</span> <span class="n">states</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span data-line="10">            <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;OPEN&quot;</span>
</span><span data-line="11">        <span class="p">]</span>
</span><span data-line="12">
</span><span data-line="13">        <span class="k">if</span> <span class="n">open_breakers</span><span class="p">:</span>
</span><span data-line="14">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">open_breakers</span><span class="p">)</span><span class="si">}</span><span class="s2"> proxies have open circuit breakers&quot;</span><span class="p">)</span>
</span><span data-line="15">            <span class="c1"># Optional: Remove unhealthy proxies</span>
</span><span data-line="16">            <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">clear_unhealthy_proxies</span><span class="p">()</span>
</span><span data-line="17">
</span><span data-line="18"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span data-line="19">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="20">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22">        <span class="c1"># Start background health monitoring</span>
</span><span data-line="23">        <span class="n">health_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">health_check_task</span><span class="p">(</span><span class="n">rotator</span><span class="p">))</span>
</span><span data-line="24">
</span><span data-line="25">        <span class="c1"># Do your work...</span>
</span><span data-line="26">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="27">
</span><span data-line="28">        <span class="c1"># Cleanup</span>
</span><span data-line="29">        <span class="n">health_task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</span></pre></div>
</div>
</section>
<section id="use-appropriate-retry-policies">
<h3><a class="toc-backref" href="#id48" role="doc-backlink">6. Use Appropriate Retry Policies</a><a class="headerlink" href="#use-appropriate-retry-policies" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># ✅ GOOD: Different retry policies for different endpoints</span>
</span><span data-line="2"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="3">    <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="4">
</span><span data-line="5">    <span class="c1"># Critical endpoint: More aggressive retries</span>
</span><span data-line="6">    <span class="n">critical_policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span><span class="n">max_attempts</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">base_delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
</span><span data-line="7">    <span class="n">critical_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span data-line="8">        <span class="s2">&quot;https://api.example.com/critical&quot;</span><span class="p">,</span>
</span><span data-line="9">        <span class="n">retry_policy</span><span class="o">=</span><span class="n">critical_policy</span>
</span><span data-line="10">    <span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12">    <span class="c1"># Non-critical: Fail fast</span>
</span><span data-line="13">    <span class="n">fast_fail_policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span><span class="n">max_attempts</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">base_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span data-line="14">    <span class="n">optional_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span data-line="15">        <span class="s2">&quot;https://api.example.com/optional&quot;</span><span class="p">,</span>
</span><span data-line="16">        <span class="n">retry_policy</span><span class="o">=</span><span class="n">fast_fail_policy</span>
</span><span data-line="17">    <span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="profile-and-optimize-connection-pooling">
<h3><a class="toc-backref" href="#id49" role="doc-backlink">7. Profile and Optimize Connection Pooling</a><a class="headerlink" href="#profile-and-optimize-connection-pooling" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># ✅ GOOD: Configure pool limits based on your workload</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncProxyRotator</span><span class="p">,</span> <span class="n">ProxyConfiguration</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># For high-throughput scraping (many concurrent requests)</span>
</span><span data-line="5"><span class="n">high_throughput_config</span> <span class="o">=</span> <span class="n">ProxyConfiguration</span><span class="p">(</span>
</span><span data-line="6">    <span class="n">pool_connections</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>      <span class="c1"># More concurrent connections</span>
</span><span data-line="7">    <span class="n">pool_max_keepalive</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>     <span class="c1"># More keep-alive connections</span>
</span><span data-line="8">    <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
</span><span data-line="9"><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">high_throughput_config</span><span class="p">)</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="12">    <span class="c1"># Can handle 100+ concurrent requests efficiently</span>
</span><span data-line="13">    <span class="k">pass</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># For low-latency API calls (fewer but faster requests)</span>
</span><span data-line="16"><span class="n">low_latency_config</span> <span class="o">=</span> <span class="n">ProxyConfiguration</span><span class="p">(</span>
</span><span data-line="17">    <span class="n">pool_connections</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>       <span class="c1"># Fewer connections</span>
</span><span data-line="18">    <span class="n">pool_max_keepalive</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>     <span class="c1"># Fewer keep-alive</span>
</span><span data-line="19">    <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>                 <span class="c1"># Shorter timeout</span>
</span><span data-line="20"><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22"><span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">low_latency_config</span><span class="p">)</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="23">    <span class="c1"># Optimized for speed, not throughput</span>
</span><span data-line="24">    <span class="k">pass</span>
</span></pre></div>
</div>
</section>
<section id="use-strategy-hot-swapping-for-adaptive-behavior">
<h3><a class="toc-backref" href="#id50" role="doc-backlink">8. Use Strategy Hot-Swapping for Adaptive Behavior</a><a class="headerlink" href="#use-strategy-hot-swapping-for-adaptive-behavior" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># ✅ GOOD: Adapt strategy based on performance</span>
</span><span data-line="2"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">adaptive_scraping</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
</span><span data-line="3">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;round-robin&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="4">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="5">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7">        <span class="c1"># Start with round-robin</span>
</span><span data-line="8">        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="9">        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
</span><span data-line="10">            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="11">            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13">            <span class="c1"># Switch to performance-based after collecting data</span>
</span><span data-line="14">            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">50</span><span class="p">:</span>
</span><span data-line="15">                <span class="n">stats</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_pool_stats</span><span class="p">()</span>
</span><span data-line="16">                <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;average_success_rate&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">:</span>
</span><span data-line="17">                    <span class="n">rotator</span><span class="o">.</span><span class="n">set_strategy</span><span class="p">(</span><span class="s2">&quot;performance-based&quot;</span><span class="p">)</span>
</span><span data-line="18">                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Switched to performance-based strategy&quot;</span><span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20">        <span class="k">return</span> <span class="n">results</span>
</span></pre></div>
</div>
</section>
<section id="clean-up-resources-properly">
<h3><a class="toc-backref" href="#id51" role="doc-backlink">9. Clean Up Resources Properly</a><a class="headerlink" href="#clean-up-resources-properly" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># ✅ GOOD: Clean up unhealthy proxies periodically</span>
</span><span data-line="2"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">periodic_cleanup</span><span class="p">(</span><span class="n">rotator</span><span class="p">):</span>
</span><span data-line="3"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Background task to clean up failed proxies.&quot;&quot;&quot;</span>
</span><span data-line="4">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span data-line="5">        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>  <span class="c1"># Every 5 minutes</span>
</span><span data-line="6">
</span><span data-line="7">        <span class="n">removed</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">clear_unhealthy_proxies</span><span class="p">()</span>
</span><span data-line="8">        <span class="k">if</span> <span class="n">removed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="9">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleaned up </span><span class="si">{</span><span class="n">removed</span><span class="si">}</span><span class="s2"> unhealthy proxies&quot;</span><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11">            <span class="c1"># Get fresh statistics</span>
</span><span data-line="12">            <span class="n">stats</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_pool_stats</span><span class="p">()</span>
</span><span data-line="13">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pool now has </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;healthy_proxies&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> healthy proxies&quot;</span><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span data-line="16">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="17">        <span class="c1"># Add proxies</span>
</span><span data-line="18">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="19">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="20">
</span><span data-line="21">        <span class="c1"># Start cleanup task</span>
</span><span data-line="22">        <span class="n">cleanup_task</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">periodic_cleanup</span><span class="p">(</span><span class="n">rotator</span><span class="p">))</span>
</span><span data-line="23">
</span><span data-line="24">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="25">            <span class="c1"># Do work...</span>
</span><span data-line="26">            <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="27">        <span class="k">finally</span><span class="p">:</span>
</span><span data-line="28">            <span class="n">cleanup_task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</span><span data-line="29">            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">cleanup_task</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="avoid-common-pitfalls">
<h3><a class="toc-backref" href="#id52" role="doc-backlink">10. Avoid Common Pitfalls</a><a class="headerlink" href="#avoid-common-pitfalls" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># ❌ COMMON PITFALL 1: Blocking operations in async code</span>
</span><span data-line="2"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">bad_example</span><span class="p">():</span>
</span><span data-line="3">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="4">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="5">
</span><span data-line="6">        <span class="c1"># BAD: time.sleep blocks the event loop!</span>
</span><span data-line="7">        <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span data-line="8">        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Use asyncio.sleep(1) instead</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># ❌ COMMON PITFALL 2: Not awaiting async operations</span>
</span><span data-line="11"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">bad_example2</span><span class="p">():</span>
</span><span data-line="12">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="13">        <span class="c1"># BAD: Forgot to await! This creates a coroutine but doesn&#39;t run it!</span>
</span><span data-line="14">        <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16">        <span class="c1"># Should be: await rotator.add_proxy(...)</span>
</span><span data-line="17">
</span><span data-line="18"><span class="c1"># ❌ COMMON PITFALL 3: Creating too many rotator instances</span>
</span><span data-line="19"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">bad_example3</span><span class="p">():</span>
</span><span data-line="20">    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;https://example.com&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</span><span data-line="21">
</span><span data-line="22">    <span class="c1"># BAD: Creates 100 rotator instances, wastes resources!</span>
</span><span data-line="23">    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
</span><span data-line="24">        <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="25">            <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="26">            <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="27">
</span><span data-line="28">    <span class="c1"># GOOD: Reuse single rotator instance</span>
</span><span data-line="29">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="30">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="31">        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
</span><span data-line="32">            <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span data-line="33">
</span><span data-line="34"><span class="c1"># ❌ COMMON PITFALL 4: Ignoring circuit breaker states</span>
</span><span data-line="35"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">bad_example4</span><span class="p">():</span>
</span><span data-line="36">    <span class="k">async</span> <span class="k">with</span> <span class="n">AsyncProxyRotator</span><span class="p">()</span> <span class="k">as</span> <span class="n">rotator</span><span class="p">:</span>
</span><span data-line="37">        <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="s2">&quot;http://bad-proxy.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="38">
</span><span data-line="39">        <span class="c1"># BAD: Keeps trying even after circuit breaker opens</span>
</span><span data-line="40">        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
</span><span data-line="41">            <span class="k">try</span><span class="p">:</span>
</span><span data-line="42">                <span class="k">await</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="43">            <span class="k">except</span><span class="p">:</span>
</span><span data-line="44">                <span class="k">pass</span>  <span class="c1"># Silently failing, doesn&#39;t check breaker state</span>
</span><span data-line="45">
</span><span data-line="46">        <span class="c1"># GOOD: Monitor circuit breaker states</span>
</span><span data-line="47">        <span class="n">states</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_circuit_breaker_states</span><span class="p">()</span>
</span><span data-line="48">        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;OPEN&quot;</span> <span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="n">states</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
</span><span data-line="49">            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All circuit breakers open, stopping requests&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="see-also">
<h2><a class="toc-backref" href="#id53" role="doc-backlink">See Also</a><a class="headerlink" href="#see-also" title="Link to this heading">¶</a></h2>
<div class="sd-container-fluid sd-sphinx-override sd-mb-4 docutils">
<div class="sd-row sd-row-cols-2 sd-row-cols-xs-2 sd-row-cols-sm-2 sd-row-cols-md-2 sd-row-cols-lg-2 sd-g-3 sd-g-xs-3 sd-g-sm-3 sd-g-md-3 sd-g-lg-3 docutils">
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Advanced Strategies</div>
<p class="sd-card-text">Performance-based, geo-targeted, session persistence, and composite strategy patterns.</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference internal" href="advanced-strategies.html"><span class="doc">Advanced Rotation Strategies</span></a></div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Retry &amp; Failover</div>
<p class="sd-card-text">Circuit breakers, backoff strategies, and intelligent proxy failover.</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference internal" href="retry-failover.html"><span class="doc">Retry &amp; Failover Guide</span></a></div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Caching Subsystem</div>
<p class="sd-card-text">Three-tier caching architecture, encryption, and performance tuning.</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference internal" href="caching.html"><span class="doc">Caching Subsystem Guide</span></a></div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
CLI Reference</div>
<p class="sd-card-text">Command-line proxy management, health checks, and data export.</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference internal" href="cli-reference.html"><span class="doc">CLI Reference</span></a></div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
MCP Server</div>
<p class="sd-card-text">AI assistant integration via the Model Context Protocol.</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference internal" href="mcp-server.html"><span class="doc">MCP Server Guide</span></a></div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
REST API Reference</div>
<p class="sd-card-text">Full REST API documentation for the ProxyWhirl HTTP server.</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference internal" href="../reference/rest-api.html"><span class="doc">ProxyWhirl REST API Usage Guide</span></a></div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Python API Reference</div>
<p class="sd-card-text">Complete Python API docs for <code class="docutils literal notranslate"><span class="pre">AsyncProxyRotator</span></code>, <code class="docutils literal notranslate"><span class="pre">ProxyRotator</span></code>, and all models.</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference internal" href="../reference/python-api.html"><span class="doc">Python API Reference</span></a></div>
</div>
<div class="sd-col sd-d-flex-row docutils">
<div class="sd-card sd-sphinx-override sd-w-100 sd-shadow-sm sd-card-hover docutils">
<div class="sd-card-body docutils">
<div class="sd-card-title sd-font-weight-bold docutils">
Rotation Strategies Overview</div>
<p class="sd-card-text">Getting started with basic rotation strategies and selection.</p>
</div>
<a class="sd-stretched-link sd-hide-link-text reference internal" href="../getting-started/rotation-strategies.html"><span class="doc">Rotation Strategies</span></a></div>
</div>
</div>
</div>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="index.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Guides</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="advanced-strategies.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Advanced Rotation Strategies</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2026, Wyatt Walsh</p>
  
  <p>
    Made with
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/wyattowalsh/proxywhirl" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=a58bc63e"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=cac61aee"></script></body>
</html>