<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Retry &amp; Failover Guide - ProxyWhirl Documentation</title><link rel="shortcut icon" href="../_static/favicon.svg"/><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Deployment Security &amp; Reverse Proxy Configuration" href="deployment-security.html" /><link rel="prev" title="Caching Subsystem Guide" href="caching.html" />
      <link rel="canonical" href="https://proxywhirl.readthedocs.io/guides/retry-failover.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=44020203" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=de968d75" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://proxywhirl.readthedocs.io/guides/retry-failover.html"/>
  <meta property="og:title" content="Retry &amp; Failover Guide"/>
  <meta property="og:image" content="https://proxywhirl.readthedocs.io/_static/og-image.png"/>
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:creator" content="@@wyaborern"/>
<meta name="twitter:site" content="@@wyaborern"/>
  </head>
<body>
<header class="pw-navbar">
  <div class="pw-navbar-inner">
    
    <button class="pw-navbar-sidebar-toggle js-menu" aria-controls="lside" aria-expanded="false" aria-label="Toggle navigation" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
    </button>

    
    <a href="/" class="pw-navbar-brand">
      <svg class="pw-navbar-logo" viewBox="0 0 100 100" aria-hidden="true">
        <defs>
          <linearGradient id="pw-logo-grad" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#06b6d4"/>
            <stop offset="50%" stop-color="#3b82f6"/>
            <stop offset="100%" stop-color="#8b5cf6"/>
          </linearGradient>
        </defs>
        <circle cx="50" cy="50" r="44" fill="none" stroke="url(#pw-logo-grad)" stroke-width="6" stroke-linecap="round" stroke-dasharray="60 30"/>
        <g fill="url(#pw-logo-grad)">
          <path d="M50 18 L58 30 L52 30 L52 42 L48 42 L48 30 L42 30 Z"/>
          <path d="M82 50 L70 58 L70 52 L58 52 L58 48 L70 48 L70 42 Z"/>
          <path d="M50 82 L42 70 L48 70 L48 58 L52 58 L52 70 L58 70 Z"/>
          <path d="M18 50 L30 42 L30 48 L42 48 L42 52 L30 52 L30 58 Z"/>
        </g>
        <circle cx="50" cy="50" r="8" fill="url(#pw-logo-grad)"/>
      </svg>
      <strong>ProxyWhirl</strong>
    </a>

    
    <nav class="pw-navbar-links">
      <a href="/docs/" class="pw-navbar-link active">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        Docs
      </a>
    </nav>

    
    <div class="pw-navbar-actions">
      
      <button class="pw-navbar-btn" id="pw-theme-toggle" type="button" aria-label="Toggle theme">
        <svg class="pw-icon-sun" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
        <svg class="pw-icon-moon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
      </button>

      
      <a href="https://github.com/wyattowalsh/proxywhirl" class="pw-navbar-btn pw-navbar-github" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"/><path d="M9 18c-4.51 2-5-2-7-2"/></svg>
      </a>
    </div>
  </div>
</header>

<script>
(function() {
  var toggle = document.getElementById('pw-theme-toggle');
  if (!toggle) return;
  toggle.addEventListener('click', function() {
    var isDark = document.documentElement.classList.contains('dark');
    var next = isDark ? 'light' : 'dark';
    localStorage._theme = next;
    if (typeof setColorMode === 'function') {
      setColorMode(next);
    } else {
      var html = document.documentElement;
      html.classList.remove('dark', 'light');
      html.classList.add(next);
      html.setAttribute('data-color-mode', next);
    }
  });
})();
</script>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="2"><ul class="current">
<li class="toctree-l1 _expand"><a class="reference internal" href="../getting-started/index.html">Getting Started</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#installation">Installation</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#quick-start">Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#async-usage">Async Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.html#using-free-proxy-lists">Using Free Proxy Lists</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#rotation-strategies">Rotation Strategies</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#next-steps">Next Steps</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/index.html#for-contributors">For Contributors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/rotation-strategies.html">Rotation Strategies Quickstart</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#bootstrap-a-rotator">Bootstrap a rotator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#strategy-selector">Strategy selector</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#strategy-recipes">Strategy recipes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#observe-the-pool">Observe the pool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting-started/rotation-strategies.html#advanced-strategies-preview">Advanced strategies (preview)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../getting-started/rotation-strategies.html">Rotation Strategies Quickstart</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/rotation-strategies.html#bootstrap-a-rotator">Bootstrap a rotator</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/rotation-strategies.html#strategy-selector">Strategy selector</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/rotation-strategies.html#strategy-recipes">Strategy recipes</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/rotation-strategies.html#observe-the-pool">Observe the pool</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../getting-started/rotation-strategies.html#advanced-strategies-preview">Advanced strategies (preview)</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Guides</a><ul class="current">
<li class="toctree-l2 _expand"><a class="reference internal" href="async-client.html">Async Client Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="async-client.html#when-to-use-async-vs-sync">When to Use Async vs Sync</a><ul>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#use-asyncproxyrotator-when">Use AsyncProxyRotator when:</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#use-proxyrotator-sync-when">Use ProxyRotator (sync) when:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="async-client.html#initialization">Initialization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#basic-initialization">Basic Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#with-initial-proxies">With Initial Proxies</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#with-custom-strategy">With Custom Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#with-custom-configuration">With Custom Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="async-client.html#context-manager-usage">Context Manager Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#async-context-manager-recommended">Async Context Manager (Recommended)</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#manual-lifecycle-management-advanced">Manual Lifecycle Management (Advanced)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="async-client.html#http-request-methods">HTTP Request Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#all-http-methods">All HTTP Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#request-parameters">Request Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="async-client.html#proxy-management">Proxy Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#adding-proxies">Adding Proxies</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#removing-proxies">Removing Proxies</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#getting-proxy-statistics">Getting Proxy Statistics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="async-client.html#hot-swapping-strategies">Hot-Swapping Strategies</a></li>
<li class="toctree-l3"><a class="reference internal" href="async-client.html#error-handling">Error Handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#basic-exception-handling">Basic Exception Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#retry-policy-override">Retry Policy Override</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#circuit-breaker-management">Circuit Breaker Management</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="async-client.html#concurrent-requests-with-asyncio-gather">Concurrent Requests with asyncio.gather</a><ul>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#parallel-requests-to-different-urls">Parallel Requests to Different URLs</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#rate-limited-concurrent-scraping">Rate-Limited Concurrent Scraping</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#production-scale-web-scraping">Production-Scale Web Scraping</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="async-client.html#performance-considerations">Performance Considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#connection-pooling">Connection Pooling</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#connection-limits">Connection Limits</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#memory-management">Memory Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#performance-benchmarks">Performance Benchmarks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="async-client.html#asyncio-integration-patterns">Asyncio Integration Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#with-fastapi">With FastAPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#with-aiohttp">With aiohttp</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#advanced-httpx-integration">Advanced httpx Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#with-asyncio-queue">With asyncio.Queue</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="async-client.html#comparison-async-vs-sync">Comparison: Async vs Sync</a><ul>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#feature-parity">Feature Parity</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#key-differences">Key Differences</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#migration-example">Migration Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="async-client.html#best-practices-and-common-patterns">Best Practices and Common Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#always-use-context-managers">1. Always Use Context Managers</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#use-semaphores-for-concurrency-control">2. Use Semaphores for Concurrency Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#handle-exceptions-gracefully">3. Handle Exceptions Gracefully</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#reuse-rotator-instances">4. Reuse Rotator Instances</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#monitor-circuit-breaker-states">5. Monitor Circuit Breaker States</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#use-appropriate-retry-policies">6. Use Appropriate Retry Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#profile-and-optimize-connection-pooling">7. Profile and Optimize Connection Pooling</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#use-strategy-hot-swapping-for-adaptive-behavior">8. Use Strategy Hot-Swapping for Adaptive Behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#clean-up-resources-properly">9. Clean Up Resources Properly</a></li>
<li class="toctree-l4"><a class="reference internal" href="async-client.html#avoid-common-pitfalls">10. Avoid Common Pitfalls</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="async-client.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="advanced-strategies.html">Advanced Rotation Strategies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#overview">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#available-strategies">Available Strategies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#performance-based-strategy">Performance-Based Strategy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#when-to-use">When to Use</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#performance-characteristics">Performance Characteristics</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#how-it-works">How It Works</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#warmup-period">Warmup Period</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#adaptation-example">Adaptation Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#success-criteria">Success Criteria</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#session-persistence-strategy">Session Persistence Strategy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id1">When to Use</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id2">Performance Characteristics</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id3">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#session-lifecycle">Session Lifecycle</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#session-management">Session Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#failover-behavior">Failover Behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#ttl-and-expiration">TTL and Expiration</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#lru-eviction">LRU Eviction</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id4">Success Criteria</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#geo-targeted-strategy">Geo-Targeted Strategy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id5">When to Use</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id6">Performance Characteristics</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id7">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#country-codes">Country Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#filtering-logic">Filtering Logic</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#fallback-modes">Fallback Modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#secondary-selection-strategies">Secondary Selection Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#retry-integration">Retry Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id8">Success Criteria</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#cost-aware-strategy">Cost-Aware Strategy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id9">When to Use</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id10">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#weight-calculation">Weight Calculation</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#cost-threshold-filtering">Cost Threshold Filtering</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#best-practices">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#composite-strategy">Composite Strategy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id11">When to Use</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id12">Performance Characteristics</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#architecture">Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#basic-composition">Basic Composition</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#common-patterns">Common Patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#configuration-from-dict">Configuration from Dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#validation-example">Validation Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#performance-considerations">Performance Considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id13">Success Criteria</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#strategy-registry">Strategy Registry</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#registration">Registration</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#validation">Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#thread-safety">Thread Safety</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#listing-strategies">Listing Strategies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#selectioncontext">SelectionContext</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#fields">Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#usage-with-strategies">Usage with Strategies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#strategyconfig">StrategyConfig</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id14">Fields</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#per-strategy-configuration">Per-Strategy Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#custom-strategy-implementation">Custom Strategy Implementation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#implementing-the-protocol">Implementing the Protocol</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#registering-custom-strategies">Registering Custom Strategies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#strategyregistry-usage">StrategyRegistry Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#registration-and-validation">Registration and Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#strategy-validation">Strategy Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id15">Thread Safety</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#unregistering-strategies">Unregistering Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#testing-with-registry-reset">Testing with Registry Reset</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#performance-requirements">Performance Requirements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#id16">Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#choose-the-right-strategy">1. Choose the Right Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#warm-up-performance-based-strategies">2. Warm Up Performance-Based Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#monitor-session-memory">3. Monitor Session Memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#use-selectioncontext-consistently">4. Use SelectionContext Consistently</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#validate-geo-data-availability">5. Validate Geo Data Availability</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#proxypoolemptyerror-no-proxies-with-ema-data">ProxyPoolEmptyError: No proxies with EMA data</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#sessionpersistencestrategy-requires-selectioncontext-with-session-id">SessionPersistenceStrategy requires SelectionContext with session_id</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#geo-targeting-returns-unexpected-proxies">Geo-targeting returns unexpected proxies</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#composite-strategy-too-slow">Composite strategy too slow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#testing-strategies">Testing Strategies</a></li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#performance-benchmarks">Performance Benchmarks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#selection-time">Selection Time</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#memory-usage">Memory Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="advanced-strategies.html#id17">Success Criteria</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="advanced-strategies.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="caching.html">Caching Subsystem Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="caching.html#architecture-overview">Architecture Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="caching.html#tier-promotion-demotion">Tier Promotion &amp; Demotion</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#l2-vs-l3-sqlite-differences">L2 vs L3 SQLite Differences</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="caching.html#core-components">Core Components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="caching.html#cachemanager">CacheManager</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#cacheentry">CacheEntry</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#cacheconfig">CacheConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#cachestatistics">CacheStatistics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="caching.html#credential-encryption">Credential Encryption</a><ul>
<li class="toctree-l4"><a class="reference internal" href="caching.html#encryption-setup">Encryption Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#key-rotation">Key Rotation</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#encryption-behavior">Encryption Behavior</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="caching.html#ttl-and-expiration">TTL and Expiration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="caching.html#ttl-configuration">TTL Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#expiration-strategies">Expiration Strategies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="caching.html#health-invalidation">Health Invalidation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="caching.html#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#invalidation-workflow">Invalidation Workflow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="caching.html#migration-from-jsonl-l2-cache">Migration from JSONL L2 Cache</a><ul>
<li class="toctree-l4"><a class="reference internal" href="caching.html#migrating-legacy-jsonl-caches">Migrating Legacy JSONL Caches</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="caching.html#cache-warming">Cache Warming</a><ul>
<li class="toctree-l4"><a class="reference internal" href="caching.html#supported-formats">Supported Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#warming-from-file">Warming from File</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="caching.html#performance-tuning">Performance Tuning</a><ul>
<li class="toctree-l4"><a class="reference internal" href="caching.html#tier-sizing-recommendations">Tier Sizing Recommendations</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#eviction-policy-selection">Eviction Policy Selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#performance-characteristics">Performance Characteristics</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#graceful-degradation">Graceful Degradation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="caching.html#cli-integration">CLI Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="caching.html#best-practices">Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="caching.html#security">Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#performance">Performance</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#reliability">Reliability</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="caching.html#example-complete-cache-setup">Example: Complete Cache Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="caching.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="caching.html#low-hit-rates">Low Hit Rates</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#high-memory-usage">High Memory Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#encryption-errors">Encryption Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="caching.html#tier-degradation">Tier Degradation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="caching.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Retry &amp; Failover Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#architecture-overview">Architecture Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#when-to-use-retry-vs-failover">When to Use Retry vs Failover</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#retry-same-proxy">Retry (Same Proxy)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#failover-different-proxy">Failover (Different Proxy)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#retrypolicy-configuration">RetryPolicy Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-configuration">Basic Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#backoff-strategies">Backoff Strategies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#jitter-explained">Jitter Explained</a></li>
<li class="toctree-l4"><a class="reference internal" href="#retryable-status-codes">Retryable Status Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#timeout-behavior">Timeout Behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="#non-idempotent-requests">Non-Idempotent Requests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#circuit-breaker-configuration">Circuit Breaker Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#sync-vs-async-circuit-breakers">Sync vs Async Circuit Breakers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#state-machine">State Machine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#thresholds-and-configuration">Thresholds and Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#circuit-breaker-persistence">Circuit Breaker Persistence</a></li>
<li class="toctree-l4"><a class="reference internal" href="#state-transitions">State Transitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rolling-window-behavior">Rolling Window Behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manual-reset">Manual Reset</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#intelligent-proxy-selection">Intelligent Proxy Selection</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#selection-algorithm">Selection Algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-performance-based-selection">Example: Performance-Based Selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-geo-targeted-selection">Example: Geo-Targeted Selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exclusion-rules">Exclusion Rules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#retrymetrics-and-observability">RetryMetrics and Observability</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#collecting-metrics">Collecting Metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#summary-statistics">Summary Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#time-series-data">Time-Series Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#per-proxy-statistics">Per-Proxy Statistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#circuit-breaker-events">Circuit Breaker Events</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hourly-aggregation">Hourly Aggregation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#retention-configuration">Retention Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#retryexecutor-deep-dive">RetryExecutor Deep Dive</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#how-retries-work-internally">How Retries Work Internally</a></li>
<li class="toctree-l4"><a class="reference internal" href="#retryable-vs-non-retryable-errors">Retryable vs Non-Retryable Errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="#direct-retryexecutor-usage">Direct RetryExecutor Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#integration-with-proxyrotator">Integration with ProxyRotator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#custom-error-handling">Custom Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monitoring-circuit-breakers">Monitoring Circuit Breakers</a></li>
<li class="toctree-l4"><a class="reference internal" href="#manual-circuit-reset">Manual Circuit Reset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#integration-with-rotation-strategies">Integration with Rotation Strategies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-patterns">Advanced Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adaptive-retry-policy">Adaptive Retry Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#circuit-breaker-alerts">Circuit Breaker Alerts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#request-level-retry-override">Request-Level Retry Override</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#best-practices">Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#start-conservative-tune-later">1. Start Conservative, Tune Later</a></li>
<li class="toctree-l4"><a class="reference internal" href="#always-use-jitter-in-production">2. Always Use Jitter in Production</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monitor-circuit-breaker-opens">3. Monitor Circuit Breaker Opens</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-timeouts-for-time-sensitive-requests">4. Set Timeouts for Time-Sensitive Requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="#use-metrics-for-capacity-planning">5. Use Metrics for Capacity Planning</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#all-retries-exhausted">All Retries Exhausted</a></li>
<li class="toctree-l4"><a class="reference internal" href="#high-latency">High Latency</a></li>
<li class="toctree-l4"><a class="reference internal" href="#non-retryable-errors">Non-Retryable Errors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#performance-impact">Performance Impact</a></li>
<li class="toctree-l3"><a class="reference internal" href="#related-documentation">Related Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="deployment-security.html">Deployment Security &amp; Reverse Proxy Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="deployment-security.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="deployment-security.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="deployment-security.html#x-forwarded-for-security">X-Forwarded-For Security</a><ul>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#the-attack">The Attack</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#the-defense">The Defense</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="deployment-security.html#reverse-proxy-configurations">Reverse Proxy Configurations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#nginx">Nginx</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#caddy">Caddy</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#haproxy">HAProxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#traefik">Traefik</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#aws-application-load-balancer">AWS Application Load Balancer</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#google-cloud-load-balancer">Google Cloud Load Balancer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="deployment-security.html#proxywhirl-configuration">ProxyWhirl Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#reading-client-ip-from-headers">Reading Client IP from Headers</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#docker-compose-example">Docker Compose Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="deployment-security.html#security-checklist">Security Checklist</a></li>
<li class="toctree-l3"><a class="reference internal" href="deployment-security.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#rate-limiting-not-working">Rate Limiting Not Working</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#metrics-showing-wrong-client-ips">Metrics Showing Wrong Client IPs</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#connection-refused-behind-reverse-proxy">Connection Refused Behind Reverse Proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#ssl-certificate-errors">SSL Certificate Errors</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="deployment-security.html#references">References</a><ul>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#security-standards">Security Standards</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#reverse-proxy-documentation">Reverse Proxy Documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="deployment-security.html#cloud-documentation">Cloud Documentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="cli-reference.html">CLI Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cli-reference.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli-reference.html#global-options">Global Options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#config-auto-discovery">Config Auto-Discovery</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cli-reference.html#commands">Commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#request">request</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#pool">pool</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#config">config</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#health">health</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#fetch">fetch</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#export">export</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#setup-geoip">setup-geoip</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#sources">sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#stats">stats</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cli-reference.html#output-formats">Output Formats</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#text-default">Text (default)</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#json">JSON</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#csv">CSV</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cli-reference.html#configuration-file">Configuration File</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli-reference.html#advanced-usage">Advanced Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#scripting-with-json-output">Scripting with JSON Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#automated-proxy-refresh">Automated Proxy Refresh</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#ci-cd-integration">CI/CD Integration</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#multi-environment-configuration">Multi-Environment Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cli-reference.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#configuration-not-found">Configuration Not Found</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#lock-file-issues">Lock File Issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#slow-validation">Slow Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#geoip-enrichment-not-working">GeoIP Enrichment Not Working</a></li>
<li class="toctree-l4"><a class="reference internal" href="cli-reference.html#ssrf-protection-blocking-local-tests">SSRF Protection Blocking Local Tests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cli-reference.html#environment-variables">Environment Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli-reference.html#exit-codes">Exit Codes</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="automation.html">Automation &amp; CI Runbook</a><ul>
<li class="toctree-l3"><a class="reference internal" href="automation.html#pre-flight-checks">Pre-flight checks</a></li>
<li class="toctree-l3"><a class="reference internal" href="automation.html#smoke-tests-for-docs-examples">Smoke tests for docs examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="automation.html#docsearch-credentials">DocSearch credentials</a></li>
<li class="toctree-l3"><a class="reference internal" href="automation.html#automating-releases">Automating releases</a></li>
<li class="toctree-l3"><a class="reference internal" href="automation.html#suggested-ci-stages">Suggested CI stages</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="mcp-server.html">MCP Server Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#quick-start">Quick Start</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#installation">Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#running-the-server">Running the Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#auto-loading-proxies">Auto-Loading Proxies</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#cli-options">CLI Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#the-proxywhirl-tool">The <code class="docutils literal notranslate"><span class="pre">proxywhirl</span></code> Tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#available-actions">Available Actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#action-examples">Action Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#resources">Resources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#resource-proxywhirl-health">resource://proxywhirl/health</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#resource-proxywhirl-config">resource://proxywhirl/config</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#prompts">Prompts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#proxy-selection-workflow">proxy_selection_workflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#troubleshooting-workflow">troubleshooting_workflow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#authentication">Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#enabling-authentication">Enabling Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#authenticated-tool-calls">Authenticated Tool Calls</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#auth-middleware">Auth Middleware</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#disabling-authentication">Disabling Authentication</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#progress-reporting">Progress Reporting</a></li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#transport-options">Transport Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#integration-with-claude-desktop">Integration with Claude Desktop</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#macos">macOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#windows">Windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#with-uvx-recommended">With uvx (Recommended)</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#with-transport-options">With Transport Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#programmatic-usage">Programmatic Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#custom-rotator-configuration">Custom Rotator Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#lifecycle-management">Lifecycle Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#how-lifespan-works">How Lifespan Works</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#server-class-usage">Server Class Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#error-handling">Error Handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#common-error-codes">Common Error Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#example-error-responses">Example Error Responses</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#best-practices">Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#always-check-pool-health-first">1. Always Check Pool Health First</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#use-recommendations-for-critical-requests">2. Use Recommendations for Critical Requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#monitor-circuit-breaker-states">3. Monitor Circuit Breaker States</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#handle-errors-gracefully">4. Handle Errors Gracefully</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#clean-up-resources">5. Clean Up Resources</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#server-wont-start">Server Won&#8217;t Start</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#no-proxies-available">No Proxies Available</a></li>
<li class="toctree-l4"><a class="reference internal" href="mcp-server.html#authentication-failures">Authentication Failures</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mcp-server.html#see-also">See Also</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../reference/index.html">Reference</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../reference/rest-api.html">ProxyWhirl REST API Usage Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html#getting-started">Getting Started</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#starting-the-api-server">Starting the API Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#using-docker">Using Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#accessing-documentation">Accessing Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html#authentication">Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#no-authentication-default">No Authentication (Default)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#api-key-authentication">API Key Authentication</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html#endpoint-reference">Endpoint Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#rotation-strategy-configuration">Rotation Strategy Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#proxied-requests">Proxied Requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#pool-management">Pool Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#monitoring">Monitoring</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#configuration">Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html#rate-limiting">Rate Limiting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html#error-handling">Error Handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#error-codes">Error Codes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html#performance-tips">Performance Tips</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#use-connection-pooling">1. Use Connection Pooling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#enable-response-compression">2. Enable Response Compression</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#use-health-checks-efficiently">3. Use Health Checks Efficiently</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#monitor-metrics">4. Monitor Metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#configure-appropriate-timeouts">5. Configure Appropriate Timeouts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#use-persistent-storage">6. Use Persistent Storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#optimize-retry-logic">7. Optimize Retry Logic</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html#security-best-practices">Security Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#x-forwarded-for-security-warning">X-Forwarded-For Security Warning</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html#deployment-examples">Deployment Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#nginx-reverse-proxy-secure-configuration">Nginx Reverse Proxy (Secure Configuration)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#kubernetes-deployment">Kubernetes Deployment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#caddy-reverse-proxy-secure-configuration">Caddy Reverse Proxy (Secure Configuration)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#haproxy-reverse-proxy-secure-configuration">HAProxy Reverse Proxy (Secure Configuration)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#aws-application-load-balancer-alb-security">AWS Application Load Balancer (ALB) Security</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html#x-forwarded-for-security-checklist">X-Forwarded-For Security Checklist</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html#security-references">Security References</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#api-wont-start">API Won&#8217;t Start</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#proxies-not-working">Proxies Not Working</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#rate-limiting-issues">Rate Limiting Issues</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rest-api.html#high-latency">High Latency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rest-api.html#support">Support</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../reference/python-api.html">Python API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html#core-classes">Core Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#proxyrotator">ProxyRotator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#asyncproxyrotator">AsyncProxyRotator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#proxyfetcher">ProxyFetcher</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#proxyvalidator">ProxyValidator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#browserrenderer">BrowserRenderer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html#rotation-strategies">Rotation Strategies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#roundrobinstrategy">RoundRobinStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#randomstrategy">RandomStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#weightedstrategy">WeightedStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#leastusedstrategy">LeastUsedStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#performancebasedstrategy">PerformanceBasedStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#sessionpersistencestrategy">SessionPersistenceStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#geotargetedstrategy">GeoTargetedStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#costawarestrategy">CostAwareStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#compositestrategy">CompositeStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#strategyregistry">StrategyRegistry</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html#data-models">Data Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#proxy">Proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#proxypool">ProxyPool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#proxychain">ProxyChain</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#proxycredentials">ProxyCredentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#proxyconfiguration">ProxyConfiguration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#selectioncontext">SelectionContext</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#strategyconfig">StrategyConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#session">Session</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html#cache-components">Cache Components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#cachemanager">CacheManager</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#cacheconfig">CacheConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#cacheentry">CacheEntry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#cachestatistics">CacheStatistics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html#retry-failover">Retry &amp; Failover</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#retrypolicy">RetryPolicy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#retryexecutor">RetryExecutor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#circuitbreaker">CircuitBreaker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#retrymetrics">RetryMetrics</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html#parsers">Parsers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#jsonparser">JSONParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#csvparser">CSVParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#plaintextparser">PlainTextParser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#htmltableparser">HTMLTableParser</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html#utility-functions">Utility Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#configure-logging">configure_logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#is-valid-proxy-url">is_valid_proxy_url</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#parse-proxy-url">parse_proxy_url</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#validate-proxy-model">validate_proxy_model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#encrypt-credentials-decrypt-credentials">encrypt_credentials / decrypt_credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#proxy-to-dict">proxy_to_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#create-proxy-from-url">create_proxy_from_url</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#deduplicate-proxies">deduplicate_proxies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html#enumerations">Enumerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#healthstatus">HealthStatus</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#proxysource">ProxySource</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#proxyformat">ProxyFormat</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#rendermode">RenderMode</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#validationlevel">ValidationLevel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#backoffstrategy">BackoffStrategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#circuitbreakerstate">CircuitBreakerState</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html#built-in-proxy-sources">Built-in Proxy Sources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#individual-sources">Individual Sources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/python-api.html#source-collections">Source Collections</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html#exceptions">Exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html#type-annotations">Type Annotations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html#version">Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/python-api.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../reference/configuration.html">Configuration Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration.html#configuration-discovery">Configuration Discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration.html#toml-configuration-format">TOML Configuration Format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#file-locations">File Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#complete-configuration-example">Complete Configuration Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration.html#environment-variables">Environment Variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#security-encryption">Security &amp; Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#rest-api-configuration">REST API Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration.html#configuration-classes">Configuration Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#cliconfig">CLIConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#datastorageconfig">DataStorageConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#proxyconfig">ProxyConfig</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration.html#programmatic-configuration">Programmatic Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#loading-configuration">Loading Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#creating-configuration">Creating Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#saving-configuration">Saving Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration.html#validation-rules">Validation Rules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#rotation-strategy">Rotation Strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#output-format">Output Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#proxy-url-schemes">Proxy URL Schemes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#numeric-constraints">Numeric Constraints</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration.html#security-best-practices">Security Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#credential-encryption">Credential Encryption</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#config-file-permissions">Config File Permissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#api-key-security">API Key Security</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration.html#configuration-examples">Configuration Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#minimal-configuration">Minimal Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#high-performance-configuration">High-Performance Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#privacy-focused-configuration">Privacy-Focused Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#analytics-enabled-configuration">Analytics-Enabled Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration.html#migration-from-legacy-config">Migration from Legacy Config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration.html#troubleshooting">Troubleshooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#config-file-not-found">Config File Not Found</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#invalid-toml-syntax">Invalid TOML Syntax</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration.html#encryption-key-issues">Encryption Key Issues</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration.html#related-documentation">Related Documentation</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../reference/exceptions.html">Exceptions Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/exceptions.html#table-of-contents">Table of Contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/exceptions.html#exception-hierarchy">Exception Hierarchy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/exceptions.html#proxyerrorcode-enum">ProxyErrorCode Enum</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#usage">Usage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/exceptions.html#utility-functions">Utility Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#redact-url">redact_url()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/exceptions.html#error-codes">Error Codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/exceptions.html#exception-reference">Exception Reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#proxywhirlerror">ProxyWhirlError</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#proxyvalidationerror">ProxyValidationError</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#proxypoolemptyerror">ProxyPoolEmptyError</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#proxyconnectionerror">ProxyConnectionError</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#proxyauthenticationerror">ProxyAuthenticationError</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#proxyfetcherror">ProxyFetchError</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#proxystorageerror">ProxyStorageError</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#cachecorruptionerror">CacheCorruptionError</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#cachestorageerror">CacheStorageError</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#cachevalidationerror">CacheValidationError</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#requestqueuefullerror">RequestQueueFullError</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/exceptions.html#error-handling-patterns">Error Handling Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#basic-error-handling">Basic Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#catch-all-error-handling">Catch-All Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#retry-logic-based-on-error-type">Retry Logic Based on Error Type</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#async-error-handling">Async Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#rest-api-error-handling">REST API Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#context-manager-pattern">Context Manager Pattern</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#error-aggregation">Error Aggregation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/exceptions.html#best-practices">Best Practices</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#use-specific-exceptions">1. Use Specific Exceptions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#check-retry-recommended-flag">2. Check retry_recommended Flag</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#use-error-codes-for-programmatic-handling">3. Use Error Codes for Programmatic Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#log-structured-error-data">4. Log Structured Error Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#implement-circuit-breaker-pattern">5. Implement Circuit Breaker Pattern</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#provide-user-friendly-error-messages">6. Provide User-Friendly Error Messages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#test-error-handling">7. Test Error Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#monitor-error-rates">8. Monitor Error Rates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#handle-async-errors-properly">9. Handle Async Errors Properly</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/exceptions.html#document-error-handling">10. Document Error Handling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/exceptions.html#summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../reference/cache-api.html">Cache API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/cache-api.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cache-api.html#data-models">Data Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#cacheentry">CacheEntry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#cacheconfig">CacheConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#cachetierconfig">CacheTierConfig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#cachestatistics">CacheStatistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#tierstatistics">TierStatistics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#healthstatus-enum">HealthStatus (Enum)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#cachetiertype-enum">CacheTierType (Enum)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#l2backendtype-enum">L2BackendType (Enum)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cache-api.html#tier-implementations">Tier Implementations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#cachetier-abstract-base-class">CacheTier (Abstract Base Class)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#memorycachetier">MemoryCacheTier</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#jsonlcachetier">JsonlCacheTier</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#diskcachetier">DiskCacheTier</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#sqlitecachetier">SQLiteCacheTier</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cache-api.html#utilities">Utilities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#credentialencryptor">CredentialEncryptor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#cachemanager">CacheManager</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cache-api.html#usage-examples">Usage Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#working-with-cache-tiers-directly">Working with Cache Tiers Directly</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#encryption-and-security">Encryption and Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#migration-from-jsonl-to-sqlite-l2">Migration from JSONL to SQLite L2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cache-api.html#performance-considerations">Performance Considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#tier-selection">Tier Selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/cache-api.html#optimization-tips">Optimization Tips</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cache-api.html#thread-safety">Thread Safety</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cache-api.html#error-handling">Error Handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/cache-api.html#see-also">See Also</a></li>
</ul>
</li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../reference/rate-limiting-api.html">Rate Limiting API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/rate-limiting-api.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rate-limiting-api.html#core-classes">Core Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#ratelimiter">RateLimiter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rate-limiting-api.html#data-models">Data Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#ratelimit">RateLimit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#ratelimitevent">RateLimitEvent</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rate-limiting-api.html#usage-examples">Usage Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#basic-rate-limiting">Basic Rate Limiting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#global-per-proxy-limits">Global + Per-Proxy Limits</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#burst-handling">Burst Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#dynamic-limit-adjustment">Dynamic Limit Adjustment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#integration-with-proxyrotator">Integration with ProxyRotator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#monitoring-and-logging">Monitoring and Logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#retry-with-backoff">Retry with Backoff</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rate-limiting-api.html#thread-safety">Thread Safety</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rate-limiting-api.html#performance-considerations">Performance Considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#token-bucket-algorithm">Token Bucket Algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#memory-usage">Memory Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#concurrency">Concurrency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rate-limiting-api.html#integration-with-monitoring">Integration with Monitoring</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#prometheus-metrics">Prometheus Metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#datadog-integration">DataDog Integration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rate-limiting-api.html#sphinx-integration">Sphinx Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rate-limiting-api.html#common-patterns">Common Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#fallback-to-different-proxy">Fallback to Different Proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#batch-requests-with-rate-limiting">Batch Requests with Rate Limiting</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rate-limiting-api.html#circuit-breaker-integration">Circuit Breaker Integration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rate-limiting-api.html#faq">FAQ</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../project/index.html">Project Status &amp; Roadmap</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#current-health">Current health</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../project/index.html#collaboration-checklists">Collaboration checklists</a></li>
</ul>
</li>
</ul>
        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#architecture-overview">Architecture Overview</a></li>
<li><a class="reference internal" href="#when-to-use-retry-vs-failover">When to Use Retry vs Failover</a><ul>
<li><a class="reference internal" href="#retry-same-proxy">Retry (Same Proxy)</a></li>
<li><a class="reference internal" href="#failover-different-proxy">Failover (Different Proxy)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#retrypolicy-configuration">RetryPolicy Configuration</a><ul>
<li><a class="reference internal" href="#basic-configuration">Basic Configuration</a></li>
<li><a class="reference internal" href="#backoff-strategies">Backoff Strategies</a><ul>
<li><a class="reference internal" href="#exponential-backoff-recommended">Exponential Backoff (Recommended)</a></li>
<li><a class="reference internal" href="#linear-backoff">Linear Backoff</a></li>
<li><a class="reference internal" href="#fixed-backoff">Fixed Backoff</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jitter-explained">Jitter Explained</a></li>
<li><a class="reference internal" href="#retryable-status-codes">Retryable Status Codes</a></li>
<li><a class="reference internal" href="#timeout-behavior">Timeout Behavior</a></li>
<li><a class="reference internal" href="#non-idempotent-requests">Non-Idempotent Requests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#circuit-breaker-configuration">Circuit Breaker Configuration</a><ul>
<li><a class="reference internal" href="#sync-vs-async-circuit-breakers">Sync vs Async Circuit Breakers</a></li>
<li><a class="reference internal" href="#state-machine">State Machine</a></li>
<li><a class="reference internal" href="#thresholds-and-configuration">Thresholds and Configuration</a></li>
<li><a class="reference internal" href="#circuit-breaker-persistence">Circuit Breaker Persistence</a></li>
<li><a class="reference internal" href="#state-transitions">State Transitions</a><ul>
<li><a class="reference internal" href="#closed-open">CLOSED &#8594; OPEN</a></li>
<li><a class="reference internal" href="#open-half-open">OPEN &#8594; HALF_OPEN</a></li>
<li><a class="reference internal" href="#half-open-closed">HALF_OPEN &#8594; CLOSED</a></li>
<li><a class="reference internal" href="#half-open-open">HALF_OPEN &#8594; OPEN</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rolling-window-behavior">Rolling Window Behavior</a></li>
<li><a class="reference internal" href="#manual-reset">Manual Reset</a></li>
</ul>
</li>
<li><a class="reference internal" href="#intelligent-proxy-selection">Intelligent Proxy Selection</a><ul>
<li><a class="reference internal" href="#selection-algorithm">Selection Algorithm</a></li>
<li><a class="reference internal" href="#example-performance-based-selection">Example: Performance-Based Selection</a></li>
<li><a class="reference internal" href="#example-geo-targeted-selection">Example: Geo-Targeted Selection</a></li>
<li><a class="reference internal" href="#exclusion-rules">Exclusion Rules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#retrymetrics-and-observability">RetryMetrics and Observability</a><ul>
<li><a class="reference internal" href="#collecting-metrics">Collecting Metrics</a></li>
<li><a class="reference internal" href="#summary-statistics">Summary Statistics</a></li>
<li><a class="reference internal" href="#time-series-data">Time-Series Data</a></li>
<li><a class="reference internal" href="#per-proxy-statistics">Per-Proxy Statistics</a></li>
<li><a class="reference internal" href="#circuit-breaker-events">Circuit Breaker Events</a></li>
<li><a class="reference internal" href="#hourly-aggregation">Hourly Aggregation</a></li>
<li><a class="reference internal" href="#retention-configuration">Retention Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#retryexecutor-deep-dive">RetryExecutor Deep Dive</a><ul>
<li><a class="reference internal" href="#how-retries-work-internally">How Retries Work Internally</a></li>
<li><a class="reference internal" href="#retryable-vs-non-retryable-errors">Retryable vs Non-Retryable Errors</a></li>
<li><a class="reference internal" href="#direct-retryexecutor-usage">Direct RetryExecutor Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#integration-with-proxyrotator">Integration with ProxyRotator</a><ul>
<li><a class="reference internal" href="#basic-usage">Basic Usage</a></li>
<li><a class="reference internal" href="#custom-error-handling">Custom Error Handling</a></li>
<li><a class="reference internal" href="#monitoring-circuit-breakers">Monitoring Circuit Breakers</a></li>
<li><a class="reference internal" href="#manual-circuit-reset">Manual Circuit Reset</a></li>
<li><a class="reference internal" href="#integration-with-rotation-strategies">Integration with Rotation Strategies</a><ul>
<li><a class="reference internal" href="#round-robin-with-automatic-failover">Round-Robin with Automatic Failover</a></li>
<li><a class="reference internal" href="#weighted-strategy-with-performance-based-failover">Weighted Strategy with Performance-Based Failover</a></li>
<li><a class="reference internal" href="#geo-targeted-strategy-with-regional-failover">Geo-Targeted Strategy with Regional Failover</a></li>
<li><a class="reference internal" href="#performance-based-strategy-with-dynamic-failover">Performance-Based Strategy with Dynamic Failover</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-patterns">Advanced Patterns</a><ul>
<li><a class="reference internal" href="#adaptive-retry-policy">Adaptive Retry Policy</a></li>
<li><a class="reference internal" href="#circuit-breaker-alerts">Circuit Breaker Alerts</a></li>
<li><a class="reference internal" href="#request-level-retry-override">Request-Level Retry Override</a></li>
</ul>
</li>
<li><a class="reference internal" href="#best-practices">Best Practices</a><ul>
<li><a class="reference internal" href="#start-conservative-tune-later">1. Start Conservative, Tune Later</a></li>
<li><a class="reference internal" href="#always-use-jitter-in-production">2. Always Use Jitter in Production</a></li>
<li><a class="reference internal" href="#monitor-circuit-breaker-opens">3. Monitor Circuit Breaker Opens</a></li>
<li><a class="reference internal" href="#set-timeouts-for-time-sensitive-requests">4. Set Timeouts for Time-Sensitive Requests</a></li>
<li><a class="reference internal" href="#use-metrics-for-capacity-planning">5. Use Metrics for Capacity Planning</a></li>
</ul>
</li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a><ul>
<li><a class="reference internal" href="#all-retries-exhausted">All Retries Exhausted</a></li>
<li><a class="reference internal" href="#high-latency">High Latency</a></li>
<li><a class="reference internal" href="#non-retryable-errors">Non-Retryable Errors</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-impact">Performance Impact</a></li>
<li><a class="reference internal" href="#related-documentation">Related Documentation</a></li>
<li><a class="reference internal" href="#summary">Summary</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">ProxyWhirl</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="index.html"><span itemprop="name">Guides</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">Retry &amp; Failover Guide</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <div class="copy-page-wrapper relative pb-4 lg:absolute lg:top-8 lg:right-6 xl:right-12">
  <div id="copy-page-trigger">
    <button
      type="button"
      class="js-copy px-3 py-1 inline-flex items-center gap-1"
      data-url="https://proxywhirl.readthedocs.io/_sources/guides/retry-failover.md.txt"
    >
      <i class="i-lucide" data-icon="copy"></i>
      <span>Copy page</span>
    </button>
    <button class="js-menu px-2 py-1" type="button" aria-label="More actions"
      aria-haspopup="menu" aria-expanded="false" aria-controls="copy-page-content">
      <i class="i-lucide chevron-down"></i>
    </button>
  </div>
  <div id="copy-page-content" role="menu" aria-orientation="vertical" aria-hidden="true">
    <div role="presentation">
      <div class="flex flex-col" role="group">
        <button class="js-copy" type="button" role="menuitem"
          data-url="https://proxywhirl.readthedocs.io/_sources/guides/retry-failover.md.txt">
          <span class="iconify-icon">
            <i class="i-lucide" data-icon="copy"></i>
          </span>
          <span>Copy page</span>
        </button>
        <a role="menuitem" href="https://proxywhirl.readthedocs.io/_sources/guides/retry-failover.md.txt" target="_blank" rel="nofollow"><iconify-icon icon="bi:markdown"></iconify-icon>
            <span>View as Markdown</span></a><a role="menuitem" href="https://chatgpt.com/?hints=search&q=Read%20https%3A//proxywhirl.readthedocs.io/_sources/guides/retry-failover.md.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:openai"></iconify-icon>
          <span>Open in ChatGPT</span>
        </a><a role="menuitem" href="https://claude.ai/new?q=Read%20https%3A//proxywhirl.readthedocs.io/_sources/guides/retry-failover.md.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:claude"></iconify-icon>
          <span>Open in Claude</span>
        </a></div>
    </div>
  </div>
</div><article class="yue" role="main">
          <section id="retry-failover-guide">
<h1>Retry &amp; Failover Guide<a class="headerlink" href="#retry-failover-guide" title="Link to this heading"></a></h1>
<p>ProxyWhirl provides intelligent retry logic, circuit breaker protection, and automatic proxy failover to maximize request success rates. This guide covers the complete retry and failover system, from basic configuration to advanced observability.</p>
<section id="architecture-overview">
<h2>Architecture Overview<a class="headerlink" href="#architecture-overview" title="Link to this heading"></a></h2>
<p>The retry system consists of four main components:</p>
<ol class="arabic simple">
<li><p><strong>RetryPolicy</strong> - Configures retry behavior and backoff strategies</p></li>
<li><p><strong>RetryExecutor</strong> - Orchestrates retry logic with intelligent proxy selection</p></li>
<li><p><strong>CircuitBreaker</strong> - Protects against cascading failures using state machine transitions</p></li>
<li><p><strong>RetryMetrics</strong> - Collects observability data for monitoring and analysis</p></li>
</ol>
</section>
<section id="when-to-use-retry-vs-failover">
<h2>When to Use Retry vs Failover<a class="headerlink" href="#when-to-use-retry-vs-failover" title="Link to this heading"></a></h2>
<section id="retry-same-proxy">
<h3>Retry (Same Proxy)<a class="headerlink" href="#retry-same-proxy" title="Link to this heading"></a></h3>
<p>Use retry when:</p>
<ul class="simple">
<li><p>Network is temporarily unstable (connection timeout, packet loss)</p></li>
<li><p>Target server returns 502/503/504 (gateway errors, service temporarily unavailable)</p></li>
<li><p>Request is idempotent (GET, HEAD, OPTIONS, DELETE, PUT)</p></li>
</ul>
</section>
<section id="failover-different-proxy">
<h3>Failover (Different Proxy)<a class="headerlink" href="#failover-different-proxy" title="Link to this heading"></a></h3>
<p>Use failover when:</p>
<ul class="simple">
<li><p>Proxy authentication fails (407)</p></li>
<li><p>Proxy consistently returns errors (circuit breaker opens)</p></li>
<li><p>Specific geo-targeting or performance requirements exist</p></li>
<li><p>One proxy exhausts rate limits</p></li>
</ul>
<p>ProxyWhirl combines both: it retries with backoff on the current proxy, then fails over to a better proxy if retries are exhausted.</p>
</section>
</section>
<section id="retrypolicy-configuration">
<h2>RetryPolicy Configuration<a class="headerlink" href="#retrypolicy-configuration" title="Link to this heading"></a></h2>
<section id="basic-configuration">
<h3>Basic Configuration<a class="headerlink" href="#basic-configuration" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyRotator</span><span class="p">,</span> <span class="n">RetryPolicy</span><span class="p">,</span> <span class="n">BackoffStrategy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Default policy: 3 attempts, exponential backoff</span>
</span><span data-line="4"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">()</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># Custom policy</span>
</span><span data-line="7"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="8">    <span class="n">max_attempts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>                          <span class="c1"># Maximum retry attempts</span>
</span><span data-line="9">    <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">EXPONENTIAL</span><span class="p">,</span>
</span><span data-line="10">    <span class="n">base_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>                          <span class="c1"># Initial delay (seconds)</span>
</span><span data-line="11">    <span class="n">multiplier</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>                          <span class="c1"># Exponential multiplier</span>
</span><span data-line="12">    <span class="n">max_backoff_delay</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>                  <span class="c1"># Maximum delay cap</span>
</span><span data-line="13">    <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                             <span class="c1"># Randomize delays 50%</span>
</span><span data-line="14">    <span class="n">retry_status_codes</span><span class="o">=</span><span class="p">[</span><span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">],</span>      <span class="c1"># Retryable HTTP errors</span>
</span><span data-line="15">    <span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>                            <span class="c1"># Total timeout for all attempts</span>
</span><span data-line="16">    <span class="n">retry_non_idempotent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>              <span class="c1"># Don&#39;t retry POST by default</span>
</span><span data-line="17"><span class="p">)</span>
</span><span data-line="18">
</span><span data-line="19"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">(</span><span class="n">retry_policy</span><span class="o">=</span><span class="n">policy</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="backoff-strategies">
<h3>Backoff Strategies<a class="headerlink" href="#backoff-strategies" title="Link to this heading"></a></h3>
<p>ProxyWhirl supports three backoff strategies:</p>
<section id="exponential-backoff-recommended">
<h4>Exponential Backoff (Recommended)<a class="headerlink" href="#exponential-backoff-recommended" title="Link to this heading"></a></h4>
<p>Best for network failures and overloaded servers. Delays increase exponentially to give systems time to recover.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">EXPONENTIAL</span><span class="p">,</span>
</span><span data-line="3">    <span class="n">base_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">multiplier</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">max_backoff_delay</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Prevents thundering herd</span>
</span><span data-line="7"><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Attempt 0: 1.0s  50% jitter</span>
</span><span data-line="10"><span class="c1"># Attempt 1: 2.0s  50% jitter</span>
</span><span data-line="11"><span class="c1"># Attempt 2: 4.0s  50% jitter</span>
</span><span data-line="12"><span class="c1"># Attempt 3: 8.0s  50% jitter</span>
</span><span data-line="13"><span class="c1"># Attempt 4: 16.0s  50% jitter</span>
</span><span data-line="14"><span class="c1"># Attempt 5+: 30.0s (capped)  50% jitter</span>
</span></pre></div>
</div>
</section>
<section id="linear-backoff">
<h4>Linear Backoff<a class="headerlink" href="#linear-backoff" title="Link to this heading"></a></h4>
<p>Best for predictable retry patterns. Delays increase linearly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">LINEAR</span><span class="p">,</span>
</span><span data-line="3">    <span class="n">base_delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">max_backoff_delay</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
</span><span data-line="5"><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Attempt 0: 2.0s</span>
</span><span data-line="8"><span class="c1"># Attempt 1: 4.0s</span>
</span><span data-line="9"><span class="c1"># Attempt 2: 6.0s</span>
</span><span data-line="10"><span class="c1"># Attempt 3: 8.0s</span>
</span><span data-line="11"><span class="c1"># Attempt 4: 10.0s (capped)</span>
</span></pre></div>
</div>
</section>
<section id="fixed-backoff">
<h4>Fixed Backoff<a class="headerlink" href="#fixed-backoff" title="Link to this heading"></a></h4>
<p>Best for testing or when delays should be constant.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">FIXED</span><span class="p">,</span>
</span><span data-line="3">    <span class="n">base_delay</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
</span><span data-line="4"><span class="p">)</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># All attempts: 5.0s</span>
</span></pre></div>
</div>
</section>
</section>
<section id="jitter-explained">
<h3>Jitter Explained<a class="headerlink" href="#jitter-explained" title="Link to this heading"></a></h3>
<p>Jitter adds randomization to delays (50%) to prevent synchronized retries across multiple clients:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Without jitter: All clients retry at exactly 1.0s, 2.0s, 4.0s...</span>
</span><span data-line="2"><span class="c1"># With jitter: Clients retry at random times:</span>
</span><span data-line="3"><span class="c1">#   Client A: 0.7s, 1.3s, 2.8s...</span>
</span><span data-line="4"><span class="c1">#   Client B: 1.4s, 2.9s, 5.1s...</span>
</span><span data-line="5"><span class="c1">#   Client C: 0.9s, 1.1s, 3.7s...</span>
</span></pre></div>
</div>
<p>This prevents thundering herd problems where many clients overwhelm a recovering server.</p>
</section>
<section id="retryable-status-codes">
<h3>Retryable Status Codes<a class="headerlink" href="#retryable-status-codes" title="Link to this heading"></a></h3>
<p>By default, ProxyWhirl retries on gateway errors:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Default retry status codes</span>
</span><span data-line="2"><span class="n">retry_status_codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">]</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Custom status codes (must be 5xx)</span>
</span><span data-line="5"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="6">    <span class="n">retry_status_codes</span><span class="o">=</span><span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">,</span> <span class="mi">507</span><span class="p">,</span> <span class="mi">508</span><span class="p">]</span>
</span><span data-line="7"><span class="p">)</span>
</span></pre></div>
</div>
<p>4xx errors (client errors) are never retried as they indicate permanent failures.</p>
</section>
<section id="timeout-behavior">
<h3>Timeout Behavior<a class="headerlink" href="#timeout-behavior" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">timeout</span></code> parameter caps total execution time across all retry attempts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">max_attempts</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span data-line="3">    <span class="n">timeout</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>  <span class="c1"># Total timeout for all attempts</span>
</span><span data-line="4"><span class="p">)</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># If 30s elapses after 3 attempts, remaining 7 attempts are skipped</span>
</span><span data-line="7"><span class="c1"># Raises: ProxyConnectionError(&quot;Request timeout after 30.00s&quot;)</span>
</span></pre></div>
</div>
</section>
<section id="non-idempotent-requests">
<h3>Non-Idempotent Requests<a class="headerlink" href="#non-idempotent-requests" title="Link to this heading"></a></h3>
<p>By default, POST/PATCH requests are not retried (theyre not idempotent):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Default: POST fails immediately without retry</span>
</span><span data-line="2"><span class="n">rotator</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Enable retries for POST (use with caution!)</span>
</span><span data-line="5"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span><span class="n">retry_non_idempotent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="6"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">(</span><span class="n">retry_policy</span><span class="o">=</span><span class="n">policy</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Now POST will retry on network failures</span>
</span><span data-line="9"><span class="n">rotator</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>
</div>
<p><strong>Warning:</strong> Only enable <code class="docutils literal notranslate"><span class="pre">retry_non_idempotent</span></code> if your API is idempotent (e.g., uses idempotency keys).</p>
</section>
</section>
<section id="circuit-breaker-configuration">
<h2>Circuit Breaker Configuration<a class="headerlink" href="#circuit-breaker-configuration" title="Link to this heading"></a></h2>
<p>Circuit breakers protect against cascading failures by temporarily removing unhealthy proxies from the rotation pool.</p>
<section id="sync-vs-async-circuit-breakers">
<h3>Sync vs Async Circuit Breakers<a class="headerlink" href="#sync-vs-async-circuit-breakers" title="Link to this heading"></a></h3>
<p>ProxyWhirl provides two circuit breaker implementations:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">CircuitBreaker</span></code></strong> - Synchronous implementation using <code class="docutils literal notranslate"><span class="pre">threading.Lock</span></code></p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">AsyncCircuitBreaker</span></code></strong> - Async implementation using <code class="docutils literal notranslate"><span class="pre">asyncio</span></code>-compatible locks</p></li>
</ul>
<p><strong>When to use which:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">#  For synchronous code - use CircuitBreaker</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreaker</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">cb</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span><span class="n">proxy_id</span><span class="o">=</span><span class="s2">&quot;proxy-1&quot;</span><span class="p">)</span>
</span><span data-line="5"><span class="n">cb</span><span class="o">.</span><span class="n">record_failure</span><span class="p">()</span>  <span class="c1"># Thread-safe</span>
</span><span data-line="6"><span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">should_attempt_request</span><span class="p">():</span>
</span><span data-line="7">    <span class="n">cb</span><span class="o">.</span><span class="n">record_success</span><span class="p">()</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1">#  For async code - use AsyncCircuitBreaker</span>
</span><span data-line="10"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.circuit_breaker_async</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncCircuitBreaker</span>
</span><span data-line="11">
</span><span data-line="12"><span class="n">cb</span> <span class="o">=</span> <span class="n">AsyncCircuitBreaker</span><span class="p">(</span><span class="n">proxy_id</span><span class="o">=</span><span class="s2">&quot;proxy-1&quot;</span><span class="p">)</span>
</span><span data-line="13"><span class="k">await</span> <span class="n">cb</span><span class="o">.</span><span class="n">record_failure</span><span class="p">()</span>  <span class="c1"># Event loop safe</span>
</span><span data-line="14"><span class="k">if</span> <span class="k">await</span> <span class="n">cb</span><span class="o">.</span><span class="n">should_attempt_request</span><span class="p">():</span>
</span><span data-line="15">    <span class="k">await</span> <span class="n">cb</span><span class="o">.</span><span class="n">record_success</span><span class="p">()</span>
</span></pre></div>
</div>
<p><strong>WARNING:</strong> Do NOT mix sync locks with async code. The <code class="docutils literal notranslate"><span class="pre">CircuitBreaker</span></code> class has some async methods (<code class="docutils literal notranslate"><span class="pre">save_state</span></code>, <code class="docutils literal notranslate"><span class="pre">load_state</span></code>) for backward compatibility, but these use <code class="docutils literal notranslate"><span class="pre">threading.Lock</span></code> internally which can block the event loop. For production async applications, always use <code class="docutils literal notranslate"><span class="pre">AsyncCircuitBreaker</span></code>.</p>
</section>
<section id="state-machine">
<h3>State Machine<a class="headerlink" href="#state-machine" title="Link to this heading"></a></h3>
<p>Circuit breakers transition through three states:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">CLOSED  OPEN  HALF_OPEN  CLOSED
</span><span data-line="2">                              
</span><span data-line="3">  
</span></pre></div>
</div>
<ol class="arabic simple">
<li><p><strong>CLOSED</strong> - Normal operation, proxy is available</p></li>
<li><p><strong>OPEN</strong> - Proxy excluded from rotation (too many failures)</p></li>
<li><p><strong>HALF_OPEN</strong> - Testing recovery with limited requests</p></li>
</ol>
</section>
<section id="thresholds-and-configuration">
<h3>Thresholds and Configuration<a class="headerlink" href="#thresholds-and-configuration" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.circuit_breaker</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreaker</span><span class="p">,</span> <span class="n">CircuitBreakerConfig</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Circuit breakers are created automatically by ProxyRotator</span>
</span><span data-line="4"><span class="c1"># Access via rotator.circuit_breakers dict</span>
</span><span data-line="5">
</span><span data-line="6"><span class="n">proxy</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
</span><span data-line="7"><span class="n">cb</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">circuit_breakers</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Configuration (set on CircuitBreaker creation)</span>
</span><span data-line="10"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">failure_threshold</span><span class="p">)</span>   <span class="c1"># Default: 5 failures</span>
</span><span data-line="11"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">window_duration</span><span class="p">)</span>     <span class="c1"># Default: 60 seconds (rolling window)</span>
</span><span data-line="12"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">timeout_duration</span><span class="p">)</span>    <span class="c1"># Default: 30 seconds (OPEN timeout)</span>
</span></pre></div>
</div>
</section>
<section id="circuit-breaker-persistence">
<h3>Circuit Breaker Persistence<a class="headerlink" href="#circuit-breaker-persistence" title="Link to this heading"></a></h3>
<p>Circuit breaker state can optionally persist across application restarts using SQLite storage.</p>
<p><strong>For async applications (recommended):</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.circuit_breaker_async</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncCircuitBreaker</span><span class="p">,</span> <span class="n">CircuitBreakerConfig</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.storage</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLiteStorage</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Configure persistence</span>
</span><span data-line="5"><span class="n">cb_config</span> <span class="o">=</span> <span class="n">CircuitBreakerConfig</span><span class="p">(</span>
</span><span data-line="6">    <span class="n">persist_state</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>            <span class="c1"># Enable state persistence</span>
</span><span data-line="7">    <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">window_duration</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
</span><span data-line="9">    <span class="n">timeout_duration</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>
</span><span data-line="10"><span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># Initialize storage</span>
</span><span data-line="13"><span class="n">storage</span> <span class="o">=</span> <span class="n">SQLiteStorage</span><span class="p">(</span><span class="s2">&quot;proxywhirl.db&quot;</span><span class="p">)</span>
</span><span data-line="14"><span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># Create async circuit breaker with persistence</span>
</span><span data-line="17"><span class="n">cb</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AsyncCircuitBreaker</span><span class="o">.</span><span class="n">create_with_storage</span><span class="p">(</span>
</span><span data-line="18">    <span class="n">proxy_id</span><span class="o">=</span><span class="s2">&quot;proxy-123&quot;</span><span class="p">,</span>
</span><span data-line="19">    <span class="n">storage</span><span class="o">=</span><span class="n">storage</span><span class="p">,</span>
</span><span data-line="20">    <span class="n">config</span><span class="o">=</span><span class="n">cb_config</span><span class="p">,</span>
</span><span data-line="21"><span class="p">)</span>
</span><span data-line="22">
</span><span data-line="23"><span class="c1"># State automatically saves to database</span>
</span><span data-line="24"><span class="k">await</span> <span class="n">cb</span><span class="o">.</span><span class="n">record_failure</span><span class="p">()</span>
</span><span data-line="25"><span class="k">await</span> <span class="n">cb</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
</span><span data-line="26">
</span><span data-line="27"><span class="c1"># On next startup, state is restored</span>
</span><span data-line="28"><span class="n">cb2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AsyncCircuitBreaker</span><span class="o">.</span><span class="n">create_with_storage</span><span class="p">(</span>
</span><span data-line="29">    <span class="n">proxy_id</span><span class="o">=</span><span class="s2">&quot;proxy-123&quot;</span><span class="p">,</span>
</span><span data-line="30">    <span class="n">storage</span><span class="o">=</span><span class="n">storage</span><span class="p">,</span>
</span><span data-line="31">    <span class="n">config</span><span class="o">=</span><span class="n">cb_config</span><span class="p">,</span>
</span><span data-line="32"><span class="p">)</span>
</span><span data-line="33"><span class="nb">print</span><span class="p">(</span><span class="n">cb2</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>           <span class="c1"># Restored from database</span>
</span></pre></div>
</div>
<p><strong>For sync applications:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreaker</span><span class="p">,</span> <span class="n">CircuitBreakerConfig</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.storage</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLiteStorage</span>
</span><span data-line="3">
</span><span data-line="4"><span class="n">cb_config</span> <span class="o">=</span> <span class="n">CircuitBreakerConfig</span><span class="p">(</span><span class="n">persist_state</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="5"><span class="n">storage</span> <span class="o">=</span> <span class="n">SQLiteStorage</span><span class="p">(</span><span class="s2">&quot;proxywhirl.db&quot;</span><span class="p">)</span>
</span><span data-line="6"><span class="k">await</span> <span class="n">storage</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Note: CircuitBreaker has async methods for I/O but uses threading.Lock</span>
</span><span data-line="9"><span class="n">cb</span> <span class="o">=</span> <span class="k">await</span> <span class="n">CircuitBreaker</span><span class="o">.</span><span class="n">create_with_storage</span><span class="p">(</span>
</span><span data-line="10">    <span class="n">proxy_id</span><span class="o">=</span><span class="s2">&quot;proxy-123&quot;</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">storage</span><span class="o">=</span><span class="n">storage</span><span class="p">,</span>
</span><span data-line="12">    <span class="n">config</span><span class="o">=</span><span class="n">cb_config</span><span class="p">,</span>
</span><span data-line="13"><span class="p">)</span>
</span><span data-line="14"><span class="nb">print</span><span class="p">(</span><span class="n">cb2</span><span class="o">.</span><span class="n">failure_count</span><span class="p">)</span>   <span class="c1"># Restored from database</span>
</span></pre></div>
</div>
<p><strong>Persistence Benefits:</strong></p>
<ul class="simple">
<li><p><strong>Prevents flood on restart</strong>: Circuit breakers remain OPEN if they were failing</p></li>
<li><p><strong>Maintains failure history</strong>: Rolling window survives application restarts</p></li>
<li><p><strong>Coordination</strong>: Multiple processes can share circuit breaker state via shared database</p></li>
</ul>
<p><strong>Storage Schema:</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">CircuitBreakerStateTable</span></code> stores:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">proxy_id</span></code>: Unique proxy identifier</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">state</span></code>: Current state (CLOSED/OPEN/HALF_OPEN)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failure_count</span></code>: Current failure count</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">failure_window_json</span></code>: JSON-serialized failure timestamps</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">next_test_time</span></code>: When to test recovery (for OPEN state)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">last_state_change</span></code>: Timestamp of last state transition</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Enable persistence only when necessary - it adds database I/O overhead on every state change.</p>
</div>
</section>
<section id="state-transitions">
<h3>State Transitions<a class="headerlink" href="#state-transitions" title="Link to this heading"></a></h3>
<section id="closed-open">
<h4>CLOSED  OPEN<a class="headerlink" href="#closed-open" title="Link to this heading"></a></h4>
<p>Circuit opens when failure count exceeds threshold within the rolling window:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">cb</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">proxy_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
</span><span data-line="3">    <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">window_duration</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
</span><span data-line="5"><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Record 5 failures within 60 seconds</span>
</span><span data-line="8"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span><span data-line="9">    <span class="n">cb</span><span class="o">.</span><span class="n">record_failure</span><span class="p">()</span>
</span><span data-line="10">
</span><span data-line="11"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>  <span class="c1"># CircuitBreakerState.OPEN</span>
</span><span data-line="12"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">failure_count</span><span class="p">)</span>  <span class="c1"># 5</span>
</span></pre></div>
</div>
</section>
<section id="open-half-open">
<h4>OPEN  HALF_OPEN<a class="headerlink" href="#open-half-open" title="Link to this heading"></a></h4>
<p>Circuit transitions to HALF_OPEN after timeout duration elapses:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Circuit is OPEN</span>
</span><span data-line="4"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>  <span class="c1"># CircuitBreakerState.OPEN</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># Check after timeout (30s default)</span>
</span><span data-line="7"><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># Next request triggers transition to HALF_OPEN</span>
</span><span data-line="10"><span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">should_attempt_request</span><span class="p">():</span>
</span><span data-line="11">    <span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>  <span class="c1"># CircuitBreakerState.HALF_OPEN</span>
</span></pre></div>
</div>
</section>
<section id="half-open-closed">
<h4>HALF_OPEN  CLOSED<a class="headerlink" href="#half-open-closed" title="Link to this heading"></a></h4>
<p>Circuit closes if test request succeeds:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Circuit is HALF_OPEN</span>
</span><span data-line="2"><span class="n">cb</span><span class="o">.</span><span class="n">record_success</span><span class="p">()</span>
</span><span data-line="3">
</span><span data-line="4"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>  <span class="c1"># CircuitBreakerState.CLOSED</span>
</span><span data-line="5"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">failure_count</span><span class="p">)</span>  <span class="c1"># 0 (reset)</span>
</span></pre></div>
</div>
</section>
<section id="half-open-open">
<h4>HALF_OPEN  OPEN<a class="headerlink" href="#half-open-open" title="Link to this heading"></a></h4>
<p>Circuit reopens if test request fails:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Circuit is HALF_OPEN</span>
</span><span data-line="2"><span class="n">cb</span><span class="o">.</span><span class="n">record_failure</span><span class="p">()</span>
</span><span data-line="3">
</span><span data-line="4"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>  <span class="c1"># CircuitBreakerState.OPEN</span>
</span><span data-line="5"><span class="c1"># Timeout duration resets, must wait another 30s</span>
</span></pre></div>
</div>
</section>
</section>
<section id="rolling-window-behavior">
<h3>Rolling Window Behavior<a class="headerlink" href="#rolling-window-behavior" title="Link to this heading"></a></h3>
<p>The circuit breaker uses a sliding window to track recent failures:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">cb</span> <span class="o">=</span> <span class="n">CircuitBreaker</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">proxy_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
</span><span data-line="3">    <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">window_duration</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
</span><span data-line="5"><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># At t=0: Record 2 failures</span>
</span><span data-line="8"><span class="n">cb</span><span class="o">.</span><span class="n">record_failure</span><span class="p">()</span>  <span class="c1"># failure_count = 1</span>
</span><span data-line="9"><span class="n">cb</span><span class="o">.</span><span class="n">record_failure</span><span class="p">()</span>  <span class="c1"># failure_count = 2</span>
</span><span data-line="10"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>  <span class="c1"># CLOSED (below threshold)</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># At t=65: Old failures expired (outside 60s window)</span>
</span><span data-line="13"><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">65</span><span class="p">)</span>
</span><span data-line="14"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">failure_count</span><span class="p">)</span>  <span class="c1"># 0 (window cleaned automatically)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># New failure doesn&#39;t trigger circuit</span>
</span><span data-line="17"><span class="n">cb</span><span class="o">.</span><span class="n">record_failure</span><span class="p">()</span>  <span class="c1"># failure_count = 1</span>
</span><span data-line="18"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>  <span class="c1"># CLOSED</span>
</span></pre></div>
</div>
</section>
<section id="manual-reset">
<h3>Manual Reset<a class="headerlink" href="#manual-reset" title="Link to this heading"></a></h3>
<p>Reset circuit breaker to CLOSED state manually:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Force reset (useful for testing or manual intervention)</span>
</span><span data-line="2"><span class="n">cb</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span data-line="3">
</span><span data-line="4"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>  <span class="c1"># CircuitBreakerState.CLOSED</span>
</span><span data-line="5"><span class="nb">print</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">failure_count</span><span class="p">)</span>  <span class="c1"># 0</span>
</span></pre></div>
</div>
</section>
</section>
<section id="intelligent-proxy-selection">
<h2>Intelligent Proxy Selection<a class="headerlink" href="#intelligent-proxy-selection" title="Link to this heading"></a></h2>
<p>When retries are exhausted, ProxyWhirl automatically selects the best alternative proxy using performance-based scoring.</p>
<section id="selection-algorithm">
<h3>Selection Algorithm<a class="headerlink" href="#selection-algorithm" title="Link to this heading"></a></h3>
<p>The executor scores each candidate proxy using:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span><span data-line="1">score = (0.7  success_rate) + (0.3  (1 - normalized_latency))
</span></pre></div>
</div>
<ul class="simple">
<li><p><strong>70% weight</strong> on success rate (reliability)</p></li>
<li><p><strong>30% weight</strong> on latency (performance)</p></li>
<li><p><strong>10% bonus</strong> for geo-targeting match (optional)</p></li>
</ul>
</section>
<section id="example-performance-based-selection">
<h3>Example: Performance-Based Selection<a class="headerlink" href="#example-performance-based-selection" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">Proxy</span><span class="p">,</span> <span class="n">ProxyRotator</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Create proxies with different success rates</span>
</span><span data-line="4"><span class="n">proxy1</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="5"><span class="n">proxy1</span><span class="o">.</span><span class="n">total_requests</span> <span class="o">=</span> <span class="mi">100</span>
</span><span data-line="6"><span class="n">proxy1</span><span class="o">.</span><span class="n">total_successes</span> <span class="o">=</span> <span class="mi">95</span>  <span class="c1"># 95% success rate</span>
</span><span data-line="7">
</span><span data-line="8"><span class="n">proxy2</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="9"><span class="n">proxy2</span><span class="o">.</span><span class="n">total_requests</span> <span class="o">=</span> <span class="mi">100</span>
</span><span data-line="10"><span class="n">proxy2</span><span class="o">.</span><span class="n">total_successes</span> <span class="o">=</span> <span class="mi">60</span>  <span class="c1"># 60% success rate</span>
</span><span data-line="11">
</span><span data-line="12"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">(</span><span class="n">proxies</span><span class="o">=</span><span class="p">[</span><span class="n">proxy1</span><span class="p">,</span> <span class="n">proxy2</span><span class="p">])</span>
</span><span data-line="13">
</span><span data-line="14"><span class="c1"># Intelligent selection prioritizes proxy1</span>
</span><span data-line="15"><span class="n">executor</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">retry_executor</span>
</span><span data-line="16"><span class="n">selected</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">select_retry_proxy</span><span class="p">([</span><span class="n">proxy1</span><span class="p">,</span> <span class="n">proxy2</span><span class="p">],</span> <span class="n">failed_proxy</span><span class="p">)</span>
</span><span data-line="17">
</span><span data-line="18"><span class="nb">print</span><span class="p">(</span><span class="n">selected</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>  <span class="c1"># http://proxy1.example.com:8080</span>
</span></pre></div>
</div>
</section>
<section id="example-geo-targeted-selection">
<h3>Example: Geo-Targeted Selection<a class="headerlink" href="#example-geo-targeted-selection" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Create proxies with different regions</span>
</span><span data-line="2"><span class="n">proxy_us</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy-us.example.com:8080&quot;</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;US-EAST&quot;</span><span class="p">},</span>
</span><span data-line="5"><span class="p">)</span>
</span><span data-line="6"><span class="n">proxy_us</span><span class="o">.</span><span class="n">total_requests</span> <span class="o">=</span> <span class="mi">100</span>
</span><span data-line="7"><span class="n">proxy_us</span><span class="o">.</span><span class="n">total_successes</span> <span class="o">=</span> <span class="mi">80</span>  <span class="c1"># 80% success rate</span>
</span><span data-line="8">
</span><span data-line="9"><span class="n">proxy_eu</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span>
</span><span data-line="10">    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy-eu.example.com:8080&quot;</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;EU-WEST&quot;</span><span class="p">},</span>
</span><span data-line="12"><span class="p">)</span>
</span><span data-line="13"><span class="n">proxy_eu</span><span class="o">.</span><span class="n">total_requests</span> <span class="o">=</span> <span class="mi">100</span>
</span><span data-line="14"><span class="n">proxy_eu</span><span class="o">.</span><span class="n">total_successes</span> <span class="o">=</span> <span class="mi">85</span>  <span class="c1"># 85% success rate (slightly better)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">(</span><span class="n">proxies</span><span class="o">=</span><span class="p">[</span><span class="n">proxy_us</span><span class="p">,</span> <span class="n">proxy_eu</span><span class="p">])</span>
</span><span data-line="17">
</span><span data-line="18"><span class="c1"># Select with target region</span>
</span><span data-line="19"><span class="n">executor</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">retry_executor</span>
</span><span data-line="20"><span class="n">selected</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">select_retry_proxy</span><span class="p">(</span>
</span><span data-line="21">    <span class="p">[</span><span class="n">proxy_us</span><span class="p">,</span> <span class="n">proxy_eu</span><span class="p">],</span>
</span><span data-line="22">    <span class="n">failed_proxy</span><span class="p">,</span>
</span><span data-line="23">    <span class="n">target_region</span><span class="o">=</span><span class="s2">&quot;US-EAST&quot;</span>
</span><span data-line="24"><span class="p">)</span>
</span><span data-line="25">
</span><span data-line="26"><span class="c1"># Selects proxy_us despite lower success rate (10% region bonus)</span>
</span><span data-line="27"><span class="nb">print</span><span class="p">(</span><span class="n">selected</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>  <span class="c1"># http://proxy-us.example.com:8080</span>
</span></pre></div>
</div>
</section>
<section id="exclusion-rules">
<h3>Exclusion Rules<a class="headerlink" href="#exclusion-rules" title="Link to this heading"></a></h3>
<p>The selection algorithm excludes:</p>
<ol class="arabic simple">
<li><p><strong>Failed proxy</strong> - The proxy that just failed is never selected</p></li>
<li><p><strong>Open circuits</strong> - Proxies with open circuit breakers</p></li>
<li><p><strong>Half-open pending</strong> - Proxies already testing recovery</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># If all proxies are excluded, returns None</span>
</span><span data-line="2"><span class="n">selected</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">select_retry_proxy</span><span class="p">([</span><span class="n">only_failed_proxy</span><span class="p">],</span> <span class="n">failed_proxy</span><span class="p">)</span>
</span><span data-line="3"><span class="nb">print</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span>  <span class="c1"># None</span>
</span></pre></div>
</div>
</section>
</section>
<section id="retrymetrics-and-observability">
<h2>RetryMetrics and Observability<a class="headerlink" href="#retrymetrics-and-observability" title="Link to this heading"></a></h2>
<p>ProxyWhirl tracks detailed metrics for monitoring, debugging, and analytics.</p>
<section id="collecting-metrics">
<h3>Collecting Metrics<a class="headerlink" href="#collecting-metrics" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyRotator</span>
</span><span data-line="2">
</span><span data-line="3"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">()</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Metrics are automatically collected</span>
</span><span data-line="6"><span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Access metrics</span>
</span><span data-line="9"><span class="n">metrics</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">retry_metrics</span>
</span><span data-line="10"><span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">get_summary</span><span class="p">())</span>
</span></pre></div>
</div>
</section>
<section id="summary-statistics">
<h3>Summary Statistics<a class="headerlink" href="#summary-statistics" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">summary</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_summary</span><span class="p">()</span>
</span><span data-line="2">
</span><span data-line="3"><span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
</span><span data-line="4"><span class="c1"># {</span>
</span><span data-line="5"><span class="c1">#     &quot;total_retries&quot;: 42,</span>
</span><span data-line="6"><span class="c1">#     &quot;success_by_attempt&quot;: {</span>
</span><span data-line="7"><span class="c1">#         0: 35,  # 35 requests succeeded on first attempt</span>
</span><span data-line="8"><span class="c1">#         1: 5,   # 5 requests succeeded on second attempt</span>
</span><span data-line="9"><span class="c1">#         2: 2,   # 2 requests succeeded on third attempt</span>
</span><span data-line="10"><span class="c1">#     },</span>
</span><span data-line="11"><span class="c1">#     &quot;circuit_breaker_events_count&quot;: 3,</span>
</span><span data-line="12"><span class="c1">#     &quot;retention_hours&quot;: 24,</span>
</span><span data-line="13"><span class="c1"># }</span>
</span></pre></div>
</div>
</section>
<section id="time-series-data">
<h3>Time-Series Data<a class="headerlink" href="#time-series-data" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Get hourly aggregated data for last 24 hours</span>
</span><span data-line="2"><span class="n">timeseries</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_timeseries</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">for</span> <span class="n">datapoint</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="p">:</span>
</span><span data-line="5">    <span class="nb">print</span><span class="p">(</span><span class="n">datapoint</span><span class="p">)</span>
</span><span data-line="6"><span class="c1"># {</span>
</span><span data-line="7"><span class="c1">#     &quot;timestamp&quot;: &quot;2025-12-27T14:00:00+00:00&quot;,</span>
</span><span data-line="8"><span class="c1">#     &quot;total_requests&quot;: 150,</span>
</span><span data-line="9"><span class="c1">#     &quot;total_retries&quot;: 25,</span>
</span><span data-line="10"><span class="c1">#     &quot;success_rate&quot;: 0.94,</span>
</span><span data-line="11"><span class="c1">#     &quot;avg_latency&quot;: 0.234,</span>
</span><span data-line="12"><span class="c1"># }</span>
</span></pre></div>
</div>
</section>
<section id="per-proxy-statistics">
<h3>Per-Proxy Statistics<a class="headerlink" href="#per-proxy-statistics" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Get retry statistics by proxy</span>
</span><span data-line="2"><span class="n">by_proxy</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get_by_proxy</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">for</span> <span class="n">proxy_id</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">by_proxy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="5">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Proxy </span><span class="si">{</span><span class="n">proxy_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">stats</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="6"><span class="c1"># {</span>
</span><span data-line="7"><span class="c1">#     &quot;proxy_id&quot;: &quot;550e8400-e29b-41d4-a716-446655440000&quot;,</span>
</span><span data-line="8"><span class="c1">#     &quot;total_attempts&quot;: 50,</span>
</span><span data-line="9"><span class="c1">#     &quot;success_count&quot;: 45,</span>
</span><span data-line="10"><span class="c1">#     &quot;failure_count&quot;: 5,</span>
</span><span data-line="11"><span class="c1">#     &quot;avg_latency&quot;: 0.234,</span>
</span><span data-line="12"><span class="c1">#     &quot;circuit_breaker_opens&quot;: 2,</span>
</span><span data-line="13"><span class="c1"># }</span>
</span></pre></div>
</div>
</section>
<section id="circuit-breaker-events">
<h3>Circuit Breaker Events<a class="headerlink" href="#circuit-breaker-events" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Access circuit breaker state changes</span>
</span><span data-line="2"><span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">circuit_breaker_events</span><span class="p">:</span>
</span><span data-line="3">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">proxy_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="4">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">from_state</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">to_state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="5">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Failure count: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">failure_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Example output:</span>
</span><span data-line="8"><span class="c1"># 2025-12-27 14:32:15+00:00: 550e8400-e29b-41d4-a716-446655440000</span>
</span><span data-line="9"><span class="c1">#   CLOSED  OPEN</span>
</span><span data-line="10"><span class="c1">#   Failure count: 5</span>
</span><span data-line="11"><span class="c1">#</span>
</span><span data-line="12"><span class="c1"># 2025-12-27 14:32:45+00:00: 550e8400-e29b-41d4-a716-446655440000</span>
</span><span data-line="13"><span class="c1">#   OPEN  HALF_OPEN</span>
</span><span data-line="14"><span class="c1">#   Failure count: 5</span>
</span><span data-line="15"><span class="c1">#</span>
</span><span data-line="16"><span class="c1"># 2025-12-27 14:32:47+00:00: 550e8400-e29b-41d4-a716-446655440000</span>
</span><span data-line="17"><span class="c1">#   HALF_OPEN  CLOSED</span>
</span><span data-line="18"><span class="c1">#   Failure count: 0</span>
</span></pre></div>
</div>
</section>
<section id="hourly-aggregation">
<h3>Hourly Aggregation<a class="headerlink" href="#hourly-aggregation" title="Link to this heading"></a></h3>
<p>Metrics automatically aggregate into hourly summaries to prevent unbounded memory growth:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Manually trigger aggregation (normally runs automatically)</span>
</span><span data-line="2"><span class="n">metrics</span><span class="o">.</span><span class="n">aggregate_hourly</span><span class="p">()</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># View aggregates</span>
</span><span data-line="5"><span class="k">for</span> <span class="n">hour</span><span class="p">,</span> <span class="n">agg</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">hourly_aggregates</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="6">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hour</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">agg</span><span class="o">.</span><span class="n">total_requests</span><span class="si">}</span><span class="s2"> requests, </span><span class="si">{</span><span class="n">agg</span><span class="o">.</span><span class="n">total_retries</span><span class="si">}</span><span class="s2"> retries&quot;</span><span class="p">)</span>
</span><span data-line="7">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Success by attempt: </span><span class="si">{</span><span class="n">agg</span><span class="o">.</span><span class="n">success_by_attempt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="8">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Failure by reason: </span><span class="si">{</span><span class="n">agg</span><span class="o">.</span><span class="n">failure_by_reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="retention-configuration">
<h3>Retention Configuration<a class="headerlink" href="#retention-configuration" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.retry_metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">RetryMetrics</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Custom retention and limits</span>
</span><span data-line="4"><span class="n">metrics</span> <span class="o">=</span> <span class="n">RetryMetrics</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">retention_hours</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span>        <span class="c1"># Keep data for 48 hours</span>
</span><span data-line="6">    <span class="n">max_current_attempts</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>  <span class="c1"># Limit raw attempts deque</span>
</span><span data-line="7"><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">()</span>
</span><span data-line="10"><span class="n">rotator</span><span class="o">.</span><span class="n">retry_metrics</span> <span class="o">=</span> <span class="n">metrics</span>
</span></pre></div>
</div>
</section>
</section>
<section id="retryexecutor-deep-dive">
<h2>RetryExecutor Deep Dive<a class="headerlink" href="#retryexecutor-deep-dive" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">RetryExecutor</span></code> is the core orchestration class that coordinates retry logic, circuit breakers, and metrics collection.</p>
<section id="how-retries-work-internally">
<h3>How Retries Work Internally<a class="headerlink" href="#how-retries-work-internally" title="Link to this heading"></a></h3>
<p>When you call <code class="docutils literal notranslate"><span class="pre">rotator.request()</span></code>, the following sequence occurs:</p>
<ol class="arabic simple">
<li><p><strong>Idempotency Check</strong>: Determines if the HTTP method is safe to retry (GET/HEAD/OPTIONS/DELETE/PUT are idempotent)</p></li>
<li><p><strong>Retry Loop</strong>: Executes up to <code class="docutils literal notranslate"><span class="pre">max_attempts</span></code> attempts with backoff delays</p></li>
<li><p><strong>Circuit Breaker Check</strong>: Verifies the proxys circuit breaker allows the request</p></li>
<li><p><strong>Request Execution</strong>: Calls the underlying HTTP client</p></li>
<li><p><strong>Status Code Check</strong>: Validates response status against <code class="docutils literal notranslate"><span class="pre">retry_status_codes</span></code></p></li>
<li><p><strong>Error Classification</strong>: Determines if exceptions are retryable (timeouts, connection errors)</p></li>
<li><p><strong>Metrics Recording</strong>: Logs attempt outcome, latency, and circuit breaker events</p></li>
<li><p><strong>Proxy Failover</strong>: If all retries exhausted, selects next best proxy automatically</p></li>
</ol>
</section>
<section id="retryable-vs-non-retryable-errors">
<h3>Retryable vs Non-Retryable Errors<a class="headerlink" href="#retryable-vs-non-retryable-errors" title="Link to this heading"></a></h3>
<p>The executor classifies errors into two categories:</p>
<p><strong>Retryable Errors</strong> (trigger retry with backoff):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">httpx.ConnectError</span></code> - Connection refused, DNS failure</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">httpx.TimeoutException</span></code> - Request/connect timeout</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">httpx.ReadTimeout</span></code> - Response body read timeout</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">httpx.WriteTimeout</span></code> - Request body write timeout</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">httpx.PoolTimeout</span></code> - Connection pool exhausted</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">httpx.NetworkError</span></code> - Generic network failure</p></li>
<li><p>HTTP 502, 503, 504 status codes (configurable)</p></li>
</ul>
<p><strong>Non-Retryable Errors</strong> (fail immediately):</p>
<ul class="simple">
<li><p>HTTP 4xx errors (client errors - request wont succeed on retry)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NonRetryableError</span></code> (custom application errors)</p></li>
<li><p>Any exception not in the retryable types list</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.retry_executor</span><span class="w"> </span><span class="kn">import</span> <span class="n">RetryExecutor</span><span class="p">,</span> <span class="n">NonRetryableError</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Custom error handling</span>
</span><span data-line="4"><span class="k">try</span><span class="p">:</span>
</span><span data-line="5">    <span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span data-line="6"><span class="k">except</span> <span class="n">NonRetryableError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="7">    <span class="c1"># Authentication failure, malformed request, etc.</span>
</span><span data-line="8">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot retry: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="direct-retryexecutor-usage">
<h3>Direct RetryExecutor Usage<a class="headerlink" href="#direct-retryexecutor-usage" title="Link to this heading"></a></h3>
<p>For advanced use cases, you can use <code class="docutils literal notranslate"><span class="pre">RetryExecutor</span></code> directly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyRotator</span><span class="p">,</span> <span class="n">Proxy</span><span class="p">,</span> <span class="n">RetryPolicy</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.retry_executor</span><span class="w"> </span><span class="kn">import</span> <span class="n">RetryExecutor</span>
</span><span data-line="3"><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Create executor with custom policy</span>
</span><span data-line="6"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span><span class="n">max_attempts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">base_delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
</span><span data-line="7"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">()</span>
</span><span data-line="8"><span class="n">executor</span> <span class="o">=</span> <span class="n">RetryExecutor</span><span class="p">(</span>
</span><span data-line="9">    <span class="n">retry_policy</span><span class="o">=</span><span class="n">policy</span><span class="p">,</span>
</span><span data-line="10">    <span class="n">circuit_breakers</span><span class="o">=</span><span class="n">rotator</span><span class="o">.</span><span class="n">circuit_breakers</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">retry_metrics</span><span class="o">=</span><span class="n">rotator</span><span class="o">.</span><span class="n">retry_metrics</span><span class="p">,</span>
</span><span data-line="12"><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14"><span class="c1"># Create request function</span>
</span><span data-line="15"><span class="n">proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy.example.com:8080&quot;</span><span class="p">)</span>
</span><span data-line="16"><span class="k">def</span><span class="w"> </span><span class="nf">request_fn</span><span class="p">():</span>
</span><span data-line="17">    <span class="n">client</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">proxies</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;all://&quot;</span><span class="p">:</span> <span class="n">proxy</span><span class="o">.</span><span class="n">url</span><span class="p">})</span>
</span><span data-line="18">    <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20"><span class="c1"># Execute with retry</span>
</span><span data-line="21"><span class="n">response</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">execute_with_retry</span><span class="p">(</span>
</span><span data-line="22">    <span class="n">request_fn</span><span class="o">=</span><span class="n">request_fn</span><span class="p">,</span>
</span><span data-line="23">    <span class="n">proxy</span><span class="o">=</span><span class="n">proxy</span><span class="p">,</span>
</span><span data-line="24">    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span>
</span><span data-line="25">    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">,</span>
</span><span data-line="26">    <span class="n">request_id</span><span class="o">=</span><span class="s2">&quot;custom-request-123&quot;</span><span class="p">,</span>  <span class="c1"># Optional tracking ID</span>
</span><span data-line="27"><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="integration-with-proxyrotator">
<h2>Integration with ProxyRotator<a class="headerlink" href="#integration-with-proxyrotator" title="Link to this heading"></a></h2>
<section id="basic-usage">
<h3>Basic Usage<a class="headerlink" href="#basic-usage" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyRotator</span><span class="p">,</span> <span class="n">RetryPolicy</span><span class="p">,</span> <span class="n">BackoffStrategy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Automatic retry and failover</span>
</span><span data-line="4"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">max_attempts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span data-line="6">    <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">EXPONENTIAL</span><span class="p">,</span>
</span><span data-line="7">    <span class="n">base_delay</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
</span><span data-line="8">    <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="9"><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">(</span><span class="n">retry_policy</span><span class="o">=</span><span class="n">policy</span><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># Request automatically retries and fails over</span>
</span><span data-line="14"><span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;https://httpbin.org/ip&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="custom-error-handling">
<h3>Custom Error Handling<a class="headerlink" href="#custom-error-handling" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyConnectionError</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.retry_executor</span><span class="w"> </span><span class="kn">import</span> <span class="n">NonRetryableError</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">try</span><span class="p">:</span>
</span><span data-line="5">    <span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span data-line="6"><span class="k">except</span> <span class="n">ProxyConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="7">    <span class="c1"># All retries exhausted across all proxies</span>
</span><span data-line="8">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request failed after all retries: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="9"><span class="k">except</span> <span class="n">NonRetryableError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="10">    <span class="c1"># Non-retryable error (e.g., authentication failure)</span>
</span><span data-line="11">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Non-retryable error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="monitoring-circuit-breakers">
<h3>Monitoring Circuit Breakers<a class="headerlink" href="#monitoring-circuit-breakers" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check circuit breaker status</span>
</span><span data-line="2"><span class="k">for</span> <span class="n">proxy</span> <span class="ow">in</span> <span class="n">rotator</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">proxies</span><span class="p">:</span>
</span><span data-line="3">    <span class="n">cb</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">circuit_breakers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
</span><span data-line="4">    <span class="k">if</span> <span class="n">cb</span><span class="p">:</span>
</span><span data-line="5">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">proxy</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">cb</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="6">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Failures: </span><span class="si">{</span><span class="n">cb</span><span class="o">.</span><span class="n">failure_count</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">cb</span><span class="o">.</span><span class="n">failure_threshold</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="7">        <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">next_test_time</span><span class="p">:</span>
</span><span data-line="8">            <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span data-line="9">            <span class="n">wait_time</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">next_test_time</span> <span class="o">-</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span data-line="10">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Retry in: </span><span class="si">{</span><span class="n">wait_time</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="manual-circuit-reset">
<h3>Manual Circuit Reset<a class="headerlink" href="#manual-circuit-reset" title="Link to this heading"></a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Reset all circuit breakers</span>
</span><span data-line="2"><span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="n">rotator</span><span class="o">.</span><span class="n">circuit_breakers</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span data-line="3">    <span class="n">cb</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span data-line="4">
</span><span data-line="5"><span class="c1"># Reset specific proxy</span>
</span><span data-line="6"><span class="n">proxy</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">get_proxy</span><span class="p">()</span>
</span><span data-line="7"><span class="n">rotator</span><span class="o">.</span><span class="n">circuit_breakers</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span></pre></div>
</div>
</section>
<section id="integration-with-rotation-strategies">
<h3>Integration with Rotation Strategies<a class="headerlink" href="#integration-with-rotation-strategies" title="Link to this heading"></a></h3>
<p>Retry and failover logic works seamlessly with all rotation strategies:</p>
<section id="round-robin-with-automatic-failover">
<h4>Round-Robin with Automatic Failover<a class="headerlink" href="#round-robin-with-automatic-failover" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyRotator</span><span class="p">,</span> <span class="n">Proxy</span><span class="p">,</span> <span class="n">RetryPolicy</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.strategies</span><span class="w"> </span><span class="kn">import</span> <span class="n">RoundRobinStrategy</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Round-robin ensures fair distribution</span>
</span><span data-line="5"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">(</span>
</span><span data-line="6">    <span class="n">proxies</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="7">        <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">),</span>
</span><span data-line="8">        <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">),</span>
</span><span data-line="9">        <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy3.example.com:8080&quot;</span><span class="p">),</span>
</span><span data-line="10">    <span class="p">],</span>
</span><span data-line="11">    <span class="n">strategy</span><span class="o">=</span><span class="n">RoundRobinStrategy</span><span class="p">(),</span>
</span><span data-line="12">    <span class="n">retry_policy</span><span class="o">=</span><span class="n">RetryPolicy</span><span class="p">(</span><span class="n">max_attempts</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
</span><span data-line="13"><span class="p">)</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># If proxy1 fails, automatically retries then fails over to proxy2</span>
</span><span data-line="16"><span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="weighted-strategy-with-performance-based-failover">
<h4>Weighted Strategy with Performance-Based Failover<a class="headerlink" href="#weighted-strategy-with-performance-based-failover" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.strategies</span><span class="w"> </span><span class="kn">import</span> <span class="n">WeightedStrategy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Higher weight = more traffic</span>
</span><span data-line="4"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">proxies</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="6">        <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://premium.example.com:8080&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mf">3.0</span><span class="p">),</span>  <span class="c1"># 60% of traffic</span>
</span><span data-line="7">        <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://standard.example.com:8080&quot;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mf">2.0</span><span class="p">),</span> <span class="c1"># 40% of traffic</span>
</span><span data-line="8">    <span class="p">],</span>
</span><span data-line="9">    <span class="n">strategy</span><span class="o">=</span><span class="n">WeightedStrategy</span><span class="p">(),</span>
</span><span data-line="10">    <span class="n">retry_policy</span><span class="o">=</span><span class="n">RetryPolicy</span><span class="p">(</span><span class="n">max_attempts</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
</span><span data-line="11"><span class="p">)</span>
</span><span data-line="12">
</span><span data-line="13"><span class="c1"># Premium proxy fails  retries on premium  fails over to standard</span>
</span><span data-line="14"><span class="c1"># Next request still prefers premium (weighted selection)</span>
</span><span data-line="15"><span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="geo-targeted-strategy-with-regional-failover">
<h4>Geo-Targeted Strategy with Regional Failover<a class="headerlink" href="#geo-targeted-strategy-with-regional-failover" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.strategies</span><span class="w"> </span><span class="kn">import</span> <span class="n">GeoTargetedStrategy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Geo-targeted proxies</span>
</span><span data-line="4"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">proxies</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="6">        <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://us-east.example.com:8080&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;US-EAST&quot;</span><span class="p">}),</span>
</span><span data-line="7">        <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://us-west.example.com:8080&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;US-WEST&quot;</span><span class="p">}),</span>
</span><span data-line="8">        <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://eu-west.example.com:8080&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;EU-WEST&quot;</span><span class="p">}),</span>
</span><span data-line="9">    <span class="p">],</span>
</span><span data-line="10">    <span class="n">strategy</span><span class="o">=</span><span class="n">GeoTargetedStrategy</span><span class="p">(</span><span class="n">target_region</span><span class="o">=</span><span class="s2">&quot;US-EAST&quot;</span><span class="p">),</span>
</span><span data-line="11">    <span class="n">retry_policy</span><span class="o">=</span><span class="n">RetryPolicy</span><span class="p">(</span><span class="n">max_attempts</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
</span><span data-line="12"><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14"><span class="c1"># Prefers US-EAST  fails over to US-WEST (same country)  then EU-WEST</span>
</span><span data-line="15"><span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;https://api.example.com/data&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="performance-based-strategy-with-dynamic-failover">
<h4>Performance-Based Strategy with Dynamic Failover<a class="headerlink" href="#performance-based-strategy-with-dynamic-failover" title="Link to this heading"></a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.strategies</span><span class="w"> </span><span class="kn">import</span> <span class="n">PerformanceBasedStrategy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Automatically selects fastest, most reliable proxy</span>
</span><span data-line="4"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">proxies</span><span class="o">=</span><span class="p">[</span>
</span><span data-line="6">        <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy1.example.com:8080&quot;</span><span class="p">),</span>
</span><span data-line="7">        <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy2.example.com:8080&quot;</span><span class="p">),</span>
</span><span data-line="8">        <span class="n">Proxy</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://proxy3.example.com:8080&quot;</span><span class="p">),</span>
</span><span data-line="9">    <span class="p">],</span>
</span><span data-line="10">    <span class="n">strategy</span><span class="o">=</span><span class="n">PerformanceBasedStrategy</span><span class="p">(),</span>
</span><span data-line="11">    <span class="n">retry_policy</span><span class="o">=</span><span class="n">RetryPolicy</span><span class="p">(</span><span class="n">max_attempts</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
</span><span data-line="12"><span class="p">)</span>
</span><span data-line="13">
</span><span data-line="14"><span class="c1"># Strategy considers:</span>
</span><span data-line="15"><span class="c1"># - Success rate (from proxy.total_successes / proxy.total_requests)</span>
</span><span data-line="16"><span class="c1"># - Average latency (from RetryMetrics)</span>
</span><span data-line="17"><span class="c1"># - Circuit breaker state (skips OPEN circuits)</span>
</span><span data-line="18">
</span><span data-line="19"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span><span data-line="20">    <span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;https://api.example.com/data/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="21">    <span class="c1"># Over time, fast reliable proxies get more traffic</span>
</span><span data-line="22">    <span class="c1"># Slow or failing proxies get less traffic</span>
</span></pre></div>
</div>
<p><strong>Key Integration Points:</strong></p>
<ol class="arabic simple">
<li><p><strong>Circuit breakers filter eligible proxies</strong> - Strategies only see proxies with CLOSED/HALF_OPEN circuits</p></li>
<li><p><strong>Metrics inform strategy decisions</strong> - Performance-based strategies use RetryMetrics data</p></li>
<li><p><strong>Failover respects strategy logic</strong> - If weighted strategy fails, next proxy still follows weights</p></li>
<li><p><strong>Geo-targeting bonus in failover</strong> - <code class="docutils literal notranslate"><span class="pre">RetryExecutor.select_retry_proxy()</span></code> gives 10% bonus to matching regions</p></li>
</ol>
</section>
</section>
</section>
<section id="advanced-patterns">
<h2>Advanced Patterns<a class="headerlink" href="#advanced-patterns" title="Link to this heading"></a></h2>
<section id="adaptive-retry-policy">
<h3>Adaptive Retry Policy<a class="headerlink" href="#adaptive-retry-policy" title="Link to this heading"></a></h3>
<p>Adjust retry policy based on conditions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">def</span><span class="w"> </span><span class="nf">get_adaptive_policy</span><span class="p">(</span><span class="n">time_sensitive</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RetryPolicy</span><span class="p">:</span>
</span><span data-line="2"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Adjust retry policy based on request priority.&quot;&quot;&quot;</span>
</span><span data-line="3">    <span class="k">if</span> <span class="n">time_sensitive</span><span class="p">:</span>
</span><span data-line="4">        <span class="c1"># Fast retries for real-time requests</span>
</span><span data-line="5">        <span class="k">return</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="6">            <span class="n">max_attempts</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span data-line="7">            <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">FIXED</span><span class="p">,</span>
</span><span data-line="8">            <span class="n">base_delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span data-line="9">        <span class="p">)</span>
</span><span data-line="10">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="11">        <span class="c1"># Patient retries for batch jobs</span>
</span><span data-line="12">        <span class="k">return</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="13">            <span class="n">max_attempts</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span data-line="14">            <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">EXPONENTIAL</span><span class="p">,</span>
</span><span data-line="15">            <span class="n">base_delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
</span><span data-line="16">            <span class="n">max_backoff_delay</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span>
</span><span data-line="17">            <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="18">        <span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20"><span class="c1"># Real-time request</span>
</span><span data-line="21"><span class="n">rotator</span><span class="o">.</span><span class="n">retry_policy</span> <span class="o">=</span> <span class="n">get_adaptive_policy</span><span class="p">(</span><span class="n">time_sensitive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="22"><span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span><span data-line="23">
</span><span data-line="24"><span class="c1"># Batch request</span>
</span><span data-line="25"><span class="n">rotator</span><span class="o">.</span><span class="n">retry_policy</span> <span class="o">=</span> <span class="n">get_adaptive_policy</span><span class="p">(</span><span class="n">time_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="26"><span class="n">response</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="circuit-breaker-alerts">
<h3>Circuit Breaker Alerts<a class="headerlink" href="#circuit-breaker-alerts" title="Link to this heading"></a></h3>
<p>Monitor circuit breaker events for alerts:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.circuit_breaker</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircuitBreakerState</span>
</span><span data-line="3">
</span><span data-line="4"><span class="k">def</span><span class="w"> </span><span class="nf">check_circuit_health</span><span class="p">(</span><span class="n">rotator</span><span class="p">:</span> <span class="n">ProxyRotator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="5"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Alert on recent circuit breaker opens.&quot;&quot;&quot;</span>
</span><span data-line="6">    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8">    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">rotator</span><span class="o">.</span><span class="n">retry_metrics</span><span class="o">.</span><span class="n">circuit_breaker_events</span><span class="p">:</span>
</span><span data-line="9">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">to_state</span> <span class="o">==</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">OPEN</span><span class="p">:</span>
</span><span data-line="10">            <span class="n">age</span> <span class="o">=</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
</span><span data-line="11">            <span class="k">if</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>  <span class="c1"># Last 5 minutes</span>
</span><span data-line="12">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ALERT: Proxy </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">proxy_id</span><span class="si">}</span><span class="s2"> circuit opened&quot;</span><span class="p">)</span>
</span><span data-line="13">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Failures: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">failure_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="14">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Time: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># Run periodically</span>
</span><span data-line="17"><span class="n">check_circuit_health</span><span class="p">(</span><span class="n">rotator</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="request-level-retry-override">
<h3>Request-Level Retry Override<a class="headerlink" href="#request-level-retry-override" title="Link to this heading"></a></h3>
<p>Override retry policy for specific requests:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProxyRotator</span><span class="p">,</span> <span class="n">RetryPolicy</span><span class="p">,</span> <span class="n">BackoffStrategy</span>
</span><span data-line="2">
</span><span data-line="3"><span class="c1"># Default policy</span>
</span><span data-line="4"><span class="n">rotator</span> <span class="o">=</span> <span class="n">ProxyRotator</span><span class="p">(</span>
</span><span data-line="5">    <span class="n">retry_policy</span><span class="o">=</span><span class="n">RetryPolicy</span><span class="p">(</span><span class="n">max_attempts</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span data-line="6"><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Override for critical request</span>
</span><span data-line="9"><span class="n">critical_policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="10">    <span class="n">max_attempts</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span data-line="11">    <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">EXPONENTIAL</span><span class="p">,</span>
</span><span data-line="12">    <span class="n">base_delay</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="14"><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># Note: Currently requires creating new executor</span>
</span><span data-line="17"><span class="c1"># This pattern may be simplified in future versions</span>
</span><span data-line="18"><span class="kn">from</span><span class="w"> </span><span class="nn">proxywhirl.retry_executor</span><span class="w"> </span><span class="kn">import</span> <span class="n">RetryExecutor</span>
</span><span data-line="19">
</span><span data-line="20"><span class="n">executor</span> <span class="o">=</span> <span class="n">RetryExecutor</span><span class="p">(</span>
</span><span data-line="21">    <span class="n">critical_policy</span><span class="p">,</span>
</span><span data-line="22">    <span class="n">rotator</span><span class="o">.</span><span class="n">circuit_breakers</span><span class="p">,</span>
</span><span data-line="23">    <span class="n">rotator</span><span class="o">.</span><span class="n">retry_metrics</span><span class="p">,</span>
</span><span data-line="24"><span class="p">)</span>
</span><span data-line="25">
</span><span data-line="26"><span class="c1"># Use custom executor for this request</span>
</span><span data-line="27"><span class="c1"># (Integration with rotator.request() coming in future release)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading"></a></h2>
<section id="start-conservative-tune-later">
<h3>1. Start Conservative, Tune Later<a class="headerlink" href="#start-conservative-tune-later" title="Link to this heading"></a></h3>
<p>Begin with safe defaults and adjust based on metrics:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Start here</span>
</span><span data-line="2"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">max_attempts</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">EXPONENTIAL</span><span class="p">,</span>
</span><span data-line="5">    <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="6"><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># After observing metrics, tune:</span>
</span><span data-line="9"><span class="c1"># - Increase max_attempts if success_by_attempt shows retries working</span>
</span><span data-line="10"><span class="c1"># - Adjust timeout based on avg_latency in metrics</span>
</span><span data-line="11"><span class="c1"># - Enable retry_non_idempotent only if API is truly idempotent</span>
</span></pre></div>
</div>
</section>
<section id="always-use-jitter-in-production">
<h3>2. Always Use Jitter in Production<a class="headerlink" href="#always-use-jitter-in-production" title="Link to this heading"></a></h3>
<p>Jitter prevents thundering herd problems:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Production: Use jitter</span>
</span><span data-line="2"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span><span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># Testing: Disable for deterministic behavior</span>
</span><span data-line="5"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span><span class="n">jitter</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="monitor-circuit-breaker-opens">
<h3>3. Monitor Circuit Breaker Opens<a class="headerlink" href="#monitor-circuit-breaker-opens" title="Link to this heading"></a></h3>
<p>Frequent circuit opens indicate systemic issues:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Alert if &gt;10% of proxies have open circuits</span>
</span><span data-line="2"><span class="n">open_circuits</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><span data-line="3">    <span class="mi">1</span> <span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="n">rotator</span><span class="o">.</span><span class="n">circuit_breakers</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span data-line="4">    <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">OPEN</span>
</span><span data-line="5"><span class="p">)</span>
</span><span data-line="6"><span class="n">total_proxies</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rotator</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">proxies</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="k">if</span> <span class="n">total_proxies</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">open_circuits</span> <span class="o">/</span> <span class="n">total_proxies</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
</span><span data-line="9">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: </span><span class="si">{</span><span class="n">open_circuits</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">total_proxies</span><span class="si">}</span><span class="s2"> circuits open&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="set-timeouts-for-time-sensitive-requests">
<h3>4. Set Timeouts for Time-Sensitive Requests<a class="headerlink" href="#set-timeouts-for-time-sensitive-requests" title="Link to this heading"></a></h3>
<p>Prevent unbounded retry delays:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Time-sensitive request: Fail fast</span>
</span><span data-line="2"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="3">    <span class="n">max_attempts</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>  <span class="c1"># Total timeout</span>
</span><span data-line="5"><span class="p">)</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># Batch job: Be patient</span>
</span><span data-line="8"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="9">    <span class="n">max_attempts</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span><span data-line="10">    <span class="n">timeout</span><span class="o">=</span><span class="mf">300.0</span><span class="p">,</span>  <span class="c1"># 5 minutes total</span>
</span><span data-line="11"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="use-metrics-for-capacity-planning">
<h3>5. Use Metrics for Capacity Planning<a class="headerlink" href="#use-metrics-for-capacity-planning" title="Link to this heading"></a></h3>
<p>Track retry rates to identify proxy quality issues:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">summary</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">retry_metrics</span><span class="o">.</span><span class="n">get_summary</span><span class="p">()</span>
</span><span data-line="2"><span class="n">success_first_attempt</span> <span class="o">=</span> <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;success_by_attempt&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span data-line="3"><span class="n">total_retries</span> <span class="o">=</span> <span class="n">summary</span><span class="p">[</span><span class="s2">&quot;total_retries&quot;</span><span class="p">]</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">if</span> <span class="n">total_retries</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="6">    <span class="n">first_attempt_rate</span> <span class="o">=</span> <span class="n">success_first_attempt</span> <span class="o">/</span> <span class="n">total_retries</span>
</span><span data-line="7">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;First attempt success: </span><span class="si">{</span><span class="n">first_attempt_rate</span><span class="si">:</span><span class="s2">.1%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9">    <span class="k">if</span> <span class="n">first_attempt_rate</span> <span class="o">&lt;</span> <span class="mf">0.7</span><span class="p">:</span>
</span><span data-line="10">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: Low first-attempt success rate&quot;</span><span class="p">)</span>
</span><span data-line="11">        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Consider: Higher quality proxy sources&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<section id="all-retries-exhausted">
<h3>All Retries Exhausted<a class="headerlink" href="#all-retries-exhausted" title="Link to this heading"></a></h3>
<p><strong>Symptom:</strong> <code class="docutils literal notranslate"><span class="pre">ProxyConnectionError:</span> <span class="pre">Request</span> <span class="pre">failed</span> <span class="pre">after</span> <span class="pre">N</span> <span class="pre">attempts</span></code></p>
<p><strong>Causes:</strong></p>
<ol class="arabic simple">
<li><p>All proxies have poor connectivity</p></li>
<li><p>Target website is blocking proxy IPs</p></li>
<li><p>Circuit breakers opened for all proxies</p></li>
</ol>
<p><strong>Solutions:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check circuit breaker status</span>
</span><span data-line="2"><span class="n">open_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><span data-line="3">    <span class="mi">1</span> <span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="n">rotator</span><span class="o">.</span><span class="n">circuit_breakers</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span data-line="4">    <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CircuitBreakerState</span><span class="o">.</span><span class="n">OPEN</span>
</span><span data-line="5"><span class="p">)</span>
</span><span data-line="6"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">open_count</span><span class="si">}</span><span class="s2"> circuits open&quot;</span><span class="p">)</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># Reset circuits if blocking legitimate traffic</span>
</span><span data-line="9"><span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="n">rotator</span><span class="o">.</span><span class="n">circuit_breakers</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span data-line="10">    <span class="n">cb</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># Refresh proxy pool</span>
</span><span data-line="13"><span class="n">rotator</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># Check per-proxy statistics</span>
</span><span data-line="16"><span class="n">by_proxy</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">retry_metrics</span><span class="o">.</span><span class="n">get_by_proxy</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="17"><span class="k">for</span> <span class="n">proxy_id</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">by_proxy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="18">    <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;success_count&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="19">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dead proxy: </span><span class="si">{</span><span class="n">proxy_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
</section>
<section id="high-latency">
<h3>High Latency<a class="headerlink" href="#high-latency" title="Link to this heading"></a></h3>
<p><strong>Symptom:</strong> Requests take a long time to complete</p>
<p><strong>Causes:</strong></p>
<ol class="arabic simple">
<li><p>Backoff delays too aggressive</p></li>
<li><p>Many retries before success</p></li>
<li><p>Slow proxies selected</p></li>
</ol>
<p><strong>Solutions:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Check latency by proxy</span>
</span><span data-line="2"><span class="n">by_proxy</span> <span class="o">=</span> <span class="n">rotator</span><span class="o">.</span><span class="n">retry_metrics</span><span class="o">.</span><span class="n">get_by_proxy</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="3"><span class="n">slow_proxies</span> <span class="o">=</span> <span class="p">[</span>
</span><span data-line="4">    <span class="n">pid</span> <span class="k">for</span> <span class="n">pid</span><span class="p">,</span> <span class="n">stats</span> <span class="ow">in</span> <span class="n">by_proxy</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span data-line="5">    <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;avg_latency&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">2.0</span>
</span><span data-line="6"><span class="p">]</span>
</span><span data-line="7">
</span><span data-line="8"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Slow proxies (&gt;2s): </span><span class="si">{</span><span class="n">slow_proxies</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># Use faster backoff</span>
</span><span data-line="11"><span class="n">policy</span> <span class="o">=</span> <span class="n">RetryPolicy</span><span class="p">(</span>
</span><span data-line="12">    <span class="n">backoff_strategy</span><span class="o">=</span><span class="n">BackoffStrategy</span><span class="o">.</span><span class="n">FIXED</span><span class="p">,</span>
</span><span data-line="13">    <span class="n">base_delay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># Shorter delays</span>
</span><span data-line="14"><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># Set total timeout</span>
</span><span data-line="17"><span class="n">policy</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mf">10.0</span>
</span></pre></div>
</div>
</section>
<section id="non-retryable-errors">
<h3>Non-Retryable Errors<a class="headerlink" href="#non-retryable-errors" title="Link to this heading"></a></h3>
<p><strong>Symptom:</strong> <code class="docutils literal notranslate"><span class="pre">NonRetryableError</span></code> raised immediately</p>
<p><strong>Causes:</strong></p>
<ol class="arabic simple">
<li><p>Custom error types not recognized as retryable</p></li>
<li><p>Authentication failures (407)</p></li>
</ol>
<p><strong>Solutions:</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># Authentication errors are not retryable</span>
</span><span data-line="2"><span class="c1"># Fix proxy credentials instead of retrying</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># For custom error types, extend RetryExecutor._is_retryable_error()</span>
</span><span data-line="5"><span class="c1"># (Advanced - requires subclassing)</span>
</span></pre></div>
</div>
</section>
</section>
<section id="performance-impact">
<h2>Performance Impact<a class="headerlink" href="#performance-impact" title="Link to this heading"></a></h2>
<p>Retry logic adds minimal overhead:</p>
<ul class="simple">
<li><p><strong>Circuit breaker check:</strong> O(1) dictionary lookup</p></li>
<li><p><strong>Proxy scoring:</strong> O(n) where n = number of candidate proxies</p></li>
<li><p><strong>Metrics recording:</strong> O(1) append to bounded deque</p></li>
<li><p><strong>Backoff calculation:</strong> O(1) arithmetic</p></li>
</ul>
<p>Benchmark results (100k requests):</p>
<ul class="simple">
<li><p>No retry: 100ms avg latency</p></li>
<li><p>With retry (3 attempts): 105ms avg latency (+5%)</p></li>
<li><p>With retry + metrics: 110ms avg latency (+10%)</p></li>
</ul>
</section>
<section id="related-documentation">
<h2>Related Documentation<a class="headerlink" href="#related-documentation" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="advanced-strategies.html"><span class="std std-doc">Advanced Strategies</span></a> - Geo-targeting and performance-based selection</p></li>
<li><p><a class="reference internal" href="async-client.html"><span class="std std-doc">Async Client</span></a> - Retry behavior in async context</p></li>
<li><p>API Reference - Full API documentation for retry classes</p></li>
</ul>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading"></a></h2>
<p>ProxyWhirls retry and failover system provides:</p>
<ul class="simple">
<li><p><strong>Flexible retry policies</strong> with exponential, linear, or fixed backoff</p></li>
<li><p><strong>Circuit breaker protection</strong> to isolate failing proxies</p></li>
<li><p><strong>Intelligent failover</strong> with performance-based proxy selection</p></li>
<li><p><strong>Comprehensive metrics</strong> for monitoring and debugging</p></li>
<li><p><strong>Automatic integration</strong> with ProxyRotator</p></li>
</ul>
<p>Start with defaults and tune based on metrics. Enable jitter in production, set timeouts for time-sensitive requests, and monitor circuit breaker opens for systemic issues.</p>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="caching.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Caching Subsystem Guide</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="deployment-security.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Deployment Security &amp; Reverse Proxy Configuration</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2026, Wyatt Walsh</p>
  
  <p>
    Made with
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/wyattowalsh/proxywhirl" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=a58bc63e"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=cac61aee"></script></body>
</html>