## Architecture

<Mermaid
  chart="flowchart TB
    %% User Interface Layer
    subgraph UI[üéØ User Interface Layer]
        CLI[CLI Interface<br/>cli.py ‚Ä¢ Typer]
        TUI[TUI Application<br/>tui.py ‚Ä¢ Textual]
        API[Python API<br/>proxywhirl.py ‚Ä¢ Async/Sync]
    end

    %% Core Orchestration
    subgraph CORE[‚öôÔ∏è Core Orchestration]
        PW[ProxyWhirl<br/>Main Controller<br/>1195 lines]
        CONFIG[Configuration<br/>config.py ‚Ä¢ Settings]
    end

    %% Data Models
    subgraph MODELS[üìã Data Models]
        CORE_MODELS[Core Models<br/>models.py ‚Ä¢ Pydantic]
        CACHE_MODELS[Cache Models<br/>cache_models.py]
        EXPORT_MODELS[Export Models<br/>export_models.py]
    end

    %% Caching System
    subgraph CACHE[üíæ Caching System]
        CACHE_BASE[Cache Abstraction<br/>caches/base.py]
        MEM[Memory Cache<br/>caches/memory.py]
        JSON[JSON Cache<br/>caches/json.py]
        SQLITE[SQLite Cache<br/>caches/sqlite.py]
        LEGACY[Legacy Cache<br/>cache.py]
    end

    %% Validation System
    subgraph VALID[üîí Validation System]
        VAL[ProxyValidator<br/>validator.py ‚Ä¢ 788 lines]
        CB[Circuit Breaker<br/>Integrated Pattern]
        TARGET[Target-based<br/>Validation]
    end

    %% Rotation Engine
    subgraph ROT[üîÑ Rotation Engine]
        ROTOR[ProxyRotator<br/>rotator.py ‚Ä¢ 402 lines]
        RR[Round Robin]
        RAND[Random Selection]
        WEIGHT[Weighted Distribution]
        HEALTH[Health-based]
        LEAST[Least Used]
    end

    %% Data Loading
    subgraph LOAD[üì° Data Loading]
        BASE_LOADER[BaseLoader<br/>loaders/base.py]
        SPEEDX[TheSpeedX<br/>HTTP/SOCKS]
        CLARKETM[Clarketm<br/>Raw Loader]
        MONOSANS[Monosans<br/>Loader]
        PROXIFLY[Proxifly<br/>Loader]
        JETKAI[JetkaiProxy<br/>List]
        VAKHOV[VakhovFresh<br/>Proxy]
        PROXYSCRAPE[ProxyScrape<br/>Loader]
        USER[UserProvided<br/>Loader]
    end

    %% Export & Monitoring
    subgraph EXPORT[ÔøΩ Export & Monitoring]
        EXP[ProxyExporter<br/>exporter.py ‚Ä¢ 742 lines]
        HEALTH_RPT[Health Reporting<br/>CLI/TUI Integration]
        LOG[Structured Logging<br/>logger.py ‚Ä¢ Loguru]
        UTILS[Utilities<br/>utils.py]
    end

    %% External Services
    subgraph EXT[üåê External Services]
        SOURCES[Proxy Sources<br/>HTTP/SOCKS Endpoints]
        TARGETS[Validation Targets<br/>Test URLs]
        HEALTH_ENDPOINTS[Health Check<br/>Endpoints]
    end

    %% User Interface connections
    CLI --> PW
    TUI --> PW
    API --> PW

    %% Core orchestration flow
    PW --> CONFIG
    PW --> CACHE_BASE
    PW --> VAL
    PW --> ROTOR
    PW --> BASE_LOADER

    %% Model dependencies
    PW --> CORE_MODELS
    CACHE_BASE --> CACHE_MODELS
    EXP --> EXPORT_MODELS

    %% Cache system connections
    CACHE_BASE --> MEM
    CACHE_BASE --> JSON
    CACHE_BASE --> SQLITE
    PW --> LEGACY

    %% Validation system connections
    VAL --> CB
    VAL --> TARGET
    VAL --> TARGETS

    %% Rotation strategies
    ROTOR --> RR
    ROTOR --> RAND
    ROTOR --> WEIGHT
    ROTOR --> HEALTH
    ROTOR --> LEAST

    %% Loading system inheritance
    BASE_LOADER --> SPEEDX
    BASE_LOADER --> CLARKETM
    BASE_LOADER --> MONOSANS
    BASE_LOADER --> PROXIFLY
    BASE_LOADER --> JETKAI
    BASE_LOADER --> VAKHOV
    BASE_LOADER --> PROXYSCRAPE
    BASE_LOADER --> USER

    %% Export and monitoring connections
    PW --> EXP
    CLI --> HEALTH_RPT
    TUI --> HEALTH_RPT
    PW --> LOG
    PW --> UTILS

    %% External connections
    SPEEDX --> SOURCES
    CLARKETM --> SOURCES
    MONOSANS --> SOURCES
    PROXIFLY --> SOURCES
    JETKAI --> SOURCES
    VAKHOV --> SOURCES
    PROXYSCRAPE --> SOURCES
    VAL --> HEALTH_ENDPOINTS
    TARGET --> HEALTH_ENDPOINTS

    %% Data flow
    CACHE_BASE --> ROTOR
    VAL --> CACHE_BASE
    ROTOR --> PW

    %% Styling
    classDef uiLayer fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef coreLayer fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef modelLayer fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px
    classDef cacheLayer fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef validLayer fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef rotLayer fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef loadLayer fill:#e0f2f1,stroke:#00695c,stroke-width:2px
    classDef exportLayer fill:#f1f8e9,stroke:#558b2f,stroke-width:2px
    classDef extLayer fill:#fafafa,stroke:#616161,stroke-width:2px

    class CLI,TUI,API uiLayer
    class PW,CONFIG coreLayer
    class CORE_MODELS,CACHE_MODELS,EXPORT_MODELS modelLayer
    class CACHE_BASE,MEM,JSON,SQLITE,LEGACY cacheLayer
    class VAL,CB,TARGET validLayer
    class ROTOR,RR,RAND,WEIGHT,HEALTH,LEAST rotLayer
    class BASE_LOADER,SPEEDX,CLARKETM,MONOSANS,PROXIFLY,JETKAI,VAKHOV,PROXYSCRAPE,USER loadLayer
    class EXP,HEALTH_RPT,LOG,UTILS exportLayer
    class SOURCES,TARGETS,HEALTH_ENDPOINTS extLayer"
/>

---